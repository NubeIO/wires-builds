!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i(i.s=96)}([function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=e.reassignContainer=e.NodeInContainerRegistry=e.ContainerRegistry=void 0;const n=i(17),o=i(13),a=i(28),r=i(21),u=i(16),d=i(25),l=i(18),p=i(30),h=i(38),c=i(5),g=i(41),m=i(11),f=i(22),O=i(4),y=o.create("container",{color:o.Colors.Magenta});class v extends g.DefaultContainerRegistry{constructor(){super(u.IdGenerator.instance())}static instance(){return v._instance||(v._instance=new v),v._instance}rootContainer(){return super.rootContainer()}optimizeBeforeRegister(t,e){const i=super.optimizeBeforeRegister(t,e);if(i.id+""!="0"){let t=this.rootContainer();t.server_dashboard_socket&&(i.server_dashboard_socket=t.server_dashboard_socket),t.server_editor_socket&&(i.server_editor_socket=t.server_editor_socket),t.client_socket&&(i.client_socket=t.client_socket),t.db&&(i.db=t.db),t.dashboard&&(i.dashboard=t.dashboard)}return i}}s([a.ErrorHandler],v.prototype,"optimizeBeforeRegister",null),e.ContainerRegistry=v;class N extends g.DefaultSubNodeRegistry{constructor(t,e,i){super(t,e,i)}parent(){return super.parent()}remove(t,e){var i,s;const n=p.NodeFactory.toSimpleNode(null!==(i=t.cid)&&void 0!==i?i:this.parent().id,null!==(s=t.id)&&void 0!==s?s:t),o=u.IdGenerator.createNodeId(n.cid,n.id);return this.parent().logInfo(`Removing node '${o}' on ${this.parent().side}...`),c.isFolderNode(t)&&(n.sub_container=t.sub_container),Promise.resolve(c.isNode(t)?t:n).then(t=>{var e;return null!==(e=this.globalNodeRegistry.get(t))&&void 0!==e?e:t}).then(t=>{var e;return null!==(e=h.NodeHookHelper.execute(t,"onRemoved"))&&void 0!==e?e:t}).then(t=>{var e;return null!==(e=h.NodeHookHelper.execute(t,"beforeRemoveNode"))&&void 0!==e?e:t}).then(t=>e?t:l.createNodeDbHelper().delete(this.parent().db,n).then(e=>t)).then(t=>super.remove(t,e)).then(t=>{var e;return null!==(e=h.NodeHookHelper.execute(t,"afterRemoveNode"))&&void 0!==e?e:t}).then(t=>(this.parent().logInfo(`Node '${o}' is removed on ${this.parent().side}`),t))}validate(t,e,i){const s=super.validate(t,e,i);if(this.parent().nodeItself()&&this.parent().nodeItself().shouldRejectNodeType(null==s?void 0:s.type))throw new r.RegistryError(`Trying to create non-compatible child node '${s.getReadableId()}' with type `+`'${s.type}' in container '${this.parent().id}'...`,s);return s}doRegister(t,e,i=!1,s){return this.parent().logInfo(`Creating new node '${e.getReadableId()}' on ${this.parent().side}...`),Promise.resolve(e).then(t=>{var e;return null!==(e=h.NodeHookHelper.execute(t,"onCreated"))&&void 0!==e?e:t}).then(t=>s?t:l.createNodeDbHelper().insert(this.parent().db,t).then(e=>t)).then(e=>super.doRegister(t,e,i,s)).then(t=>{var e;return null!==(e=h.NodeHookHelper.execute(t,"onAdded"))&&void 0!==e?e:t}).then(t=>{var e;return null!==(e=h.NodeHookHelper.execute(t,"afterAdded"))&&void 0!==e?e:t}).then(t=>(this.parent().logInfo(`New node '${e.getReadableId()}' is created on ${this.parent().side}`),t))}}e.NodeInContainerRegistry=N,e.reassignContainer=(t,e,i,s)=>(t.sub_container=T.create(t.side,e,t,i,s),t);class T{constructor(t,e,i,s,n,o){var a,r;this.renderers=null,this.side=t,this.id=null!==(a=null!=e?e:null==i?void 0:i.id)&&void 0!==a?a:u.IdGenerator.UNINITIALIZED,this.name=this.id===u.IdGenerator.ROOT?"Main":null!==(r=null==s?void 0:s.name)&&void 0!==r?r:"",this.config=O.default.cloneObject(null==s?void 0:s.config),this._itself=i,this._nodeRegistry=new N(this,n,o),this.clear()}static initRoot(t,e,i){return new T(t,u.IdGenerator.ROOT,null,null,e,i)}static create(t,e,i,s,n){let o=new T(t,null==e?void 0:e.id,i,e,s,n);return o.serializedNodes=null==e?void 0:e.serializedNodes,o}static registerNodeType(t,e,i=null,s=!0,n=!1,o=!1){m.NodeTypeRegistry.registerNodeType(t,e,i,s,n,o)}nodeItself(){return this.id===u.IdGenerator.ROOT?null:this._itself}nodeRegistry(){return this._nodeRegistry}subNodes(){return this.nodeRegistry().list()}getSubNode(t){return this.nodeRegistry().get(t)}clear(){this.stop(),this.isRunning=!1,this.nodeRegistry().clear(),this.iteration=0,this.config={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.starttime=0,this.sendActionToRenderer("clear")}stop(){if(this.isRunning){this.isRunning=!1,this.onStopEvent&&this.onStopEvent(),null!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null;for(let t of this.nodeRegistry().list())t.onStopContainer&&t.onStopContainer()}}attachRenderer(t){t.container&&t.container!=this&&(t.deselectAllNodes(),t.container.detachRenderer(t)),t.container=this,this.renderers||(this.renderers=[]),this.renderers.push(t);for(let e of t.container.nodeRegistry().list())e.boxcolor=t.theme.NODE_DEFAULT_BOXCOLOR,e.setDirtyCanvas(!0,!0)}detachRenderer(t){if(!this.renderers)return;let e=this.renderers.indexOf(t);-1!=e&&(t.container=null,this.renderers.splice(e,1),0==this.renderers.length&&delete this.renderers)}run(t=1){if(this.isRunning)return;this.isRunning=!0,this.onPlayEvent&&this.onPlayEvent();for(let t of this.nodeRegistry().list())t.onRunContainer&&t.onRunContainer();this.starttime=O.default.getTime();let e=this;this.execution_timer_id=setInterval(()=>e.runStep(1),t)}runStep(t=1){let e=O.default.getTime();this.globaltime=.001*(e-this.starttime);for(let e=0;e<t;e++){this.transferDataBetweenNodes();let t=Date.now();for(let e of this.nodeRegistry().list())if((!e.EXECUTE_INTERVAL||e.EXECUTE_INTERVAL&&!e.executeLastTime||e.executeLastTime&&t-e.executeLastTime>=e.EXECUTE_INTERVAL)&&(e.onExecute&&e.onExecute(),e.EXECUTE_INTERVAL&&(e.executeLastTime=t)),e.isUpdated&&(!e.UPDATE_INPUTS_INTERVAL||e.UPDATE_INPUTS_INTERVAL&&!e.updateInputsLastTime||e.updateInputsLastTime&&t-e.updateInputsLastTime>=e.UPDATE_INPUTS_INTERVAL)){e.onInputUpdated&&e.onInputUpdated(),e.isUpdated=!1;for(let t in e.inputs)e.inputs[t].updated&&(e.inputs[t].updated=!1);e.UPDATE_INPUTS_INTERVAL&&(e.updateInputsLastTime=t)}this.fixedtime+=this.fixedtime_lapse,this.onExecuteStep&&this.onExecuteStep()}this.onAfterExecute&&this.onAfterExecute();let i=O.default.getTime()-e;0==i&&(i=1),this.elapsed_time=.001*i,this.globaltime+=.001*i,this.iteration+=1}transferDataBetweenNodes(){var t;for(let e of this.nodeRegistry().list())if(e.outputs)for(let i in e.outputs){let s=e.outputs[i];if(s.updated&&(s.updated=!1,null!=s.links))for(let i of s.links){let n=this.nodeRegistry().get(i.nodeId);if(!n){this.debugErr(`Can't transfer data from node ${e.getReadableId()}. Target node not found`);continue}let o=null!==(t=i.ioId)&&void 0!==t?t:i.slot,a=n.inputs[o];if(!a)return;a.data=O.default.parseValue(s.data,a.type),n.isUpdated=!0,a.updated=!0}}}getTime(){return this.globaltime}sendActionToRenderer(t,e){if(this.renderers)for(let i=0;i<this.renderers.length;++i){let s=this.renderers[i];s[t]&&s[t].apply(s,e)}}getNodes(t=!1){let e=[];return function i(s){for(let n of s)e.push(n),t&&c.isFolderNode(n)&&i(n.sub_container.nodeRegistry().list())}(this.nodeRegistry().list()),e}getNodesByType(t,e=!1){t=t.toLowerCase();let i=[];for(let e of this.nodeRegistry().list())e.type.toLowerCase()==t&&i.push(e);if(e)for(let e of this.nodeRegistry().list())if(e instanceof d.ContainerNode){e.sub_container.getNodesByType(t,!0).forEach(t=>i.push(t))}return i}getNodesByClass(t,e=!1){let i=[];for(let e of this.nodeRegistry().list())e instanceof t&&i.push(e);if(e)for(let e of this.nodeRegistry().list())if(e instanceof d.ContainerNode){e.sub_container.getNodesByClass(t,!0).forEach(t=>i.push(t))}return i}getAllNodes(t,e=0){let i=[];return(null!=t?t:this.nodeRegistry().list()).forEach(t=>{t instanceof d.ContainerNode?i.push({id:t.sub_container.id,name:t.sub_container.name,parentId:e,list:this.getAllNodes(t.sub_container.nodeRegistry().list(),t.sub_container.id),isContainer:!0,iconImageUrl:t.iconImageUrl,icon:t.icon}):i.push({id:t.id,parentId:e,name:t.name?`${t.name}: ${t.title}`:t.title,isContainer:!1,iconImageUrl:t.iconImageUrl,icon:t.icon})}),i.sort((t,e)=>t.isContainer&&e.isContainer?t.id-e.id:t.isContainer&&!e.isContainer?-1:1)}setDirtyCanvas(t,e){this.sendActionToRenderer("setDirty",[t,e])}runWithEditor(t){const e=n.get(this,"renderers[0].editor");e&&t(e)}serialize(){return{id:this.id,name:this.name,config:this.config,serializedNodes:this.nodeRegistry().list().map(t=>f.SerializableHelper.serialize(t))}}logInfo(t){y.info(`[${this.id}] ${t}`)}debug(t){y.debug(`[${this.id}] ${t}`)}debugWarn(t){y.warn(`[${this.id}] ${t}`)}debugErr(t){y.error(`[${this.id}] ${t}`)}}e.Container=T},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.convertType=e.convertSettingType=e.SettingType=e.convertStringToType=e.NodeInput=e.NodeOutput=e.NodeSetting=e.Type=void 0;const s=i(6),n=i(19),o=i(22);var a,r;!function(t){t.STRING="string",t.NUMBER="number",t.BOOLEAN="boolean",t.ANY="any",t.JSON="json",t.DROPDOWN="dropdown"}(a=e.Type||(e.Type={}));class u{constructor(t,e,i,s,n,o){this.description=t,this.type=e,this.value=i,this.config=s,this.validation=n,this.toJSON=o}static create(t){return new u(t.description,t.type,t.value,t.config,t.validation,t.toJSON)}serialize(){return{description:this.description,type:this.type,config:o.SerializableHelper.serialize(this.config),value:o.SerializableHelper.serialize(this.value)}}deserialize(t){return u.create(t)}}e.NodeSetting=u;class d{constructor(t,e,i,s,n,o,a,r,u){this.name=t,this.type=e,this.label=i,this.locked=s,this.pos=n,this.round=o,this.subNodeId=u,this.data=a,this.updated=r}serialize(){return{name:this.name,type:this.type,label:this.label,locked:this.locked,pos:this.pos,round:this.round,subNodeId:this.subNodeId}}}class l extends d{constructor(t,e,i,o,a,r,u,d,l,p){super(t,e,o,a,r,u,d,l,p),this.links=s.isEmpty(i)?[]:i.map(t=>n.Link.create(t))}static create(t){return new l(t.name,t.type,t.links,t.label,t.locked,t.pos,t.round,t.data,t.updated,t.subNodeId)}serialize(){var t;return Object.assign(Object.assign({},super.serialize()),{links:null===(t=this.links)||void 0===t?void 0:t.map(t=>o.SerializableHelper.serialize(t))})}deserialize(t){return l.create(Object.assign({},t))}}e.NodeOutput=l;class p extends d{constructor(t,e,i,s,o,a,r,u,d,l,p,h){super(t,e,a,r,u,d,l,p,h),this.link=n.Link.create(s),this.isOptional=o,this.setting=i}static create(t){return new p(t.name,t.type,t.setting,t.link,t.isOptional,t.label,t.locked,t.pos,t.round,t.data,t.updated,t.subNodeId)}serialize(){return Object.assign(Object.assign({},super.serialize()),{link:o.SerializableHelper.serialize(this.link),setting:o.SerializableHelper.serialize(this.setting),isOptional:this.isOptional})}deserialize(t){return p.create(Object.assign({},t))}}e.NodeInput=p,e.convertStringToType=t=>{switch(t){case a.STRING:return a.STRING;case a.NUMBER:return a.NUMBER;case a.BOOLEAN:return a.BOOLEAN;case a.JSON:return a.JSON}return a.ANY},function(t){t.STRING="string",t.NUMBER="number",t.BOOLEAN="boolean",t.READONLY="readonly",t.DROPDOWN="dropdown",t.TREE_SELECT="treeselect",t.AUTOCOMPLETE="autocomplete",t.CODE_AREA="codearea",t.PASSWORD="password",t.GROUP="group"}(r=e.SettingType||(e.SettingType={})),e.convertSettingType=t=>{switch(t){case r.STRING:return a.STRING;case r.NUMBER:return a.NUMBER;case r.BOOLEAN:return a.BOOLEAN}return a.ANY},e.convertType=t=>{switch(t){case a.STRING:return r.STRING;case a.NUMBER:return r.NUMBER;case a.BOOLEAN:return r.BOOLEAN;case a.DROPDOWN:return r.DROPDOWN}return r.STRING}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NODE_INFO=void 0;const s=i(40),n=i(108);e.NODE_INFO={boolean:{and:{title:"AND",description:"Performs a logical 'AND' operation (output 'true' when ALL inputs are 'true'). You can specify the number of inputs in the node settings."},"min-on-off":{title:"Min On Off",description:"‘output’ matches ‘input’ but is delayed by the 'minOn' and 'minOff' durations. ‘output’ will remain 'true' for 'minOn' duration then match the ‘input’ value. ‘output’ will remain 'false' for 'minOff' duration then match the ‘input’ value. 'minOn' and 'minOff' delays are cancelled when 'reset' transitions from 'false' to 'true. ‘minOn active’ is ‘true’ during ‘minOn’ periods. ‘minOff active’ is ‘true’ during ‘minOff’ periods.  'minOn' and 'minOff' units can be configured from settings. Maximum ‘minOn’ and ‘'minOff'’ setting is 587 hours.   (See Figure A.)"},not:{title:"NOT",description:"Performs a logical 'NOT' operation (output will be the inverse of the input)."},"off-delay":{title:"Off Delay",description:"‘output’ matches ‘input’, but ‘output’ transitions from 'true' to 'false' are delayed by 'delay' duration. The delay is cancelled when 'reset' transitions from 'false' to 'true. ‘offDelay active’ is ‘true’ during ‘offDelay’ periods. 'delay' units can be configured from settings.  Maximum ‘delay’ setting is 587 hours. (See Figure A.)"},"on-delay":{title:"On Delay",description:"‘output’ matches ‘input’, but ‘output’ transitions from 'false' to 'true' are delayed by 'delay' duration. The delay is cancelled when 'reset' transitions from 'false' to 'true. ‘onDelay active’ is ‘true’ during ‘onDelay’ periods. 'delay' units can be configured from settings. Maximum ‘delay’ setting is 587 hours.  (See Figure A.)"},"one-shot":{title:"One Shot",description:"Triggers output to 'true' for 'interval' duration when 'trigger' input transitions from 'false' to 'true.  Output is reset to 'false' when 'reset' transitions from 'false' to 'true. 'interval' units can be configured from settings. Maximum ‘interval’ setting is 587 hours. (See Figure A.).  If 'Retrigger While Output Is 'true'' setting is false, then 'fire' input transitions will have an effect when output is 'false'."},or:{title:"OR",description:"Performs a logical 'OR' operation (output 'true' when ANY input is 'true'). You can specify the number of inputs in the node settings."},ticker:{title:"Ticker",description:"While 'enable' is 'true', ‘output’ will change to 'true' at every 'interval' period. If 'Generate False' setting is set to ‘true’, ‘output’ will be 'false' for the second half of the 'interval' period. When 'enable' is 'false', ‘output’ will be 'false'. 'interval' units can be configured from settings.  Maximum ‘interval’ setting is 587 hours.  (See Figure A.)"},toggle:{title:"Toggle",description:"When the 'input' transitions from 'false' to 'true', 'output' will switch between 'false'/'true'.   (See Figure A.)"},xor:{title:"XOR",description:"Performs a logical 'XOR' operation (output 'true' when EITHER input is 'true', but not both). Limited to only 2 inputs."}},cumulocity:{"cumulocity-device":{title:"Cumulocity Device",description:"see https://cumulocity.com/guides/concepts/introduction/"},"cumulocity-point":{title:"Cumulocity Point (History)",description:"see https://cumulocity.com/guides/concepts/introduction/"},"cumulocity-alarm":{title:"Cumulocity Alarm",description:"see https://cumulocity.com/guides/concepts/introduction/"},"cumulocity-operation":{title:"Cumulocity Operation",description:"see https://cumulocity.com/guides/concepts/introduction/"}},compare:{between:{title:"Between",description:"'output' is 'true' when 'in 1' is within the numeric range between 'from' value and 'to' value (exclusive), otherwise 'output' is 'false'.  'output' will be 'false' if either input is undefined. 'outp not' is always the opposite of 'output'."},equal:{title:"Equal",description:"'output equal' is 'true' when 'in 1' and 'in 2' are identical, otherwise 'output equal' is 'false'.  Can be used to compare boolean, numeric, and string values; it can also be used to compare 'null' values. 'output not equal' is always the opposite of 'out equal'."},"greater-than":{title:"Greater than",description:"'out >' is 'true' when 'in 1' is greater than 'in 2', otherwise 'out >' is 'false'. 'out >=' is 'true' when 'in 1' is greater than or equal to 'in 2', otherwise 'out>=' is 'false'.  Both Outputs will be 'false' if either input is undefined."},hysteresis:{title:"Hysteresis",description:"Boolean 'output' based on 'input' in relation to 'risingEdge' and 'fallingEdge' setpoints.  There are 2 cases: 'risingEdge' greater than 'fallingEdge', and 'risingEdge' less than 'fallingEdge'. [For 'risingEdge' > 'fallingEdge'] => 'output' is 'true' when 'input' is greater than 'risingEdge'.  'output' is  'false' when 'input' is less than 'fallingEdge'. [For 'fallingEdge' < 'fallingEdge'] => 'output' is 'false' when 'input' is greater than 'risingEdge'.  'output' is 'true' when 'input' is less than 'fallingEdge'.  In both cases, when 'input' is between 'risingEdge' and 'fallingEdge', 'output' will remain in its current state."},"less-than":{title:"Less than",description:"'out <' is 'true' when 'in 1' is less than 'in 2', otherwise 'out <' is 'false'.  'out <=' is 'true' when 'in 1' is less than or equal to 'in 2', otherwise 'out <=' is 'false'.  Both outputs will be 'false' if either input is undefined."},"type-check":{title:"Type Check (string)",description:"'output' is 'true' when 'input' type matches 'Type to check' setting.  'isType' outputs the type of the 'input' value."}},connection:{"dispatch-listener":{title:"Dispatch Listener",description:"Listens dispatch values",iconImageUrl:s.default.aiIcon},"link-transmitter-single":{title:"Link Transmitter Single",description:"This node works in conjunction with link-receiver node, and provides a connection of nodes without the graphical wires. ‘in #’ inputs will be sent to the corresponding ‘out #’ output on link-receiver nodes with matching ‘Channel Number’ settings. The number of inputs is configurable from settings.",iconImageUrl:s.default.aiIcon},"link-receiver-single":{title:"Link Receiver Single",description:"This node works in conjunction with link-transmitter node and provides a connection of nodes without the graphical wires. ‘out #’ outputs will match the corresponding ‘in #’ input from link-transmitter nodes with matching ‘Channel Number’ settings. The number of outputs is configurable from settings.",iconImageUrl:s.default.aiIcon},"link-transmitter":{title:"Link Transmitter",description:"This node works in conjunction with link-receiver node, and provides a connection of nodes without the graphical wires. ‘in #’ inputs will be sent to the corresponding ‘out #’ output on link-receiver nodes with matching ‘Channel Number’ settings. The number of inputs is configurable from settings."},"link-receiver":{title:"Link Receiver ",description:"This node works in conjunction with link-transmitter node and provides a connection of nodes without the graphical wires. ‘out #’ outputs will match the corresponding ‘in #’ input from link-transmitter nodes with matching ‘Channel Number’ settings. The number of outputs is configurable from settings."},hub:{title:"Hub",description:"This node merges multiple inputs into a single stream/output.  Any new 'input' ('in #') value will be passed to 'output'.  The number of inputs can be modified from settings."}},container:{folder:{title:"Folder",description:"Contains other nodes"},"folder-input":{title:"Folder Input",description:"Input of the container",iconImageUrl:s.default.aiIcon},"folder-output":{title:"Folder Output",description:"Output of the container",iconImageUrl:s.default.aiIcon}},conversion:{"bit-mask-single":{title:"Bit Mask Single",description:"A node to mask a single bit of a byte"},"bit-mask-multiple":{title:"Bit Mask Multiple",description:"A node to mask certain bits of a byte"},"int-to-bits":{title:"Bit Split",description:"A node to split an Int (or Int array) into all individual bits\nAssuming all Ints are 8 bits (UINT8)"},"bool-to-int":{title:"Bool-to-Int Conversion",description:"This node converts a Boolean to a Number."},"int-to-bool":{title:"Int-to-Bool Conversion",description:"This node converts a Number to a Boolean."},"string-to-bool":{title:"String-to-Bool Conversion",description:"This node converts a String to a Boolean."},"buffer-to-hex-string":{title:"Buffer to hex string",description:""},"buffer-to-num":{title:"Buffer To Num",description:"A node to convert byte array (string or json array) (8bit words or 16bit words) to a num with Big-endian And Little-endian format. Example [16691, 34079] = 11.22 (BEB_BEW, FLOAT32)"},"convert-units":{title:"Unit converter",description:"This node converts units."},"hex-string-to-buffer":{title:"Hex string to Buffer",description:""},"int-to-buffer":{title:"Int to Buffer",description:"A node to convert an int to a buffer array to an int with Big-endian And Little-endian format. This node is used for testing data types"}},count:{"any-event-counter":{title:"Any Event Counter",description:"‘count' increases by 1 every time an event occurs at 'input'. Any incoming value, including null, will be taken. 'count' will be reset to 0 when 'reset' transitions from 'false' to 'true.  ‘toggle’ will alternate between ‘true’ and ‘false’, changing each time count increases."},counter:{title:"Counter",description:"'count' increases by 1 every time 'countUp' transitions from 'false' to 'true.  'count' decreases by 1 every time 'countDown' transitions from 'false' to 'true.  'count' will be set to 'set value' when 'reset' transitions from 'false' to 'true."},"interval-ramp":{title:"Interval Ramp",description:"‘output' changes at every 'interval' period, while 'enable' is set to 'true'. 'output' will change by the 'step' value on each change (if a full 'step' would cause the output to be greater than 'max', or less than 'min' it will be limited by 'max' or 'min' respectively). 'output' will first ramp up to 'max' then it will change directions and ramp down to 'min'. 'output' will be reset to 'min' when 'reset' transitions from 'false' to 'true. If ‘Ramp Up Only’ setting is ticked, the ramp down stage will be bypassed and ‘output’ will be reset back to ‘min’ value when it reaches the ‘max’ value. 'interval’ units can be configured from settings.  Maximum ‘interval’ setting is 587 hours."},"triggered-ramp":{title:"Triggered Ramp",description:"'output' changes on every time 'trigger' transitions from 'false' to 'true'. If 'count on true->false?' setting is enabled, 'output' will also change on 'false' to 'true' transition.   'output' will change by the 'step' value on each change (if a full 'step' would cause the output to be greater than 'max', or less than 'min' it will be limited by 'max' or 'min' respectively).  'output' will first ramp up to 'max' then it will change directions and ramp down to 'min'.  'output' will be reset to 'min' when 'reset' transitions from 'false' to 'true."},waveform:{title:"Waveform",description:"This node generates a sequence of numbers based on the selected settings; these sequences (waveforms) are of the form 'Ramp', 'Sine', 'Square', 'Triangle', and 'Sawtooth'. While 'enable' is 'true', 'output' will produce the next number in the sequence after every 'interval' duration. The period (how often the waveform pattern repeats) is defined by 'period'. The amplitude of the waveform is defined by 'amplitude'. The waveform can be inverted by setting 'Invert Output' to 'true' in settings. The waveform will reset to its starting position if 'reset' transitions from 'false' to 'true'.  'interval' and ‘period’ units can be configured from settings.  Maximum 'interval' and ‘period’ setting is 587 hours."}},csv:{"csv-merge-columns":{title:"CSV Merge Columns",description:"This node merges the columns of properly formatted CSV strings.  ‘merge’ CSV string will be joined with the ‘original’ CSV string.  The ‘merge’ CSV columns will be added to the right of the ‘original’ CSV columns.  ‘null’ will be added to rows where no value exists for that column.  No error checking."},"csv-merge-rows":{title:"CSV Merge Rows",description:"This node merges the rows of properly formatted CSV strings.  ‘merge’ CSV string will be joined with the ‘original’ CSV string.  The ‘merge’ CSV rows will be added below the ‘original’ CSV rows.  Only the ‘original’ header titles will be kept.  No error checking."}},"custom-function":{"fan-out-function":{title:"Fan-Out Function",description:'Evaluates a code block upon message reception, and sends results to multiple outputs. The incoming value is accessible through the variable named "message". Values can be emitted by using emit(index, value), where the index specifies the outlet. Emit can be called multiple times.'},"merge-function":{title:"Merge Function",description:'Evaluates a code block upon message reception. The incoming values is accessible by index in the array named "messages". The "return" value will be emitted through the outlet, unless that value is null. The script runs every time any inlet receives a value.'},function:{title:"Function",description:"Evaluates a code block upon message reception. The incoming value is accessible through the variable named “message”. The “return” value will be emitted through the outlet. Null values are ignored."},uuid:{title:"UUID",description:"A node function to create a UUID identifier. A universally unique identifier (UUID) is an identifier standard used in software construction. A UUID is simply a 128-bit value. The meaning of each bit is defined by any of several variants. For human-readable display, many systems use a canonical format using hexadecimal text with inserted hyphen characters. For example : de305d54-75b4-431b-adb2-eb6b9e546014"}},dashboard:{button:{title:"Button",description:"Dashboard node which displays a push button on the dashboard.  When clicked it will send 'true' from the node 'output'."},label:{title:"Label",description:"Dashboard node which displays inputed values on the dashboard."},log:{title:"Log",description:"Dashboard node which displays a log of the values wired into 'input', these log entries have timestamps attached.  There is an option in settings to save the log entries to the Wires Database (DB)."},progress:{title:"Progress",description:"Dashboard node which displays 'input' value from 0-100 on a progress bar on the dashboard."},slider:{title:"Slider",description:"Dashboard node which displays an input slider bar on the dashboard.  The user can move the slider bar knob to adjust the output between 0 and 100.  The slider can be overridden by wiring a Numeric into the node 'input'."},switch:{title:"Switch",description:"Dashboard node which displays a toggle switchon the dashboard.  When clicked it will switch the node 'output' between 'true' and 'false'.  The button text can be edited in settings.  The button can be overridden by wiring a Boolean into the node 'input'."},"text-box":{title:"Text-Box",description:"Dashboard node which provides a user input text box on the dashboard.  The entered string is sent from the node 'output'.  The text-box can be overridden by wiring a String into the node 'input'."},chart:{title:"Chart",description:"Dashboard node which displays a chart of the values wired into 'input'.  Chart properties and types can be modified in settings.  There is an option in settings to save the chart entries to the Wires Database (DB)."}},debug:{console:{title:"Console",description:"Show value inside the console"},comments:{title:"Comments",description:"This node is simply for adding some code comments"},watch:{title:"Watch",description:"Show value of input"}},error:{"link-check":{title:"Link Error Check",description:"This node is designed to check that links have the same value on both ends"},"output-check":{title:"Output Error Check",description:"This node is designed to check that outputs have a 'data' value"}},filter:{"only-true":{title:"Only True",description:"This node filters ‘input’ values. Only ‘true’ values are passed to ‘output’."},"only-false":{title:"Only False",description:"This node filters ‘input’ values. Only ‘false’ values are passed to ‘output’."},"only-between":{title:"Only Between",description:"This node filters ‘input’ values. Only Numeric ‘input’ values between ‘min’ and ‘max’ are passed to ‘output’."},"only-greater":{title:"Only Greater",description:"This node filters ‘input’ values. Only Numeric ‘input’ values greater than ‘threshold’ are passed to ‘output’."},"only-lower":{title:"Only Lower",description:"This node filters ‘input’ values. Only Numeric ‘input’ values less than ‘threshold’ are passed to ‘output’."},"only-equal":{title:"Only Equal",description:"This node filters ‘input’ values. Only ‘input’ values equal to ‘match’ are passed to ‘output’."},"prevent-null":{title:"Prevent Null",description:"This node filters ‘input’ values. All ‘input’ values are passed to ‘output’ EXCEPT ‘null’."},"prevent-equal":{title:"Prevent Equal",description:"This node filters ‘input’ values. All ‘input’ values are passed to ‘output’ EXCEPT ‘input’ values which are equal to ‘match’."},"prevent-duplicates":{title:"Prevent Duplicates",description:"This node filters ‘input’ values. All ‘input’ values are passed to ‘output’ EXCEPT ‘input’ values which are equal to the previous ‘input’ value."},"reduce-duplicates":{title:"Reduce Duplicates",description:"This node reduces the number of duplicated transmitted values. When the value on the input is changed, the node sends it to the output and stops receiving the same value at a specified time interval. The values that come at this time and that are the same are simply ignored, but the last value will be stored if it is enabled in the settings. When the interval passes, the last value is sent to the output. This reduces the number of events, if they are sent too often, but ensures that the node will always send the last actual value. You can disable the sending of the last value in the settings of the node. This may be necessary if you do not want to receive messages late, but then it is not guaranteed that the nodes connected to this node will have the last actual value. If you activate Reset pin, the node will reset the timer and send the last value, if it is enabled in the settings."},"reduce-events":{title:"Reduce Events",description:"This node reduces the number of transmitted values. When the value on the input is changed, the node sends it to the output and stops receiving at a specified time interval. The values that come at this time are simply ignored, but the last value will be stored if it is enabled in the settings. When the interval passes, the last value is sent to the output. This reduces the number of events, if they are sent too often, but ensures that the node will always send the last actual value. You can disable the sending of the last value in the settings of the node. This may be necessary if you do not want to receive messages late, but then it is not guaranteed that the nodes connected to this node will have the last actual value. If you activate Reset pin, the node will reset the timer and send the last value, if it is enabled in the settings."}},history:{"data-store":{title:"Data Store",description:"The data-store node is used to store history log data locally. The data-store node has limited memory so the capacity is limited to 50 log entries; beware of using too many data-store nodes as it could affect the operation of Wires. The history logs can be configured to log in UTC or local timezone, and the output format can be set to ‘Array’, ‘CSV’, or ‘JSON’. If ‘Round up in increments of’ setting is used (not zero), then the timestamp will be rounded up to the nearest increment value step."},"influx-db":{title:"Influx-DB",description:"A node for sending data to influxDB"},"influx-db-2":{title:"Influx-DB-2",description:"A node for sending data to influxDB v2"},persistence:{title:"Point Persistance",description:"This node is used when you want to store the node output on a restart and also to not pass to the output any null values. While ‘enable’ is ‘true’, ‘output’ will send ‘input’ value at every ‘interval’ period. When ‘enable’ is ‘false’, ‘output’ will be ‘null’. ‘interval’ units can be configured from settings. Maximum ‘interval’ setting is 587 hours. On a trigger input the output will be sent even if the enable is set to false"}},hvac:{deadband:{title:"Deadband",description:"This node applies a Hysteresis function (see hysteresis node), with a deadband centered at ‘setpoint’. The ON direction can be reversed from settings."},thermostat:{title:"Heat/Cool Thermostat",description:"This node functions as a Heat/Cool thermostat. While ‘enable’ is set to ‘true’, the node will function as follows: ‘CLG Mode’ will be set to ‘true’ if ‘input’ is greater than ‘setpoint’ + ‘CLG offset’, ‘CLG Mode’ will be set to ‘false’ if ‘input’ is less than ‘setpoint’. ‘HTG Mode’ will be set to ‘true’ if ‘input’ is less than ‘setpoint’ - ‘HTG offset’, ‘HTG Mode’ will be set to ‘false’ if ‘input’ is greater than ‘setpoint’. If ‘enable’ is ‘false’, ‘CLG Mode’ and ‘HTG Mode’ will both be set to ‘false’."},"pac-unit-control":{title:"PAC Unit Control",description:"This node functions as a Heat/Cool thermostat. While ‘enable’ is set to ‘true’, the node will function as follows: ‘CLG Mode’ will be set to ‘true’ if ‘input’ is greater than ‘setpoint’ + ‘CLG offset’, ‘CLG Mode’ will be set to ‘false’ if ‘input’ is less than ‘setpoint’. ‘HTG Mode’ will be set to ‘true’ if ‘input’ is less than ‘setpoint’ - ‘HTG offset’, ‘HTG Mode’ will be set to ‘false’ if ‘input’ is greater than ‘setpoint’. If ‘enable’ is ‘false’, ‘CLG Mode’ and ‘HTG Mode’ will both be set to ‘false’."},PID:{title:"PID",description:"This node generates a PID ‘output’ based on input parameter settings. Inputs: Enable, Setpoint, Process Variable, inP (Proportional), inI (Integral), inD (Derivative), Direction, Interval, MaxOut, MinOut, Manual, and Bias. If ‘direction’ is ‘true’ the PID will be a Direct loop (‘output’ increases when ‘processVariable’ > ‘setpoint’), if ‘direction’ is ‘false’ the PID will be a Reverse loop (‘output’ increases when ‘processVariable’ < ‘setpoint’). ‘interval’ is the period that the PID output is re-calculated. ‘bias’ value is added to ‘output’. ‘manual’ will be the ‘output’ value when ‘enable’ is ‘false’. PID integral factor will be reset to 0 when ‘reset’ transitions from ‘false’ to ‘true’. 'interval’ units can be configured from settings. Maximum ‘interval’ setting is 587 hours."},"toggle-duration":{title:"Toggle Duration",description:"This node accepts a ‘pushButton’ input which triggers ‘output’ to ‘true’ for the ‘runtime’, or until ‘pushButton’ transitions from ‘false’ to ‘true’ within the ‘runtime’ period"},psychrometrics:{title:"Psychrometric Calcs (Metric/SI)",description:"This node provides psychrometric calculations based on a selection of: Dry Bulb Temp, Wet Bulb Temp, Dew Point, Relative Humidity, and Pressure. Inputs and Outputs as follows: (i) Dry bulb temperature in °F [IP] or °C [SI]; (i) Wet bulb temperature in °F [IP] or °C [SI]; (i) Atmospheric pressure in Psi [IP] or Pa [SI]; (o) Humidity ratio in lb_H₂O lb_Air⁻¹ [IP] or kg_H₂O kg_Air⁻¹ [SI]; (o) Dew point temperature in °F [IP] or °C [SI]; (o) Relative humidity [0-1]; (o) Partial pressure of water vapor in moist air in Psi [IP] or Pa [SI]; (o) Moist air enthalpy in Btu lb⁻¹ [IP] or J kg⁻¹ [SI]; (o) Specific volume ft³ lb⁻¹ [IP] or in m³ kg⁻¹ [SI]. Input types can be selected from settings. Outputs will change based on selected input type. Unit system can be set from settings to be in: Metric/SI or Imperial/IP."},"energy-conversion":{title:"Energy Conversion (W·h)",description:"This node converts between Energy units watt-hour (W·h), kilowatt-hour (kW·h), British Thermal Unit (Btu), calorie (cal), joule(J), and joule(kJ). Input type can be selected from settings. Outputs will change based on selected input type."},"power-conversion":{title:"Power Conversion (kW)",description:"This node converts between Power units kilowatt (kW), Tons of Refrigeration (tons), British Thermal Unit per hour (Btu/h), and Electrical Horsepower (hp). Input type can be selected from settings. Outputs will change based on selected input type."},"volume-conversion":{title:"Volume Conversion (L)",description:"This node converts between Volume units Litre (L), Cubic Metre (m³), Cubic Foot (ft³), and Gallon (gal). Input type can be selected from settings. Outputs will change based on selected input type."},"temperature-conversion":{title:"Temperature Conversion (C-> F)",description:"This node converts between Temperature units: Celsius, Fahrenheit, Kelvin, and Rankine . Input type can be selected from settings. Outputs will change based on selected input type."},"atmospheric-pressure":{title:"Atmospheric Pressure (Meters-> Pa)",description:"This node converts ‘altitude’ to Atmospheric Pressure in various units: Pascal (Pa), Standard Atmosphere (atm), Bar (bar), and Pound-force per square inch (lbf/in2) . ‘altitude’ units can be set from settings to be in: Metric/SI (Meters-> Pa), or Imperial/IP (Feet-> Psi)."},"pressure-conversion":{title:"Pressure Conversion (Pa)",description:"This node converts between Pressure units: Pascal (Pa), Standard Atmosphere (atm), Bar (bar), and Pound-force per square inch (lbf/in2) . Input type can be selected from settings. Outputs will change based on selected input type."},"actuator-sizing":{title:"Actuator Sizing",description:"This node provides a calculation for sizing of damper actuators based on cross sectional area."},"k-factor":{title:"K Factor",description:"This node computes the K Factor (Airflow Multiplier) based on Airflow(air hood), Differential Pressure, and Duct Area. This is frequenty used in VAV applications."},"dp-airflow":{title:"DP Airflow",description:"This node computes the Airflow based on a Differential Pressure, Duct Area, and a K-Factor. This is frequenty used in VAV applications."},"lead-lag-staging":{title:"Lead Lag Staging",description:"This node provides enable signals to equipment in a Lead-Lag configuration."},"lead-lag-switch":{title:"Lead Lag Switch",description:"This node rotates the lead unit between A and B when 'rotate' is toggled."}},json:{"array-builder":{title:"Array Builder",description:"Outputs an array of values based on the input values"},"array-builder-number":{title:"Array Builder Number",description:"Outputs an array of values based on the input values as numbers"},"array-combine":{title:"Array Combine",description:"This node will combine two array into one array"},"json-builder":{title:"JSON builder",description:"JSON builder"},"json-enum-builder":{title:"JSON enum builder",description:"JSON enum builder"},"json-filter":{title:"Json Filter",description:"Filter a json object Example: msg.myKey"},"json-obj-filter":{title:"Json Array Of Object Filter",description:"Filter a json object Example: msg.myKey"},"json-prevent-duplicates":{title:"Json Prevent Duplicates",description:"This node takes a json input and will return the json input if a value has changed"},"json-filter-compare":{title:"Json Comparison Compare (Equals)",description:"This node provides several functions to compare a JSON object input, with a Boolean ‘output’. Available comparison functions are: Equals, Includes, Starts With, and Ends With. The comparison function is selected from settings."},"json-filter-multiple":{title:"Json Filter Multiple",description:"Filter a json object to multiple outputs. There are two Output Update options for whether you want to update all keys or not (ALL: update as `null` when the key value will not be on the JSON, FOUND: don't update values and leave as is when key key value doesn't exist"},"json-checker":{title:"JSON Checker",description:"Checks ‘input’ for valid JSON format string."},"json-parse":{title:"Json Parse",description:"Return JSON.stringify or a JSON.parse"},"json-query":{title:"Json Query (JSONata)",description:"Filter a json data using JSONata http://docs.jsonata.org/overview"},"json-forEach-functions":{title:"Json ForEach functions",description:"Return json object values."},"json-keys":{title:"Json Keys",description:"Return json object values. Example: Object.keys(in)"}},latch:{"any-latch":{title:"Any data type Latch",description:"The ‘input’ value (Input value can be any data type) is passed to ‘output’ when ‘latch’ transitions from ‘false’ to ‘true’; The ‘output’ value is maintained until the next ‘false’ to ‘true’ transition."},"bool-latch":{title:"Boolean Latch",description:"The Boolean ‘input’ value is passed to ‘output’ when ‘latch’ transitions from ‘false’ to ‘true’; The ‘output’ value is maintained until the next ‘false’ to ‘true’ transition."},"num-latch":{title:"Numeric Latch",description:"The Numeric ‘input’ value is passed to ‘output’ when ‘latch’ transitions from ‘false’ to ‘true’; The ‘output’ value is maintained until the next ‘false’ to ‘true’ transition."},"string-latch":{title:"String Latch",description:"The String ‘input’ value is passed to ‘output’ when ‘latch’ transitions from ‘false’ to ‘true’; The ‘output’ value is maintained until the next ‘false’ to ‘true’ transition."},"set-reset":{title:"Set Reset",description:"‘output’ will change to ‘true’ when ‘set’ is ‘true’, and ‘reset’ is ‘false’. There are 2 cases when ‘output’ will change to ‘false’: 1) ‘reset’ is ‘true’, and 'set is ‘false’. 2) If the ‘Reset when set=true’ setting is turned ON (Default), and ‘reset’ and ‘set’ are both ‘true’ . If this setting is turned OFF, ‘output’ will only change to ‘false’ under Case 1) conditions."}},math:{add:{title:"Add",description:"(‘output’ = ‘in 1’ + ‘in 2’ + …) ‘output’ is the result of adding of all Numeric inputs. Input values can be set from settings. The number of inputs is configurable from settings."},subtract:{title:"Subtract",description:"(‘output’ = ‘in 1’ - ‘in 2’ - …) ‘output’ is the result of subtracting each Numeric input in order. Input values can be set from settings. The number of inputs is configurable from settings."},multiply:{title:"Multiply",description:"(‘output’ = ‘in 1’ * ‘in 2’ * …) ‘output’ is the result of multiplying each Numeric input in order. Input values can be set from settings. The number of inputs is configurable from settings."},divide:{title:"Divide",description:"(‘output’ = ‘in 1’ / ‘in 2’ / …) ‘output’ is the result of dividing each Numeric input in order. Input values can be set from settings. The number of inputs is configurable from settings."},absolute:{title:"Absolute",description:"(‘output’ = |‘in 1’|) ‘output’ is the absolute value (positive) of the Numeric input."},modulus:{title:"Modulus",description:"(‘output’ = ‘in 1’ % ‘in 2’) ‘output’ is the modulus of the Numeric inputs. Input values can be set from settings."},power:{title:"Power",description:"(‘output’ = ‘in 1’ ^ ‘in 2’) ‘output’ is the result of ‘in 1’ to the power of ‘in 2’. Input values can be set from settings."},"flexible-math":{title:"Flexible Math",description:""}},"math-advanced":{acos:{title:"Acos",description:"‘acos(x)’ is the result of arccos(‘x’). The Inverse Cosine function of input ‘x’."},asin:{title:"Asin",description:"‘asin(x)’ is the result of arcsin(‘x’). The Inverse Sine function of input ‘x’."},atan:{title:"Atan",description:"‘atan(x)’ is the result of arctan(‘x’). The Inverse Tangent function of input ‘x’."},cbrt:{title:"Cbrt",description:"‘cbrt(x)’ is the Cubic Root of input ‘x’."},cos:{title:"Cos",description:"‘cos(x)’ is the result of cos(‘x’). The Cosine function of input ‘x’."},exp:{title:"Exp",description:"(‘exp(x)’ = E^‘x’) ‘exp(x)’ is the result of raising E (Euler’s Number 2.71828) to the power of ‘x’. The Natural Exponential function."},log:{title:"Logarithm (Base E)",description:"‘log(x)’ is the result of log(‘x’) with base E (Euler’s Number 2.71828). The Natural Logarithmic function of input ‘x’."},log10:{title:"Logarithm (Base 10)",description:"‘log10(x)’ is the result of log(‘x’) with base 10."},sin:{title:"Sin",description:"‘sin(x)’ is the result of sin(‘x’). The Sine function of input ‘x’."},sqrt:{title:"Sqrt",description:"‘sqrt(x)’ is the Square Root of input ‘x’."},tan:{title:"Tan",description:"‘tan(x)’ is the result of tan(‘x’). The Tangent function of input ‘x’."}},"math-trigger":{"trigger-add":{title:"Trigger Add",description:"When ‘trigger’ transitions from ‘false’ to ‘true’, ‘output’ is updated with the result of the addition of all inputs (‘in 1’ + ‘in 2’ + …). Input values can be set from settings. The number of inputs is configurable from settings."},"trigger-subtract":{title:"Trigger Subtract",description:"When ‘trigger’ transitions from ‘false’ to ‘true’, ‘output’ is updated with the result of the subtraction of all inputs (‘in 1’ - ‘in 2’ - …). Input values can be set from settings. The number of inputs is configurable from settings."},"trigger-multiply":{title:"Trigger Multiply",description:"When ‘trigger’ transitions from ‘false’ to ‘true’, ‘output’ is updated with the result of the multiplication of all inputs (‘in 1’ * ‘in 2’ * …). Input values can be set from settings. The number of inputs is configurable from settings."},"trigger-divide":{title:"Trigger Divide",description:"When ‘trigger’ transitions from ‘false’ to ‘true’, ‘output’ is updated with the result of the division of all inputs (‘in 1’ / ‘in 2’ / …). Input values can be set from settings. The number of inputs is configurable from settings."},"trigger-modulus":{title:"Trigger Modulus",description:"When ‘trigger’ transitions from ‘false’ to ‘true’, ‘output’ is updated with the result of the modulus of the inputs (‘in 1’ % ‘in 2’). Input values can be set from settings."},"trigger-power":{title:"Trigger Power",description:"When ‘trigger’ transitions from ‘false’ to ‘true’, ‘output’ is updated with the result of ‘in1’ to the power of ‘in2’ (‘in 1’ ^ ‘in 2’). Input values can be set from settings."}},miscellaneous:{"geo-hash":{title:"Geohash decode/encode",description:"A function that encodes lat,lon to and from a geo-hash"},"num-series-generator":{title:"Numeric Series Generator",description:""},"append-to-strings":{title:"Append To Strings",description:""}},nube:{"get-schedules":{title:"Get-Schedules",description:"This node is used to fetch schedules from the Nube dashboard. The ‘Get-Schedules’ node will output all schedules from the device; Specific schedule selection is done on the ‘Schedule-Checker’ node. ‘Interval’ (set from settings) is how often the node will re-check for schedule changes (minimum 10 seconds). In order for the ‘get-schedules’ node to work, there must be a `system/platform’ node in the main container (default editor pane) and there must be a ‘deviceID’ in the ‘system/platform’ node settings, It is recommended that the API-Schedule node is used in conjunction with a filter/prevent-null node to maintain the last successful schedule read in the case that the API-Login node becomes disconnected. 'interval’ units can be configured from settings. Maximum ‘interval’ setting is 587 hours."}},"num-transform":{round:{title:"Round (Decimal Place)",description:"‘output’ is the ‘input’ value rounded to the configured number of decimal places. The number of decimal places can be configured from settings (limited to 5 decimal places)."},floor:{title:"Floor",description:"‘output’ is the ‘input’ value rounded DOWN to the nearest integer."},ceil:{title:"Ceil",description:"‘output’ is the ‘input’ value rounded UP to the nearest integer."},limit:{title:"Limit",description:"‘output’ follows the ‘input’ value when it is between the ‘min’ and ‘max’ values. If ‘input’ is greater than the ‘max’ value, ‘output’ will be the ‘max’ value. If ‘input’ is less than the ‘min’ value, ‘output’ will be the ‘min’ value. ‘max’ and ‘min’ values can be configured from settings."},scale:{title:"Scale",description:"Performs a linear interpolation of the ‘input’ value based configured settings. When ‘input’ value is between ‘in-min’ and ‘in-max’ it is linearly interpolated between ‘out-min’ and ‘out-max’. If ‘input’ is greater than the ‘in-max’ value, ‘output’ will be the ‘out-max’ value. If ‘input’ is less than the ‘in-min’ value, ‘output’ will be the ‘out-min’ value. ‘in-max’, ‘in-min’, ‘out-max’, and ‘out-min’ values can be configured from settings."},"linear-shaper":{title:"Linear shaper",description:"Performs a linear interpolation of the ‘input’ value between configured inflection points. The number of inflection points can be configured in settings. The inflection points will be evenly distributed from 0-100. Values for each inflection point can be wired in, or set from settings. When the ‘input’ value is between 0 and 100 the ‘output’ value will be the linear interpolation of the ‘input’ value between the surrounding inflection point values."},fade:{title:"Fade",description:"This node makes a smooth transition from ‘from’ to ‘to’ over the ‘interval’ period when ‘enable’ transitions from ‘false’ to ‘true’; after this ‘interval’ period ‘output’ will match the ‘to’ value while ‘enable’ is ‘true’. During the ‘interval’ period, the rate of ‘output’ change cannot be changed. Once the ‘interval’ period is complete ‘out=to’ becomes ‘true’ until ‘enable’ becomes ‘false’ again."},"rate-limit":{title:"Rate-Limit",description:"This node makes a rate limited transition from its current output value to the ‘input’ value. When ‘enable’ is ‘true’, ‘output’ is permitted to change towards the ‘input’ value based on settings values. ‘output’ can change by ‘step’ size every ‘interval’ period. ‘output’ will be ‘null’ when ‘enable’ is ‘false’."}},point:{"bool-constant":{title:"Boolean Constant",description:"Outputs a Boolean value set from settings. Can also output null."},"num-constant":{title:"Numeric Constant",description:"Outputs a Numeric value set from settings. Can also output null by leaving the settings field blank."},"string-constant":{title:"String Constant",description:"Outputs a String value set from settings. Can also output null by leaving the settings field blank."},"json-constant":{title:"Json Constant",description:"Outputs a JSON value set from settings. Can also output null by leaving the settings field blank. Example {“name”:“John Hill”, “age”:31} or [1,2,3,4]"},"bool-writable":{title:"Boolean Writable (Priority)",description:"Outputs the highest priority, non-null, Boolean input. Highest priority is ‘in 1’ then ‘in 2’ and so on. Input values can also be wired in, or set from settings. The number of inputs can be modified from settings."},"num-writable":{title:"Numeric Writable (Priority)",description:"Outputs the highest priority, non-null, Numeric input. Highest priority is ‘in 1’ then ‘in 2’ and so on. Input values can also be wired in, or set from settings. The number of inputs can be modified from settings."},"string-writable":{title:"String Writable (Priority)",description:"Outputs the highest priority, non-null, String input. Highest priority is ‘in 1’ then ‘in 2’ and so on. Input values can also be wired in, or set from settings. The number of inputs can be modified from settings."},"generic-point":{title:"Generic Point",description:"This node is to test the generic point input types"}},"protocols/misc":{email:{title:"Email",description:"Once configured (in settings) with the sender email server details (‘email’ and ‘password’) for Gmail, Hotmail, Outlook365, or Yahoo accounts: This node will attempt to send a new email when ‘trigger’ transitions from ‘false’ to ‘true’. The String ‘recipient’ value will be the to: email address; The String ‘subject’ value will be the email subject; and the String ‘message’ value will be the email body. The ‘response’ output will be ‘true’ if the email is sent successfully. The ‘error’ output will be an error message String if there is an error sending the email."},"serial-connector":{title:"Serial Connector",description:"This node reads/writes serial data from/to the onboard serial ports.  These ports can be RS485 ports, or Rubix Compute wireless interface ports.  Once the Port and Baud Rate settings are configured, when enabled, the ‘output’ will be raw messages received over the configured serial port.  Any values written to the ‘writeValue’ input will be sent on the configured serial port"}},"protocols/http":{"dynamic-http-client":{title:"Dynamic HTTP client",description:'Sends a HTTP(S) request by executing a "axios" configuration JSON object. The request will be triggered when a configuration object is received on the inlet. The configuration object must be the "config" object of the "axios" library. For a list of all possible options, see here: https://github.com/axios/axios#request-config'},"http-client":{title:"HTTP client",description:"Sends a HTTP(S) request to the specified URL, using the specified request method. The request will be triggered when data is received on the inlet. For PUT/POST/PATCH requests, the received data string will be submitted as the request body."}},"protocols/nube":{"edge-28-network":{title:"Edge 28 Network",description:"The is node is used for reading and writing values to the edge-io-28. This node uses an internal rest-api to talk to the edge-io-28. No details need to be set",iconImageUrl:s.default.frog},"edge-28-lora-reset":{title:"Edge IO 28 LORA Map Reset",description:"The is node is used in conjunction with the edge-io-28 when using the lora-Connect. This node uses an internal rest-api to rest a LORA Map gateway connected to an edge-io-28 controller. The reason for this nodes is to give the user more control over the nube hardware. When a trigger is activated on the node input or the interval timer is triggered the lora-modules will be reset. The reboot of the module only takes 1000ms to restart "},"edge-28-input":{title:"Edge IO 28 Input",description:n.default.inputsDesc},"edge-28-output":{title:"Edge IO 28 Output",description:n.default.outputsDesc}},"protocols/bacnet":{"bacnet-network":{title:"BACnet Network",description:"This node acts as a container for bacnet-device nodes. All bacnet-device nodes should be added within the bacnet-network container. IP configuration for the BACnet network connection are set from settings. The bacnet-network node can also be used to perform a BACnet Discover (WhoIs)."},"bacnet-device":{title:"BACnet Device",description:"This node acts as a container for bacnet-point nodes. All bacnet-device nodes should be added within the bacnet-network container.  All bacnet-point nodes should be added within a bacnet-device container node.  Configuration of BACnet device connections are set from settings.  Both IP and MSTP BACnet devices can be configured from the bacnet-device settings."},"bacnet-point":{title:"BACnet Point",description:"All bacnet-point nodes should be added within the bacnet-device container node. Configuration of BACnet points are set from settings.  If the bacnet-network, and bacnet-device are configured correctly, the BACnet points will be available to select from the ‘Select a point’ setting; otherwise the point can be set manually. For information on History settings, see History/History node. Configuration is the same for bacnet-point histories."}},"protocols/bacnet-server":{"bacnet-server-api":{title:"BACnet Server",description:"A BACnet server is used to host BACnet points to be read/written by other BACnet devices. The bacnet-server node acts as a container for bacnet-server-point nodes. All bacnet-server-point nodes should be added within the bacnet-server container. IP configurations for the BACnet server connection are set from settings."}},"protocols/lora-raw":{"lora-sensor-decoder":{title:"Lora Sensor Decoder (Droplet | ALL)",description:"This node is used to decode raw serial input messages to LORA sensor values. It should be used in conjunction with the protocols/serial-connector node. If a ‘nodeID’ is set, only messages from matching LORA sensors will be output; if no ‘nodeID’ is set, all valid LORA sensor messages will be output. Outputs that are not present in the raw serial input message will be ‘null’. ‘lowBatteryAlm’ output will be ‘true’ if the LORA sensor has a battery ‘voltage’ value less than the ‘Low battery warning voltage’ setting; otherwise it will be ‘false’. ‘watchdog’ output will be ‘true’ if there has been no valid message from the ‘nodeID’ LORA sensor for the ‘Watchdog Delay’; otherwise ‘watchdog’ output will be false. Maximum ‘Watchdog Delay’ setting is 587 hours. This node can be used for decoding Nube Droplet sensors, and Nube MicroEdge sensors. The sensor type can be selected from settings."},"lora-raw-two-way-in":{title:"Nube LoRaRAW Two Way In",description:"This node parses Nubes LoRa Two Way protocol"},"lora-raw-two-way-out":{title:"Nube LoRaRAW Two Way Out",description:"This node compiles points to Nubes LoRa Two Way protocol"},"lora-raw-filter":{title:"Nube LoRaRAW Filter",description:"This node filters differe nube lora protocols"},"lora-raw-two-way-test":{title:"Nube LoRaRAW Two Way Test Node",description:"Acts as the transport layer for testing only"}},"protocols/lora-raw-v2":{"lora-raw-points-in":{title:"Nube LoRaRAW Points In",description:"This node parses Nubes LoRa Points protocol payload"},"lora-raw-points-out":{title:"Nube LoRaRAW Points Out",description:"This node compiles points to Nubes LoRa Points protocol"},"lora-raw-sensor-decoder-legacy":{title:"Lora Sensor Decoder (Droplet | ALL)",description:"LEGACY DECODER. PROVIDES DECRYPTION AS NEW FIRMWARE DOESNT. This node is used to decode raw serial input messages to LORA sensor values. It should be used in conjunction with the protocols/serial-connector node. If a ‘nodeID’ is set, only messages from matching LORA sensors will be output. If no ‘nodeID’ is set, all valid LORA sensor messages will be output. Outputs that are not present in the raw serial input message will be ‘null’. ‘lowBatteryAlm’ output will be ‘true’ if the LORA sensor has a battery ‘voltage’ value less than the ‘Low battery warning voltage’ setting otherwise it will be ‘false’. ‘watchdog’ output will be ‘true’ if there has been no valid message from the ‘nodeID’ LORA sensor for the ‘Watchdog Delay’ otherwise ‘watchdog’ output will be false. Maximum ‘Watchdog Delay’ setting is 587 hours. This node can be used for decoding Nube Droplet sensors, and Nube MicroEdge sensors. The sensor type can be selected from settings."}},"protocols/modbus":{"modbus-server":{title:"Modbus Server",description:"This node is used to create a modbus server. Once the Port and Modbus Address settings are configured, when enabled, this node will create a Local Modbus TCP/IP Server. The points on this created Modbus Server can be written to and read from with other Modbus Nodes, or from another device."}},"protocols/mqtt":{client:{title:"MQTT client",description:"This node connects to an MQTT Broker, subscribes to topics, and can publish values to topics. Once configured (in settings) with a valid ‘Broker URL’, ‘Broker Port’, and ‘Authentication’ (if required), this node will read and write to MQTT topics when ‘enable’ is ‘true’. Number of topics, and the topic names can be configured from settings. Each topic will have a corresponding input and output."},"client-single":{title:"MQTT Single Topic client",description:"This node connects to an MQTT Broker, subscribes to topics, and can publish values to topics. Once configured (in settings) with a valid ‘Broker URL’, ‘Broker Port’, and ‘Authentication’ (if required), this node will read and write to MQTT topics when ‘enable’ is ‘true’. Each topic will have a corresponding input and output."},"mqtt-topic-extractor":{title:"MQTT topic extractor",description:"The is node is used to extract sections out of an MQTT topic"},"topic-builder":{title:"MQTT Topic Builder",description:"This node takes String inputs and concatenates/joins them with ‘/’ to produce an MQTT Topic ‘output’. The number of inputs can be modified from settings."}},"protocols/social":{"sms-twilio":{title:"Twilio SMS",description:"Send a sms without the need of a sim card using twilio"}},"protocols/websocket":{websocket:{title:"WebSocket",description:"WebSocket Client for request/listen output"}},schedule:{"weekly-schedule":{title:"Weekly Schedule",description:"Weekly Schedule"},"event-schedule":{title:"Event Schedule Node",description:"Event Schedule Node"},"schedule-merge":{title:"Merge Schedule",description:"Merge Schedule"},"schedule-checker":{title:"Schedule Checker (unconfigured)",description:"This node checks the API-Schedule output string for active schedules that match the selected ‘Schedule Name’ setting. ‘output’ will be ‘true’ when the matching schedule is active and ‘enable’ is ‘true’; otherwise ‘output’ will be ‘false’. ‘nextStart’ is the timestamp output of the next scheduled start time. ‘nextStop’ is the timestamp output of the next scheduled stop time. ‘lastCheck’ is the timestamp output of the last time a schedule check was run. ‘error’ output will be ‘true’ if there is an error while checking the schedule input string; otherwise ‘error’ will be false. The frequency that schedules are checked can be modified with the ‘Schedule Check Interval’ setting (set in millis). The ‘Timestamp Output Format’ setting can be adjusted to output timestamps as strings or as Epoch Timestamps. String timestamps will be displayed in the timezone specified by the ‘Timezone’ setting."}},statistics:{"min-max-avg":{title:"Min-Max-Avg",description:"Outputs the Minimum, Maximum, and Average values of all the (non null) Numeric inputs. The number of inputs and their values can be modified from settings."},avg:{title:"Average",description:"Outputs the Average, Count, and Sum values of all the (non null) Numeric inputs. The number of inputs and their values can be modified from settings."},min:{title:"Min",description:"Outputs the Minimum value of all the (non null) Numeric inputs. The number of inputs and their values can be modified from settings."},max:{title:"Max",description:"Outputs the Maximum value of all the (non null) Numeric inputs. The number of inputs and their values can be modified from settings."},sum:{title:"Sum",description:"Outputs the Sum of all the (non null) Numeric inputs. The number of inputs and their values can be modified from settings."},median:{title:"Median",description:"Outputs the Median value of all the (non null) Numeric inputs. The number of inputs and their values can be modified from settings."},range:{title:"Range",description:"Outputs the Range value (max-min) of all the (non null) Numeric inputs. The number of inputs and their values can be modified from settings."},rank:{title:"Rank (Highest)",description:"Outputs the ranked highest (max to min), or ranked lowest (min to max) of all the (non null) Numeric inputs. The number of inputs and the number of outputs can be modified from settings."},"stats-all":{title:"All Stats",description:"Outputs the Maximum, Minimum, Range, Sum, Mean, Median, Modes, Variance, Standard Deviation, Mean Absolute Deviation, and Z Score values of all the (non null) Numeric inputs. The number of inputs and their values can be modified from settings."}},streams:{"stream-average":{title:"Stream Average",description:"'output' is the average of all received Numeric 'input' value.  'output' is reset when 'reset' transitions from 'false' to 'true'."},"stream-highest":{title:"Stream Highest",description:"‘output’ is the highest received Numeric ‘input’ value. ‘output’ is reset when ‘reset’ transitions from ‘false’ to ‘true’."},"stream-lowest":{title:"Stream Lowest",description:"'output' is the lowest received Numeric 'input' value.  'output' is reset when 'reset' transitions from 'false' to 'true'."},"stream-sum":{title:"Stream Sum",description:"output’ is the sum of all received Numeric ‘input’ value. ‘output’ is reset to 0 when ‘reset’ transitions from ‘false’ to ‘true’."},"stream-merge":{title:"Stream Merge",description:"This node merges multiple inputs into a single stream/output. Any new ‘input’ (‘in #’) value will be passed to ‘output’. The number of inputs can be modified from settings."},gate:{title:"Message Gate",description:"This node can allow(gate open) or block(gate close) the transfer of the ‘input’ to ‘output’. When ‘open’ is ‘true’, ‘input’ is passed to ‘output’. When ‘open’ is ‘false’, ‘output’ will maintain its last value. If ‘Send null when closed’ setting is ticked, ‘output’ will be ‘null’ when ‘open’ is ‘false’."},stack:{title:"Stack",description:"‘input’ values are stored in a list. Stored ‘input’ values are passed to ‘output’ one by one each time ‘trigger’ transitions from ‘false’ to ‘true’. ‘input’ values are passed to ‘output’ in a last-in, first-out order. Stored ‘input’ values are deleted when ‘clear’ transitions from ‘false’ to ‘true’. ‘count’ is the number of stored ‘input’ values."},queue:{title:"Queue",description:"‘input’ values are stored in a list. Stored ‘input’ values are passed to ‘output’ one by one each time ‘trigger’ transitions from ‘false’ to ‘true’. ‘input’ values are passed to ‘output’ in a first-in, first-out order. Stored ‘input’ values are deleted when ‘clear’ transitions from ‘false’ to ‘true’. ‘count’ is the number of stored ‘input’ values."},"stream-delay":{title:"Stream Delay",description:"‘input’ values are passed to ‘output’ after a ‘delay’ period. Each ‘input’ value is delayed by the same ‘delay’ period. ‘delay’ units can be configured from settings. Maximum ‘delay’ setting is 587 hours."},"stream-delay-meter":{title:"Stream Delay meter",description:"This node measures the delay between the incoming events. Any value sent to ‘input’ (excluding null) will be accepted. ‘ms’ output is the time between the lastest ‘input’, and the previous ‘input’. ‘ms’ is reset when ‘reset’ transitions from ‘false’ to ‘true’. ‘ms’ output is in millis."},"frequency-meter":{title:"Frequency meter",description:"This node measures the frequency of the incoming ‘input’ events. Any value sent to ‘input’ (excluding null) will be accepted. ‘events/sec’ output is the average rate received ‘input’ values. ‘events/sec’ is reset when ‘reset’ transitions from ‘false’ to ‘true’."},flatline:{title:"Flatline",description:"This node checks to see if the input has not changed for the 'interval' period."}},string:{"string-acronyms":{title:"String Case Acronyms",description:"This node will upper case any common HVAC Acronyms, For example it will Upper Fcu to FCU"},"string-compare":{title:"String Compare",description:"This node provides several functions to compare 2 String inputs, with a Boolean ‘output’. Available comparison functions are: Equals, Includes, Starts With, and Ends With. The comparison function is selected from settings."},"cut-substring":{title:"Substring Cut",description:"This node outputs a portion of a String ‘input’ defined by the Numeric ‘start’ and ‘length’ parameters. String ‘output’ is the portion of ‘input’ starting at index (position) ‘start’ and continating the next ‘length’ value of characters. ‘start’ value of 0 is the beggining of the string. If a negative ‘start’ value is given, the substring will be selected from the end of the ‘input’ string (eg. -1 is the end of the ‘input’; -2 is the second to last character of the ‘input’, …)."},"string-join":{title:"String Join",description:"This node takes String inputs and concatenates/joins them to produce a String ‘output’. The number of inputs can be modified from settings."},"string-length":{title:"String Length",description:"‘output’ is the number of characters in the given String ‘input’ value."},"string-index-of":{title:"String Index Of",description:"This node takes String ‘input’ and ‘searchFor’; Numeric ‘output’ is the index(position) of the first instance of ‘searchFor’ in ‘input’. Index of 0 is the begginning of the ‘input’ string."},"char-at-index":{title:"Char at Index",description:"‘output’ is the character at the Numeric ‘index’ (position) of String ‘input’. The first character of the String ‘input’ is ‘index’ 0. If ‘index’ is negative, characters will be selected from the end of the ‘input’ string (eg. -1 is the last character; -2 is the second to last character). ‘output’ will be ‘null’ on an invalid ‘index’."},"string-split":{title:"String Split",description:"Portions of the String ‘input’ are sent to the String ‘output’ sequentially when ‘next’ trasitions from ‘false’ to ‘true’; these ‘output’ strings are portions of the ‘input’ string split by the String ‘separator’ value. The Numeric ‘left’ outputs the number of ‘output’ strings remaining to be sent. When ‘start’ transitions from ‘false’ to ‘true’, the ‘output’ string will go back to the first portion of the ‘input’ string."},"string-case":{title:"String Case (Lower)",description:"‘output’ is the ‘input’ string with all characters changed to either upper or lower case. Upper or Lower case can be selected from settings."},"char-to-ascii":{title:"Char to ASCII Code",description:"‘output’ is the ASCII code of the first character of a given String ‘input’ value."},"ascii-to-char":{title:"ASCII Code to Char",description:"‘output’ is the character of the given Numeric ASCII code ‘input’ value."},"string-buffer":{title:"String Buffer",description:""}},switch:{"bool-switch":{title:"Boolean Switch",description:"Boolean ‘switch’ passes corresponding Boolean input to ‘output’. If ‘switch’ is ‘true’, Boolean ‘inTrue’ value will be passed to ‘output’ ‘inTrue’ and ‘inFalse’ values can be set in settings."},"num-switch":{title:"Numeric Switch",description:"Boolean ‘switch’ passes corresponding Numeric input to ‘output’. If ‘switch’ is ‘true’, Numeric ‘inTrue’ value will be passed to ‘output’ ‘inTrue’ and ‘inFalse’ values can be set in settings."},"string-switch":{title:"String Switch",description:"Boolean ‘switch’ passes corresponding String input to ‘output’. If ‘switch’ is ‘true’, String ‘inTrue’ value will be passed to ‘output’ ‘inTrue’ and ‘inFalse’ values can be set in settings."},"bool-select":{title:"Boolean Select",description:"Numeric integer ‘select’ passes corresponding Boolean input to ‘output’. If ‘select’ is 2, ‘in 2’ will be passed to ‘output’ (likewise for other integer ‘select’ values). If the ‘select’ value does not have a corresponding ‘in #’ value, ‘output’ value will be ‘null’. The number of inputs and their values can be modified from settings."},"num-select":{title:"Numeric Select",description:"Numeric integer ‘select’ passes corresponding Numeric input to ‘output’. If ‘select’ is 2, ‘in 2’ will be passed to ‘output’ (likewise for other integer ‘select’ values). If the ‘select’ value does not have a corresponding ‘in #’ value, ‘output’ value will be ‘null’. The number of inputs and their values can be modified from settings."},"string-select":{title:"String Select",description:"Numeric integer ‘select’ passes corresponding String input to ‘output’. If ‘select’ is 2, ‘in 2’ will be passed to ‘output’ (likewise for other integer ‘select’ values). If the ‘select’ value does not have a corresponding ‘in #’ value, ‘output’ value will be ‘null’. The number of inputs and their values can be modified from settings."},"bool-output-select":{title:"Boolean Output Select",description:"Numeric integer ‘select’ passes Boolean ‘input’ to the corresponding Boolean ‘output’. If ‘select’ is 2, ‘input’ will be passed to ‘out 2’ (likewise for other integer ‘select’ values). If the ‘select’ value does not have a corresponding ‘out #’ value, no values will be passed. The number of outputs can be modified from settings."},"num-output-select":{title:"Numeric Output Select",description:"Numeric integer ‘select’ passes Numeric ‘input’ to the corresponding Numeric ‘output’. If ‘select’ is 2, ‘input’ will be passed to ‘out 2’ (likewise for other integer ‘select’ values). If the ‘select’ value does not have a corresponding ‘out #’ value, no values will be passed. The number of outputs can be modified from settings."},"string-output-select":{title:"String Output Select",description:"Numeric integer ‘select’ passes String ‘input’ to the corresponding String ‘output’. If ‘select’ is 2, ‘input’ will be passed to ‘out 2’ (likewise for other integer ‘select’ values). If the ‘select’ value does not have a corresponding ‘out #’ value, no values will be passed. The number of outputs can be modified from settings."}},system:{"host-info":{title:"Host Info",description:"This node outputs various linux system information. More Info: https://docs.nube-iiot.com/en/nodes/home#host-info"},platform:{title:"Platform",description:"This node provides a node to read the settings for the Wires instance."},"system-info":{title:"System Info ",description:"This node outputs various linux system information. Once a system property has been selected from settings, a ‘false’ to ‘true’ transition on the ‘trigger’ input will update the ‘output’. ‘error’ will display error information if the request is not successful."},beep:{title:"Beep",description:"This node plays a default system sound on the server (not in the browser) when ‘trigger’ transitions from ‘false’ to ‘true’."},"execute-cmd":{title:"Execute Command",description:"This node triggers commands to be run on the linux host. The string input ‘command input’ will be run when ‘trigger’ transitions from ‘false’ to ‘true’. NOTE: ONLY USE THIS NODE IF YOU KNOW EXACTLY WHAT YOU ARE DOING. SYSTEM COMMANDS CAN CHANGE SYSTEM CONFIGURATION WHICH CANNOT BE FIXED FROM WITHIN WIRES. YOU COULD BREAK WIRES, THE CONTROLLER, OR YOUR PC."},"flow-export":{title:"Flow Export",description:"A node to export the wires flow to JSON when trigger values gets changed to true from different state"},"network-interface-edge-28":{title:"Network Interface EdgeIO-28",description:"This node is used to configure the network (IP) interface for edge28 controllers. Changes made to settings will only be saved if ‘Save changes on save’ is toggled ON. In some cases a reboot will be required to save the changes, if ‘Reboot’ is toggled ON, then clicking ‘save’ will reboot the controller. NOTE: Making changes on a remote device could cause the device to become inaccessible."},"network-interfaces":{title:"Network Interfaces",description:"This node is used to configure the network (IP) interfaces for the device. Changes made to settings will only be saved if ‘Save changes on save’ is toggled ON. In some cases a reboot will be required to save the changes, if ‘Reboot’ is toggled ON, then clicking ‘save’ will reboot the controller. NOTE: Making changes on a remote device could cause the device to become inaccessible."},"system-build-version":{title:"Build Versions",description:"A node for return the build versions of wires and nodejs"},file:{title:"File",description:"This node can read and write any file on the disk. Send the file name to the input named File Name. The path can be omitted. With logic inputs named Read, Write, Clear you can perform the requested operation. The input named Text set a text value to be written to the file. The contents of the file will be sent to the output."},"json-file":{title:"Json File",description:"This node can read and write Json file on the disk. Send the file name To the input named File Name. The path can be omitted. With logic inputs named Read, Write, Delete File you can perform the requested operation. Specify the key that you want to read/write. The value that you want to write, send to Value input. Read value will be sent to the output."}},time:{conversion:{title:"Time Conversion (min)",description:"This node converts between Time units Days(‘day’), Hours(‘hour’), Minutes(‘min’), Seconds(‘sec’), and Milliseconds(‘milli’). Input type can be selected from settings. Outputs will change based on selected input type. The number of decimal places that output values have can be set from the ‘Precision’ setting."},"conversion-plus":{title:"Time Conversion Json",description:"This node will let you convert a timestamp or unix (epoch) timestamp into date and time parts"},"timezone-conversion":{title:"Timezone Conversion",description:"The is node is used to convert two timestamps"},clock:{title:"Clock",description:"Outputs the System Time in various forms. Standard outputs are: Time(‘timeString’) Hours(‘hour’), Minutes(‘min’), and Seconds(‘sec’). There are also Advanced outputs which can be enabled from settings. The Advanced outputs are: Milliseconds(millis), Time String including timezone (‘longString’), Timezone Offset from UTC(‘TZOffset’), and Unix Timestamp (‘epoch’). ‘interval’ is the output update frequency. ‘interval’ units can be configured from settings. Maximum ‘interval’ setting is 587 hours."},date:{title:"Date",description:"Outputs various date information based on the system time. String ‘dateString’ is the current date. String ‘dayString’ is the current day of the week. Numeric ‘dayOfWeek’ is an integer between 0 and 6 corresponding to Sunday(0) through Saturday(6). Numeric ‘date’ is and integer of the current date. Numeric ‘month’ is an integer of the current month Jan(0) - Dec(12). Numeric ‘year’ is an integer of the current year."},"date-difference":{title:"Date Difference",description:"The is node is used to compare the difference between two timestamps"},stopwatch:{title:"Stopwatch",description:"This node converts between Time units Days(‘day’), Hours(‘hour’), Minutes(‘min’), Seconds(‘sec’), and Milliseconds(‘milli’). Input type can be selected from settings. Outputs will change based on selected input type. The number of decimal places that output values have can be set from the ‘Precision’ setting. ‘interval’ units can be configured from settings. Maximum ‘interval’ setting is 587 hours."},"cron-interval":{title:"Cron Interval",description:"This node triggers ‘output’ to transition from ‘false’ to ‘true’ for 500 milliseconds at a selected times/intervals, configured in settings. ‘info’ will show information about the status of the node. ‘cronExpression’ represents the configured scheduled timings in Cron notation. ‘cronDescription’ represents the configured scheduled timings in plain english. ‘nextExecution’ is a String output representing the datetime that the next ‘message’ will be sent from ‘output’. For more information on Cron Expressions see: (https://www.freeformatter.com/cron-expression-generator-quartz.html)"},"cron-weekly":{title:"Cron Weekly",description:"This node triggers ‘output’ to transition from ‘false’ to ‘true’ for 500 milliseconds at a configured time on each selected day. Days and Times are set in settings. ‘info’ will show information about the status of the node. ‘cronExpression’ represents the configured scheduled timings in Cron notation. ‘cronDescription’ represents the configured scheduled timings in plain english. ‘nextExecution’ is a String output representing the datetime that the next ‘message’ will be sent from ‘output’. For more information on Cron Expressions see: (https://www.freeformatter.com/cron-expression-generator-quartz.html)"},"cron-expression":{title:"Cron Expression",description:"This node triggers ‘output’ to transition from ‘false’ to ‘true’ for 500 milliseconds at times triggered by the ‘input’ CRON expression. ‘info’ will show information about the status of the node. ‘cronDescription’ represents the configured scheduled timings in plain english. ‘nextExecution’ is a String output representing the datetime that the next ‘message’ will be sent from ‘output’. For more information on Cron Expressions see: (https://www.freeformatter.com/cron-expression-generator-quartz.html)"},"timestamp-generator":{title:"Timestamp Generator",description:"The is node is used to generate a timestamps"},"rate-limit":{title:"Rate Limit",description:""}},trigger:{"change-of-value":{title:"Change Of Value",description:"when ‘input’ changes value, output becomes ‘true’ for ‘interval’ duration, then ‘output’ changes back to ‘false’. For Numeric ‘input’ values, the change of value must be greater than the ‘threshold’ value to trigger the output."},random:{title:"Random",description:"When ‘trigger’ transitions from ‘false’ to ‘true’, a random number between ‘min’ and ‘max’ values is produced at ‘output’. The number of decimal places that ‘output’ values have can be set from settings."},inject:{title:"Inject",description:"While ‘enable’ is ‘true’, ‘output’ will send ‘message’ value when ‘trigger’ transitions from ‘false’ to 'true"},"interval-inject":{title:"Interval Inject",description:"While ‘enable’ is ‘true’, ‘output’ will send ‘message’ value at every ‘interval’ period. When ‘enable’ is ‘false’, ‘output’ will be ‘null’. ‘interval’ units can be configured from settings. Maximum ‘interval’ setting is 587 hours."},iterator:{title:"Iterator",description:"This node generates a sequence of ‘true’ messages at ‘output’. If the ‘Generate False’ setting is ticked (default), then a ‘false’ message will be sent between each ‘true’ at ‘output’. The number of ‘true’ messages sent will be equal to ‘iterations’ value; these values are sent over the ‘interval’ duration (unless interrupted by ‘stop’ inputs). For example, if ‘interval’ is set to 5 (seconds) and ‘iterations’ is set to 5, a ‘true’ message will be sent from ‘output’ every 1000 millis. If 'stop’ input is ‘true’ then the next ‘true’ value will not be sent from ‘output’ until ‘stop’ is ‘false’ again. ‘interval’ units can be configured from settings. Maximum ‘interval’ setting is 587 hours."}},widget:{"schedule-afterhours-off":{title:"Schedule-Afterhours-Off Widget",description:'This node works with a multi-select cloud dashboard widget to perform the logic to output ‘enable’ and ‘remaining runtime’. Widget Example: {“new”:false,“widgetType”:“MultiSwitch”,“dataSource”:“Ditto”,“tableSelectionMode”:“Tabular”,“cellWidthAuto”:true,“numCharts”:1,“timeSeriesData”:true,“valuePrecision”:3,“trimTableHeaders”:0,“enableTooltip”:true,“enableLegend”:true,“enableZoomSlider”:true,“syncTime”:60,“chartSettings”:[{“xAxisSplits”:3,“yAxisSplits”:5}],“graphType”:“LineChart”,“fontSize”:35,“statusImageName”:“Light”,“trueStatus”:1,“falseStatus”:0,“priority”:16,“sliderMin”:10,“sliderMax”:30,“sliderStep”:0.1,“min”:0,“max”:100,“gaugeSplits”:6,“maximum”:0,“unit”:“°C”,“steps”:0,“reverseGradient”:true,“lowerBound”:0,“upperBound”:100,“cellWidth”:150,“tickCount”:100,“theme”:“nube”,“titleColor”:"#333333",“gateway”:"/api/ditto",“query”:"/api/2/things/com.nubeio:97768707-4a17-4d36-baa5-e1f95cbd74d4/features/points/properties/CHAPEL_Mode",“units”:"%",“title”:“AC Control”,“containerHeight”:150,“icon”:“None”,“topicIcon”:“None”,“subTopicIcon”:“None”,“layouts”:{“lg”:{“w”:6,“h”:4,“x”:0,“y”:7,“moved”:false,“static”:false},“md”:{“x”:0,“y”:144,“w”:6,“h”:8},“sm”:{“x”:0,“y”:104,“w”:6,“h”:8},“xs”:{“x”:0,“y”:8,“w”:4,“h”:8},“xxs”:{“x”:0,“y”:8,“w”:2,“h”:8}},“numButtons”:3,“buttonSettings”:[{“name”:“SCHEDULE”,“value”:“SCHEDULE”},{“name”:“AFTERHOURS”,“value”:“AFTERHOURS”},{“name”:“OFF”,“value”:“OFF”}],“dataType”:“Global”,“enableBackground”:false,“isSelect”:false,“fontWeight”:“bold”,“fontColor”:"",“overriddenFields”:[],“isTransparent”:false,“isSelectedDitto”:true,“showValue”:true,“dataEditorCode”:""}'},"schedule-prestart-fixed":{title:"Schedule Prestart Fixed",description:"This node provides a pre-start function based on fixed settings. Conditions are evaluated every 30 seconds."}},unknown:{unknown:{title:"Unknown",description:"Fallback node, this node need to be replace by another node"}}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(e,"__esModule",{value:!0}),e.Node=e.NodeState=e.BROADCAST=void 0;const n=i(17),o=i(13),a=i(34),r=i(65),u=i(29),d=i(28),l=i(6),p=i(16),h=i(12),c=i(18),g=i(38),m=i(5),f=i(1),O=i(19),y=i(67),v=i(11),N=i(22),T=i(4),I=o.create("node",{color:o.Colors.Magenta}),S=()=>{};var b;!function(t){t[t.UPDATE_SETTINGS=0]="UPDATE_SETTINGS",t[t.UPDATE_OUTPUTS=1]="UPDATE_OUTPUTS",t[t.UPDATE_TITLE=2]="UPDATE_TITLE",t[t.UPDATE_VALUE=3]="UPDATE_VALUE",t[t.UPDATE_STATE=4]="UPDATE_STATE",t[t.UPDATE_NAME=5]="UPDATE_NAME",t[t.UPDATE_PROPERTIES=6]="UPDATE_PROPERTIES"}(b=e.BROADCAST||(e.BROADCAST={})),function(t){t.NORMAL="normal",t.INFO="info",t.WARNING="warning",t.ERROR="error",t.DISABLED="disabled",t.ONLINE="online",t.OFFLINE="offline"}(e.NodeState||(e.NodeState={}));class E{constructor(){this.pos=[100,100],this.settings={},this.properties={},this.flags={},this.MIN_WIDTH=100,this.settingConfigs={},this.contextMenu={},this.clonable=!0,this.showIcon=!0,this.convertInput=(t,e,i=3)=>{const s=typeof t;return e===f.Type.NUMBER?t=Number((isNaN(t)?0:Number(t)).toFixed(i)):e===f.Type.BOOLEAN?t="boolean"===s?Number(t):1===t||"true"===t?1:0:e===f.Type.STRING&&"string"!==s&&(t=JSON.stringify(t)),t},this.type="",this.id=p.IdGenerator.UNINITIALIZED,this.cid=p.IdGenerator.UNINITIALIZED}onAfterSettingsChange(t,e,i){}onAdded(){}afterAdded(){this.size=y.Shape2D.isDisplayable(this.size)?this.size:this.computeSize()}onRemoved(){}beforeRemoveNode(){var t,e;Object.entries(null!==(t=this.inputs)&&void 0!==t?t:{}).filter(([t,e])=>l.isNotNull(e.link)).forEach(([t,e])=>this.disconnectInputLink(+t)),Object.entries(null!==(e=this.outputs)&&void 0!==e?e:{}).filter(([t,e])=>l.isEmpty(e.links)).forEach(([t,e])=>this.disconnectOutputLinks(+t))}afterRemoveNode(){var t;if(null===(t=this.container)||void 0===t?void 0:t.renderers)for(let t=0;t<this.container.renderers.length;++t){let e=this.container.renderers[t];e.selected_nodes[this.id]&&delete e.selected_nodes[this.id],e.node_dragged==this&&(e.node_dragged=null)}}serialize(){var t,e;let i={cid:null!==(e=null===(t=this.container)||void 0===t?void 0:t.id)&&void 0!==e?e:this.cid,id:this.id,type:this.type,pos:this.pos,name:this.name,size:this.size,icon:this.icon,inputs:N.SerializableHelper.serialize(this.inputs),outputs:N.SerializableHelper.serialize(this.outputs),settings:N.SerializableHelper.serialize(this.settings),properties:N.SerializableHelper.serialize(this.properties),flags:N.SerializableHelper.serialize(this.flags)};return this.onSerialize&&this.onSerialize(i),i}deserialize(t,e){var i,s,o,a,r;function u(t,e,i){const s=l.mapToObjectSameKey(t,(t,e)=>N.SerializableHelper.serialize(e));return i?n.merge({},s,e):s}let d=v.NodeTypeRegistry.instance().get(t.type);d||(this.debugWarn(`Node class of type [${t.type}] is not registered. Fallback to 'unknown'`),d=v.NodeTypeRegistry.instance().get(h.UNKNOWN_NODE));let p=new d;return p.category=d.category,g.NodeHookHelper.execute(p,"setup"),g.NodeHookHelper.execute(p,"init",p),p.id=null!==(i=t.id)&&void 0!==i?i:p.id,p.cid=null!==(s=t.cid)&&void 0!==s?s:p.cid,p.type=null!==(o=t.type)&&void 0!==o?o:p.type,p.name=t.name,p.pos=t.pos,p.icon=null!==(a=t.icon)&&void 0!==a?a:p.icon,p.flags=e?p.flags:n.merge(p.flags,t.flags),p.inputs=l.mapToObjectSameKey(u(p.inputs,t.inputs,!e),(t,e)=>f.NodeInput.create(e)),p.outputs=l.mapToObjectSameKey(u(p.outputs,t.outputs,!e),(t,e)=>f.NodeOutput.create(e)),p.settings=l.mapToObjectSameKey(u(p.settings,t.settings,!e),(t,e)=>{const i=p.settings[t];return f.NodeSetting.create(Object.assign(Object.assign({},e),{validation:null==i?void 0:i.validation,toJSON:null==i?void 0:i.toJSON}))}),p.properties=e?p.properties:n.merge(p.properties,t.properties),p.size=null!==(r=t.size)&&void 0!==r?r:this.computeSize(!0),p}getParent(){return this.container}getParentNode(){var t;return null===(t=this.getParent())||void 0===t?void 0:t.nodeItself()}toString(){return JSON.stringify(this.serialize())}getTitle(){return this.title}getName(){return this.name}getDefinedInputValues(){return Object.keys(this.inputs).map(t=>this.inputs[t].data).filter(t=>null!=t)}emitTransformedInput(t){let e=this.getInputData(0);null!=e?this.setOutputData(0,t(e)):this.setOutputData(0,null)}updateNodeInput(){c.createNodeDbHelper().update(this,["inputs"])}updateNodeOutput(){c.createNodeDbHelper().update(this,["outputs"])}persistProperties(t=!1,e=!1,i=!1,s=!1){const n={settings:t,properties:e,inputs:i,outputs:s};let o=Object.entries(n).filter(([t,e])=>!0===e).map(([t,e])=>t);c.createNodeDbHelper().update(this,o)}persistConfiguration(t=S){c.createNodeDbHelper().update(this,["settings","properties"])}updateNodeInputOutput(){c.createNodeDbHelper().update(this,["inputs","outputs"])}setOutputData(t,e,i=!1){this.outputs[t]&&void 0!==e&&(i&&this.outputs[t].data===e||(this.outputs[t].updated=!0,this.isRecentlyActive||(this.isRecentlyActive=!0),this.dispatch(t,e),this.outputs[t].data=e))}getInputData(t){var e;try{const e=this.inputs[t],i=null==e?void 0:e.setting;let s=null==e?void 0:e.data;if((null==i?void 0:i.exist)&&(l.isNull(e.link)||!T.default.hasValidInput(s,null==i?void 0:i.nullable)||e.type===f.Type.DROPDOWN)){const i=this.inputs[t].name.match(/\[(.*?)\]/)[1],n=this.settings[i];e.type===f.Type.DROPDOWN?n.config.items.map(t=>t.value).includes(s)||(s=n.value):s=T.default.parseValue(n.value,e.type)}return s}catch(t){this.debugErr(`Get input data! Error: ${null!==(e=t.stack)&&void 0!==e?e:t}`)}}getInputInfo(t){return this.inputs?this.inputs[t]:null}addOutput(t,e,i,s){i=this.getFreeOutputId(i),t=t||"out "+(i+1);let n=f.NodeOutput.create({name:t,type:e,links:null});if(s)for(let t in s)n[t]=s[t];return this.outputs||(this.outputs={}),this.outputs[i]=n,this.onOutputAdded&&this.onOutputAdded(n),this.size=this.computeSize(),i}getFreeOutputId(t){if(this.outputs||(this.outputs={}),void 0!==t&&!this.outputs[t])return t;for(let t=0;t<1e3;t++)if(!this.outputs[t])return t}removeOutput(t){this.disconnectOutputLinks(t),delete this.outputs[t],this.size=this.computeSize(),this.onOutputRemoved&&this.onOutputRemoved(t)}addInput(t,e,i={exist:!1,nullable:!1,hidden:!1},s,n){s=this.getFreeInputId(s),t=t||"in "+(s+1);let o=f.NodeInput.create(Object.assign({name:t,type:e,setting:i},n));return this.inputs||(this.inputs={}),this.inputs[s]=o,this.size=this.computeSize(),this.onInputAdded&&this.onInputAdded(o),s}addInputWithSettings(t,e,i,s=t,n=!0,o,a){const r={exist:!0,nullable:n,hidden:!1};this.addInput(`[${t}]`,e,r,a),this.settings[t]=f.NodeSetting.create({description:s,value:i,type:f.convertType(e),config:o})}addInputAtPosition(t,e,i,s={exist:!1,nullable:!1,hidden:!1},n={}){this.inputs||(this.inputs={});const o=this.getInputsCount();if(t>=o)return this.addInput(e,i,s,n);const a=this.id;for(let e=o;e>t;e--){this.inputs[e]=this.inputs[e-1];const t=O.Link.create(this.inputs[e].link);if(t){const i=O.Link.create({nodeId:a,slot:e-1}),s=this.container.nodeRegistry().get(t.nodeId),n=s.outputs[t.ioId].links,o=n.map(t=>O.Link.create(t)).findIndex(t=>O.compareNodeIO(t,i));-1!=o&&n.splice(o,1,i),s.updateNodeOutput()}}let r=Object.assign({name:e,type:i,setting:s},n);return this.inputs[t]=r,this.size=this.computeSize(),this.onInputAdded&&this.onInputAdded(r),t}getFreeInputId(t){if(this.inputs||(this.inputs={}),void 0!==t&&!this.inputs[t])return t;for(let t=0;t<1e3;t++)if(!this.inputs[t])return t}hideInput(t=!0,...e){for(let t of e)this.disconnectInputLink(null,t),this.inputs[t].setting.hidden=!0;this.redrawNode(t)}showInput(t=!0,...e){for(let t of e)this.inputs[t].setting.hidden=!1;this.redrawNode(t)}redrawNode(t=!0){t&&(this.size=this.computeSize(),this.setDirtyCanvas(!0,!0))}removeInput(t){this.disconnectInputLink(t),delete this.inputs[t],this.size=this.computeSize(),this.onInputRemoved&&this.onInputRemoved(t)}removeInputAtPosition(t){this.disconnectInputLink(t);const e=this.getInputsCount(),i=this.id;for(let s=t;s<e-1;s++){this.inputs[s]=this.inputs[s+1];const t=O.Link.create({nodeId:i,slot:s+1}),e=O.Link.create(this.inputs[s].link);if(e){const i=this.container.nodeRegistry().get(e.nodeId),s=i.outputs[e.ioId].links,n=s.map(t=>O.Link.create(t)).findIndex(e=>O.compareNodeIO(e,t));-1!=n&&s.splice(n,1,t),i.updateNodeOutput()}}delete this.inputs[e-1],this.size=this.computeSize(),this.onInputRemoved&&this.onInputRemoved(t)}getInputsCount(){return this.inputs?Object.keys(this.inputs).length:0}getOutputsCount(){return this.outputs?Object.keys(this.outputs).length:0}changeInputsCount(t,e){let i=t-this.getInputsCount();if(i>0)for(let t=0;t<i;t++)this.addInput(null,e);if(i<0){let t=Object.keys(this.inputs);for(let e=0;e>i;e--){let i=t[t.length+e-1];this.removeInput(+i)}}}changeOutputsCount(t,e){let i=t-this.getOutputsCount();if(i>0)for(let t=0;t<i;t++)this.addOutput(null,e);if(i<0){let t=Object.keys(this.outputs);for(let e=0;e>i;e--){let i=t[t.length+e-1];this.removeOutput(+i)}}}getLastInputIndex(){return this.inputs?Object.values(this.inputs).filter(t=>{var e;return!(null===(e=t.setting)||void 0===e?void 0:e.hidden)}).length:0}getLastOutputIndex(){return this.outputs?Object.values(this.outputs).length:0}computeHeight(){return 15*Math.max(this.getLastInputIndex()+this.getLastOutputIndex(),1)+6}computeSize(t=!1){var e,i,s,n;let o=[0,0];if(o[1]=this.computeHeight(),!t&&null!=this.size)return o[0]=this.size[0],o;let a=d(this.title),r=0,u=0;if(this.inputs)for(let t in this.inputs){let s=this.inputs[t],n=null!==(e=s.label)&&void 0!==e?e:"",o=null!==(i=s.name)&&void 0!==i?i:"",a=d(n),l=d(o);r<a&&(r=a),u<l&&(u=l)}if(this.outputs)for(let t in this.outputs){let e=this.outputs[t],i=null!==(s=e.label)&&void 0!==s?s:"",o=null!==(n=e.name)&&void 0!==n?n:"",a=d(i),l=d(o);r<a&&(r=a),u<l&&(u=l)}function d(t){return t?14*t.length*.6:0}return 0==r&&(r=u),o[0]=Math.max(r+u+10,a),o[0]=Math.max(o[0],this.MIN_WIDTH),o}calculateMinWidth(...t){return Math.max(this.MIN_WIDTH,...t)}disconnectOutputLinks(t){const e=O.Link.create({nodeId:this.id,slot:+t}),i=this.getParent().nodeRegistry().containerRegistry;return new r.BackendLinkVisitor(i).visit(O.createLinkHandler(i).disconnectOutput(this.cid,e))}disconnectInputLink(t,e){const i=O.Link.create({nodeId:this.id,ioId:e,slot:t}),s=this.getParent().nodeRegistry().containerRegistry;return new r.BackendLinkVisitor(s).visit(O.createLinkHandler(s).disconnectInput(this.cid,i))}setDirtyCanvas(t,e){this.container&&this.container.sendActionToRenderer("setDirty",[t,e])}collapse(){var t;this.flags.collapsed=!(null===(t=this.flags)||void 0===t?void 0:t.collapsed),this.setDirtyCanvas(!0,!0)}debug(t){I.debug(this.getReadableId()+" "+t)}debugInfo(t){I.info(this.getReadableId()+" "+t)}debugWarn(t,e){I.warn(this.getReadableId()+" "+t)}debugErr(t,e){I.error(this.getReadableId()+" "+t)}getReadableId(){return this.container?`[${this.type}][${this.container.id}/${this.id}]`:`[${this.type}][-/${this.id}]`}sendMessageToServerSide(t){this.side===m.Side.server?I.warn(`Node ${this.getReadableId()} is trying to send message from server side to server side`):this.container.client_socket.emit("nodeMessageToServerSide",{id:this.id,cid:this.container.id,message:t})}sendMessageToEditorSide(t,e=!0){let i={id:this.id,cid:this.container.id,message:t};if(this.side==m.Side.editor)I.warn(`Node ${this.getReadableId()} is trying to send message from editor side to editor side`);else if(this.side===m.Side.server){let t=this.container.server_editor_socket;e?t.in(""+this.container.id).emit("nodeMessageToEditorSide",i):t.emit("nodeMessageToEditorSide",i)}else this.container.client_socket.emit("nodeMessageToEditorSide",i)}sendAddInputToEditorSide(t,e,i){let s={id:this.id,cid:this.container.id,input:{name:t,type:e,extra_info:i}};if(this.side===m.Side.editor)I.warn("Node "+this.getReadableId()+" is trying to send message from editor side to editor side");else if(this.side===m.Side.server){this.container.server_editor_socket.emit("node-add-input",s)}else this.container.client_socket.emit("node-add-input",s)}sendAddOutputToEditorSide(t,e,i){let s={id:this.id,cid:this.container.id,output:{name:t,type:e,extra_info:i}};if(this.side===m.Side.editor)I.warn("Node "+this.getReadableId()+" is trying to send message from editor side to editor side");else if(this.side===m.Side.server){this.container.server_editor_socket.emit("node-add-output",s)}else this.container.client_socket.emit("node-add-output",s)}sendRemoveInputToEditorSide(t){let e={id:this.id,cid:this.container.id,input:t};if(this.side===m.Side.editor)I.warn("Node "+this.getReadableId()+" is trying to send message from editor side to editor side");else if(this.side===m.Side.server){this.container.server_editor_socket.emit("node-remove-input",e)}else this.container.client_socket.emit("node-remove-input",e)}sendRemoveOutputToEditorSide(t){let e={id:this.id,cid:this.container.id,output:t};if(this.side===m.Side.editor)I.warn("Node "+this.getReadableId()+" is trying to send message from editor side to editor side");else if(this.side===m.Side.server){this.container.server_editor_socket.emit("node-remove-output",e)}else this.container.client_socket.emit("node-remove-output",e)}sendIOValuesToEditor(){let t=[],e=[];if(this.inputs)for(let e in this.inputs){const i=this.inputs[e].data;t.push({nodeId:this.id,inputId:e,data:i})}if(this.outputs)for(let t in this.outputs){const i=this.outputs[t].data;e.push({nodeId:this.id,outputId:t,data:i})}const i={cid:this.container.id,inputs:t,outputs:e};this.container.server_editor_socket.in(""+this.container.id).emit(u.NODE_IO_VALUES,i)}updateInputsLabels(){if(this.inputs){for(let t in this.inputs){this.inputs[t].label=""}this.setDirtyCanvas(!0,!0)}}updateOutputsLabels(){if(this.outputs){for(let t in this.outputs){this.outputs[t].label=""}this.setDirtyCanvas(!0,!0)}}broadcastSettingsToClients(t=!0){this.sendMessageToEditorSide({action:b.UPDATE_SETTINGS,payload:this.settings},t)}broadcastPropertiesToClients(t=!0){this.sendMessageToEditorSide({action:b.UPDATE_PROPERTIES,payload:this.properties},t)}broadcastOutputsToClients(t=!0){this.sendMessageToEditorSide({action:b.UPDATE_OUTPUTS,payload:this.outputs},t)}broadcastNodeStateToClients(t=!0){this.sendMessageToEditorSide({action:b.UPDATE_STATE,payload:this.nodeState},t)}broadcastTitleToClients(t=!0){this.sendMessageToEditorSide({action:b.UPDATE_TITLE,payload:this.title},t)}broadcastNameToClients(t=!0){this.sendMessageToEditorSide({action:b.UPDATE_NAME,payload:this.name},t)}broadcastValToClients(t,e,i=!0){this.sendMessageToEditorSide({action:b.UPDATE_VALUE,key:t,payload:e},i)}onGetMessageToEditorSide({action:t,payload:e,key:i}){switch(t){case b.UPDATE_VALUE:return void(this.settings[i].value=e);case b.UPDATE_SETTINGS:return void(this.settings=e);case b.UPDATE_PROPERTIES:return void(this.properties=e);case b.UPDATE_OUTPUTS:this.outputs=e;break;case b.UPDATE_TITLE:this.title=e,this.size=this.computeSize();break;case b.UPDATE_STATE:this.nodeState=e;break;case b.UPDATE_NAME:this.name=e;break;default:this.debugErr(`Received unknown editor action ${t} with payload ${JSON.stringify(e)}`)}}setSettingsConfig(t){this.settingConfigs=t}formattedExecutionTime(){return a(this.executeLastTime).format("YYYY-MM-DDTHH:MM:ss")}setNodeState(t){this.nodeState=t,this.side==m.Side.server&&this.broadcastNodeStateToClients()}settingsWithValidation(t){const e=t;let i=new(v.NodeTypeRegistry.instance().get(this.type))(this.container,this.id,this.properties);const s=Object.assign({},i.settings);return Object.keys(e).forEach(t=>{e[t].validation=s[t]?s[t].validation:null}),e}displayError(t,e=""){this.container.server_editor_socket.emit(u.ERROR,`${e} ${this.extractErrorMessage(t)}`)}displayMessage(t){this.container.server_editor_socket.emit(u.NOTIFICATION,t)}dispatch(t,e){if(0===t){const{PubSubHelpers:t}=i(53);t.dispatch(this,e)}}extractErrorMessage(t){return n.get(t,"response.data.message",n.get(t,"message",t))}}s([d.ErrorHandler],E.prototype,"deserialize",null),e.Node=E},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6);class n{static getTimeStamp(){const t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()+":00")}static onlySerializable(t){return JSON.parse(JSON.stringify(t))}static cloneObject(t,e){if(null==t)return null;let i=JSON.parse(JSON.stringify(t));if(!e)return i;for(let t in i)e[t]=i[t];return e}static parseValue(t,e){const i=typeof t;if(null===t&&"string"===e&&"string"!==i)return"";if(null==t)return t;if("number"===e&&"number"!==i)return"boolean"===i?t?1:0:isNaN(parseFloat(t))?null:parseFloat(t);if("string"===e&&"string"!==i)return JSON.stringify(t);if("boolean"===e&&"boolean"!==i)return s.isNull(t)||""===t?null:/true|1/gi.test(t);if("json"===e){const e=t;if(t={},"string"===i)try{t=JSON.parse(e)}catch(t){}else if("object"===i)try{t=JSON.parse(JSON.stringify(e))}catch(t){}}return t}static formatValue(t){return null==t?"":this.formatAsPerValueType(t)}static formatNodeInOut(t){return null===t?"null":""===t?"null":void 0!==t?this.formatAsPerValueType(t):void 0}static formatAsPerValueType(t){if("boolean"==typeof t)t=t?"true":"false";else if("number"==typeof t)t=parseFloat(t.toFixed(3)).toString();else if("object"==typeof t){try{JSON.parse(JSON.stringify(t))}catch(t){return"[object]"}t=JSON.stringify(t)}return t}static hasInput(t){return void 0!==t}static hasValidInput(t,e){return e?void 0!==t:null!=t&&""!==t}static getTime(){return"undefined"!=typeof performance?performance.now():Date.now()}static toFixedNumber(t,e){let i=Math.pow(10,e);return+Math.round(t*i)/i}static formatAndTrimValue(t){const e=typeof t;return null==t||"string"!==e&&"object"!==e?t:("object"===e&&(t=JSON.stringify(t)),t.length>30&&(t=t.substr(0,30)+"..."),t)}static copyToClipboard(t){const e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{return document.execCommand("copy")}catch(t){return!1}finally{document.body.removeChild(e)}}static download(t,e){const i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}static getISOday(t){return n.WEEKDAYS.indexOf(t.toLowerCase())}}e.default=n,n.operatorsBoolName=["==","!=","<","<=",">",">="],n.operatorsMathName=["+","-","/","*","min","max"],n.operatorsBool={eq:function(t,e){return t==e},neq:function(t,e){return t!=e},lt:function(t,e){return t<e},lte:function(t,e){return t<=e},gt:function(t,e){return t>e},gte:function(t,e){return t>=e},btwn:function(t,e,i){return t>=e&&t<=i||t<=e&&t>=i},contains:function(t,e){return-1!=(t+"").indexOf(e)},regex:function(t,e,i,s){return(t+"").match(new RegExp(e,s?"i":""))},true:function(t){return!0===t},false:function(t){return!1===t},null:function(t){return null==t},notNull:function(t){return null!=t},empty:function(t){return"string"==typeof t||Array.isArray(t)||Buffer.isBuffer(t)?0===t.length:"object"==typeof t&&null!==t&&0===Object.keys(t).length},notEmpty:function(t){return"string"==typeof t||Array.isArray(t)||Buffer.isBuffer(t)?0!==t.length:"object"==typeof t&&null!==t&&0!==Object.keys(t).length}},n.operatorsStatName=["max","min","range","midRange","sum","mean","median","variance","standardDeviation","meanAbsoluteDeviation"],n.stat={max:function(t){return Math.max.apply(null,t)},min:function(t){return Math.min.apply(null,t)},range:function(t){return n.stat.max(t)-n.stat.min(t)},midRange:function(t){return n.stat.range(t)/2},sum:function(t){let e=0;for(let i=0,s=t.length;i<s;i++)e+=t[i];return e},mean:function(t){return n.stat.sum(t)/t.length},median:function(t){t.sort((function(t,e){return t-e}));const e=t.length/2;return e%1?t[e-.5]:(t[e-1]+t[e])/2},modes:function(t){if(!t.length)return[];let e={},i=0,s=[];return t.forEach((function(t){e[t]?e[t]++:e[t]=1,e[t]>i?(s=[t],i=e[t]):e[t]===i&&(s.push(t),i=e[t])})),s},variance:function(t){const e=n.stat.mean(t);return n.stat.mean(t.map((function(t){return Math.pow(t-e,2)})))},standardDeviation:function(t){return Math.sqrt(n.stat.variance(t))},meanAbsoluteDeviation:function(t){const e=n.stat.mean(t);return n.stat.mean(t.map((function(t){return Math.abs(t-e)})))},zScores:function(t){const e=n.stat.mean(t),i=n.stat.standardDeviation(t);return t.map((function(t){return(t-e)/i}))}},n.buildUrl=(t,e,i="http")=>`${i}://${t}${e?`:${e}`:""}`,n.sum=t=>t.reduce((t,e)=>t+e,0),n.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},n.remap=function(t,e,i,s,n){return t=Number(t),e=Number(e),i=Number(i),s=Number(s),t>i?t=i:t<e&&(t=e),(t-e)/(i-e)*((n=Number(n))-s)+s},n.renameKey=(t,e)=>i=>{if(t===e)return i;const s=Object.assign(Object.assign({},i),{[e]:i[t]});return delete s[t],s},n.pSBC=(t,e,i,s=!1)=>{let n,o,a,r,u,d,l,p,h=parseInt,c=Math.round,g="string"==typeof i;if("number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!=e[0]&&"#"!=e[0]||i&&!g)return null;const m=t=>{let e=t.length,i={r:0,g:0,b:0,a:0};if(e>9){if([n,o,a,r]=t=t.split(","),e=t.length,e<3||e>4)return null;i.r=h("a"==n[3]?n.slice(5):n.slice(4)),i.g=h(o),i.b=h(a),i.a=r?parseFloat(r):-1}else{if(8==e||6==e||e<4)return null;e<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?t[4]+t[4]:"")),t=h(t.slice(1),16),9==e||5==e?(i.r=t>>24&255,i.g=t>>16&255,i.b=t>>8&255,i.a=c((255&t)/.255)/1e3):(i.r=t>>16,i.g=t>>8&255,i.b=255&t,i.a=-1)}return i};return p=e.length>9,p=g?i.length>9||"c"==i&&!p:p,d=m(e),u=t<0,l=i&&"c"!=i?m(i):u?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},u=1-(t=u?-1*t:t),d&&l?(s?(n=c(u*d.r+t*l.r),o=c(u*d.g+t*l.g),a=c(u*d.b+t*l.b)):(n=c(Math.pow(u*Math.pow(d.r,2)+t*Math.pow(l.r,2),.5)),o=c(Math.pow(u*Math.pow(d.g,2)+t*Math.pow(l.g,2),.5)),a=c(Math.pow(u*Math.pow(d.b,2)+t*Math.pow(l.b,2),.5))),r=d.a,l=l.a,d=r>=0||l>=0,r=d?r<0?l:l<0?r:r*u+l*t:0,p?"rgb"+(d?"a(":"(")+n+","+o+","+a+(d?","+c(1e3*r)/1e3:"")+")":"#"+(4294967296+16777216*n+65536*o+256*a+(d?c(255*r):0)).toString(16).slice(1,d?void 0:-2)):null},n.WEEKDAYS=[null,"monday","tuesday","wednesday","thursday","friday","saturday","sunday"],n.sleep=t=>new Promise(e=>setTimeout(e,t))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isContainer=e.isSerializedContainer=e.isFolderNode=e.isNode=e.Side=void 0;const s=i(103),n=i(6);class o extends s.Enumify{constructor(t){super(),this.name=t}toString(){return this.name}}e.Side=o,o.server=new o("SERVER"),o.editor=new o("EDITOR"),o.dashboard=new o("DASHBOARD"),o._=o.closeEnum(),e.isNode=t=>n.isNotNull(t)&&"object"==typeof t&&"id"in t&&"cid"in t&&"type"in t,e.isFolderNode=t=>e.isNode(t)&&"sub_container"in t,e.isSerializedContainer=t=>n.isNotNull(t)&&!e.isNode(t)&&"object"==typeof t&&"id"in t,e.isContainer=t=>e.isSerializedContainer(t)&&n.isFunction(t.nodeRegistry)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.objectOf=e.groupBy=e.arrayToObject=e.mapToObjectSameKey=e.mapToObject=e.unionToArray=e.union=e.range=e.Generator=e.convertToNumber=e.isNumeric=e.isFunction=e.parseBool=e.toLowerSnakeCase=e.isEmpty=e.isGreaterThanZero=e.isString=e.isJSON=e.isNotNull=e.isNull=void 0,e.isNull=t=>null==t,e.isNotNull=t=>!e.isNull(t),e.isJSON=t=>e.isNotNull(t)&&("object"==typeof t||Array.isArray(t)),e.isString=t=>"string"==typeof t||t instanceof String,e.isGreaterThanZero=t=>e.isNumeric(t)&&+t>0,e.isEmpty=t=>!!e.isNull(t)||(t instanceof Array?0===t.length:t instanceof Object?0===Object.keys(t).length:t instanceof String?""===t.trim():""===t.toString().trim()),e.toLowerSnakeCase=t=>e.isNull(t)?null:t.toString().toLowerCase().replace(/-+\s+/g,"_"),e.parseBool=function(t){return null==t.length?1==t:"true"==t},e.isFunction=t=>t&&"[object Function]"==={}.toString.call(t),e.isNumeric=t=>!isNaN(parseFloat(t))&&isFinite(t),e.convertToNumber=(t,i=!1)=>{if(e.isNull(t))return null;let s=t.toString(),n=+s;if(e.isNumeric(n)&&!/^\s*$/.test(s))return n;if(i)throw new Error("Invalid number");return null},e.Generator={map:(t,e)=>function*(...i){for(const s of t(...i))yield e(s)},filter:(t,e)=>function*(...i){for(const s of t(...i))e(s)&&(yield s)}},e.range=function*(t,e,i=1){let s=0,n=1+~~((e-t)/i);for(;s<n;)yield t+s++*i},e.union=(...t)=>t.reduce((t,e)=>new Set([...t,...e]),new Set),e.unionToArray=(...t)=>[...e.union(...t)],e.mapToObject=(t,e,i)=>t?Object.keys(t).reduce((s,n)=>Object.assign(Object.assign({},s),{[""+e(n,t[n])]:i(n,t[n])}),{}):{},e.mapToObjectSameKey=(t,i)=>e.mapToObject(t,(t,e)=>t,i),e.arrayToObject=(t,e,i)=>t.reduce((t,s,n)=>(t[""+e(s,n)]=i(s,n),t),{}),e.groupBy=(t,e,i)=>t.reduce((t,s,n)=>{var o;const a=""+e(s,n);return t[a]=[...null!==(o=t[a])&&void 0!==o?o:[],...i(s,a,n)],t},{}),e.objectOf=(t,e)=>{const i={};return i[t]=e,i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TIME_TYPE=void 0;const s=i(14);var n;!function(t){t.DAYS="days",t.HOURS="hours",t.MINUTES="minutes",t.SECONDS="seconds",t.MILLISECONDS="milliseconds"}(n=e.TIME_TYPE||(e.TIME_TYPE={}));class o{static timeConvert(t,e){switch(e){case n.DAYS:return 24*t*60*60*1e3;case n.HOURS:return 60*t*60*1e3;case n.MINUTES:return 60*t*1e3;case n.SECONDS:return 1e3*t;case n.MILLISECONDS:return t;default:return-1}}static nearestFutureMinutes(t,e){const i=Math.ceil(e.minute()/t)*t;return e.clone().minute(i).second(0).millisecond(0)}static timeDisplay(t,e=5,i){let n=t;i&&"milliseconds"!=i&&(n=o.timeConvert(n,i));const a=s.duration(n);switch(e){case 0:return a.days().toString()+":"+a.hours()+":"+a.minutes()+":"+a.seconds()+":"+a.milliseconds();case 1:return"DD:HH:MM:SS:MS "+a.days()+":"+a.hours()+":"+a.minutes()+":"+a.seconds()+":"+a.milliseconds();case 2:return"DD"+a.days()+":HH"+a.hours()+":MM"+a.minutes()+":SS"+a.seconds()+":MS"+a.milliseconds();case 3:return"DD"+a.days().toString().padStart(2,"0")+":HH"+a.hours().toString().padStart(2,"0")+":MM"+a.minutes().toString().padStart(2,"0")+":SS"+a.seconds().toString().padStart(2,"0")+":MS"+a.milliseconds().toString().padStart(3,"0");case 4:return"D"+a.days()+":H"+a.hours()+":M"+a.minutes()+":S"+a.seconds()+":MS"+a.milliseconds();case 5:return"D"+a.days().toString().padStart(2,"0")+":H"+a.hours().toString().padStart(2,"0")+":M"+a.minutes().toString().padStart(2,"0")+":S"+a.seconds().toString().padStart(2,"0")+":MS"+a.milliseconds().toString().padStart(3,"0");default:return a.days().toString()+":"+a.hours()+":"+a.minutes()+":"+a.seconds()+":"+a.milliseconds()}}static timeConvertPlus(t){try{const e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];let s=t.toDateString(),n=t.getTime(),o=this.pad(t.getMonth()+1,2),a=e[t.getMonth()],r=i[t.getDay()],u=this.pad(t.getDate(),2),d=t.getFullYear(),l=t.getHours(),p=t.getMinutes(),h=Math.ceil((t-new Date(t.getFullYear(),0,1))/864e5),c=this.pad(l,2),g=this.pad(p,2),m=this.pad(t.getSeconds(),2),f=this.pad(t.getMilliseconds(),3),O=null;O=0===l?12:l>12?l-12:l,O=""+O;let y=60*l+p;return y=y<720?"AM":"PM",{date:s,yearMonthDay:d+"-"+o+"-"+u,year:""+d,month:a,monthAsNumber:o,dayAsNumber:u,dayOfYearNumber:""+h,day:r,pmOrAm:y,hourAsAmPm:O,hour:c,timeHourMin:c+":"+g,time:c+":"+g+":"+m,minute:g,minutesSeconds:g+":"+m,seconds:m,milliseconds:f,epoch:""+n,rawDate:t}}catch(t){console.log(t)}}static pad(t,e){let i=t+"";for(;i.length<e;)i="0"+i;return i}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlexibleNode=void 0;const s=i(3),n=i(1),o=i(4);class a extends s.Node{constructor(){super(),this.nullableInputs=!0,this.dynamicInputsExist=!0,this.dynamicOutputsExist=!1,this.dynamicSettingsExist=!0,this.dynamicInputsField="inputs",this.dynamicOutputsField="outputs",this.dynamicInputStartPosition=0,this.dynamicInputsStartName="in",this.dynamicOutputsStartName="out",this.dynamicInputsType=n.Type.ANY,this.dynamicOutputsType=n.Type.ANY,this.dynamicMinInputs=2,this.dynamicMaxInputs=100,this.dynamicMinOutputs=2,this.dynamicMaxOutputs=100,this.dynamicDefaultInputs=2,this.dynamicDefaultOutputs=2,this.addDynamicInputsOnRange=(t=!0)=>{const e=this.dynamicInputsCount(),i=o.default.clamp(e,this.dynamicMinInputs,this.dynamicMaxInputs)-(this.getInputsCount()-this.dynamicInputStartPosition);if(i>0)for(let t=0;t<i;t++)this.addInputWithName();else if(i<0){const t=this.getInputsCount();for(let e=t;e>t+i;e--)this.removeInput(e-1)}t&&this.updateNodeInput()},this.addDynamicOutputsOnRange=(t=!0)=>{const e=this.dynamicOutputsCount(),i=o.default.clamp(e,this.dynamicMinOutputs,this.dynamicMaxOutputs)-this.getOutputsCount();if(i>0)for(let t=0;t<i;t++)this.addOutputWithName();else if(i<0){const t=this.getOutputsCount();for(let e=t;e>t+i;e--)this.removeOutput(e-1)}t&&this.updateNodeOutput()},this.settingWiseDynamicInputsAndSettingsUpdate=(t=!0)=>{const e=this.getInputsCount();this.addDynamicInputsOnRange(t);const i=this.getInputsCount();this.addDynamicSettings(e,i)},this.settingWiseDynamicInputsAndSettingsUpdateForBoolean=(t=!0)=>{this.dynamicInputsType=n.Type.BOOLEAN;const e=this.getInputsCount();this.addDynamicInputsOnRange(t);const i=this.getInputsCount(),s=this.dynamicInputsStartName;for(let t=e;t<i;t++)this.settings[`${s} ${this.dynamicIndex(t)}`]||(this.settings[`${s} ${this.dynamicIndex(t)}`]=n.NodeSetting.create({description:`${s} ${this.dynamicIndex(t)}`,type:n.SettingType.DROPDOWN,config:{items:[{value:!1,text:"false"},{value:!0,text:"true"},{value:null,text:"null"}]},value:null}));for(let t=i;t<e;t++)delete this.settings[`${s} ${this.dynamicIndex(t)}`]},this.dynamicInputsCount=()=>this.settings[this.dynamicInputsField].value,this.dynamicOutputsCount=()=>this.settings[this.dynamicOutputsField].value,this.addInputWithName=()=>{let t=this.getFreeInputId(),e=this.getInputSetting(),i=`${this.dynamicInputsStartName} ${t+1-this.dynamicInputStartPosition}`;this.dynamicSettingsExist&&(i=`[${i}]`);let s=n.NodeInput.create({name:i,type:this.dynamicInputsType,setting:e});this.inputs||(this.inputs={}),this.inputs[t]=s,this.onInputAdded&&this.onInputAdded(s)},this.addOutputWithName=()=>{let t=this.getFreeOutputId(),e=`${this.dynamicOutputsStartName} ${t+1}`,i=n.NodeOutput.create({name:e,type:this.dynamicOutputsType});this.outputs||(this.outputs={}),this.outputs[t]=i,this.onOutputAdded&&this.onOutputAdded(i)},this.addDynamicSettings=(t,e)=>{const i=n.SettingType.STRING?"":null,s=this.dynamicInputsStartName,o=n.convertType(this.dynamicInputsType);for(let a=t;a<e;a++)this.settings[`${s} ${this.dynamicIndex(a)}`]||(this.settings[`${s} ${this.dynamicIndex(a)}`]=n.NodeSetting.create({description:`${s} ${this.dynamicIndex(a)}`,value:i,type:o}));for(let i=e;i<t;i++)delete this.settings[`${s} ${this.dynamicIndex(i)}`]},this.dynamicIndex=t=>t+1-this.dynamicInputStartPosition}setup(){this.dynamicInputsExist&&(this.settings.inputs=n.NodeSetting.create({description:"Inputs count",value:this.dynamicDefaultInputs,type:n.SettingType.NUMBER})),this.dynamicOutputsExist&&(this.settings.outputs=n.NodeSetting.create({description:"Outputs count",value:this.dynamicDefaultOutputs,type:n.SettingType.NUMBER}))}init(){this.dynamicInputsExist&&this.changeDynamicInputsAndSettings(!1),this.dynamicOutputsExist&&this.addDynamicOutputsOnRange(!1)}onAfterSettingsChange(){this.dynamicInputsExist&&this.changeDynamicInputsAndSettings(),this.dynamicOutputsExist&&this.addDynamicOutputsOnRange()}changeDynamicInputsAndSettings(t=!0){this.dynamicSettingsExist?this.dynamicInputsType===n.Type.BOOLEAN?this.settingWiseDynamicInputsAndSettingsUpdateForBoolean(t):this.settingWiseDynamicInputsAndSettingsUpdate(t):this.addDynamicInputsOnRange(t)}getInputSetting(){return{exist:this.dynamicSettingsExist,nullable:this.nullableInputs,hidden:!1}}}e.FlexibleNode=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.heartbeat_logger=e.server_logger=e.node_service_logger=e.reliability_logger=e.registry_logger=e.db_logger=void 0;const s=i(13);e.db_logger=s.create("database",{color:s.Colors.Blue}),e.registry_logger=s.create("registry",{color:s.Colors.Blue}),e.reliability_logger=s.create("reliability",{color:s.Colors.Red}),e.node_service_logger=s.create("node-service",{color:s.Colors.Cyan}),e.server_logger=s.create("server",{color:s.Colors.Yellow}),e.heartbeat_logger=s.create("heartbeat",{color:s.Colors.Yellow})},function(t,e,i){"use strict";var s,n,o,a,r,u,d,l,p,h,c,g,m,f,O,y,v,N,T,I,S,b,E,D,_,R,A,C,P,w,M,U,x,B,L,F,k,j,G,V,W,H,$,Y;Object.defineProperty(e,"__esModule",{value:!0}),e.RUBIX_VERSION=void 0;const z=null===process||void 0===process?void 0:process.env,q={rubix:{version:"1.8.4-7892470",buildNb:""},secretKey:(null==z?void 0:z.SECRET_KEY)||"",port:parseInt(null!==(s=null==z?void 0:z.PORT)&&void 0!==s?s:"1313"),dataDir:null==z?void 0:z.DATA_DIR,loopInterval:parseInt(null!==(n=null==z?void 0:z.LOOP_INTERVAL)&&void 0!==n?n:"100"),backendSync:{enabled:/true|1/i.test(null!==(o=null==z?void 0:z.BACKEND_ENABLED)&&void 0!==o?o:"false"),baseUrl:null!==(a=null==z?void 0:z.BACKEND_API)&&void 0!==a?a:"",nodeRefreshIntervalSeconds:parseInt(null!==(r=null==z?void 0:z.NODE_DISTANCE)&&void 0!==r?r:"60"),pointRefreshIntervalSeconds:parseInt(null!==(u=null==z?void 0:z.NODE_REFRESH_INTERVAL_SEC)&&void 0!==u?u:"60"),nodeDistance:parseInt(null!==(d=null==z?void 0:z.POINT_REFRESH_INTERVAL_SEC)&&void 0!==d?d:"60")},database:{compactionInterval:30},bsa:{baseURL:null!==(l=null==z?void 0:z.BSA_BASEURL)&&void 0!==l?l:"",username:null!==(p=null==z?void 0:z.BSA_USERNAME)&&void 0!==p?p:"",password:null!==(h=null==z?void 0:z.BSA_PASSWORD)&&void 0!==h?h:"",paths:{measurement:{path:null!==(c=null==z?void 0:z.BSA_PATHS_MEASUREMENT_PATH)&&void 0!==c?c:"",accept:null!==(g=null==z?void 0:z.BSA_PATHS_MEASUREMENT_ACCEPT)&&void 0!==g?g:""},alarm:{path:null!==(m=null==z?void 0:z.BSA_PATHS_ALARM_PATH)&&void 0!==m?m:"",accept:null!==(f=null==z?void 0:z.BSA_PATHS_ALARM_ACCEPT)&&void 0!==f?f:"",contentType:null!==(O=null==z?void 0:z.BSA_PATHS_ALARM_CONTENTTYPE)&&void 0!==O?O:""},device:{path:null!==(y=null==z?void 0:z.BSA_PATHS_DEVICE_PATH)&&void 0!==y?y:""},operation:{path:null!==(v=null==z?void 0:z.BSA_PATHS_OPERATION_PATH)&&void 0!==v?v:"",accept:null!==(N=null==z?void 0:z.BSA_PATHS_OPERATION_ACCEPT)&&void 0!==N?N:"",contentType:null!==(T=null==z?void 0:z.BSA_PATHS_OPERATION_CONTENTTYPE)&&void 0!==T?T:""}}},ditto:{baseURL:null!==(I=null==z?void 0:z.DITTO_BASEURL)&&void 0!==I?I:"",username:null!==(S=null==z?void 0:z.DITTO_USERNAME)&&void 0!==S?S:"",password:null!==(b=null==z?void 0:z.DITTO_PASSWORD)&&void 0!==b?b:""},pg:{baseURL:null!==(E=null==z?void 0:z.PG_BASEURL)&&void 0!==E?E:""},influxDb:{protocol:null!==(D=null==z?void 0:z.INFLUX_DB_PROTOCOL)&&void 0!==D?D:"http",host:null!==(_=null==z?void 0:z.INFLUX_DB_HOST)&&void 0!==_?_:"",port:null!==(R=null==z?void 0:z.INFLUX_DB_PORT)&&void 0!==R?R:"",databaseName:null!==(A=null==z?void 0:z.INFLUX_DB_DB_NAME)&&void 0!==A?A:"",username:null!==(C=null==z?void 0:z.INFLUX_DB_USERNAME)&&void 0!==C?C:"",password:null!==(P=null==z?void 0:z.INFLUX_DB_PASSWORD)&&void 0!==P?P:""},influxDb2:{protocol:null!==(w=null==z?void 0:z.INFLUX_DB_2_PROTOCOL)&&void 0!==w?w:"http",url:null!==(M=null==z?void 0:z.INFLUX_DB_2_URL)&&void 0!==M?M:"",token:null!==(U=null==z?void 0:z.INFLUX_DB_2_TOKEN)&&void 0!==U?U:"",bucket:null!==(x=null==z?void 0:z.INFLUX_DB_2_BUCKET)&&void 0!==x?x:"",org:null!==(B=null==z?void 0:z.INFLUX_DB_2_ORG)&&void 0!==B?B:"",username:null!==(L=null==z?void 0:z.INFLUX_DB_2_USERNAME)&&void 0!==L?L:"",password:null!==(F=null==z?void 0:z.INFLUX_DB_2_PASSWORD)&&void 0!==F?F:""},edge28:{baseURL:null!==(k=null==z?void 0:z.EDGE_28_BASEURL)&&void 0!==k?k:"",port:parseInt(null!==(j=null==z?void 0:z.EDGE_28_PORT)&&void 0!==j?j:"5000"),apiVer:null!==(G=null==z?void 0:z.EDGE_28_API_VER)&&void 0!==G?G:""},mqtt:{protocol:null!==(V=null==z?void 0:z.MQTT_PROTOCOL)&&void 0!==V?V:"mqtt",host:null!==(W=null==z?void 0:z.MQTT_HOST)&&void 0!==W?W:"",port:parseInt(null!==(H=null==z?void 0:z.MQTT_PORT)&&void 0!==H?H:"1883"),username:null!==($=null==z?void 0:z.MQTT_USERNAME)&&void 0!==$?$:"",password:null!==(Y=null==z?void 0:z.MQTT_PASSWORD)&&void 0!==Y?Y:""}};e.RUBIX_VERSION=`v${q.rubix.version}${q.rubix.buildNb&&`-${q.rubix.buildNb}`}`,e.default=q},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeTypeRegistry=void 0;const s=i(6),n=i(12),o=i(3),a=i(39);class r extends a.AbstractRegistry{constructor(){super()}static instance(){return r._instance||(r._instance=new r),r._instance}static registerNodeType(t,e,i=null,s=!0,n=!1,a=!1){if(!(e.prototype instanceof o.Node))throw`Can't register node of type [${t}]. Class must inherit Node base class!`;e.type=t,e.category=t.substr(0,t.lastIndexOf("/")),e.node_name=t.substr(t.lastIndexOf("/")+1,t.length),e.show_in_menu=s,e.parentContainerNodeType=i,e.recursive=n,e.onlyInsideContainer=a;let u=new e;e.icon=u.iconImageUrl,e.color=u.headerColor,e.title=u.title||u.type,r.instance().register(e,!0,t)}lookupNodeType(t){return this.has(t)?t:n.UNKNOWN_NODE}getNodeTypesInCategory(t){return Object.values(this._registry).filter(e=>e.category==(t||null))}nodeIsInCategory(t){return e=>e.category==(t||null)}getNodeTypesCategories(){return s.unionToArray(Object.values(this._registry).filter(t=>!!t.category&&t.show_in_menu).map(t=>t.category))}enableDebug(){return!1}createKey(t){}}e.NodeTypeRegistry=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UNKNOWN_NODE=e.MQTT_POINT_READ=e.MQTT_POINT_WRITE=e.MQTT_NETWORK=e.EDGE_28_OUTPUT=e.EDGE_28_INPUT=e.EDGE_28_NETWORK=e.BACNET_POINT=e.BACNET_DEVICE=e.BACNET_NETWORK=e.MODBUS_RTU_POINT=e.MODBUS_RTU_DEVICE=e.MODBUS_RTU_NETWORK=e.IOT_TYPES=e.MODULE_NODE_TYPE=e.SERVICE_NODE_TYPE=e.POINT_NODE_TYPE=e.GROUP_CONTAINER_TYPE=e.DEVICE_CONTAINER_TYPE=e.NETWORK_CONTAINER_TYPE=e.EDGE_CONTAINER_TYPE=e.SERVICES_PARENT_CONTAINER_TYPE=e.MODULES_PARENT_CONTAINER_TYPE=e.EDGES_PARENT_CONTAINER_TYPE=void 0,e.EDGES_PARENT_CONTAINER_TYPE="IoT/edges-container",e.MODULES_PARENT_CONTAINER_TYPE="IoT/modules-container",e.SERVICES_PARENT_CONTAINER_TYPE="IoT/services-container",e.EDGE_CONTAINER_TYPE="IoT/edge",e.NETWORK_CONTAINER_TYPE="IoT/network",e.DEVICE_CONTAINER_TYPE="IoT/device",e.GROUP_CONTAINER_TYPE="IoT/group",e.POINT_NODE_TYPE="IoT/point",e.SERVICE_NODE_TYPE="IoT/service",e.MODULE_NODE_TYPE="IoT/module",e.IOT_TYPES=[e.EDGES_PARENT_CONTAINER_TYPE,e.MODULES_PARENT_CONTAINER_TYPE,e.SERVICES_PARENT_CONTAINER_TYPE,e.EDGE_CONTAINER_TYPE,e.NETWORK_CONTAINER_TYPE,e.DEVICE_CONTAINER_TYPE,e.GROUP_CONTAINER_TYPE,e.POINT_NODE_TYPE,e.SERVICE_NODE_TYPE,e.MODULE_NODE_TYPE],e.MODBUS_RTU_NETWORK="protocols/modbus/modbus-rtu-network",e.MODBUS_RTU_DEVICE="protocols/modbus/modbus-rtu-device",e.MODBUS_RTU_POINT="protocols/modbus/modbus-rtu-point",e.BACNET_NETWORK="protocols/bacnet/bacnet-network",e.BACNET_DEVICE="protocols/bacnet/bacnet-device",e.BACNET_POINT="protocols/bacnet/bacnet-point",e.EDGE_28_NETWORK="protocols/nube/edge-28-network",e.EDGE_28_INPUT="protocols/nube/edge-28-input",e.EDGE_28_OUTPUT="protocols/nube/edge-28-output",e.MQTT_NETWORK="protocols/mqtt/mqtt-network",e.MQTT_POINT_WRITE="protocols/mqtt/mqtt-point-write",e.MQTT_POINT_READ="protocols/mqtt/mqtt-point-read",e.UNKNOWN_NODE="unknown/unknown"},function(t,e){t.exports=require("logplease")},function(t,e){t.exports=require("moment-timezone")},function(t,e){t.exports=require("axios")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.IdGenerator=e.NoChangeId=e.BaseIdGenerator=void 0;const s=i(102),n=i(6);class o{static createNodeId(t,e){return n.isNotNull(t)?n.isNumeric(e)?`c${t}n${e}`:e:null}shouldGenerateCid(t){return t===o.ROOT||t===o.UNINITIALIZED}shouldGenerateNid(t,e){return this.shouldGenerateCid(e)}}e.BaseIdGenerator=o,o.UNINITIALIZED=-1,o.ROOT=0;e.NoChangeId=class extends o{genContainerId(t){return null!=t?t:o.UNINITIALIZED}genNodeId(t,e){return null!=e?e:o.UNINITIALIZED}};class a extends o{constructor(){super()}static instance(){return a._instance||(a._instance=new a),a._instance}genContainerId(t){return s.v4()}genNodeId(t,e){return s.v4()}}e.IdGenerator=a},function(t,e){t.exports=require("lodash")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createNodeDbHelper=void 0;const s=i(52),n=i(6),o=i(16),a=i(9),r=i(5),u=i(22);e.createNodeDbHelper=()=>new d;class d{listByIds(t,e){return a.db_logger.debug(`Query nodes by ids: [${e}]...`),t?s.AsyncDbHelper.oneArgs(t,t.listNodes,{_id:{$in:e}}):Promise.resolve([])}listByContainer(t,e){if(t){a.db_logger.debug(`Query nodes in container id '${e}'...`);const i=n.isNumeric(e)?{$in:[+e,e+""]}:e;return s.AsyncDbHelper.oneArgs(t,t.listNodes,{cid:i})}return Promise.resolve([])}update(t,e){if(t.side===r.Side.server&&t.container.db){let i=n.isEmpty(e)?t.serialize():e.reduce((e,i)=>(e[i]=u.SerializableHelper.serialize(t[i]),e),{});t.container.db.updateNode(t.id,t.container.id,{$set:i})}}updateAsync(t,e,...i){if(t){const r=n.isEmpty(i)?"whole node":`[${i}] of node`;a.db_logger.debug(`Updating ${r} '${o.IdGenerator.createNodeId(e.cid,e.id)}'...`);const d=n.isEmpty(i)?u.SerializableHelper.serialize(e):i.reduce((t,i)=>(t[i]=u.SerializableHelper.serialize(e[i]),t),{});return s.AsyncDbHelper.threeArgs(t,t.updateNode,e.id,e.cid,{$set:d})}return Promise.resolve()}insert(t,e){return t?(a.db_logger.debug(`Inserting node '${o.IdGenerator.createNodeId(e.cid,e.id)}' into database...`),s.AsyncDbHelper.oneArgs(t,t.addNode,u.SerializableHelper.serialize(e))):Promise.resolve(e)}batchInsert(t,e){return t?(a.db_logger.debug(`Inserting ${e.length} nodes into database...`),s.AsyncDbHelper.oneArgs(t,t.batchInsertNodes,e.map(t=>u.SerializableHelper.serialize(t))).then(t=>(a.db_logger.debug(`Inserted ${t.length} nodes in database`),t))):Promise.resolve(e)}batchDeleteByIds(t,e){return t?(a.db_logger.debug(`Deleting node ids: [${e}] in database...`),s.AsyncDbHelper.oneArgs(t,t.batchDeleteNodes,{_id:{$in:e}}).then(t=>(a.db_logger.debug(`Deleted ${t} nodes in database`),t))):Promise.resolve(0)}delete(t,e){return t?(a.db_logger.debug(`Deleting node '${o.IdGenerator.createNodeId(e.cid,e.id)}' in database...`),s.AsyncDbHelper.twoArgs(t,t.removeNode,e.id,e.cid)):Promise.resolve()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createLinkHandler=e.createLegacyLinkHandler=e.Link=e.compareNodeIO=e.slimIOtoKey=e.nodeIOtoMsg=e.createBiNodeLink=e.createNodeLink=void 0;const s=i(13),n=i(104),o=i(35),a=i(21),r=i(6),u=i(16),d=i(18),l=s.create("node-link",{color:s.Colors.Magenta});e.createNodeLink=(t,e,...i)=>({cid:t+"",source:e,targets:i}),e.createBiNodeLink=t=>new p(t+""),e.nodeIOtoMsg=(t,e,...i)=>{const s=i.map(i=>`node '${u.IdGenerator.createNodeId(e,i.nodeId)}'-${t} '${i.ioId}'`).join(",");return r.isEmpty(s)?s:`[${s}]`},e.slimIOtoKey=t=>{var e;return t.nodeId+"/"+(null!==(e=t.ioId)&&void 0!==e?e:t.slot)},e.compareNodeIO=(t,i)=>!r.isNull(t)&&!r.isNull(i)&&e.slimIOtoKey(t)===e.slimIOtoKey(i);class p{constructor(t){this.cid=t,this._bySource={},this._byTarget={}}add(...t){return t.filter(t=>t.cid+""===this.cid).forEach(t=>{var i;const s=e.slimIOtoKey(t.source);this._bySource[s]=null!==(i=this._bySource[s])&&void 0!==i?i:{source:t.source,targets:{}},t.targets.forEach(t=>{const i=e.slimIOtoKey(t);r.isNull(this._byTarget[i])&&(this._bySource[s].targets[i]=t,this._byTarget[i]=s)})}),this}optimize(){return Object.values(this._bySource).map(t=>e.createNodeLink(this.cid,t.source,...Object.values(t.targets)))}}class h{constructor(t,e,i){this.nodeId=t+"",this.slot=e,this.ioId=(null!=i?i:e)+""}static create(t){return r.isNull(t)?null:(new h).deserialize(t)}serialize(){return Object.assign({},this)}deserialize(t){var e,i,s;return new h(null!==(e=t.nodeId)&&void 0!==e?e:t.target_node_id,null!==(i=t.slot)&&void 0!==i?i:t.target_slot,null!==(s=t.ioId)&&void 0!==s?s:t.target_input_id)}}e.Link=h,e.createLegacyLinkHandler=(t,e)=>new c(t,null!=e?e:d.createNodeDbHelper());class c{constructor(t,e){this.node=t,this.dbHelper=e}recomputeInputLinks(t){let i=null!=t?t:this.node,s=-1;for(const[t,n]of Object.entries(i.inputs)){if(n.setting.hidden)continue;if(s++,r.isNull(n.link))continue;let o=n.link,a=i.container.nodeRegistry().get(o.nodeId);if(r.isNull(a))continue;let u=o.ioId,d=o.slot,l=a.outputs[null!=u?u:d];if(r.isNull(l)||r.isNull(l.links))continue;let p=l.links.findIndex(n=>e.compareNodeIO(n,{nodeId:i.id,ioId:+t,slot:s}));-1!==p&&(l.links.splice(p,1,new h(i.id,s,t)),this.dbHelper.update(a,["outputs"]))}this.dbHelper.update(i,["inputs"])}recomputeOutputLinks(t){let e=null!=t?t:this.node,i=-1;Object.entries(e.outputs).forEach(([t,s])=>{i++,r.isEmpty(s.links)||s.links.forEach(s=>{var n;let o=e.container.nodeRegistry().get(s.nodeId);const a=null!==(n=s.ioId)&&void 0!==n?n:s.slot;r.isNull(o)||r.isNull(o.inputs[a])||(o.inputs[a].link=new h(e.id,i,t),this.dbHelper.update(o,["inputs"]))})}),this.dbHelper.update(e,["outputs"])}}e.createLinkHandler=(t,e,i,s)=>new g(t,e,i,s);class g{constructor(t,e,i,s=!1){this.validator=null!=e?e:new o.ContainerRegistryValidator(t),this.nodeValidator=null!=i?i:new o.NodeRegistryValidator,this.globalStrict=!s}static msg(t,i,s,n,...o){return[e.nodeIOtoMsg(i,t,s),e.nodeIOtoMsg(n,t,...o)]}static statement(t,e,i,s="from"){const n="from"===s?`from ${i[0]}`:`to ${i[0]}`,o=r.isEmpty(i[1])?"":`${"from"===s?"to":"from"} ${i[1]}`,a=t.includes("ing")?"...":"";return`${t} ${e} link(s) ${n} ${o}${a}`}create(t,i){const s=e.createBiNodeLink(t.cid).add(t).optimize()[0],n=g.msg(t.cid,"output",s.source,"input",...s.targets);l.info(g.statement("Connecting",s.targets.length,n));const o=this.doCreate(s,i);return o.message=g.statement("Connected",s.targets.length,n),o}batchCreate(...t){return Object.entries(r.groupBy(t,t=>t.cid,t=>[t])).map(([t,i])=>e.createBiNodeLink(t).add(...i)).flatMap(t=>t.optimize()).reduce((t,e)=>t.merge(this.doCreate(e,!0)),new n.LinkResult)}remove(t,i){const s=this.validator.validate(t.cid),n=e.createBiNodeLink(t.cid).add(t).optimize()[0],o=g.msg(n.cid,"output",n.source,"input",...n.targets);l.info(g.statement("Disconnecting",n.targets.length,o));const a=this.doDisconnectOutput(s,n.source,!i,t=>n.targets.some(i=>e.compareNodeIO(i,t)));return a.message=g.statement("Disconnected",n.targets.length,o),a}move(t,i,s){let n,o;const a=e.createBiNodeLink(i.cid).add(i).optimize()[0];if("input"===t){if(1!=a.targets.length)throw new Error("Cannot move empty or more than one input's link to another node");n=e.createNodeLink(a.cid,a.source,s),o=a.targets[0]}else n=e.createNodeLink(a.cid,s,...a.targets),o=a.source;const r=g.msg(a.cid,t,o,t,s);l.info(g.statement("Moving",a.targets.length,r));const u=this.remove(a,!0).merge(this.doCreate(n,!0,...a.targets));return u.message=g.statement("Moved",a.targets.length,r),u}disconnectInput(t,e){const i=g.msg(t,"input",e);return l.info(g.statement("Disconnecting","all",i,"to")),this.doDisconnectInput(this.validator.validate(t),e,!1)}disconnectOutput(t,e){const i=g.msg(t,"output",e);return l.info(g.statement("Disconnecting","all",i)),this.doDisconnectOutput(this.validator.validate(t),e,!1)}doCreate(t,e,...i){const s=this.validator.validate(t.cid),o=this.validateSource(s,t.source,this.globalStrict);return r.isNull(o.io)?new n.LinkResult:t.targets.map(t=>this.doConnect(s,o,t,!e,i)).reduce((t,e)=>t.merge(e),new n.LinkResult)}validateTarget(t,e,i){var s;const n=this.nodeValidator.validate(e.nodeId,t,i),o=null!==(s=e.ioId)&&void 0!==s?s:e.slot,d=r.isNull(n)?null:n.inputs[o],l=r.isNull(d)||d.setting.hidden;if(i&&l)throw new a.NotFoundError(`Not found input id ${o} in `+`node ${u.IdGenerator.createNodeId(t.id,e.nodeId)}`);return{io:l?null:e,link:l?null:h.create(d.link)}}validateSource(t,e,i){var s,n;const o=this.nodeValidator.validate(e.nodeId,t,i),d=null!==(s=e.ioId)&&void 0!==s?s:e.slot,l=r.isNull(o)?null:o.outputs[d];if(i&&r.isNull(l))throw new a.NotFoundError(`Not found output id ${d} in `+`node ${u.IdGenerator.createNodeId(t.id,e.nodeId)}`);return{io:r.isNull(l)?null:e,links:(null!==(n=null==l?void 0:l.links)&&void 0!==n?n:[]).map(t=>h.create(t))}}doConnect(t,i,s,n,o){const a=g.msg(t.id,"output",i.io,"input",s);l.debug(g.statement("Connecting",1,a));const u=this.doDisconnectInput(t,s,n,o);if(u.hasInput(t.id,s.nodeId,s.ioId)){l.debug(g.statement("Connected",1,a));const n=r.isEmpty(o)?[s]:[...o,s],d=i.links.filter(t=>!n.some(i=>e.compareNodeIO(t,i)));return u.push(t.id,s.nodeId,"input",s.ioId,i.io).push(t.id,i.io.nodeId,"output",i.io.ioId,...d,s)}return u}doDisconnectInput(t,i,s,o){const a=this.validateTarget(t,i,s);if(r.isNull(a.io))return new n.LinkResult;const u=(new n.LinkResult).push(t.id,i.nodeId,"input",i.ioId);if(r.isNull(a.link))return u;const d=this.validateSource(t,a.link,!1).links.filter(t=>!e.compareNodeIO(t,i)),p=r.isEmpty(o)?d:d.filter(t=>!o.some(i=>e.compareNodeIO(t,i)));return l.debug(g.statement("Disconnected",p.length,g.msg(t.id,"input",i),"to")),u.push(t.id,a.link.nodeId,"output",a.link.ioId,...p)}doDisconnectOutput(t,i,s,o=(t=>!0)){const a=this.validateSource(t,i,s),r=(new n.LinkResult).push(t.id,i.nodeId,"output",i.ioId);return a.links.filter(s=>e.compareNodeIO(this.validateTarget(t,s,!1).link,i)).forEach(e=>{o(e)?r.push(t.id,e.nodeId,"input",e.ioId):r.push(t.id,i.nodeId,"output",i.ioId,e)}),l.debug(g.statement("Disconnected",a.links.length,g.msg(t.id,"output",i))),r}}},function(t,e){t.exports=require("express")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegistryItemExistedError=e.RegistryError=e.NotFoundError=void 0;class s extends Error{}e.NotFoundError=s;class n extends Error{constructor(t,e){super(t),this.item=e}}e.RegistryError=n;e.RegistryItemExistedError=class extends n{}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(e,"__esModule",{value:!0}),e.SerializableHelper=void 0;const n=i(28),o=i(6);class a{static serialize(t){return o.isNull(t)?null:o.isFunction(t.serialize)?t.serialize():new r(t).serialize()}}e.SerializableHelper=a;class r{constructor(t){this.obj=t}serialize(){return this.obj instanceof Array?this.obj.map(t=>a.serialize(t)):this.obj instanceof Object?o.mapToObjectSameKey(this.obj,(t,e)=>a.serialize(e)):JSON.parse(JSON.stringify(this.obj))}}s([n.ErrorCallbackHandler(t=>null)],r.prototype,"serialize",null)},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(e,"__esModule",{value:!0}),e.UiNode=void 0;const n=i(72),o=i(3),a=i(5),r=i(1);class u extends o.Node{constructor(t,e,i){super(),this.name=i&&i.name,this.titlePrefix=t,this.defaultTitle=t,this.uiElementType=e,this.isDashboardNode=!0,this.settings.title=r.NodeSetting.create({description:"Title",value:this.titlePrefix,type:r.SettingType.STRING}),this.settings["ui-panel"]=r.NodeSetting.create({description:"Ui Panel Name",type:r.SettingType.STRING})}init(){this.settings["ui-panel"]&&(this.uiPanelValue=this.settings["ui-panel"]&&this.settings["ui-panel"].value)}onCreated(){this.settings["ui-panel"].value=this.uiPanelValue||this.container.name,this.side==a.Side.server&&this.container.dashboard.onNodeChangePanelOrTitle(this,this.settings["ui-panel"].value,this.settings.title.value)}onAdded(){this.changeTitle(this.settings.title.value)}onBeforeSettingsChange(t,e){this.side==a.Side.server&&(this.name=e,this.container.dashboard.onNodeChangePanelOrTitle(this,t["ui-panel"].value,t.title.value)),this.changeTitle(t.title.value)}changeTitle(t){this.defaultTitle===t?this.title=t:this.title=this.defaultTitle+": "+t}onRemoved(){this.side==a.Side.server&&this.container.dashboard.onNodeRemoved(this)}setState(t,e=!0){if(this.properties.state=t,null!=this.container){if(e){let e={id:this.id,cid:this.container.id,state:t};if(this.side==a.Side.server){let t=this.container.server_dashboard_socket,i=this.settings["ui-panel"].value;t.in(""+i).emit("dashboardElementGetNodeState",e)}}this.storeInDatabase()}}storeInDatabase(){this.container&&this.container.db&&this.container.db.updateNode(this.id,this.container.id,{$set:{properties:this.properties}})}sendMessageToDashboardSide(t){let e={id:this.id,cid:this.container.id,message:t};if(this.side==a.Side.server){let t=this.container.server_dashboard_socket,i=this.settings["ui-panel"].value;t.in(""+i).emit("nodeMessageToDashboardSide",e)}else this.container.client_socket.emit("nodeMessageToDashboardSide",e)}getState(){return this.properties.state}}s([n.default(1e3)],u.prototype,"storeInDatabase",null),e.UiNode=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(8),n=i(1);class o extends s.FlexibleNode{constructor(){super(),this.dynamicInputsType=n.Type.NUMBER}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){}getDefinedInputsOrSettingsValues(){const t=[];for(let e=0;e<this.getInputsCount();e++){const i=this.getInputData(e);null!=i&&t.push(i)}return t}}e.default=o},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerNode=void 0;const n=i(28),o=i(12),a=i(0),r=i(3),u=i(2),d=i(1);class l extends r.Node{constructor(){super(),this.title=u.NODE_INFO.container.folder.title,this.description=u.NODE_INFO.container.folder.description,this.settings.name=d.NodeSetting.create({description:"Folder name",type:d.SettingType.STRING}),this.sub_container={}}static create(t,e,i,s){return(new l).deserialize(t,e,i,s)}shouldRejectNodeType(t){return o.IOT_TYPES.includes(t)}onCreated(){}onAdded(){this.applyTitle(),super.onAdded()}afterAdded(){super.afterAdded()}onAfterSettingsChange(t,e){this.applyTitle()}onRemoved(){}serialize(){var t;return Object.assign(Object.assign({},super.serialize()),{sub_container:null===(t=this.sub_container)||void 0===t?void 0:t.serialize()})}deserialize(t,e,i,s){return a.reassignContainer(super.deserialize(t,e),t.sub_container,i,s)}getExtraMenuOptions(t,e){let i=this;return[{content:"Open",callback:function(){e.openContainer(i.sub_container.id)}},null]}onExecute(){this.isUpdated&&(this.isRecentlyActive=!0),this.sub_container.runStep()}applyTitle(){var t,e;this.settings.name.value=null!==(e=null===(t=this.settings.name)||void 0===t?void 0:t.value)&&void 0!==e?e:`${l.NAME} ${this.sub_container.id}`,this.title=this.title===l.NAME?this.settings.name.value:this.title,this.sub_container.name=this.title}}l.NAME="Folder",s([n.ErrorHandler],l.prototype,"deserialize",null),e.ContainerNode=l},function(t,e){t.exports=require("child_process")},function(t,e,i){"use strict";if(Object.defineProperty(e,"__esModule",{value:!0}),e.App=void 0,"function"!=typeof Promise.allSettled&&(Promise.allSettled=function(t){return Promise.all(t.map(t=>Promise.resolve(t).then(t=>({status:"fulfilled",value:t}),t=>({status:"rejected",reason:t}))))}),void 0===Array.prototype.flatMap){const t=(t,e)=>t.concat(e),e=(e,i)=>i.map(e).reduce(t,[]);Array.prototype.flatMap=function(t){return e(t,this)}}i(97).install();const s=i(13),n=s.create("app",{color:s.Colors.Green}),o=i(51),a=i(98),r=i(99)(a.argv.slice(2)),u=a.env.DATA_DIR||r.datadir||"./db",d=r.envFile||".env",l=o.isAbsolute(d)?d:o.resolve(a.cwd(),d);a.env.DATA_DIR=o.isAbsolute(u)?u:o.resolve(a.cwd(),u),i(100).config({path:l}),global.__rootdirname=o.resolve(__dirname);const p=i(101),h=i(10),c=i(55),g=i(52),m=i(0),f=i(38),O=i(5),y=i(41),v=i(11),N=i(114),T=i(115),I=i(78),S=i(6),b=i(16);class E{constructor(){this.logger=s.create("app",{color:s.Colors.Green}),this.logger.info("----------------------------- Rubix Wires -----------------------------"),this.logger.info(`Process Dir       : '${a.cwd()}'`),this.logger.info(`Working Dir       : '${global.__rootdirname}'`),this.logger.info(`Data Dir          : '${a.env.DATA_DIR}'`),this.logger.info(`Environment       : '${a.env.NODE_ENV||"development"}'`),this.logger.info(`Environment file  : '${l}'`),this.logger.info("-----------------------------------------------------------------------"),this.registerNodeTypes(),this.server=new T.Server(global.__rootdirname,h.default.port,h.default.loopInterval),this.dashboard=new N.Dashboard(this.server.dashboardSocket),Promise.resolve(m.ContainerRegistry.instance().register(m.Container.initRoot(O.Side.server),!0)).then(t=>this.start(t)).then(t=>this.logger.info("Rubix Wires is ready"))}start(t){return this.connectDatabase().then(t=>this.db=t).then(t=>t.asyncLoadDatabase(h.default.dataDir,1e3*h.default.database.compactionInterval).then(e=>t)).then(e=>this.onDatabaseReady(t,e)).catch(e=>this.onDatabaseError(t,e))}registerNodeTypes(){i(142),this.logger.info(`Registered ${v.NodeTypeRegistry.instance().size()} nodes types`)}connectDatabase(){return this.logger.info("Loading database..."),c.dataBase.enable?c.dataBase.useInternalDb?Promise.resolve(i(406).db):Promise.reject(new Error("Unsupported external database")):Promise.reject(new Error("Not enabled database"))}startBackend(){new p.Backend(this.db,h.default.backendSync).start()}onDatabaseReady(t,e){return Promise.resolve(this.configApp(t,this.server,this.dashboard,e)).then(t=>g.AsyncDbHelper.noArgs(e,e.getNodes)).then(e=>new I.NodeTree(t.id,new b.NoChangeId).compute(e).flatten()).then(e=>this.registerNodes(t,e)).then(t=>this.dashboard.loadFromDatabase(e)).then(t=>this.startBackend()).then(e=>t.run(h.default.loopInterval))}registerNodes(t,e){return y.NodeRegistryHelper.register(t,e,m.ContainerRegistry.instance(),!0).then(t=>(n.info(`Imported ${m.ContainerRegistry.instance().size()-1} containers, `+`${t.objects.length}/${e.length} nodes successfully from database`),S.isEmpty(t.errors)||n.warn(`Import failed: [${t.errors.join("\n")}]`),t)).then(t=>(t.objects.forEach(t=>{var e;return null!==(e=f.NodeHookHelper.execute(t,"onDbReaded"))&&void 0!==e?e:t}),t))}onDatabaseError(t,e){var i;if("Not enabled database"===e.message)return this.logger.warn("Database is not enabled, rubix-wires is running on memory..."),void t.run(h.default.loopInterval);this.logger.error(`Unable to bootstrap application. Failed at: ${null!==(i=e.stack)&&void 0!==i?i:e}`),a.exit(99)}configApp(t,e,i,s){return this.logger.info("Setup root container..."),t.dashboard=i,t.server_editor_socket=e.editorSocket.io,t.server_dashboard_socket=e.dashboardSocket.io,t.db=s,t}}e.App=E;const D=new E;e.default=D},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncErrorHandler=e.ErrorCallbackHandler=e.ErrorHandler=void 0;const s=i(6),n=i(9).reliability_logger;function o(t,...e){n.error(t),"undefined"!=typeof alert&&alert(t.toString())}e.ErrorHandler=(t,e,i)=>{const s=i.value;return i.value=function(...t){try{return s.apply(this,t)}catch(t){o(t)}},i},e.ErrorCallbackHandler=t=>(e,i,n)=>{const a=n.value;return n.value=function(...e){try{return a.apply(this,e)}catch(i){if(o(i),s.isFunction(t))return t(i,e)}},n},e.AsyncErrorHandler={}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NODE_IO_VALUES=e.REMOVE_NODE_OUTPUT=e.REMOVE_NODE_INPUT=e.ADD_NODE_OUTPUT=e.ADD_NODE_INPUT=e.UPDATE_NODE_SETTING=e.MOVE_LINK=e.REMOVE_LINK=e.CREATE_LINK=e.CREATE_NODE=e.REMOVE_NODES=e.CLONE_NODES=e.EXPORT_NODES=e.IMPORT_NODES=e.PACK_UP_NODES=e.NOTIFICATION=e.ERROR=void 0,e.ERROR="error",e.NOTIFICATION="notification",e.PACK_UP_NODES="pack-up-nodes",e.IMPORT_NODES="import-nodes",e.EXPORT_NODES="export-nodes",e.CLONE_NODES="clone-nodes",e.REMOVE_NODES="remove-nodes",e.CREATE_NODE="create-node",e.CREATE_LINK="create-link",e.REMOVE_LINK="remove-link",e.MOVE_LINK="move-link",e.UPDATE_NODE_SETTING="update-node-settings",e.ADD_NODE_INPUT="add-node-input",e.ADD_NODE_OUTPUT="add-node-output",e.REMOVE_NODE_INPUT="remove-node-input",e.REMOVE_NODE_OUTPUT="remove-node-output",e.NODE_IO_VALUES="nodes-io-values"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeFactory=void 0;const s=i(0),n=i(3),o=i(5),a=i(11);class r{static create(t,e=!0,a,r){if(o.isFolderNode(t)){const{ContainerNode:s}=i(25);return s.create(t,e,a,r)}const u=(new n.Node).deserialize(t,e);return o.isFolderNode(u)?s.reassignContainer(u,t.sub_container,a,r):u}static createTempNode(t,e){const i=a.NodeTypeRegistry.instance().get(t);if(i){const s=new i;return s.type=t,s.pos=e,s.size=s.computeSize(!0),s}throw`Can't create node of type [${t}]. Make sure it is registered through registerNodeType`}static toSimpleNode(t,e){return{id:e,cid:t,type:""}}static standardize(t,e){return e.map(e=>{var i;const s=o.isNode(e)?e:r.toSimpleNode(t.id,e);return s.container=null!==(i=s.container)&&void 0!==i?i:t,s})}}e.NodeFactory=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(10),n=i(13).create("cryto-utils",{color:3}),o=i(136);class a{}e.default=a,a.encrypt=t=>{if(t)return o.AES.encrypt(t,s.default.secretKey).toString();n.error("Your text to encrypt is empty")},a.decrypt=t=>{if(t)return o.AES.decrypt(t,s.default.secretKey).toString(o.enc.Utf8);n.error("Your text to decrypt is empty")}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(26),o=i(140),a=i(141),r=i(80);class u{static execute(t,e){return new Promise((i,s)=>{n.exec(t,e,(t,e,n)=>{t?s(t):i({stdout:e,stderr:n})})})}static hostName(){return new Promise((t,e)=>{try{t(o.hostname())}catch(t){e("Unknown")}})}static getCurrentWiresVersion(){return new Promise((t,e)=>{try{t(r.version)}catch(t){e("Unknown")}})}static cpuTemperature(){return new Promise((t,e)=>{try{t(a.cpuTemperature())}catch(t){e("Unknown")}})}static fsSize(){return new Promise((t,e)=>{try{t(a.fsSize())}catch(t){e("Unknown")}})}static systemInfo(){return new Promise((t,e)=>{try{const e={cpu:"*",osInfo:"platform, release",system:"model, manufacturer"};t(a.get(e))}catch(t){e("Unknown")}})}static systemModelBBB(){return new Promise((t,e)=>{u.systemInfo().then(e=>{"GENERIC AM33XX (FLATTENED DEVICE TREE)"===e.system.model?t(!0):t(!1)}).catch(t=>{e(!1)})})}static systemModelRubixCompute(){return new Promise((t,e)=>{u.systemInfo().then(e=>{"BCM2835"===e.system.model?t(!0):t(!1)}).catch(t=>{e(!1)})})}static systemTime(){return new Promise((t,e)=>{try{t(a.time())}catch(t){e("Unknown")}})}static systemMem(){return new Promise((t,e)=>{try{t(a.mem())}catch(t){e("Unknown")}})}static systemAll(){return new Promise((t,e)=>s(this,void 0,void 0,(function*(){let e=[];yield u.systemInfo().then(t=>{console.log(" systemInfo",t),e.push({systemInfo:t})}).catch(t=>{console.log("ERROR systemInfo",t)}),yield u.systemTime().then(t=>{console.log(" systemTime",t),e.push({systemTime:t})}).catch(t=>{console.log("ERROR systemTime",t)}),yield u.fsSize().then(t=>{console.log(" fsSize",t),e.push({fsSize:t})}).catch(t=>{console.log("ERROR fsSize",t)}),yield u.cpuTemperature().then(t=>{console.log(" cpuTemperature",t),e.push({cpuTemperature:t})}).catch(t=>{console.log("ERROR cpuTemperature",t)}),yield u.hostName().then(t=>{console.log(" hostName",t),e.push({hostName:t})}).catch(t=>{console.log("ERROR hostName",t)}),yield u.getCurrentWiresVersion().then(t=>{console.log(" getCurrentWiresVersion",t),e.push({getCurrentWiresVersion:t})}).catch(t=>{console.log("ERROR getCurrentWiresVersion",t)}),t(e)})))}}e.default=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractDatabase=void 0;const s=i(408),n=i(9);e.AbstractDatabase=class{asyncLoadDatabase(t,e){const i=`${t}/${this.dbName()}.db`;return n.db_logger.info(`Loading database '${this.dbName()}' from '${i}'...`),this.db=new s({filename:`${i}`}),this.db.persistence.setAutocompactionInterval(e),this.load()}load(){return new Promise((t,e)=>{this.db.loadDatabase(i=>(i&&(n.db_logger.error(`Failed when loading database ${this.dbName()}: ${i.stack}`),e(i)),t()))})}}},function(t,e){t.exports=require("moment")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ListValidator=e.ContainerRegistryValidator=e.NodeRegistryValidator=e.NodeValidator=void 0;const s=i(5),n=i(21),o=i(6),a=i(66);e.NodeValidator=class{static NodeArrayValidator(){return a.array().items(a.object().keys({type:a.string().required()}))}};e.NodeRegistryValidator=class{validate(t,e,i=!0){const s=e.nodeRegistry().get(t);if(o.isNull(s)&&i)throw new n.NotFoundError(`Not found node id ${t} in container ${e.id}`);return s}};class r{constructor(t){this.registry=t}validate(t,e=!0){const i=this.registry.get(s.isSerializedContainer(t)?t.id:t+"");if(o.isNull(i)&&e)throw new n.NotFoundError(`Not found container id ${t}`);return i}}e.ContainerRegistryValidator=r,r.mustExisted=(t,e)=>Promise.resolve(()=>new r(e).validate(t)).then(t=>t());class u{}e.ListValidator=u,u.notEmpty=(t,e)=>t.length>0?Promise.resolve(t):Promise.reject(e)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.singleton=e.PromiseActor=void 0;class s{constructor(){this.stack=Promise.resolve(null)}process(t){const e=()=>t();return this.stack=this.stack.then(e,t=>(console.log(t),e())),Promise.resolve(this.stack)}}e.PromiseActor=s,e.singleton=new s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.edgeApiVer=e.edgePort=e.edgeIp=e.REMOVE_POINT=e.ADD_POINT=e.SEND_PAYLOAD_TO_CHILD=void 0;const s=i(10).default.edge28;e.SEND_PAYLOAD_TO_CHILD="SEND_PAYLOAD_TO_CHILD",e.ADD_POINT="ADD_POINT",e.REMOVE_POINT="REMOVE_POINT",e.edgeIp=s.baseURL,e.edgePort=s.port,e.edgeApiVer=s.apiVer},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(e,"__esModule",{value:!0}),e.NodeHookHelper=void 0;const n=i(28),o=i(6);class a{static execute(t,e,...i){return o.isFunction(t[e])&&t[e](i),t}}s([n.ErrorHandler],a,"execute",null),e.NodeHookHelper=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RegistryResult=e.AbstractRegistry=void 0;const s=i(21),n=i(6),o=i(9).registry_logger;e.AbstractRegistry=class{constructor(){this._registry={}}get(t){return this._registry[t]}has(t){return n.isNotNull(this.get(t))}list(){return Object.values(this._registry)}register(t,e,i){const s=this.optimizeBeforeRegister(this.validate(t,e,i),e);return this.doRegister(null!=i?i:this.createKey(s),s,e)}remove(t){this.enableDebug()&&o.debug(`Removing ${this.itemName()} by key='${t}'...`);let e=this.get(t);return delete this._registry[t],e}size(){return Object.keys(this._registry).length}clear(){this._registry={}}itemName(){return"Item"}enableDebug(){return!0}itemNullable(){return!1}optimizeBeforeRegister(t,e){return t}validate(t,e,i){if(n.isNull(t)&&!this.itemNullable())throw new s.RegistryError(`Given ${this.itemName()} is null or undefined`);return t}doRegister(t,e,i){if(!i&&this.has(t))throw new s.RegistryItemExistedError(`${this.itemName()} with key ${t} is already existed`);return this.enableDebug()&&o.debug(`Registering ${this.itemName()} by key='${t}' and force=${i}...`),this._registry[t]=e,e}};e.RegistryResult=class{constructor(t,e){this.objects=null!=t?t:[],this.errors=null!=e?e:[]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}e.default=s,s.frog="/images/logos/iot-lora-alliance-logo.png",s.aiIcon="/images/node-editor/icons/points/ai.svg",s.aiColour="#262B2F",s.uiMainIcon="/images/node-editor/icons/logic-bool/and2.svg",s.uiMainColour="#262B2F",s.logicMainColour="#262B2F",s.logicAndIcon="/images/node-editor/icons/logic-bool/and2.svg",s.logicOrIcon="/images/node-editor/icons/logic-bool/or.svg",s.logicNotIcon="/images/node-editor/icons/logic-bool/not.svg",s.compareGreaterIcon="/images/node-editor/icons/logic-compare/greater-than-equal-solid.svg",s.mathMainColour="#262B2F",s.mathMainIcon="/images/node-editor/icons/math-arithmetic/plus-solid.svg",s.mathAddIcon="/images/node-editor/icons/math-arithmetic/plus-solid.svg",s.mathSubIcon="/images/node-editor/icons/math-arithmetic/minus-solid.svg",s.mathDivideIcon="/images/node-editor/icons/math-arithmetic/divide-solid.svg",s.mathTimesIcon="/images/node-editor/icons/math-arithmetic/times-solid.svg",s.edgeNetwork="/images/node-editor/icons/logic-bool/not.svg"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultSubNodeRegistry=e.DefaultContainerRegistry=e.NodeRegistryHelper=e.GlobalNodeRegistry=e.DefaultGlobalNodeRegistry=void 0;const s=i(21),n=i(6),o=i(16),a=i(0),r=i(30),u=i(5),d=i(39);class l extends d.AbstractRegistry{constructor(){super()}register(t,e,i){return super.register(t,e,i)}get(t){return super.get(u.isNode(t)?this.createKey(t):t)}remove(t){return super.remove(u.isNode(t)?this.createKey(t):t)}createKey(t){return o.IdGenerator.createNodeId(t.cid,t.id)}itemName(){return"Global Node"}}e.DefaultGlobalNodeRegistry=l;class p extends l{constructor(){super()}static instance(){return p._instance||(p._instance=new p),p._instance}}e.GlobalNodeRegistry=p;class h{static register(t,e,i,s){return Promise.allSettled(e.map(t=>r.NodeFactory.create(t,!s,i)).map(t=>h.registerNode(i,t,s))).then(t=>t.reduce((t,e)=>h.accumulate(t,e),new d.RegistryResult))}static unregister(t,e,i,s){return Promise.allSettled(r.NodeFactory.standardize(t,e).map(t=>h.unregisterNode(i,t,s))).then(t=>t.reduce((t,e)=>h.accumulate(t,e),new d.RegistryResult))}static registerNode(t,e,i){const a=t.get(e.cid);if(n.isNull(a)){const t=o.IdGenerator.createNodeId(e.cid,e.id);return Promise.reject(new s.RegistryError(`Not found parent container of node '${t}'`,e))}return u.isFolderNode(e)&&t.register(e.sub_container,!0),a.nodeRegistry().register(e,!0,null,i)}static unregisterNode(t,e,i){const a=t.get(e.cid);if(n.isNull(a)){const t=o.IdGenerator.createNodeId(e.cid,e.id);return Promise.reject(new s.RegistryError(`Not found parent container of node '${t}'`,e))}return a.nodeRegistry().remove(e,i)}static accumulate(t,e){if("rejected"===e.status){if(e.reason instanceof s.RegistryError)t.errors.push(e.reason);else{const i=new s.RegistryError(e.reason instanceof Error?e.reason.message:e.reason);i.stack=e.reason instanceof Error?e.reason.stack:null,t.errors.push(i)}t.errors.push(e.reason instanceof s.RegistryError?e.reason:new s.RegistryError(e.reason))}else t.objects.push(e.value);return t}}e.NodeRegistryHelper=h;class c extends d.AbstractRegistry{constructor(t){super(),this.idGenerator=t}register(t,e){const i=this.optimizeBeforeRegister(this.validate(t,e,null),e);return this.doRegister(this.createKey(i),i,e)}remove(t){return super.remove(t)}clear(){super.clear()}rootContainer(){return this.get(o.IdGenerator.ROOT)}itemName(){return"Container"}optimizeBeforeRegister(t,e){return(this.rootContainer()&&this.idGenerator.shouldGenerateCid(t.id)||this.has(t.id)&&!e)&&(t.id=this.idGenerator.genContainerId(t.id)),this.rootContainer()&&(t.side=this.rootContainer().side),super.optimizeBeforeRegister(t,e)}createKey(t){return t.id}}e.DefaultContainerRegistry=c;class g extends d.AbstractRegistry{constructor(t,e,i){super(),this._parent=t,this.globalNodeRegistry=null!=i?i:p.instance(),this.containerRegistry=null!=e?e:a.ContainerRegistry.instance(),this.idGenerator=this.containerRegistry.idGenerator}parent(){return this._parent}register(t,e,i,s){return Promise.resolve(this.optimizeBeforeRegister(this.validate(t,e,i),e)).then(t=>this.doRegister(this.createKey(t),t,e,s))}remove(t,e){let i=this.globalNodeRegistry.remove((u.isNode(t),t));return u.isFolderNode(i)&&this.containerRegistry.remove(i.sub_container.id),Promise.resolve(super.remove(i.id))}get(t){var e,i;return super.get(null!==(i=null===(e=t)||void 0===e?void 0:e.id)&&void 0!==i?i:t)}itemName(){return`Node in Container '${this._parent.id}'`}optimizeBeforeRegister(t,e){var i;if((this.has(t.id)&&!e||this.idGenerator.shouldGenerateNid(t.cid,t.id))&&(t.id=this.idGenerator.genNodeId(t.cid,t.id)),t.container=this.parent(),t.cid=this.parent().id,t.side=this.parent().side,t.title=null!==(i=t.title)&&void 0!==i?i:t.type,u.isFolderNode(t)){const i=t;i.sub_container=this.containerRegistry.register(i.sub_container,e)}return super.optimizeBeforeRegister(t,e)}doRegister(t,e,i=!1,s){return this.globalNodeRegistry.register(e,i),Promise.resolve(super.doRegister(t,e,i))}createKey(t){return t.id}}e.DefaultSubNodeRegistry=g},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(17),n=i(36),o=i(0),a=i(3),r=i(5),u=i(1);class d extends a.Node{entry(){return this.properties.entry}entryId(){return this.entry()&&this.entry().entryId()}applyEntry(t){this.properties.entry=Object.assign(this.entryFactory(),t),this.title=this.namePrefix()+" "+this.properties.entry.label(),this.size=this.computeSize(),this.settings.name&&(this.settings.name.value=this.entryId()),s.merge(this.settings,this.createSettingForm(t)),this.broadcastSettingsToClients(),this.broadcastTitleToClients()}createSettingForm(t){return Object.keys(this.settingFields).map(e=>({[e]:u.NodeSetting.create({description:e,value:t?t[e]:null,type:this.settingFields[e]})})).reduce(s.merge)}deactivate(){this.properties.entry=null}onCreated(){if(this.entry())this.applyEntry(this.entry());else{if(this.side!==r.Side.server)return;n.singleton.process(()=>this.createEntry().then(t=>this.applyEntry(t)).catch(t=>(this.displayError(t,"Entry not created."),console.log(t),this.deactivate(),this.container.nodeRegistry().remove(this))))}}onAdded(){this.entry()&&this.applyEntry(this.entry())}onAfterSettingsChange(){if(this.side!==r.Side.server)return;const t={},e={};Object.keys(this.settingFields).filter(t=>this.settingFields[t]!==u.SettingType.READONLY).forEach(i=>{t[i]=this.settings[i].value,e[i]=this.entry()&&this.entry()[i]}),s.isEqual(e,t)||n.singleton.process(()=>this.updateEntry(t).catch(t=>this.displayError(t,"Unable to update entry remotely.")))}onRemoved(){return this.side===r.Side.server&&this.entry()?n.singleton.process(()=>this.deleteEntry().catch(t=>{this.displayError(t,"Failed to remove entry from backend."),console.log(t)})):Promise.resolve()}findFreeIdentifier(){return this.getTakenIdentifiers().then(t=>{for(let e=1;;e+=1){const i=this.makeIdentifier(e);if(!t.includes(i))return i}})}getTakenIdentifiers(){const t=o.ContainerRegistry.instance().rootContainer().getNodesByClass(this.constructor,!0);return Promise.resolve(t.filter(t=>t.entry()).map(t=>t.entry().identifier()))}makeIdentifier(t){return`WIRES_${this.namePrefix().toUpperCase()}_${t}`}}e.default=d},function(t,e){t.exports=require("fs")},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(43),o=i(51);class a{static getDir(){return o.dirname(__filename)}static getAllFiles(t){if(null!==t)return new Promise((e,i)=>{n.readdir(t,(t,s)=>{t&&i(t);let n=[];return s.forEach(t=>{n.push(t)}),e(n),n})})}static checkFileExists(t){return n.existsSync(t)}static createFile(t){return new Promise((e,i)=>{n.open(t,"r",(s,o)=>{if(s)n.writeFile(t,"",t=>{t&&i(t);e("The file was created!")});else{e("The file exists!")}})})}static createDirectory(t){const e=o.normalize(t);return new Promise((t,i)=>{n.stat(e,s=>{s?"ENOENT"===s.code?n.mkdir(e,s=>{s?i(s):t(e)}):i(s):t(e)})})}static ensureDirSync(t){try{return n.mkdirSync(t)}catch(t){if("EEXIST"!==t.code)throw t}}static readFile(t){return new Promise((e,i)=>{n.readFile(t,(t,s)=>{t&&i(t),e(s)})})}static checkForOldDirectory(t){return s(this,void 0,void 0,(function*(){try{const e=yield a.readFile(t);if(!e)return!1;Boolean(e.toString())}catch(t){return!1}}))}static readFileReturnJson(t){return s(this,void 0,void 0,(function*(){return new Promise((e,i)=>{n.readFile(t,(t,s)=>{let n=[];t&&i(t),s.toString().split("\n").forEach((function(t,e,i){0!==t.length&&n.push(t)}));let o=JSON.stringify(n),a=JSON.parse(o);e(a)})})}))}static appendFile(t,e){return s(this,void 0,void 0,(function*(){return new Promise((i,s)=>{let o="The file "+t+" was saved!";n.appendFile(t,e,t=>{t&&s(t),i(o)})})}))}static writeFile(t,e){return s(this,void 0,void 0,(function*(){return new Promise((i,s)=>{let o="The file "+t+" was saved!";n.writeFile(t,e,t=>{t&&s(t),i(o)})})}))}static deleteFiles(t,e){let i=t.length;t.forEach((function(t){console.log(t),a.checkFileExists(t)?n.unlink(t,(function(t){i--,t?e(t):i<=0&&e(null)})):(e(!0),console.log(11111),console.log(t))}))}}e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(43),n=i(10),o=i(44),a=i(9),r=`${n.default.dataDir}/platform.db`,u=`${n.default.dataDir}/ip.db`;e.default=class{static getPlatform(){return new Promise((t,e)=>{o.default.createFile(r).then(()=>{s.readFile(r,{encoding:"utf-8"},(i,s)=>{if(i)e(i),a.db_logger.error(i.message);else{const e=s?JSON.parse(s):{};t(e)}})})})}static updatePlatform(t){return new Promise((e,i)=>{o.default.createFile(r).then(()=>{const n=JSON.stringify(t);s.writeFile(r,n,"utf-8",t=>{t?(i(t),a.db_logger.error(t.message)):e(n)})})})}static getEth(){return new Promise((t,e)=>{o.default.createFile(u).then(()=>{s.readFile(u,{encoding:"utf-8"},(i,s)=>{var n;if(i)e(i),a.db_logger.error(null!==(n=i.stack)&&void 0!==n?n:i.message);else{const e=s?JSON.parse(s):{};t(e)}})})})}static updateEth(t){return new Promise((e,i)=>{o.default.createFile(u).then(()=>{let n=JSON.stringify(t);s.writeFile(u,n,"utf-8",t=>{var s;t?(i(t),a.db_logger.error(null!==(s=t.stack)&&void 0!==s?s:t.message)):e(n)})})})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(45);e.default=class{static getDeviceID(t){return new Promise((e,i)=>{var s;(null===(s=null==t?void 0:t.container)||void 0===s?void 0:s.db)?t.container.db.getNodeType("system/platform",(t,s)=>{var n,o;t?(console.log(t),i(t)):(null==s?void 0:s.length)&&(null===(o=null===(n=s[0])||void 0===n?void 0:n.properties)||void 0===o?void 0:o.deviceID)?e(s[0].properties.deviceID.trim()):i("No deviceID")}):i("No DB")})}static getClientID(t){return new Promise((e,i)=>{var s;(null===(s=null==t?void 0:t.container)||void 0===s?void 0:s.db)?t.container.db.getNodeType("system/platform",(t,s)=>{var n,o,a;t?(console.log(t),i(t)):(null==s?void 0:s.length)&&(null===(a=null===(o=null===(n=s[0])||void 0===n?void 0:n.settings)||void 0===o?void 0:o["client-id"])||void 0===a?void 0:a.value)?e(s[0].settings["client-id"].value.trim()):i("No clientId")}):i("No DB")})}static getDeviceIdDb(){return new Promise((t,e)=>{s.default.getPlatform().then(e=>{e&&t(e.deviceID)}).catch(t=>{e("No deviceID")})})}static getClientIdDb(){return new Promise((t,e)=>{s.default.getPlatform().then(e=>{e&&t(e.clientId)}).catch(t=>{e("No clientId")})})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.bsaClientConfig=void 0;const s=i(10);e.bsaClientConfig=t=>{var e,i;let n=s.default.bsa.paths[t];return n?{baseURL:s.default.bsa.baseURL,auth:{username:s.default.bsa.username,password:s.default.bsa.password},url:n.path,headers:{"Content-Type":null!==(e=n.contentType)&&void 0!==e?e:"application/json",Accept:null!==(i=n.accept)&&void 0!==i?i:"application/json"}}:null}},function(t,e){t.exports=require("jsonata")},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),o=i(13),a=i(4),r=i(37),u=o.create("edge-utils",{color:o.Colors.Grey});e.default=class{static sendPayloadToChild(t,e){t&&t.subscribe?t.subscribe(this.createMessage(r.SEND_PAYLOAD_TO_CHILD,e)):u.error("Child Node is not available on sendPayloadToChild")}static addPoint(t,e){t&&t.subscribe?t.subscribe(this.createMessage(r.ADD_POINT,e)):u.error("Parent Node is not available on addPoint")}static removePoint(t,e){t&&t.subscribe?t.subscribe(this.createMessage(r.REMOVE_POINT,e)):u.error("Parent Node is not available on removePoint")}static createMessage(t,e=null){return{action:t,payload:e}}static writePointValue(t,e,i,o,r,u,d){return s(this,void 0,void 0,(function*(){const s=`${a.default.buildUrl(t,e)}/api/${i}/write/${o}/${r}/${u}/${d}`;return(yield n.default.get(s)).data}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WRITE_PRESENT_VALUE=e.REMOVE_DEVICE=e.ADD_DEVICE=e.REMOVE_POINT=e.ADD_POINT=e.SEND_POINT_VALUE=e.SEND_PAYLOAD_TO_CHILD=e.GET_PRESENT_VALUE=e.GET_POINTS=e.GET_NETWORK_NODE=e.GET_BACNET_CLIENT=void 0,e.GET_BACNET_CLIENT="GET_BACNET_CLIENT",e.GET_NETWORK_NODE="GET_NETWORK_NODE",e.GET_POINTS="GET_POINTS",e.GET_PRESENT_VALUE="GET_PRESENT_VALUE",e.SEND_PAYLOAD_TO_CHILD="SEND_PAYLOAD_TO_CHILD",e.SEND_POINT_VALUE="SEND_POINT_VALUE",e.ADD_POINT="ADD_POINT",e.REMOVE_POINT="REMOVE_POINT",e.ADD_DEVICE="ADD_DEVICE",e.REMOVE_DEVICE="REMOVE_DEVICE",e.WRITE_PRESENT_VALUE="WRITE_PRESENT_VALUE"},function(t,e){t.exports=require("path")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncDbHelper=void 0;e.AsyncDbHelper=class{static noArgs(t,e){return new Promise((i,s)=>e.call(t,this.cbHandler(s,i)))}static oneArgs(t,e,i){return new Promise((s,n)=>e.call(t,i,this.cbHandler(n,s)))}static twoArgs(t,e,i,s){return new Promise((n,o)=>e.call(t,i,s,this.cbHandler(o,n)))}static threeArgs(t,e,i,s,n){return new Promise((o,a)=>e.call(t,i,s,n,this.cbHandler(a,o)))}static cbHandler(t,e){return(i,s)=>{i?t(i):e(s)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PubSubHelpers=void 0;const s=i(5),n=i(105),o=i(106),a=i(107);class r{static map(t){if(t.side===s.Side.server&&!(t instanceof n.DispatchNode)){const e=r.getPoint(t);r.logger.info(`Mapping protocol: ${t.category} having point: ${e}`),a.pubSubSingleton.addPoint(t.category,e,r.getDisplayPointName(t),!1)}}static unMap(t){if(t.side===s.Side.server&&!(t instanceof n.DispatchNode)){const e=r.getPoint(t);r.logger.info(`Un-mapping protocol: ${t.category} having point: ${e}`),a.pubSubSingleton.removePoint(t.category,e)}}static renameFunction(t){if(t.side===s.Side.server&&!(t instanceof n.DispatchNode)){const e=r.getPoint(t);r.logger.info(`Renaming protocol: ${t.category} having point: ${e}`),a.pubSubSingleton.renamePoint(t.category,e,r.getDisplayPointName(t))}}static dispatch(t,e){if(t.side===s.Side.server&&!(t instanceof n.DispatchNode)){const i=r.getPoint(t);a.pubSubSingleton.dispatch(t.category,i,e)}}static connect(t){if(t.side===s.Side.server&&t instanceof n.DispatchNode){const e=t.getSelectedProtocol(),i=t.getSelectedPoint(),s=t.getSelectedPointName();r.logger.info(`Subscribing protocol: ${e} having point: ${i}`),a.pubSubSingleton.connect(e,i,s,t)}}static disconnect(t){if(t.side===s.Side.server&&t instanceof n.DispatchNode){const e=t.getSelectedProtocol(),i=t.getSelectedPoint();r.logger.info(`Un-subscribing protocol: ${e} having point: ${i}`),a.pubSubSingleton.disconnect(e,i,t)}}static getPoint(t){const{cid:e,id:i}=t;return`${e}/${i}`}static getDisplayPointName(t){let e=[],i=t.getParentNode();for(;i;)e.push(i.title),i=i.getParentNode();return e=e.reverse(),e.push(t.name||t.title||o.UNKNOWN_POINT_NAME),e.join("/")}}e.PubSubHelpers=r,r.logger=i(13).create("pub-sub",{color:4})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PointData=e.Service=e.Point=e.Folder=e.Device=e.Network=e.Edge=void 0;const s=i(12);class n{entryId(){return this.id}identifier(){return this.code}nodeType(){return this._nodeType}label(){return this.identifier()||this.entryId()}}e.Edge=class extends n{constructor(){super(...arguments),this._nodeType=s.EDGE_CONTAINER_TYPE}};e.Network=class extends n{constructor(){super(...arguments),this._nodeType=s.NETWORK_CONTAINER_TYPE}};e.Device=class extends n{constructor(){super(...arguments),this._nodeType=s.DEVICE_CONTAINER_TYPE}};e.Folder=class extends n{constructor(){super(...arguments),this._nodeType=s.GROUP_CONTAINER_TYPE}label(){return this.name||super.label()}};e.Point=class extends n{constructor(){super(...arguments),this._nodeType=s.POINT_NODE_TYPE}};e.Service=class{constructor(){this._nodeType=s.MODULE_NODE_TYPE}entryId(){return this.service_id}identifier(){return this.service_name}nodeType(){return this._nodeType}label(){return`${this.identifier()} ${this.version}`||this.entryId()}};e.PointData=class{}},function(t){t.exports=JSON.parse('{"dataBase":{"enable":true,"useInternalDb":true,"externalDbConnectionString":"","writeInterval":5000},"nodesEngine":{"enable":true,"updateInterval":10,"debugEngine":true,"debugNodes":true},"nodeEditor":{"theme":0},"console":{"showAllErrors":true,"showGatewayState":true,"showGatewayMessages":false,"showGatewayDecodedMessages":false,"showDataBaseState":false,"showNodesEngineState":true,"showNodesEngineNodes":false,"showSystemState":true},"logs":{"storeGatewayState":true,"storeGatewayMessages":true,"storeGatewayDecodedMessages":true,"storeDataBaseState":true,"storeNodesEngineState":true,"storeNodesEngineNodes":true,"storeSystemState":true,"maxGatewayState":1000,"maxGatewayMessages":1000,"maxGatewayDecodedMessages":1000,"maxDataBaseState":1000,"maxNodesEngineState":1000,"maxNodesEngineNodes":1000,"maxSystemState":1000},"webServer":{"enable":true,"port":"1313","rules":{"allowFullAccessWithoutAuthorization":false,"allowRegistrationOfNewUsers":false},"debug":true}}')},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeService=void 0;const s=i(0),n=i(18),o=i(5),a=i(9);e.NodeService=class{constructor(t,e,i){this.logger=a.node_service_logger,this.cRegistry=null!=t?t:s.ContainerRegistry.instance(),this.idGenerator=null!=i?i:this.cRegistry.idGenerator,this.dbHelper=null!=e?e:n.createNodeDbHelper()}getNodesInContainer(t,e){const i=e.filter(t=>o.isFolderNode(t)).map(t=>t).map(e=>this.dbHelper.listByContainer(t,e.sub_container.id).then(e=>this.getNodesInContainer(t,e)));return Promise.all([Promise.resolve(e),...i]).then(t=>t.flatMap(t=>t))}}},function(t,e){t.exports=require("influx")},function(t,e){t.exports=function(){var t=Math.log,e=Math.exp,i=Math.pow,s=Math.min,n=Math.max,o=Math.abs,a=void 0,r=void 0;this.IP=1,this.SI=2,this.SetUnitSystem=function(t){if(t!=this.IP&&t!=this.SI)throw new Error("UnitSystem must be IP or SI");r=(a=t)==this.IP?.001*9/5:.001},this.GetUnitSystem=function(){return a},this.isIP=function(){if(a==this.IP)return!0;if(a==this.SI)return!1;throw new Error("Unit system is not defined")},this.GetTRankineFromTFahrenheit=function(t){return t+459.67},this.GetTFahrenheitFromTRankine=function(t){return t-459.67},this.GetTKelvinFromTCelsius=function(t){return t+273.15},this.GetTCelsiusFromTKelvin=function(t){return t-273.15},this.GetTCelsiusFromTFahrenheit=function(t){return(t-32)/1.8},this.GetTFahrenheitFromTCelsius=function(t){return 1.8*t+32},this.GetTRankineFromTCelsius=function(t){return 1.8*t+32+459.67},this.GetTKelvinFromTFahrenheit=function(t){return(t-32)/1.8+273.15},this.GetTFahrenheitFromTKelvin=function(t){return 1.8*(t-273.15)+32},this.GetTRankineFromTKelvin=function(t){return 1.8*(t-273.15)+32+459.67},this.GetTCelsiusFromTRankine=function(t){return(t-459.67-32)/1.8},this.GetTKelvinFromTRankine=function(t){return(t-459.67-32)/1.8+273.15},this.GetTWetBulbFromTDewPoint=function(t,e,i){var s;if(!(e<=t))throw new Error("Dew point temperature is above dry bulb temperature");return s=this.GetHumRatioFromTDewPoint(e,i),this.GetTWetBulbFromHumRatio(t,s,i)},this.GetTWetBulbFromRelHum=function(t,e,i){var s;if(!(e>=0&&e<=1))throw new Error("Relative humidity is outside range [0,1]");return s=this.GetHumRatioFromRelHum(t,e,i),this.GetTWetBulbFromHumRatio(t,s,i)},this.GetRelHumFromTDewPoint=function(t,e){if(!(e<=t))throw new Error("Dew point temperature is above dry bulb temperature");return this.GetSatVapPres(e)/this.GetSatVapPres(t)},this.GetRelHumFromTWetBulb=function(t,e,i){var s;if(!(e<=t))throw new Error("Wet bulb temperature is above dry bulb temperature");return s=this.GetHumRatioFromTWetBulb(t,e,i),this.GetRelHumFromHumRatio(t,s,i)},this.GetTDewPointFromRelHum=function(t,e){var i;if(!(e>=0&&e<=1))throw new Error("Relative humidity is outside range [0,1]");return i=this.GetVapPresFromRelHum(t,e),this.GetTDewPointFromVapPres(t,i)},this.GetTDewPointFromTWetBulb=function(t,e,i){var s;if(!(e<=t))throw new Error("Wet bulb temperature is above dry bulb temperature");return s=this.GetHumRatioFromTWetBulb(t,e,i),this.GetTDewPointFromHumRatio(t,s,i)},this.GetVapPresFromRelHum=function(t,e){if(!(e>=0&&e<=1))throw new Error("Relative humidity is outside range [0,1]");return e*this.GetSatVapPres(t)},this.GetRelHumFromVapPres=function(t,e){if(!(e>=0))throw new Error("Partial pressure of water vapor in moist air is negative");return e/this.GetSatVapPres(t)},this.dLnPws_=function(t){var e,s;return this.isIP()?(s=this.GetTRankineFromTFahrenheit(t),e=t<=32.018?10214.165/i(s,2)-.0053765794+3.8404754e-7*s+1.06727496e-9*i(s,2)-361378752e-21*i(s,3)+4.1635019/s:10440.397/i(s,2)-.027022355+2578072e-11*s-7.4342043e-9*i(s,2)+6.5459673/s):(s=this.GetTKelvinFromTCelsius(t),e=t<=.01?5674.5359/i(s,2)-.009677843+124431402e-14*s+6.2243475e-9*i(s,2)-37936096e-19*i(s,3)+4.1635019/s:5800.2206/i(s,2)-.048640239+83529536e-12*s-4.3356279e-8*i(s,2)+6.5459673/s),e},this.GetTDewPointFromVapPres=function(e,i){var a;if(a=this.isIP()?[-148,392]:[-100,200],i<this.GetSatVapPres(a[0])||i>this.GetSatVapPres(a[1]))throw new Error("Partial pressure of water vapor is outside range of validity of equations");var u,d,l=e,p=t(i),h=1;do{u=l,d=t(this.GetSatVapPres(u));var c=this.dLnPws_(u);if(l=n(l=u-(d-p)/c,a[0]),l=s(l,a[1]),h>100)throw new Error("Convergence not reached in GetTDewPointFromVapPres. Stopping.");h++}while(o(l-u)>r);return s(l,e)},this.GetVapPresFromTDewPoint=function(t){return this.GetSatVapPres(t)},this.GetTWetBulbFromHumRatio=function(t,e,i){var s,o,a,u,d=1;if(!(e>=0))throw new Error("Humidity ratio is negative");for(u=n(e,1e-7),s=((a=this.GetTDewPointFromHumRatio(t,u,i))+(o=t))/2;o-a>r;){if(this.GetHumRatioFromTWetBulb(t,s,i)>u?o=s:a=s,s=(o+a)/2,d>100)throw new Error("Convergence not reached in GetTWetBulbFromHumRatio. Stopping.");d++}return s},this.GetHumRatioFromTWetBulb=function(t,e,i){var s,o=-99999;if(!(e<=t))throw new Error("Wet bulb temperature is above dry bulb temperature");return s=this.GetSatHumRatio(e,i),o=this.isIP()?e>=32?((1093-.556*e)*s-.24*(t-e))/(1093+.444*t-e):((1220-.04*e)*s-.24*(t-e))/(1220+.444*t-.48*e):e>=0?((2501-2.326*e)*s-1.006*(t-e))/(2501+1.86*t-4.186*e):((2830-.24*e)*s-1.006*(t-e))/(2830+1.86*t-2.1*e),n(o,1e-7)},this.GetHumRatioFromRelHum=function(t,e,i){var s;if(!(e>=0&&e<=1))throw new Error("Relative humidity is outside range [0,1]");return s=this.GetVapPresFromRelHum(t,e),this.GetHumRatioFromVapPres(s,i)},this.GetRelHumFromHumRatio=function(t,e,i){var s;if(!(e>=0))throw new Error("Humidity ratio is negative");return s=this.GetVapPresFromHumRatio(e,i),this.GetRelHumFromVapPres(t,s)},this.GetHumRatioFromTDewPoint=function(t,e){var i;return i=this.GetSatVapPres(t),this.GetHumRatioFromVapPres(i,e)},this.GetTDewPointFromHumRatio=function(t,e,i){var s;if(!(e>=0))throw new Error("Humidity ratio is negative");return s=this.GetVapPresFromHumRatio(e,i),this.GetTDewPointFromVapPres(t,s)},this.GetHumRatioFromVapPres=function(t,e){if(!(t>=0))throw new Error("Partial pressure of water vapor in moist air is negative");return n(.621945*t/(e-t),1e-7)},this.GetVapPresFromHumRatio=function(t,e){var i;if(!(t>=0))throw new Error("Humidity ratio is negative");return e*(i=n(t,1e-7))/(.621945+i)},this.GetSpecificHumFromHumRatio=function(t){var e;if(!(t>=0))throw new Error("Humidity ratio is negative");return(e=n(t,1e-7))/(1+e)},this.GetHumRatioFromSpecificHum=function(t){if(!(t>=0&&t<1))throw new Error("Specific humidity is outside range [0, 1[");return n(t/(1-t),1e-7)},this.GetDryAirEnthalpy=function(t){return this.isIP()?.24*t:1006*t},this.GetDryAirDensity=function(t,e){return this.isIP()?144*e/53.35/this.GetTRankineFromTFahrenheit(t):e/287.042/this.GetTKelvinFromTCelsius(t)},this.GetDryAirVolume=function(t,e){return this.isIP()?53.35*this.GetTRankineFromTFahrenheit(t)/(144*e):287.042*this.GetTKelvinFromTCelsius(t)/e},this.GetTDryBulbFromEnthalpyAndHumRatio=function(t,e){var i;if(!(e>=0))throw new Error("Humidity ratio is negative");return i=n(e,1e-7),this.isIP()?(t-1061*i)/(.24+.444*i):(t/1e3-2501*i)/(1.006+1.86*i)},this.GetHumRatioFromEnthalpyAndTDryBulb=function(t,e){var i;return i=this.isIP()?(t-.24*e)/(1061+.444*e):(t/1e3-1.006*e)/(2501+1.86*e),n(i,1e-7)},this.GetSatVapPres=function(s){var n,o;if(this.isIP()){if(!(s>=-148&&s<=392))throw new Error("Dry bulb temperature is outside range [-148, 392]");o=this.GetTRankineFromTFahrenheit(s),n=s<=32.018?-10214.165/o-4.8932428-.0053765794*o+1.9202377e-7*o*o+3.5575832e-10*i(o,3)-90344688e-21*i(o,4)+4.1635019*t(o):-10440.397/o-11.29465-.027022355*o+1289036e-11*o*o-2.4780681e-9*i(o,3)+6.5459673*t(o)}else{if(!(s>=-100&&s<=200))throw new Error("Dry bulb temperature is outside range [-100, 200]");o=this.GetTKelvinFromTCelsius(s),n=s<=.01?-5674.5359/o+6.3925247-.009677843*o+6.2215701e-7*o*o+2.0747825e-9*i(o,3)-9484024e-19*i(o,4)+4.1635019*t(o):-5800.2206/o+1.3914993-.048640239*o+41764768e-12*o*o-1.4452093e-8*i(o,3)+6.5459673*t(o)}return e(n)},this.GetSatHumRatio=function(t,e){var i;return i=this.GetSatVapPres(t),n(.621945*i/(e-i),1e-7)},this.GetSatAirEnthalpy=function(t,e){return this.GetMoistAirEnthalpy(t,this.GetSatHumRatio(t,e))},this.GetVaporPressureDeficit=function(t,e,i){var s;if(!(e>=0))throw new Error("Humidity ratio is negative");return s=this.GetRelHumFromHumRatio(t,e,i),this.GetSatVapPres(t)*(1-s)},this.GetDegreeOfSaturation=function(t,e,i){if(!(e>=0))throw new Error("Humidity ratio is negative");return n(e,1e-7)/this.GetSatHumRatio(t,i)},this.GetMoistAirEnthalpy=function(t,e){var i;if(!(e>=0))throw new Error("Humidity ratio is negative");return i=n(e,1e-7),this.isIP()?.24*t+i*(1061+.444*t):1e3*(1.006*t+i*(2501+1.86*t))},this.GetMoistAirVolume=function(t,e,i){var s;if(!(e>=0))throw new Error("Humidity ratio is negative");return s=n(e,1e-7),this.isIP()?53.35*this.GetTRankineFromTFahrenheit(t)*(1+1.607858*s)/(144*i):287.042*this.GetTKelvinFromTCelsius(t)*(1+1.607858*s)/i},this.GetTDryBulbFromMoistAirVolumeAndHumRatio=function(t,e,i){var s;if(!(e>=0))throw new Error("Humidity ratio is negative");return s=n(e,1e-7),this.isIP()?this.GetTFahrenheitFromTRankine(t*(144*i)/(53.35*(1+1.607858*s))):this.GetTCelsiusFromTKelvin(t*i/(287.042*(1+1.607858*s)))},this.GetMoistAirDensity=function(t,e,i){var s;if(!(e>=0))throw new Error("Humidity ratio is negative");return(1+(s=n(e,1e-7)))/this.GetMoistAirVolume(t,s,i)},this.GetStandardAtmPressure=function(t){return this.isIP()?14.696*i(1-68754e-10*t,5.2559):101325*i(1-225577e-10*t,5.2559)},this.GetStandardAtmTemperature=function(t){return this.isIP()?59-.0035662*t:15-.0065*t},this.GetSeaLevelPressure=function(t,i,s){var n,o;return this.isIP()?(n=s+.0036*i/2,o=53.351*this.GetTRankineFromTFahrenheit(n)):(n=s+.0065*i/2,o=287.055*this.GetTKelvinFromTCelsius(n)/9.807),t*e(i/o)},this.GetStationPressure=function(t,e,i){return t/this.GetSeaLevelPressure(1,e,i)},this.CalcPsychrometricsFromTWetBulb=function(t,e,i){var s=this.GetHumRatioFromTWetBulb(t,e,i);return[s,this.GetTDewPointFromHumRatio(t,s,i),this.GetRelHumFromHumRatio(t,s,i),this.GetVapPresFromHumRatio(s,i),this.GetMoistAirEnthalpy(t,s),this.GetMoistAirVolume(t,s,i),this.GetDegreeOfSaturation(t,s,i)]},this.CalcPsychrometricsFromTDewPoint=function(t,e,i){var s=this.GetHumRatioFromTDewPoint(e,i);return[s,this.GetTWetBulbFromHumRatio(t,s,i),this.GetRelHumFromHumRatio(t,s,i),this.GetVapPresFromHumRatio(s,i),this.GetMoistAirEnthalpy(t,s),this.GetMoistAirVolume(t,s,i),this.GetDegreeOfSaturation(t,s,i)]},this.CalcPsychrometricsFromRelHum=function(t,e,i){var s=this.GetHumRatioFromRelHum(t,e,i);return[s,this.GetTWetBulbFromHumRatio(t,s,i),this.GetTDewPointFromHumRatio(t,s,i),this.GetVapPresFromHumRatio(s,i),this.GetMoistAirEnthalpy(t,s),this.GetMoistAirVolume(t,s,i),this.GetDegreeOfSaturation(t,s,i)]}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),o=i(14),a=i(10),r=i(3),u=i(5),d=i(1),l=i(4),p=i(85),h=i(7),c=i(46),g=i(57);var m,f;!function(t){t[t.COV=0]="COV",t[t.PERIODIC=1]="PERIODIC",t[t.TRIGGER_ONLY=2]="TRIGGER_ONLY"}(m||(m={})),function(t){t[t.POSTGRES=0]="POSTGRES",t[t.InfluxDB=1]="InfluxDB"}(f||(f={}));class O extends r.Node{constructor(){super(...arguments),this.interval=-1,this.dynamicInputStartPosition=2,this.alarmCount=0,this.tagCount=0,this.lastTrigger=!1}addHistoryConfiguration(){this.addInput("histTrigger",d.Type.BOOLEAN),this.addInput("clearStoredHis",d.Type.BOOLEAN),this.addOutput("histError",d.Type.ANY),this.addOutput("storedHistCount",d.Type.NUMBER),this.addOutput("lastHistExport",d.Type.STRING),this.settings.history_group=d.NodeSetting.create({description:"History Settings",value:"",type:d.SettingType.GROUP}),this.settings.databaseType=d.NodeSetting.create({description:"Database Type",type:d.SettingType.DROPDOWN,config:{items:[{value:f.POSTGRES,text:"Postgres"}]},value:f.POSTGRES}),this.settings.enable=d.NodeSetting.create({description:"History Enable",value:!1,type:d.SettingType.BOOLEAN}),this.settings.tableName=d.NodeSetting.create({description:"Measurement Name",value:"",type:d.SettingType.STRING}),this.addInputWithSettings("pointName",d.Type.STRING,"","Point Name"),this.settings.historyMode=d.NodeSetting.create({description:"History Logging Mode",type:d.SettingType.DROPDOWN,config:{items:[{value:m.COV,text:"Change Of Value (COV)"},{value:m.PERIODIC,text:"Periodic"},{value:m.TRIGGER_ONLY,text:"Trigger Only"}]},value:m.COV}),this.settings.dataType=d.NodeSetting.create({description:"Data type for storing",type:d.SettingType.DROPDOWN,config:{items:[{value:d.Type.NUMBER,text:"Number"},{value:d.Type.BOOLEAN,text:"Boolean"},{value:d.Type.STRING,text:"String"}]},value:d.Type.NUMBER}),this.settings.threshold=d.NodeSetting.create({description:"COV Threshold",value:0,type:d.SettingType.NUMBER}),this.settings.period=d.NodeSetting.create({description:"Logging Interval",value:15,type:d.SettingType.NUMBER}),this.settings.periodUnits=d.NodeSetting.create({description:"Units",type:d.SettingType.DROPDOWN,config:{items:[{value:h.TIME_TYPE.MILLISECONDS,text:"Milliseconds"},{value:h.TIME_TYPE.SECONDS,text:"Seconds"},{value:h.TIME_TYPE.MINUTES,text:"Minutes"},{value:h.TIME_TYPE.HOURS,text:"Hours"}]},value:h.TIME_TYPE.MINUTES}),this.settings["storage-limit"]=d.NodeSetting.create({description:"Local Storage Limit (Max 50)",value:25,type:d.SettingType.NUMBER}),this.settings.minuteRoundValue=d.NodeSetting.create({description:"Round minutes up in increments of",value:0,type:d.SettingType.NUMBER}),this.settings.decimals=d.NodeSetting.create({description:"Decimal Places (Limit 5)",value:3,type:d.SettingType.NUMBER}),this.settings.timeAsString=d.NodeSetting.create({description:"Display Timestamp as",type:d.SettingType.DROPDOWN,config:{items:[{value:!1,text:"Numeric"},{value:!0,text:"String"}]},value:!0}),this.settings.alarm_group=d.NodeSetting.create({description:"Alarm Settings",value:"",type:d.SettingType.GROUP}),this.settings.alarms_count=d.NodeSetting.create({description:"Alarms Count (Max 10)",value:0,type:d.SettingType.NUMBER}),this.settings.tags_group=d.NodeSetting.create({description:"Tag Settings",value:"",type:d.SettingType.GROUP}),this.settings.tags_count=d.NodeSetting.create({description:"Tag Count (Max 10)",value:0,type:d.SettingType.NUMBER}),this.properties.obj=[]}setup(){this.addHistoryConfiguration()}init(t){this.historyFunctionsForAfterSettingsChange(t.settings,!1),this.lastTrigger=!1}changeInputDynamically(t){this.assignInputsOutputs(),-1===this.tableNameInput&&t.databaseType.value===f.InfluxDB?(this.pointNameInput&&this.removeInput(this.pointNameInput),this.addInput("[tableName]",d.Type.STRING,{exist:!0,nullable:!1,hidden:!1}),this.addInput("[pointName]",d.Type.STRING,{exist:!0,nullable:!1,hidden:!1})):-1!==this.tableNameInput&&t.databaseType.value===f.POSTGRES&&(this.pointNameInput&&this.removeInput(this.pointNameInput),this.removeInput(this.tableNameInput),this.addInput("[pointName]",d.Type.STRING,{exist:!0,nullable:!1,hidden:!1}))}onAdded(){this.assignInputsOutputs(),this.resetOutputs(),this.doPeriodicHistoryFunctions()}onInputUpdated(){return s(this,void 0,void 0,(function*(){this.getInputData(this.clearStoredHisInput)&&(this.properties.obj=[],this.updateHistoryCountOutput()),yield this.doNonPeriodicHistoryFunctions()}))}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){this.historyFunctionsForAfterSettingsChange(),yield this.doNonPeriodicHistoryFunctions(),this.doPeriodicHistoryFunctions()}))}onRemoved(){clearInterval(this.timeoutFunc)}assignInputsOutputs(){this.tableNameInput=-1,this.pointNameInput=-1;for(let t in this.inputs)this.inputs.hasOwnProperty(t)&&("histTrigger"==this.inputs[t].name&&(this.histTriggerInput=Number(t)),"clearStoredHis"==this.inputs[t].name&&(this.clearStoredHisInput=Number(t)),"[tableName]"==this.inputs[t].name&&(this.tableNameInput=Number(t)),"[pointName]"==this.inputs[t].name&&(this.pointNameInput=Number(t)));for(let t in this.outputs)this.outputs.hasOwnProperty(t)&&("histError"==this.outputs[t].name?this.histErrorOutput=Number(t):"storedHistCount"==this.outputs[t].name?this.storedHistCountOutput=Number(t):"lastHistExport"==this.outputs[t].name&&(this.lastHistExportOutput=Number(t)))}addHistorySettingsConfig(t=0,e=!0){this.settingConfigs.hasOwnProperty("groups")&&this.settingConfigs.hasOwnProperty("conditions")||this.setSettingsConfig({groups:this.settingConfigs.groups||[],conditions:this.settingConfigs.conditions||{}}),this.settingConfigs.groups.push({period:{weight:2},periodUnits:{}}),this.settingConfigs.conditions.tableName=t=>t.databaseType.value===f.InfluxDB,this.settingConfigs.conditions.threshold=t=>t.historyMode.value===m.COV,this.settingConfigs.conditions.period=t=>t.historyMode.value===m.PERIODIC,this.settingConfigs.conditions.periodUnits=t=>t.historyMode.value===m.PERIODIC,this.settingConfigs.conditions.alarms_count=t=>t.databaseType.value===f.InfluxDB,this.settingConfigs.conditions.tags_count=t=>t.databaseType.value===f.InfluxDB,this.valueInput=t,this.takeValueFromInput=e}resetOutputs(){this.updateHistoryCountOutput()}doNonPeriodicHistoryFunctions(){return s(this,void 0,void 0,(function*(){if(this.side!==u.Side.server)return;if(!this.settings.enable.value)return;let t=null;t=this.takeValueFromInput?this.getInputData(this.valueInput):this.outputs[this.valueInput].data,this.checkTriggered()?yield this.storeLogEntry(t):this.checkCOV(t)&&(yield this.storeLogEntry(t)),this.properties.obj.length>0&&(yield this.trySendStoredData())}))}trySendStoredData(){return s(this,void 0,void 0,(function*(){let t=this.settings.decimals.value;t=l.default.clamp(t,0,5);const e=[];this.properties.obj.forEach(i=>{const s=this.settings.dataType.value;i.payload=this.convertInput(i.payload,s,t);const n={};n.point=this.getInputData(this.pointNameInput)||"undefined",Object.keys(i).map(t=>{"payload"!==t&&"timestamp"!==t&&"tags"!==t&&(n[t]=i[t])});for(let t=0;t<10;t++)n["tag"+(t+1)]=i.tags[t]||null;e.push({measurement:this.getInputData(this.tableNameInput),fields:{val:i.payload},timestamp:1e6*o(i.timestamp).valueOf(),tags:n})});let i=!1;if(this.settings.databaseType.value===f.POSTGRES){let t,s;try{t=yield c.default.getClientIdDb()}catch(e){t="unknownClientID"}try{s=yield c.default.getDeviceIdDb()}catch(t){s="unknownDeviceID"}const r=e.map(e=>({deviceid:s,clientid:t,val:e.fields.val,point:e.tags.point,ts:o(Number(e.timestamp)/1e6).toISOString()})),u=this,d=a.default.pg.baseURL;try{yield n.default({method:"post",url:d,data:r})}catch(t){this.setOutputData(u.histErrorOutput,String(t)),i=!0}}else if(f.InfluxDB==f.InfluxDB){const t={},{protocol:s,host:n,port:o,databaseName:r,username:u,password:d}=a.default.influxDb,l=new g.InfluxDB({host:n,port:o,protocol:"https"===s?"https":"http",database:r,username:u,password:d});try{yield l.writePoints(e,t)}catch(t){this.setOutputData(this.histErrorOutput,String(t)),this.debugErr(t),i=!0}}i||(this.properties.obj=[],this.setOutputData(this.histErrorOutput,""),this.settings.timeAsString.value?this.setOutputData(this.lastHistExportOutput,o().format(),!0):this.setOutputData(this.lastHistExportOutput,o().valueOf(),!0),this.updateHistoryCountOutput())}))}historyFunctionsForAfterSettingsChange(t=null,e=!0){this.changeInputDynamically(t||this.settings),this.assignInputsOutputs(),this.settings.databaseType.value===f.POSTGRES&&(this.settings.alarms_count.value=0,this.settings.tags_count.value=0),this.dynamicInputStartPosition=this.pointNameInput+1,this.changeAlarmsCount(this.settings.alarms_count.value),this.renameAlarmInputs(t),this.changeTagsCount(this.settings.tags_count.value),e&&this.persistProperties(!0,!1,!0,!1)}storeLogEntry(t){return s(this,void 0,void 0,(function*(){if(null==t)return;const e=l.default.clamp(this.settings["storage-limit"].value,0,50),i=l.default.clamp(this.settings.minuteRoundValue.value,0,60),s=i?h.default.nearestFutureMinutes(i,o()):o(),n={payload:t,timestamp:s.toISOString()};for(let t=this.dynamicInputStartPosition;t<this.dynamicInputStartPosition+this.alarmCount;t++){let e=t-this.dynamicInputStartPosition+1;n[this.settings["alarm"+e].value||"alarm"+e]=this.getInputData(t)||"null"}const a=[];let r=1;for(;r<=this.tagCount;)this.settings["tag"+r].value&&a.push(this.settings["tag"+r].value),r++;for(n.tags=a,this.properties.obj.push(n);this.properties.obj.length>e;)this.properties.obj.shift();this.properties.lastHistoryValue=t,this.persistProperties(!1,!0,!1,!1),this.updateHistoryCountOutput()}))}checkTriggered(){const t=this.getInputData(this.histTriggerInput)||!1,e=this.inputs[this.histTriggerInput].updated&&t&&!this.lastTrigger;return this.lastTrigger=t,e}checkCOV(t){if(this.settings.historyMode.value===m.COV){const e=this.settings.threshold.value;return isNaN(t)||isNaN(this.properties.lastHistoryValue)?t!==this.properties.lastHistoryValue:Math.abs(Number(t)-Number(this.properties.lastHistoryValue))>=e}return!1}doPeriodicHistoryFunctions(){if(this.side!==u.Side.server)return;const t=this.settings.enable.value,e=this.settings.historyMode.value===m.PERIODIC;if(t&&e||this.timeoutFunc&&(this.interval=-1,clearInterval(this.timeoutFunc),this.debugInfo("Clearing Periodic interval data insertion...")),t&&e){const t=h.default.timeConvert(this.settings.period.value,this.settings.periodUnits.value);this.interval!==t&&(clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>s(this,void 0,void 0,(function*(){let t=null;t=this.takeValueFromInput?this.getInputData(this.valueInput):this.outputs[this.valueInput].data,yield this.storeLogEntry(t),this.properties.obj.length>0&&(yield this.trySendStoredData())})),t),this.interval=t,this.debugInfo(`Setting Periodic Period of: ${t} ms`))}}changeAlarmsCount(t){t=l.default.clamp(t,0,10),this.settings.alarms_count.value=t;let e=t-this.alarmCount;if(0==e)return;this.changeInputsCount(t+this.dynamicInputStartPosition,d.Type.STRING);const i={};if(e>0){for(let e=this.alarmCount+1;e<=t;e++)i["alarm"+e]={description:"Alarm "+e,value:"",type:d.SettingType.STRING};this.settings=p.default.insertIntoObjectAtPosition(this.settings,i,0==this.alarmCount?"alarms_count":"alarm"+this.alarmCount)}else if(e<0)for(let e=this.alarmCount;e>t;e--)delete this.settings["alarm"+e];this.alarmCount=t}renameAlarmInputs(t){for(let e=1;e<=this.alarmCount;e++){let i=this.settings["alarm"+e].value;!i&&t&&(i=t["alarm"+e]&&t["alarm"+e].value||""),i.length>20&&(i="..."+i.substr(i.length-20,20)),this.inputs[this.dynamicInputStartPosition+e-1].name="alarm"+e+" | "+i}}changeTagsCount(t){t=l.default.clamp(t,0,10),this.settings.tags_count.value=t;let e=t-this.tagCount;if(0==e)return;const i={};if(e>0){for(let e=this.tagCount+1;e<=t;e++)i["tag"+e]={description:"Tag "+e,value:"",type:d.SettingType.STRING};this.settings=p.default.insertIntoObjectAtPosition(this.settings,i,0===this.tagCount?"tags_count":"tag"+this.tagCount)}else if(e<0)for(let e=this.tagCount;e>t;e--)delete this.settings["tag"+e];this.tagCount=t}updateHistoryCountOutput(){this.setOutputData(this.storedHistCountOutput,this.properties.obj&&this.properties.obj.length||0)}}e.default=O},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.singleton=void 0;const s=i(13),n=i(36),o=i(50),a=s.create("bacnet-utils",{color:s.Colors.Grey});e.singleton=new n.PromiseActor;e.default=class{static getBacnetClient(t){return t&&t.subscribe?t.subscribe(this.createMessage(o.GET_BACNET_CLIENT)):(a.error("Network Node is not available on getBacnetClient"),null)}static getPoints(t){return t&&t.subscribe?t.subscribe(this.createMessage(o.GET_POINTS)):(a.error("Device Node is not available on getPoints"),[])}static getPresentValue(t,e){return t&&t.subscribe?t.subscribe(this.createMessage(o.GET_PRESENT_VALUE,e)):(a.error("Device Node is not available on getPresentValue"),null)}static writePresentValue(t,e){t&&t.subscribe?t.subscribe(this.createMessage(o.WRITE_PRESENT_VALUE,e)):a.error("Device Node is not available on writePresentValue")}static getNetworkNode(t){return t&&t.subscribe?t.subscribe(this.createMessage(o.GET_NETWORK_NODE)):(a.error("Parent Node is not available on getNetworkNode"),null)}static sendPayloadToChild(t,e){t&&t.subscribe?t.subscribe(this.createMessage(o.SEND_PAYLOAD_TO_CHILD,e)):a.error("Child Node is not available on sendPayloadToChild")}static sendPointValue(t,e){t&&t.subscribe?t.subscribe(this.createMessage(o.SEND_POINT_VALUE,e)):a.error("Point Node is not available on sendPointValue")}static addDevice(t,e){t&&t.subscribe?t.subscribe(this.createMessage(o.ADD_DEVICE,e)):a.error("Network Node is not available on addDevice")}static removeDevice(t,e){t&&t.subscribe?t.subscribe(this.createMessage(o.REMOVE_DEVICE,e)):a.error("Network Node is not available on removeDevice")}static addPoint(t,e){t&&t.subscribe?t.subscribe(this.createMessage(o.ADD_POINT,e)):a.error("Device Node is not available on addPoint")}static removePoint(t,e){t&&t.subscribe?t.subscribe(this.createMessage(o.REMOVE_POINT,e)):a.error("Device Node is not available on removePoint")}static createMessage(t,e=null){return{action:t,payload:e}}}},function(t,e){t.exports=require("mqtt-match")},function(t,e){t.exports=require("mqtt")},function(t,e){t.exports=require("cron")},function(t,e){t.exports=require("cronstrue")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FrontendLinkVisitor=e.BackendLinkVisitor=void 0;const s=i(0),n=i(18),o=i(4),a=i(6),r=i(35);class u{constructor(t){this.fn=t}visit(t,e){return e.isUpdated=!0,a.isFunction(this.fn)?this.fn(t,e):null}}class d{constructor(t){this.registry=null!=t?t:s.ContainerRegistry.instance(),this.validator=new r.ContainerRegistryValidator(this.registry)}containerVisitor(){return new class{visit(t){}}}inputVisitor(){return new class{visit(t,e,i,s){var n,r;e.inputs[i].link=s,e.inputs[i].updated=!0,a.isNotNull(s)&&(e.inputs[i].data=o.default.parseValue(null===(r=null===(n=t.nodeRegistry().get(s.nodeId))||void 0===n?void 0:n.outputs[s.ioId])||void 0===r?void 0:r.data,e.inputs[i].type))}}}outputVisitor(){return new class{visit(t,e,i,s){a.isNotNull(e.outputs[i])&&(e.outputs[i].links=s)}}}perNode(t,e){const i=(new r.NodeRegistryValidator).validate(t.nid,e,!1);if(a.isNull(i))return;const s=this.inputVisitor(),n=this.outputVisitor();return Object.keys(t.inputs).forEach(n=>s.visit(e,i,n,t.inputs[n])),Object.keys(t.outputs).forEach(s=>n.visit(e,i,s,t.outputs[s])),this.nodeVisitor().visit(e,i)}}e.BackendLinkVisitor=class extends d{constructor(t,e){super(t),this.dbHelper=null!=e?e:n.createNodeDbHelper(),this.db=this.registry.rootContainer().db}nodeVisitor(){return new u((t,e)=>this.dbHelper.updateAsync(this.db,e,"inputs","outputs"))}visit(t){return Promise.all(Object.keys(t.result()).map(t=>this.validator.validate(t,!1)).filter(t=>a.isNotNull(t)).map(e=>Promise.all(Object.values(t.result()[e.id]).map(t=>this.perNode(t,e))).then(t=>this.containerVisitor().visit(e)))).then(e=>t)}};e.FrontendLinkVisitor=class extends d{constructor(t,e){super(e),this.fn=t}nodeVisitor(){return new u}containerVisitor(){const t=this;return new class{visit(e){t.fn(e)}}}visit(t){return Object.keys(t.result()).map(t=>this.validator.validate(t,!1)).filter(t=>a.isNotNull(t)).forEach(e=>{Object.values(t.result()[e.id]).forEach(t=>this.perNode(t,e)),this.containerVisitor().visit(e)}),t}}},function(t,e){t.exports=require("@hapi/joi")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Shape2D=e.TWEAK_POS=void 0;const s=i(6);e.TWEAK_POS=[50,-100];class n{static isDisplayable(t){return!s.isEmpty(t)&&t[0]>0&&t[1]>0}static distance(t,e){const i=n.relative(t,e);return Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2))}static relative(t,e){const i=n.guard(t),s=n.guard(e);return[s[0]-i[0],s[1]-i[1]]}static bottomRight(t,e){const i=n.guard(t),s=n.guard(e);return[s[0]+i[0],s[1]+i[1]]}static move(t,e,i){const s=n.bottomRight(i,e),o=n.guard(t);return[s[0]+o[0],s[1]+o[1]]}static avgPos(t){return t.map(t=>n.guard(t)).reduce((t,e,i,{length:s})=>[t[0]+e[0]/s,t[1]+e[1]/s],[0,0])}static isInside(t,e,i){const s=this.bottomRight(t,e);return i[0]>=e[0]&&i[0]<=s[0]&&i[1]>=e[1]&&i[1]<=s[1]}static guard(t,e=0,i=0){var n,o;const a=null!=e?e:0,r=null!=i?i:0;return s.isEmpty(t)?[a,r]:[null!==(n=t[0])&&void 0!==n?n:a,null!==(o=t[1])&&void 0!==o?o:r]}static isInsideRectangle(t,e,i,s,n,o){return i<t&&i+n>t&&s<e&&s+o>e}static overlapBounding([t,e,i,s],[n,o,a,r]){return!(t>a||e>r||i<n||s<o)}static quadraticEquationSolver(t,e,i,s){const n=e*e-3*t*i,o=(9*t*e*i-2*e*e*e-27*t*t*s)/(2*Math.sqrt(Math.pow(Math.abs(n),3)));let a;if(n>0&&(Math.abs(o)<=1&&(a={x1:(2*Math.sqrt(n)*Math.cos(Math.acos(o)/3)-e)/(3*t),x2:(2*Math.sqrt(n)*Math.cos(Math.acos(o)/3-2*Math.PI/3)-e)/(3*t),x3:(2*Math.sqrt(n)*Math.cos(Math.acos(o)/3+2*Math.PI/3)-e)/(3*t)}),Math.abs(o)>1)){const i=Math.sqrt(n)*Math.abs(o)/(3*t*o)*(Math.cbrt(Math.abs(o)+Math.sqrt(o*o-1))+Math.cbrt(Math.abs(o)-Math.sqrt(o*o-1)))-e/(3*t);a={x1:i,x2:i,x3:i}}if(0===n){const i=(-e+Math.cbrt(e*e*e-27*t*t*s))/(3*t);a={x1:i,x2:i,x3:i}}if(n<0){const i=Math.sqrt(Math.abs(n))/(3*t)*(Math.cbrt(o+Math.sqrt(o*o+1))+Math.cbrt(o-Math.sqrt(o*o+1)))-e/(3*t);a={x1:i,x2:i,x3:i}}return a}}e.Shape2D=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DispatcherRegistry=void 0;const s=i(39),n=i(16);class o extends s.AbstractRegistry{constructor(){super()}static instance(){return o._instance||(o._instance=new o),o._instance}createKey(t){return n.IdGenerator.createNodeId(t.cid,t.id)}itemName(){return"Dispatcher Node"}}e.DispatcherRegistry=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Api=void 0;const s=i(15),n=i(17),o=i(10);e.Api=class{constructor(){this.client=s.default.create({baseURL:o.default.backendSync.baseUrl})}fetchMany(t,e){return this.client.get(t).then(this.extractData(e)).then(this.assignAllTo(()=>this.factoryEntry()))}fetchOne(t,e){return this.client.get(t).then(this.extractData(e)).then(t=>Object.assign(this.factoryEntry(),t))}newEntry(t){return new t}extractData(t=null){return e=>t?n.get(e.data,t):e.data}assignAllTo(t){return e=>e.map(e=>Object.assign(t(),e))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(17),n=i(10),o=i(36),a=i(12),r=i(25),u=i(3),d=i(30),l=i(5),p=i(1),h=i(42);class c extends r.ContainerNode{constructor(){super(),this.extra_node_types=this.childNodeType().filter(t=>a.IOT_TYPES.includes(t)),this.clonable=!1,this.movable=!1,this.entry=h.default.prototype.entry.bind(this),this.entryId=h.default.prototype.entryId.bind(this),this.deactivate=h.default.prototype.deactivate.bind(this),this.createSettingForm=h.default.prototype.createSettingForm.bind(this),this.getTakenIdentifiers=h.default.prototype.getTakenIdentifiers.bind(this),this.makeIdentifier=h.default.prototype.makeIdentifier.bind(this),this.findFreeIdentifier=h.default.prototype.findFreeIdentifier.bind(this),this.description="placeholder",this.api=this.initAPI(),this.settings.name=p.NodeSetting.create({description:"Entry",value:this.title,type:p.SettingType.READONLY})}entryFactory(){return this.api.factoryEntry()}updateEntry(t){return this.api.update(t,this.entryId())}deleteEntry(){return this.api.delete(this.entryId())}onAdded(){h.default.prototype.onAdded.call(this),super.onAdded()}applyEntry(t){h.default.prototype.applyEntry.call(this,t),this.applyTitle(),this.broadcastTitleToClients()}onAfterSettingsChange(t){h.default.prototype.onAfterSettingsChange.call(this),super.onAfterSettingsChange(t)}onCreated(){super.onCreated();const t=this.namePrefix(),e=this.entry()?" "+this.entryId():"";this.settings.name.value=t+e,h.default.prototype.onCreated.call(this)}onRemoved(){h.default.prototype.onRemoved.call(this)}shouldRejectNodeType(t){return!this.childNodeType().includes(t)}syncWithBackend(){this.side===l.Side.server&&o.singleton.process(()=>this.fetchChildren().then(t=>{const e=t.map(t=>t.entryId()),i=this.collectChildNodes(this.sub_container.getNodes()).map(t=>t),s=i.filter(t=>e.includes(t.entryId())),n=i.filter(t=>!t.properties.is_protected&&!e.includes(t.entryId()));Promise.all(n.map(t=>(t.deactivate(),t.container.nodeRegistry().remove(t)))).then(e=>this.processNextChildEntry(t,s))}))}onGetMessageToEditorSide({action:t,payload:e}){super.onGetMessageToEditorSide({action:t,payload:e,key:null}),t===u.BROADCAST.UPDATE_TITLE&&this.applyTitle()}applyTitle(){super.applyTitle(),this.container.runWithEditor(t=>{s.get(t,"renderer.container.id")===this.container.id&&t.emit("rerender-siderbar-containers")})}processNextChildEntry(t,e){if(!t||0===t.length)return;const i=t.pop();let o=e.find(t=>t.entryId()===i.entryId());const a=()=>{o instanceof c&&o.syncWithBackend(),this.processNextChildEntry(t,e)};if(o)s.isEqual(o.entry(),i)?a():(o.applyEntry(i),o.persistConfiguration(a));else{const t=[250,Math.max(100,...this.sub_container.getNodes(!1).map(t=>t.pos[1]))+n.default.backendSync.nodeDistance];this.sub_container.nodeRegistry().register(d.NodeFactory.create({type:i.nodeType(),properties:{entry:i},pos:t},!0)).then(t=>{o=t,a()})}}}e.default=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(70);class n extends s.default{constructor(){super(...arguments),this.settingFields={},this.entryFactory=()=>null,this.applyEntry=()=>{this.title=this.namePrefix(),this.sub_container.name=this.title},this.onAdded=()=>{this.ignore_remove=!0,this.removable=!1,this.movable=!1,this.applyEntry(),this.syncWithBackend()},this.createEntry=()=>Promise.resolve(null),this.updateEntry=t=>Promise.resolve(null),this.deleteEntry=()=>Promise.resolve(null),this.namePrefix=()=>this.title,this.getTakenIdentifiers=()=>Promise.resolve([]),this.makeIdentifier=t=>null,this.findFreeIdentifier=()=>Promise.resolve(null)}}e.default=n},function(t,e){t.exports=require("lodash-decorators/debounce")},function(t,e){t.exports=require("socket.io")},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.authMiddleware=e.schemaMiddleware=void 0;const n=i(27);e.schemaMiddleware=(t,e)=>(i,s,n)=>{const{error:o}=t.validate(i[e]);if(null==o)n();else{const{details:t}=o,e=t.map(t=>t.message).join(",");s.status(422).json({error:e})}};e.authMiddleware=()=>(t,e,i)=>s(void 0,void 0,void 0,(function*(){const o=t.headers.token;o?(yield(t=>s(void 0,void 0,void 0,(function*(){try{return yield n.default.db.isAuthenticated(t),!0}catch(t){return!1}})))(o))?i():e.status(403).json({error:"Please provide valid token"}):e.status(403).json({error:"Please provide token"})}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ApiHandler=void 0;const s=i(21),n=i(6),o=i(9);e.ApiHandler=class{constructor(t){this.editorSocket=t}emitSuccess(t,e,i,s=200){return this.editorSocket.io.emit(e,i.result()),t.status(s).send(i.message)}emitError(t,e,i,a){var r;return o.reliability_logger.warn(null!==(r=e.stack)&&void 0!==r?r:e.message),t.status(e instanceof s.NotFoundError?404:n.isNotNull(a)?a(e):400).send(`Can't ${i.toLowerCase()}. Reason: ${e}`)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeCRUDService=void 0;const s=i(30),n=i(5),o=i(41),a=i(77),r=i(35),u=i(6),d=i(16),l=i(56);class p extends l.NodeService{getNodes(t,e){const i=null!=e?e:this.cRegistry,s=i.rootContainer().db;return r.ContainerRegistryValidator.mustExisted(t,i).then(t=>this.dbHelper.listByContainer(s,t.id).then(t=>this.getNodesInContainer(s,t)).then(e=>({id:t.id,name:t.name,serializedNodes:e})))}createNode(t,e,i){this.logger.info(`Creating new node '${e.type}' in container '${t}'...`);const n=null!=i?i:this.cRegistry;return r.ContainerRegistryValidator.mustExisted(t,n).then(t=>t.nodeRegistry().register(s.NodeFactory.create(e,!0,i))).then(t=>new a.CreationResult(t))}removeNodes(t,e,i=!1,s){const n=null!=s?s:this.cRegistry,u=n.rootContainer().db;return r.ContainerRegistryValidator.mustExisted(t,n).then(t=>{const s=this.findNodes(t,e,i,n);return this.dbHelper.batchDeleteByIds(u,s.map(t=>d.IdGenerator.createNodeId(t.cid,t.id))).then(e=>o.NodeRegistryHelper.unregister(t,s,n,!0)).then(e=>a.initETLResult(a.RemoveResult,t.id,s.length,e))})}findNodes(t,e,i,o){const a=s.NodeFactory.standardize(t,e);return i?a.flatMap(e=>{const s=t.nodeRegistry().get(e);if(n.isFolderNode(s)){const t=o.get(s.sub_container.id);if(u.isNotNull(t))return[...this.findNodes(t,t.nodeRegistry().list(),i,o),s]}return[null!=s?s:e]}):a}}e.NodeCRUDService=p},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.initETLResult=e.PackResult=e.CloneResult=e.ImportResult=e.ExportResult=e.RemoveResult=e.CreationResult=void 0;const s=i(39),n=i(22),o=i(21),a=i(6);class r extends s.RegistryResult{constructor(t,e,i,s){super(i,s),this.containerId=t,this.total=e,this.message=this.genMessage()}static init(t,e,i,s,n){return new t(e,i,s.objects.map(t=>t.serialize()),s.errors.map(t=>{var e;return new o.RegistryError(t.message,null===(e=t.item)||void 0===e?void 0:e.serialize())}),n)}errMsg(){return a.isEmpty(this.errors)?"":`Errors: [${this.errors}]`}}e.CreationResult=class{constructor(t){var e,i;this.node=n.SerializableHelper.serialize(t),this.isDashboardNode=null===(e=t)||void 0===e?void 0:e.isDashboardNode,this.message=`Created node '${null===(i=t)||void 0===i?void 0:i.getReadableId()}' into container '${t.cid}'.`}result(){return this.node}};e.RemoveResult=class extends r{result(){return this}genMessage(){return`Removed ${this.objects.length}/${this.total} nodes into container '${this.containerId}'. ${this.errMsg()}`}};e.ExportResult=class extends r{constructor(t,e){super(t,0,e,null)}result(){return this}genMessage(){return`Exported ${this.objects.length} nodes and sub nodes in container '${this.containerId}'.`}};e.ImportResult=class extends r{result(){return this}genMessage(){return`Imported ${this.objects.length}/${this.total} nodes into container '${this.containerId}'. ${this.errMsg()}`}};e.CloneResult=class extends r{result(){return this}genMessage(){return`Cloned ${this.objects.length}/${this.total} nodes into container '${this.containerId}'. ${this.errMsg()}`}};e.PackResult=class extends r{constructor(t,e,i,s,n){super(t,e,i,s),this.dest=n.cid,this.cleanupResult=n.rr,this.message=this.genMessage()}result(){return{containerId:this.containerId,objects:this.objects,errors:this.errors}}genMessage(){return`Moved ${this.objects.length-1}/${this.total} nodes `+`from '${this.containerId}' into container '${this.dest}'. ${this.errMsg()}`}},e.initETLResult=(t,e,i,s,a)=>new t(e,i,s.objects.map(t=>n.SerializableHelper.serialize(t)),s.errors.map(t=>new o.RegistryError(t.message,n.SerializableHelper.serialize(t.item))),a)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeTree=e.NodeETLService=void 0;const s=i(30),n=i(5),o=i(19),a=i(67),r=i(41),u=i(11),d=i(79),l=i(22),p=i(77),h=i(35),c=i(6),g=i(16),m=i(9),f=i(56),O=i(76);class y extends f.NodeService{packUpNodes(t,e,i,s){this.logger.info(`Packing nodes [${e}] in container '${t}' into new container...`);const n=null!=s?s:this.cRegistry;return h.ContainerRegistryValidator.mustExisted(t,n).then(s=>h.ListValidator.notEmpty(e,"No node to pack-up").then(e=>this.doExport(t,e,n)).then(t=>this.doPackUp(s,i,t,n)))}cloneNodes(t,e,i,s){return this.logger.info(`Cloning nodes [${e}] inside container id '${t}'...`),h.ListValidator.notEmpty(e,"No node to clone").then(e=>this.doExport(t,e,s)).then(e=>this.doImport(e,t,s,i)).then(i=>p.initETLResult(p.CloneResult,t,e.length,i))}exportNodes(t,e,i){return h.ListValidator.notEmpty(e,"No node to export").then(e=>this.doExport(t,e,i)).then(t=>h.ListValidator.notEmpty(t,`Not found any [${e}] to export`)).then(e=>new p.ExportResult(t,e))}importNodes(t,e,i,s){return h.ListValidator.notEmpty(e,"No nodes to import").then(e=>this.doImport(e,t,s,i)).then(i=>p.initETLResult(p.ImportResult,t,e.length,i))}doExport(t,e,i){this.logger.info(`Exporting [${e}] nodes in container '${t}'...`);const s=null!=i?i:this.cRegistry,n=s.rootContainer().db;return h.ContainerRegistryValidator.mustExisted(t,s).then(t=>c.unionToArray(e.map(e=>g.IdGenerator.createNodeId(t.id,e)))).then(t=>this.dbHelper.listByIds(n,t)).then(t=>this.getNodesInContainer(n,t))}createFolder(t,e,i){this.logger.info(`Creating new folder node into container id '${t.id}'...`);const n=this.idGenerator.genNodeId(t.id,g.IdGenerator.UNINITIALIZED),o=s.NodeFactory.create({id:n,cid:t.id,type:d.CONTAINER_NODE_TYPE,pos:i,sub_container:{id:n}},!0,e);return o.container=t,o.sub_container=e.register(o.sub_container),this.logger.info(`Cached new folder node id '${g.IdGenerator.createNodeId(t.id,o.id)}' `+`with container id '${o.sub_container.id}'`),o}doPackUp(t,e,i,s){const n=this.createFolder(t,s,e),o=n.sub_container.id,a=i.map(t=>t.id);return this.logger.info(`Analyzing ${a.length} nodes to move from container '${t.id}' `+`into container id '${o}'...`),Promise.resolve(new v(o,this.idGenerator,t.id)).then(t=>t.compute(i)).then(t=>this.dbHelper.batchInsert(s.rootContainer().db,[l.SerializableHelper.serialize(n),...t.flatten()])).then(e=>(new O.NodeCRUDService).removeNodes(t,a).then(t=>({nodes:e,rr:t}))).then(({nodes:e,rr:i})=>r.NodeRegistryHelper.register(t,e,s,!0).then(t=>({pr:t,rr:i}))).then(({pr:e,rr:i})=>p.initETLResult(p.PackResult,t.id,a.length,e,{cid:o,rr:i}))}doImport(t,e,i,s){this.logger.info(`Analyzing ${t.length} nodes to import into container id '${e}'...`);const n=null!=i?i:this.cRegistry,o=n.rootContainer().db;return h.ContainerRegistryValidator.mustExisted(e,n).then(e=>Promise.resolve(new v(e.id,this.idGenerator)).then(e=>e.compute(t,s)).then(t=>this.dbHelper.batchInsert(o,t.flatten())).then(t=>r.NodeRegistryHelper.register(e,t,n,!0)))}}e.NodeETLService=y;class v{constructor(t,e,i){this.logger=m.node_service_logger,this.destCId=t+"",this.contextCId=c.isNull(i)?this.destCId:i+"",this.idGenerator=e}compute(t,e){const{containers:i,nodeMap:s}=this.analyze(t);return c.isEmpty(s)?this:(this.tree=this.build(i,s),this.tree=this.tree.normalize(e),this.outputs=this.tree.flatten(),this)}flatten(){var t;return null!==(t=this.outputs)&&void 0!==t?t:[]}analyze(t){return t.reduce((t,e)=>{if(n.isFolderNode(e)){const i=e.sub_container.id;t.containers[i]={id:this.idGenerator.genContainerId(i)}}return t.nodeMap[e.cid]=c.isNull(t.nodeMap[e.cid])?[e]:[...t.nodeMap[e.cid],e],t},{containers:{},nodeMap:{}})}build(t,e){const i=Object.keys(e).filter(e=>c.isNull(t[e]));if(i.length>1)throw new Error("The given nodes has invalid node(s) that is under non-existed container(s) "+`[${i.filter(t=>t!==this.destCId)}]`);const s=Object.assign(Object.assign({},t),c.objectOf(this.contextCId,{id:this.destCId}));this.logger.info(`Building node tree with ${Object.keys(t).length} new containers `+`into container '${this.destCId}'...`),1===i.length&&i[0]!==this.contextCId&&(e[this.contextCId]=e[i[0]],delete e[i[0]]);const n=c.arrayToObject(Object.keys(s),t=>t,t=>{var i;return null!==(i=e[t])&&void 0!==i?i:[]});return this.buildBranch(this.contextCId,s,n)}buildBranch(t,e,i){return this.logger.info(`Analyzing ${i[t].length} nodes(s) in container '${e[t].id}'...`),new N(e[t]).add(i[t],e=>this.idGenerator.genNodeId(t,e),t=>this.buildBranch(t,e,i))}}e.NodeTree=v;class N{constructor(t){this.siblingIds={},this.nodes={},this.nodeLinks=[],this.logger=m.node_service_logger,this.parent=t}add(t,e,i){return t.forEach(t=>{var s,a;const r=n.isFolderNode(t)?i(t.sub_container.id):null;this.siblingIds[t.id]=e(t.id),this.nodes[t.id]={node:t,descendant:r};let u=0;for(const[e,i]of Object.entries(null!==(s=t.inputs)&&void 0!==s?s:{}))c.isNull(i.link)||(this.nodeLinks.push(o.createNodeLink(this.parent.id,o.Link.create(i.link),o.Link.create({nodeId:t.id,ioId:e,slot:++u}))),i.link=null);u=0;for(const[e,i]of Object.entries(null!==(a=t.outputs)&&void 0!==a?a:{}))c.isEmpty(i.links)||(this.nodeLinks.push(o.createNodeLink(this.parent.id,o.Link.create({nodeId:t.id,ioId:e,slot:++u}),...i.links.map(t=>o.Link.create(t)))),i.links=[])}),this}normalize(t){const e=this.computeRelativePositions(t);this.logger.info(`Optimizing ${this.nodeLinks.length} node link(s) in container '${this.parent.id}'...`);const i=o.createLinkHandler(null,new T(this.parent),new I(this.nodes),!0).batchCreate(...this.nodeLinks);return this.logger.info(`Normalizing ${Object.keys(this.nodes).length} nodes in container '${this.parent.id}'...`),this.outputs=Object.keys(this.nodes).map(t=>this.nodes[t]=this.normalizeNode(this.nodes[t],i,e)).flatMap(t=>this.flattenBranch(t)),this}flatten(){var t;return null!==(t=this.outputs)&&void 0!==t?t:[]}computeRelativePositions(t){const e=Object.values(this.nodes).map(t=>t.node.pos);return c.isNull(t)?null:a.Shape2D.relative(a.Shape2D.avgPos(e),t)}flattenBranch(t){if(c.isNull(t.descendant))return[t.node];const e=Object.values(t.descendant.nodes).flatMap(t=>this.flattenBranch(t));return[t.node,...e]}normalizeNode(t,e,i){if(n.isFolderNode(t.node)){t.node.sub_container.id=t.descendant.parent.id,t.descendant=t.descendant.normalize()}const s=t.node.id+"";return t.node.id=this.siblingIds[t.node.id],t.node.cid=this.parent.id,t.node.type=u.NodeTypeRegistry.instance().lookupNodeType(t.node.type),t.node.pos=a.Shape2D.move(i,t.node.pos),t.node.inputs=this.normalizeNodeInputs(s,t.node.inputs,e,t.descendant),t.node.outputs=this.normalizeNodeOutputs(s,t.node.outputs,e,t.descendant),t}normalizeNodeInputs(t,e,i,s){return c.mapToObjectSameKey(e,(e,n)=>{const a=i.getLinkByInput(this.parent.id,t,e);return n.link=c.isNull(a)?null:o.Link.create(Object.assign(Object.assign({},a),{nodeId:this.siblingIds[a.nodeId]})),c.isNotNull(s)&&(n.subNodeId=s.siblingIds[n.subNodeId+""]),n})}normalizeNodeOutputs(t,e,i,s){return c.mapToObjectSameKey(e,(e,n)=>{var a;const r=null!==(a=i.getLinkByOutput(this.parent.id,t,e))&&void 0!==a?a:[];return n.links=r.map(t=>o.Link.create(Object.assign(Object.assign({},t),{nodeId:this.siblingIds[t.nodeId]}))),c.isNotNull(s)&&(n.subNodeId=s.siblingIds[n.subNodeId+""]),n})}}class T{constructor(t){this.container=t}validate(t,e){return this.container}}class I{constructor(t){this.nodes=t}validate(t,e,i){var s;return null===(s=this.nodes[t])||void 0===s?void 0:s.node}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CONTAINER_NODE_TYPE=void 0;const s=i(25),n=i(11);e.CONTAINER_NODE_TYPE="container/folder",n.NodeTypeRegistry.registerNodeType(e.CONTAINER_NODE_TYPE,s.ContainerNode,null,!0,!0)},function(t){t.exports=JSON.parse('{"name":"rubix-wires","version":"1.8.4","title":"Rubix Wires","author":"zero, binod, marc, ap, hilly, ritesh, ig, dan <dev@nube-io.com>","private":true,"engines":{"node":">=10.0.0","npm":">=6.0.0"},"scripts":{"compile":"tsc","prepareBuild":"node buildSrc/prepareBuild.js","prestart":"npm run prepareBuild && npm run compile","start":"node dist/app.js --datadir ./db","prebuild":"npm run prepareBuild --prod","build":"webpack --config webpack.all.prod.js --env.production","postbuild":"node buildSrc/distribute.js","test":"jest","predocker":"npm run compile","docker":"node dist/app.js","docker:prod":"node app.js","prod:start":"node app.js","pm2:start":"npm run pm2:delete && NODE_ENV=production pm2 start ecosystem.config.js","pm2:stop":"pm2 stop ecosystem.config.js","pm2:delete":"pm2 delete ecosystem.config.js","pm2:status":"pm2 status","pm2:save":"pm2 save","pm2:startup":"pm2 startup","pm2:unstartup":"pm2 unstartup","pm2":"pm2","install:pm2-logrotate":"pm2 install pm2-logrotate","uninstall:pm2-logrotate":"pm2 uninstall pm2-logrotate"},"dependencies":{"@femessage/log-viewer":"^1.4.2","@hapi/joi":"^17.1.0","@influxdata/influxdb-client":"^1.7.1","@influxdata/influxdb-client-apis":"^1.7.1","@mdi/font":"^4.9.95","axios":"^0.19.0","body-parser":"^1.16.1","btoa":"^1.2.1","codeflask":"^1.4.1","convert-units":"^2.3.4","cookie-parser":"^1.4.3","cron":"^1.8.2","cron-parser":"^2.13.0","cron-time-generator":"^1.0.4","cron-validator":"^1.1.1","cronstrue":"^1.92.0","crypto-js":"^3.1.9-1","dotenv":"^8.2.0","enumify":"^2.0.0","events":"^1.1.1","express":"^4.14.1","express-validator":"^4.3.0","influx":"^5.5.1","ip":"^1.1.5","jquery":"^3.2.1","jsonata":"^1.8.1","jsonwebtoken":"^8.5.1","lodash":"^4.17.4","lodash-decorators":"latest","logplease":"^1.2.14","material-icons":"^0.3.1","microcache":"^1.0.0","minimist":"^1.2.5","modbus-serial":"^7.8.1","moment":"^2.19.1","moment-timezone":"^0.5.28","morgan":"^1.8.1","mqtt":"^2.18.8","mqtt-match":"^2.0.3","nedb":"^1.8.0","net":"^1.0.2","network":"^0.5.0","nexmo":"^2.6.0","ngeohash":"^0.6.3","node-aes-cmac":"^0.1.1","node-bacnet":"^0.1.2-beta.3","nodemailer":"^6.4.2","perm":"^1.0.0","ping":"^0.2.2","pubsub-js":"^1.8.0","roboto-fontface":"^0.10.0","serialport":"^8.0.6","set-ip-address":"^0.2.0","slugid":"^2.0.0","socket.io":"^2.0.4","socket.io-client":"^2.3.0","systeminformation":"^4.26.10","twilio":"^3.40.0","uuid":"^8.0.0","vis":"^4.21.0","vm2":"^3.9.2","vue":"^2.6.11","vue-cookie":"^1.1.4","vue-markdown":"^2.2.4","vue-moment":"^3.2.0","vue-multipane":"^0.9.5","vue-resize-directive":"^1.2.0","vue-router":"^3.1.5","vue-socket.io":"^2.1.1-a","vue-toasted":"^1.1.27","vue2-editor":"^2.10.2","vuebar":"0.0.17","vuetify":"^2.2.8","websocket":"^1.0.31"},"devDependencies":{"@babel/core":"^7.11.6","@babel/preset-env":"^7.11.5","@types/body-parser":"^1.16.7","@types/codeflask":"^1.4.0","@types/cookie-parser":"^1.3.30","@types/express":"^4.0.35","@types/express-validator":"^3.0.0","@types/handlebars":"^4.0.31","@types/jest":"^25.1.3","@types/jquery":"^3.2.16","@types/jquery.noty":"^2.0.28","@types/lodash":"^4.14.149","@types/moment":"^2.13.0","@types/morgan":"^1.7.32","@types/mqtt":"^2.5.0","@types/nedb":"^1.8.5","@types/node":"^8.10.59","@types/shelljs":"^0.7.9","@types/socket.io":"^1.4.42","@types/socket.io-client":"^1.4.31","@types/vis":"^4.17.3","adm-zip":"^0.4.14","archiver":"^3.1.1","awesome-typescript-loader":"5.2.1","babel-loader":"^7.1.5","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^6.1.0","css-loader":"^3.6.0","deepmerge":"^4.2.2","empty-module":"0.0.2","favicons-webpack-plugin":"^4.2.0","fibers":"^4.0.2","file-loader":"^5.1.0","generate-package-json-webpack-plugin":"^1.1.2","html-webpack-plugin":"^4.4.1","husky":"^3.1.0","jest":"^25.1.0","lint-staged":"^9.5.0","mini-css-extract-plugin":"^0.11.1","prettier":"^1.19.1","pug":"^2.0.4","pug-loader":"^2.4.0","pug-plain-loader":"^1.0.0","sass":"^1.26.10","sass-loader":"^10.0.2","shebang-loader":"0.0.1","shelljs":"^0.8.3","source-map-loader":"1.0.0","source-map-support":"^0.5.16","ts-jest":"^25.2.1","ts-loader":"^6.2.1","typescript":"^3.9.7","vue-loader":"^15.8.3","vue-template-compiler":"^2.6.11","webpack":"^4.44.1","webpack-cli":"^3.3.12","webpack-dev-middleware":"^1.12.2","webpack-hot-middleware":"^2.25.0","webpack-merge":"^5.1.4","webpack-node-externals":"^2.5.2","webpack-strip-block":"^0.3.0"},"optionalDependencies":{"pm2":"^4.2.2"}}')},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractFolderIONode=void 0;const s=i(6),n=i(3),o=i(18),a=i(2);class r extends n.Node{constructor(t,e){super(),this.title=t,this.description=e,this.iconImageUrl=a.NODE_INFO.container["folder-input"].iconImageUrl}onAdd(){if(!this.isUnderContainer()||s.isNull(this.properties.slot)||-1===this.properties.slot)return;let t=this.properties.slot;delete this.properties.slot,o.createNodeDbHelper().update(this,["properties"]),this.correctParentIO(this.container.nodeItself(),t)}isUnderContainer(){var t;return s.isNotNull(null===(t=this.container)||void 0===t?void 0:t.nodeItself())}findParentIOById(t){var e;return null!==(e=Object.entries(this.container.nodeItself()[t]).find(([t,e])=>this.id===e.subNodeId))&&void 0!==e?e:[null,null]}hasItself(t){return null!==this.findParentIOById(t)[0]}}e.AbstractFolderIONode=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}e.default=s,s.TYPES={INT16:1,UINT16:2,INT32:3,UINT32:4,FLOAT32:5,INT64:6,UINT64:7,DOUBLE64:8},s.ENDIAN={LEB_BEW:0,LEB_LEW:1,BEB_LEW:2,BEB_BEW:3},s.readByteOrder=(t,e,i,n)=>{let o,a,r=s.TYPES,u=s.ENDIAN;try{o=i<=r.UINT16?t.slice(e,e+2):i<=r.FLOAT32?t.slice(e,e+4):t.slice(e,e+8),n===u.BEB_LEW||i<=r.UINT16&&n===u.BEB_BEW?o.swap16():i>r.UINT16&&i<=r.FLOAT32&&n===u.BEB_BEW?o.swap32():i>=r.INT64&&n===u.BEB_BEW&&o.swap64()}catch(t){console.log(`buffer readValue issue in modbus-point-methods. Buffer.alloc ${t}`)}try{switch(i){case r.INT16:a=o.readInt16LE(a);break;case r.UINT16:a=o.readUInt16LE(a);break;case r.INT32:a=o.readInt32LE(a);break;case r.UINT32:a=o.readUInt32LE(a);break;case r.FLOAT32:a=o.readFloatLE(a);break;case r.INT64:case r.UINT64:break;case r.DOUBLE64:a=o.readDoubleLE(a)}}catch(t){console.log(`buffer readValue issue in modbus-point-methods. switch case ${t}`)}return a},s.writeValue=(t,e,i)=>{let n,o=s.TYPES,a=s.ENDIAN;try{n=e<=o.UINT16?Buffer.alloc(2):e<=o.FLOAT32?Buffer.alloc(4):Buffer.alloc(8)}catch(t){console.log(`buffer writeValue issue in modbus-point-methods. Buffer.alloc  ${t}`)}try{switch(e){case o.INT16:n.writeInt16LE(t);break;case o.UINT16:n.writeUInt16LE(t);break;case o.INT32:n.writeInt32LE(t);break;case o.UINT32:n.writeUInt32LE(t);break;case o.FLOAT32:n.writeFloatLE(t);break;case o.INT64:case o.UINT64:break;case o.DOUBLE64:n.writeDoubleLE(t)}}catch(t){console.log(`buffer writeValue issue in modbus-point-methods :switch case ${t}`)}try{return i===a.BEB_LEW||e<=o.UINT16&&i===a.BEB_BEW?n.swap16():e>o.UINT16&&e<=o.FLOAT32&&i===a.BEB_BEW?n.swap32():e>=o.INT64&&i===a.BEB_BEW&&n.swap64(),n}catch(t){console.log(`buffer writeValue issue in modbus-point-methods :buf.swap() ${t}`)}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(44);class o{static isUUID(t){const e=t.toString().trim().split("-");return e.length>=1&&8===e[0].length}static isUUIDFile(t){return s(this,void 0,void 0,(function*(){try{let e=yield n.default.readFile(t);return!!e&&o.isUUID(e)}catch(t){return!1}}))}static makeUUIDFile(t,e){return s(this,void 0,void 0,(function*(){try{yield n.default.createDirectory(t),yield n.default.writeFile(`${t}/${e}`,o.create8DigId())}catch(t){throw t}}))}}e.default=o,o.createUUID=(t="")=>t?((Number(t)^16*Math.random())>>Number(t)/4).toString(16):`${1e7}-1000-4000-8000-${1e11}`.replace(/[018]/g,o.createUUID),o.create8DigId=(t="")=>t?((Number(t)^16*Math.random())>>Number(t)/4).toString(16):`${1e7}`.replace(/[018]/g,o.create8DigId),o.create12DigId=(t="")=>t?((Number(t)^16*Math.random())>>Number(t)/4).toString(16):`${1e7}-4000`.replace(/[018]/g,o.create12DigId)},function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.Equals="Equals",t.NotEquals="Not Equal",t.GreaterThanEqual="Greater Than Equal",t.GreaterThan="Greater Than",t.LessThanEqual="Less Than Equal",t.LessThan="Less Than",t.Includes="Includes",t.startsWith="Starts With",t.endsWith="Ends With"}(s||(s={}));e.default=class{static compare(t,e,i){const n=t.settings.function.value;switch(t.settings.isNumber.value&&(e=Number(e),i=Number(i)),n){case s.Equals:return e===i;case s.NotEquals:return e!==i;case s.GreaterThanEqual:return e>=i;case s.GreaterThan:return e>i;case s.LessThanEqual:return e<=i;case s.LessThan:case s.LessThan:return e<i;case s.Includes:return e.includes(i);case s.startsWith:return e.startsWith(i);case s.endsWith:return e.endsWith(i);default:return e===i}}static findVal(t,e){let i;return Object.keys(t).some((function(s){if(s===e&&(i={valueWithKey:{[e]:t[s]},value:t[s]}),t[s]&&"object"==typeof t[s])return i=this.findVal(t[s],e),void 0!==i})),i}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static insertIntoObjectAtPosition(t,e,i="",s=""){if(""===s&&""===i)return Object.assign(t,e),t;const n={};let o=!1;const a=""!==s&&""!==i;let r=!1;for(let u in t)t.hasOwnProperty(u)&&(!r&&a&&o&&s===u?(Object.assign(n,e),r=!0,o=!1):r||a||!o&&s!==u?r||u!==i||(o=!0):(Object.assign(n,e),r=!0,o=!1),n[u]=t[u]);return r||Object.assign(n,e),n}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static persistProperties(t,e=!1,i=!1,s=!1,n=!1){if(t.container.db){var o={};e&&(o.settings=t.settings),i&&(o.properties=t.properties),s&&(o.inputs=t.inputs),n&&(o.outputs=t.outputs),t.container.db.updateNode(t.id,t.container.id,{$set:o})}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static scale420maToRange(t,e,i){return t<=4?e:t>=20?i:(t-4)*((i-e)/16)+e}static scaleUI420ma(t,e,i){const s=(t-e)*(20/(i-e));return s<=4?4:s>=20?20:s}}e.default=s,s.scaleToGPIOValue=(t,e,i,s=120,n=0)=>{let o=t,a=(i-e)*(o-s)/(n-s)+e;return a>i?(a=i,o=n):a<e&&(a=e,o=s),a},s.scaleFromGPIOValue=(t,e,i,s=0,n=1)=>(i-e)*(t-s)/(n-s)+e,s.uiAsDI=t=>t>.6?0:t<.2?1:void 0,s.diInvert=t=>1^t},function(t,e){t.exports=require("node-bacnet")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoRaRawTwoWayInput=e.LORA_DATA_TYPE_LENGTHS=e.LORA_DATA_TYPE_NAMES=void 0;const s=i(0),n=i(3),o=i(2),a=i(1);var r;!function(t){t[t.INT8=0]="INT8",t[t.UINT8=1]="UINT8",t[t.INT16=2]="INT16",t[t.UINT16=3]="UINT16",t[t.INT32=4]="INT32",t[t.UINT32=5]="UINT32",t[t.FLOAT=6]="FLOAT"}(r=e.LORA_DATA_TYPE_NAMES||(e.LORA_DATA_TYPE_NAMES={})),e.LORA_DATA_TYPE_LENGTHS=[1,1,2,2,4,4,4];class u extends n.Node{constructor(){super(),this.payloadDefinition=[],this.title=o.NODE_INFO["protocols/lora-raw"]["lora-raw-two-way-in"].title,this.description=o.NODE_INFO["protocols/lora-raw"]["lora-raw-two-way-in"].description,this.settings.enable=a.NodeSetting.create({description:"enable",type:a.SettingType.BOOLEAN,value:!1}),this.settings.senderId=a.NodeSetting.create({description:"sender Id",type:a.SettingType.NUMBER,value:0}),this.settings.port=a.NodeSetting.create({description:"port number",type:a.SettingType.NUMBER,value:0}),this.settings.types=a.NodeSetting.create({description:"Types",type:a.SettingType.READONLY,value:"INT8, INT16, INT32, FLOAT"}),this.settings.definition=a.NodeSetting.create({description:"payload definition (JSON)",type:a.SettingType.STRING,value:""}),this.addInput("rawInput",a.Type.STRING),this.addOutput("error",a.Type.STRING)}init(){this.updateOutputs()}onAdded(){this.payloadDefinition=this.stringToDataTypes(this.settings.definition.value)}onInputUpdated(){let t=this.getInputData(0)||"";if(!1===this.settings.enable.value)return;if(!t)return;if(!t||t.length<=12||"FFFFFFFF"!==t.substring(0,8))return;const i=parseInt(t.substring(10,12),16),s=parseInt(t.substring(12,14),16);if(i!==this.settings.senderId.value||s!==this.settings.port.value)return;"\r\n"===t.substring(t.length-2,t.length)?t=t.substring(0,t.length-2):t.length%2==1&&"\n"===t[t.length-1]&&(t=t.substring(0,t.length-1));const n=t=>{this.setOutputData(0,"parse error: "+t)};let o=Buffer.from(t.substring(14),"hex"),a=new Array(this.payloadDefinition.length);a.fill(!1);for(let t=0;t<o.length;){let i=o.readUInt8(t++),s=0;if(i>=this.payloadDefinition.length)return void n("invalid point "+i);if(a[i])return void n("point already parsed: "+i);if(s=e.LORA_DATA_TYPE_LENGTHS[this.payloadDefinition[i]],o.length-t<s)return void n("invalid length");switch(this.payloadDefinition[i]){case r.INT8:this.setOutputData(i+1,o.readInt8(t));break;case r.UINT8:this.setOutputData(i+1,o.readUInt8(t));break;case r.INT16:this.setOutputData(i+1,o.readInt16LE(t));break;case r.UINT16:this.setOutputData(i+1,o.readUInt16LE(t));break;case r.INT32:this.setOutputData(i+1,o.readInt32LE(t));break;case r.UINT32:this.setOutputData(i+1,o.readUInt32LE(t));break;case r.FLOAT:this.setOutputData(i+1,o.readFloatLE(t))}a[i]=!0,t+=s}this.setOutputData(0,null)}onAfterSettingsChange(){this.payloadDefinition=this.updateOutputs(),this.setOutputData(0,null),this.onInputUpdated()}updateOutputs(){const t=this.stringToDataTypes(this.settings.definition.value);if(this.payloadDefinition.length!==t.length){const e=this.getOutputsCount();for(let t=1;t<e;t++)this.removeOutput(t);for(let e=0;e<t.length;e++)this.addOutput(e.toString(),a.Type.NUMBER);this.updateNodeOutput()}return t}stringToDataTypes(t){const e=t.toUpperCase().replace(/ /g,"").split(",").filter(t=>""!==t);if(e&&e.length)for(let t=0;t<e.length;t++){if(void 0===r[e[t]])return void this.setOutputData(1,"settings parse error");e[t]=r[e[t]]}return e}}e.LoRaRawTwoWayInput=u,s.Container.registerNodeType("protocols/lora-raw/lora-raw-two-way-in",u)},function(t,e){t.exports=require("crypto")},function(t,e){t.exports=require("serialport")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(26),n=i(32),o=i(381),a=i(26),r=i(93),u=i(94);class d{static getActiveNetworks(){return new Promise(t=>{o.get_interfaces_list((function(e,i){e&&t(),i||t(),t(i)}))})}static networkUpDown(t,e){return new Promise((i,n)=>{let o=`sudo ip link set ${t} ${e}`;s.exec(o,(t,e,s)=>{t?n({err:t,stderr:s}):i(e)})})}static checkIpValid(t,e,i,s){const n=u.isV4Format(t),o=u.isV4Format(e),a=u.isV4Format(i),r=u.isV4Format(s);return!!(n&&o&&a&&r)}static bbbGetInterfaceDetails(){return new Promise((t,e)=>{a.execSync("connmanctl services",(i,s,n)=>{i?e({err:i,stderr:n}):t(s.toString().replace(/\s/g,"").substring(8))})})}static bbbSetIPDHCP(t){return new Promise((e,i)=>{const s=`sudo connmanctl config ${t} --ipv4 dhcp`;a.execSync(s,(t,s,n)=>{t?i({err:t,stderr:n}):e(!0)})})}static bbbSetIPFixed(t,e,i,s){return new Promise((n,o)=>{const r=`sudo connmanctl config ${t} --ipv4 manual ${e} ${i} ${s} --nameservers 8.8.8.8 8.8.4.4`;a.execSync(r,(t,e,i)=>{t?o({err:t,stderr:i}):n(!0)})})}static updateIpRubixCompute(t,e,i,s,o,a,l,p,h,c,g,m){return new Promise((f,O)=>{const y="ERROR: invalid ip settings",v=t,N=e,T=i,I=s,S=o,b=a,E=l,D=p,_=h,R=c,A=g,C=m,P=d.checkIpValid(T,I,S,b),w=d.checkIpValid(_,R,A,C);console.log(t,N,i,s,o,a,l,D,h,c,g,m,"checkIpValidEth1=",P,"checkIpValidEth2=",w),n.default.systemInfo().then(t=>{if("BCM2835"===t.system.model)if(P&&w){let t=[];if(!0===N){console.log("dhcpEth1 === true");const e={interface:v,dhcp:!0};t.push(e)}if(!0===D){console.log("dhcpEth2 === true");const e={interface:E,dhcp:!0};t.push(e)}if(!1===N){console.log("dhcpEth1 === false");const e=u.subnet(T,I),i={interface:v,ip_address:T,prefix:e.subnetMaskLength,gateway:S,nameservers:[b]};t.push(i)}if(!1===D){console.log("dhcpEth2 === false");const e=u.subnet(_,R),i={interface:E,ip_address:_,prefix:e.subnetMaskLength,gateway:A,nameservers:[C]};t.push(i)}console.log(`SET: new ip  ${JSON.stringify(t)} @ ${v} @ ${E}`),r.configure(t).then(e=>{console.log(`SET: new ip  ${JSON.stringify(t)} @ ${v} @ ${E} msg ${e}`),f(`SET: new ip  ${JSON.stringify(t)} @ ${v} msg ${e}`)})}else console.log(`${y} @ ${v}  @ ${E}`),O(`${y} @ ${v}  @ ${E}`);else console.log(`ERROR: incorrect host type ${t.system.model} @ ${v} @ ${E}`),O(`ERROR: incorrect host type ${t.system.model} @ ${v} @ ${E}`)}).catch(t=>{console.log(`${y} @ ${v} @ ${E} ${t}`),O(`${y} @ ${v} @ ${E} ${t}`)})})}}e.default=d},function(t,e){t.exports=require("set-ip-address")},function(t,e){t.exports=require("ip")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{static nodeColourChange(t,e){t.setNodeState(e)}}},function(t,e,i){t.exports=i(27)},function(t,e){t.exports=require("source-map-support")},function(t,e){t.exports=require("process")},function(t,e){t.exports=require("minimist")},function(t,e){t.exports=require("dotenv")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Backend=void 0;const s=i(13),n=i(12),o=i(0),a=i(30),r=i(109),u=i(111);s.create("backend",{color:s.Colors.Yellow});e.Backend=class{constructor(t,e){this.database=t,this.backendSyncCfg=e}start(){this.backendSyncCfg.enabled&&this.ensureParentContainers().then(()=>this.refreshPeriodically())}ensureParentContainers(){return this.findOrCreateNode(n.EDGES_PARENT_CONTAINER_TYPE,t=>t instanceof r.EdgesParentContainerNode).then(t=>this.edgesContainer=t).then(()=>this.findOrCreateNode(n.MODULES_PARENT_CONTAINER_TYPE,t=>t instanceof u.ModulesParentContainerNode)).then(t=>this.modulesContainer=t).then(()=>this.findOrCreateNode(n.SERVICES_PARENT_CONTAINER_TYPE,t=>t instanceof u.ServicesParentContainerNode)).then(t=>this.servicesContainer=t)}findOrCreateNode(t,e){const i=o.ContainerRegistry.instance().rootContainer();return new Promise((s,n)=>{const o=i.getNodes().find(e);if(!o)return i.nodeRegistry().register(a.NodeFactory.create({type:t},!0));s(o)})}refreshPeriodically(){setInterval(()=>this.refreshParentContainers(),1e3*this.backendSyncCfg.nodeRefreshIntervalSeconds)}refreshParentContainers(){this.edgesContainer.syncWithBackend(),this.modulesContainer.syncWithBackend(),this.servicesContainer.syncWithBackend()}}},function(t,e){t.exports=require("slugid")},function(t,e){t.exports=require("enumify")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LinkResult=void 0;const s=i(19);e.LinkResult=class{constructor(t){this._map=null!=t?t:{}}push(t,e,i,n,...o){var a,r,u,d;if(this._map[t]=null!==(a=this._map[t])&&void 0!==a?a:{},this._map[t][e]=null!==(r=this._map[t][e])&&void 0!==r?r:{nid:e+"",inputs:{},outputs:{}},"input"===i&&(this._map[t][e].inputs[n]=null!==(u=(null!=o?o:[])[0])&&void 0!==u?u:null),"output"===i){const i=null!==(d=this._map[t][e].outputs[n])&&void 0!==d?d:[],a=null!=o?o:[];this._map[t][e].outputs[n]=i.concat(a.filter(t=>!i.some(e=>s.compareNodeIO(t,e))))}return this}hasInput(t,e,i){return void 0!==this.getLinkByInput(t,e,i)}getLinkByInput(t,e,i){var s,n;return null===(n=(null!==(s=this._map[t])&&void 0!==s?s:{})[e])||void 0===n?void 0:n.inputs[i]}getLinkByOutput(t,e,i){var s,n;return null===(n=(null!==(s=this._map[t])&&void 0!==s?s:{})[e])||void 0===n?void 0:n.outputs[i]}result(){return this._map}merge(t){return Object.keys(t.result()).forEach(e=>Object.values(t.result()[e]).forEach(t=>{Object.keys(t.inputs).forEach(i=>this.push(e,t.nid,"input",i,t.inputs[i])),Object.keys(t.outputs).forEach(i=>this.push(e,t.nid,"output",i,...t.outputs[i]))})),this}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DispatchNode=void 0;const s=i(3),n=i(68),o=i(53);class a extends s.Node{onAdded(){super.onAdded(),n.DispatcherRegistry.instance().register(this,!0),o.PubSubHelpers.map(this)}onRemoved(){n.DispatcherRegistry.instance().remove(this),o.PubSubHelpers.unMap(this)}}e.DispatchNode=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UNKNOWN_POINT_NAME=void 0,e.UNKNOWN_POINT_NAME="Unknown"},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pubSubSingleton=void 0;const s=i(68);e.pubSubSingleton=new class{constructor(){this.store={}}getStore(){return this.store}addPoint(t,e,i,s){this.store[t]||(this.store[t]={points:{}}),this.store[t].points[e]?this.store[t].points[e].soft&&!s&&(this.store[t].points[e].soft=s):this.store[t].points[e]={msg:{},name:i,listeners:[],soft:s},this.updateProtocols()}removePoint(t,e){var i,s,n,o;(null===(s=null===(i=this.store[t])||void 0===i?void 0:i.points)||void 0===s?void 0:s[e])&&delete this.store[t].points[e],0===(null===(o=Object.keys((null===(n=this.store[t])||void 0===n?void 0:n.points)||{}))||void 0===o?void 0:o.length)&&delete this.store[t],this.updateProtocols()}renamePoint(t,e,i){var s,n,o;(null===(o=null===(n=null===(s=this.store)||void 0===s?void 0:s[t])||void 0===n?void 0:n.points)||void 0===o?void 0:o[e])&&(this.store[t].points[e].name=i),this.updateProtocols()}dispatch(t,e,i){var s,n;(null===(n=null===(s=this.store[t])||void 0===s?void 0:s.points)||void 0===n?void 0:n[e])&&(this.store[t].points[e].msg=i,this.store[t].points[e].listeners.forEach(t=>{t.subscribe(i)}))}connect(t,e,i,s){Object.keys(this.store).forEach(t=>{Object.keys(this.store[t].points).forEach(e=>{this.store[t].points[e].listeners=this.store[t].points[e].listeners.filter(t=>!(t.cid===s.cid&&t.id===s.id))})}),t&&e&&i&&(this.addPoint(t,e,i,!0),this.store[t].points[e].listeners.push(s),s.subscribe(this.store[t].points[e].msg))}disconnect(t,e,i){var s,n;if(null===(n=null===(s=this.store[t])||void 0===s?void 0:s.points)||void 0===n?void 0:n[e]){const s=this.store[t].points[e];s.listeners=s.listeners.filter(t=>!(t.cid===i.cid&&t.id===i.id))}}updateProtocols(){s.DispatcherRegistry.instance().list().forEach(t=>t.updateProtocols())}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}e.default=s,s.NetworkDesc="## Description\n  The is node is used for reading and writing values to the edge-io-28. This node uses an internal rest-api to talk to the edge-io-28. No details need to be set\n    \n ### Enable\n    \n  The point enable will disable any new value being sent to the node **output**  \n    \n ### Polling Interval\n    \n  This will change the poll rate of the edge-io-28 inputs. A normal setting is 1 second\n  The faster the polling rate is the higher the memory usage is\n    \n ### Polling Interval Time Setting\n    \n Used in conjugation with the **Polling Interval**. Make the selection for the time units for **Seconds**, **Minutes**, **Hours** \n    \n ",s.inputsDesc="## Description\n  The is node is used in conjunction with the edge-io-28. This node uses an internal rest-api to talk to the edge-io-28\n    \n ## Digital Input\n    \n A total of 14 DIs can be used on the edge-io-28. There are 7 DIs and 7 UIs\n    \n ### DIs (From the UIs)  \n    \n  The UIs can be setup and used to read a status change from a *Digital Input* (7 off dry input)\n    \n ### DIs (From the UIs)  \n    \n  The UIs can be setup and used to read a status change from a *Digital Input* (7 off dry input)\n    \n ## Universal Input\n    \n  The Universal Input or Analogue Input (7 off) can be used in a number of combinations for reading different sensor types\n    \n ### UI as 0/10dc  \n    \n  When configured as a UI 0/10dc the node output value will return a value that is set in the **Low scale** & **High scale**\n    \n ### UI as 0/20ma and or 4/20ma \n    \n  When configured as a UI 0/20ma and or 4/20ma the node output value will return a value that is set in the **Low scale** & **High scale**\n    \n ### UI as 10K thermistor \n    \n  When configured as a UI 10K thermistor type 2 the node output value will return a value based on the resistance and corresponding temperature\n    \n ## Point Configuration\n ### Point Enable\n    \n  The point enable will disable any new value being sent to the node **output**  \n    \n ### Point Debug\n    \n  The point debug will allow the node **output** to always send the value even if there is node change\n  This is just a guide to see if the polling is working\n    \n ### Point Selection\n    \n  1. Select the **Point Type** for example UO  \n  2. Select the **Point Number** for example UO-1   \n  **Note:** You cant set a type **Digital** and point number **UI1** the correct types must be matched with the correct point numbers  \n    \n ### Point Units\n    \n  The units can be set as required see steps below.  \n  1. Select the **Units Category**.  \n  2. Lock (**lock icon**) the node setting's and hit the **save** button to return the units types.  \n  3. Select the units type.  \n  4. Save and close the node as required  \n    \n ### Point Low Scale\n    \n  This is used in when the UI type is set as a 0-10dc or 4-20ma. The **High Scale**  must be set as well \n  For example if the point type is 0-10dc and the *Low Scale* is set to 0 and *High Scale* is set to 100    \n  the node output value when at 0vdc will return 0 and at 10vdc the node output value will return 100    \n    \n ### Point High Scale\n    \n  This is used in when the UI type is set as a 0-10dc or 4-20ma (See **Low Scale** setting for more info).  \n    \n ### Point Decimal Places\n    \n  The units can be set as required see steps below.  \n    \n ### Point Offset\n    \n  Enter a float value to offset. This will apply an math add function to the original value  \n  Example original value is 20 and offset is -1 the **node output** value result will be 19 \n    \n ### Point Decimal Places\n    \n  Enter a int value to Decimal. This will apply an math round function to the original value \n  Example original value is 99.9999 and the device places is set to 0  the **node output** value result will be 99 \n    \n ### Math Function\n    \n  The units can be set as required see steps below.  \n  1. **na** Will apply not math.  \n  2. **add** Will add a **value** node output.  \n  3. **subtract** Will subtract a **value** node output.  \n  4. **multiply** Will multiply a **value** node output.  \n  5. **divide** Will divide a **value** node output. \n  6. **invert** Will invert the node output. Example in original value = 0 the node output value will = 1.   \n    \n ###  History Settings Database Type\n    \n  The are two options for the database type. The data can either be pushed to influxDB or PostgreSQL.  \n  1. Select required database type (if type is *Nube DB PostgreSQL* *no more steps are required*).  \n  2. Enter DB details like IP, port, username and password(if type is *InfluxDB*)\n    \n #### History Settings History Type\n    \n  1. **Change Of Value (COV)**.  \n  2. **Periodic**.  \n  3. **Trigger Only**.  \n    \n ####  History Settings Local Storage Limit\n    \n  1. **Change Of Value (COV)**.  \n  2. **Periodic**.  \n  3. **Trigger Only**.  \n    \n ####  History Settings Round minutes\n    \n  1. **Change Of Value (COV)**.  \n  2. **Periodic**.  \n  3. **Trigger Only**.  \n    \n ### Alarm Settings\n    \n  to be added  \n    \n ### Tag Settings\n    \n  to be added  \n ",s.outputsDesc="## Description\n  The is node is used in conjunction with the edge-io-28. This node uses an internal rest-api to talk to the edge-io-28\n    \n ## Digital Output\n    \n  The DOs can be used to drive a 0-12vdc relay (5 off) or an onboard Normally Open Relay (2 off)\n ### DOs  \n    \n  The input of the node can will drive the output on/true  with any value > 1 or a true value \n  Any value < 0 or a false will drive the output off/false \n ### Relay Output  \n    \n  The input of the node can will drive the output on/true  with any value > 1 or a true value \n  Any value < 0 or a false will drive the output off/false \n ## Universal Output\n    \n  The Universal Output or Analogue Output (7 off) has a voltage range of 0 to 12vdc\n  The UOs can be used as an AO floating point 0/10dc or a binary on/off 0-12dc \n ### UOs as 0/10dc  \n    \n  When configured as a UOs a the node input value is a float value between 0/100 to drive a voltage of 0/10dc \n ### UOs as On/Off  \n    \n  The input of the node can will drive the output on/true  with any value > 1 or a true value \n  Any value < 0 or a false will drive the output off/false \n ## Point Configuration\n ### Point Enable\n    \n  The point enable will disable any new value being sent to the node **output**  \n ### Point Selection\n    \n  1. Select the **Point Type** for example UO  \n  2. Select the **Point Number** for example UO-1   \n ### Point Settings\n    \n  The DOs can be used to drive a 0-12vdc relay (5 off) or an onboard Normally Open Relay (2 off)\n ### Point Units\n    \n  The units can be set as required see steps below.  \n  1. Select the **Units Category**.  \n  2. Lock (**lock icon**) the node setting's and hit the **save** button to return the units types.  \n  3. Select the units type.  \n  4. Save and close the node as required  \n ###  History Settings Database Type\n    \n  The are two options for the database type. The data can either be pushed to influxDB or PostgreSQL.  \n  1. Select required database type (if type is *Nube DB PostgreSQL* *no more steps are required*).  \n  2. Enter DB details like IP, port, username and password(if type is *InfluxDB*)\n #### History Settings History Type\n    \n  1. **Change Of Value (COV)**.  \n  2. **Periodic**.  \n  3. **Trigger Only**.  \n ####  History Settings Local Storage Limit\n    \n  1. **Change Of Value (COV)**.  \n  2. **Periodic**.  \n  3. **Trigger Only**.  \n ####  History Settings Round minutes\n    \n  1. **Change Of Value (COV)**.  \n  2. **Periodic**.  \n  3. **Trigger Only**.  \n ### Alarm Settings\n    \n  to be added  \n ### Tag Settings\n    \n  to be added  \n "},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PointNode=e.GroupContainerNode=e.DeviceContainerNode=e.NetworkContainerNode=e.EdgeContainerNode=e.EdgesParentContainerNode=void 0;const s=i(17),n=i(110),o=i(54),a=i(10),r=i(36),u=i(29),d=i(12),l=i(0),p=i(3),h=i(5),c=i(1),g=i(4),m=i(70),f=i(42),O=i(71),y=()=>{};class v extends O.default{constructor(){super(...arguments),this.title="Edges",this.extra_node_types=[]}collectChildNodes(t){return t.filter(t=>t instanceof N)}initAPI(){return new n.EdgeAPI}fetchChildren(){return this.api.list()}childNodeType(){return[d.EDGE_CONTAINER_TYPE]}}e.EdgesParentContainerNode=v;class N extends m.default{constructor(){super(...arguments),this.title="Edge Container",this.settingFields={code:c.SettingType.STRING,customer_code:c.SettingType.STRING,side_code:c.SettingType.STRING,model:c.SettingType.STRING,firmware_version:c.SettingType.STRING,data_version:c.SettingType.STRING}}onAdded(){this.ignore_remove=!0,this.removable=!1,this.movable=!1,super.onAdded()}createEntry(){return Promise.reject("ERROR: Edge creation not currently supported.")}deleteEntry(){return Promise.reject("ERROR: Edge deletion not currently supported.")}collectChildNodes(t){return t.filter(t=>t instanceof T)}namePrefix(){return"Edge"}initAPI(){return new n.EdgeAPI}fetchChildren(){return(new n.NetworkAPI).list(this.entryId())}childNodeType(){return[d.NETWORK_CONTAINER_TYPE]}}e.EdgeContainerNode=N;class T extends m.default{constructor(){super(...arguments),this.title="Network Container",this.settingFields={state:c.SettingType.READONLY,protocol:c.SettingType.READONLY,code:c.SettingType.STRING},this.protocols=["GPIO","BACNET","MODBUS","UNKNOWN"].map(t=>({value:t,text:t})),this.createSettingForm=t=>s.merge(f.default.prototype.createSettingForm.call(this,t),{protocol:{value:this.protocols[this.protocols.length-1].value,type:c.SettingType.DROPDOWN,config:{items:this.protocols}}})}collectChildNodes(t){return t.filter(t=>t instanceof I)}namePrefix(){return"Network"}createEntry(){const t=this.container.nodeItself();if(!(t instanceof N)){const t="Error: Trying to create network, but network node does not exist inside a valid Edge container...";return console.log(t),Promise.reject(t)}return this.findFreeIdentifier().then(e=>this.api.create({code:e},t.entryId()))}initAPI(){return new n.NetworkAPI}fetchChildren(){return(new n.DeviceAPI).list(this.entryId())}childNodeType(){return[d.DEVICE_CONTAINER_TYPE]}}e.NetworkContainerNode=T;class I extends m.default{constructor(){super(...arguments),this.title="Device Container",this.settingFields={state:c.SettingType.READONLY,code:c.SettingType.STRING,manufacturer:c.SettingType.STRING,protocol:c.SettingType.STRING,type:c.SettingType.STRING}}collectChildNodes(t){return t.filter(t=>t instanceof S||t instanceof b)}namePrefix(){return"Device"}createEntry(){const t=this.container.nodeItself(),e=t.container.nodeItself();if(!(t instanceof T)){const t="Error: Trying to create device, but device node does not exist inside a valid Network container...";return Promise.reject(t)}return this.findFreeIdentifier().then(i=>this.api.create({edge_id:e.entryId(),device:{type:"EQUIPMENT",code:i}},t.entryId()))}initAPI(){return new n.DeviceAPI}fetchChildren(){return(new n.FolderAPI).list(this.entryId())}childNodeType(){return[d.GROUP_CONTAINER_TYPE,d.POINT_NODE_TYPE]}}e.DeviceContainerNode=I;class S extends m.default{constructor(){super(...arguments),this.title="Group Container",this.settingFields={name:c.SettingType.STRING}}collectChildNodes(t){return t.filter(t=>t instanceof b)}namePrefix(){return"Group"}createEntry(){const t=this.container.nodeItself(),e=t.container.nodeItself(),i=e.container.nodeItself();if(!(t instanceof I&&e instanceof T&&i instanceof N)){const t="Error: Trying to create group, but group node does not exist inside a valid Device container hierarchy...";return Promise.reject(t)}return this.findFreeIdentifier().then(e=>this.api.create({folder:{name:e}},t.entryId()))}initAPI(){return new n.FolderAPI}fetchChildren(){return(new n.PointAPI).list(this.entryId())}childNodeType(){return[d.POINT_NODE_TYPE]}}e.GroupContainerNode=S;class b extends p.Node{constructor(){super(),this.clonable=!1,this.movable=!1,this.settingFields={edge:c.SettingType.READONLY,network:c.SettingType.READONLY,code:c.SettingType.STRING,enabled:c.SettingType.BOOLEAN,kind:c.SettingType.STRING,measure_unit:c.SettingType.STRING,offset:c.SettingType.NUMBER,precision:c.SettingType.NUMBER,protocol:c.SettingType.STRING,type:c.SettingType.STRING},this.entry=f.default.prototype.entry.bind(this),this.entryId=f.default.prototype.entryId.bind(this),this.onAfterSettingsChange=f.default.prototype.onAfterSettingsChange.bind(this),this.applyEntry=f.default.prototype.applyEntry.bind(this),this.deactivate=f.default.prototype.deactivate.bind(this),this.onCreated=f.default.prototype.onCreated.bind(this),this.makeIdentifier=f.default.prototype.makeIdentifier.bind(this),this.findFreeIdentifier=f.default.prototype.findFreeIdentifier.bind(this),this.getTakenIdentifiers=f.default.prototype.getTakenIdentifiers.bind(this),this.createSettingForm=f.default.prototype.createSettingForm.bind(this),this.title="Point container",this.description="placeholder",this.backend=new n.PointAPI,this.settings.name=c.NodeSetting.create({description:"Point ID",value:this.title,type:c.SettingType.READONLY}),this.settings.priority=c.NodeSetting.create({description:"Priority",value:1,type:c.SettingType.NUMBER}),this.addOutput("value",c.Type.NUMBER),this.addInput("in",c.Type.NUMBER)}entryFactory(){return new o.Point}onAdded(){f.default.prototype.onAdded.call(this),this.syncWithBackend(),this.interval=setInterval(()=>this.syncWithBackend(),1e3*a.default.backendSync.pointRefreshIntervalSeconds)}onRemoved(){return f.default.prototype.onRemoved.call(this)}namePrefix(){return"Point"}syncWithBackend(){this.side===h.Side.server&&r.singleton.process(()=>{if(this.entry())return this.backend.fetchPointData(this.entryId()).then(t=>{this.entry()&&this.setOutputData(0,s.get(t,"value"))}).catch(y)})}onInputUpdated(){let t=parseFloat(this.getInputData(0));if(isNaN(t)||null===t)return void console.log("WARNING: Received non-numeric value on point inlet.");this.setOutputData(0,t);const e=g.default.clamp(this.settings.priority.value,1,17);this.backend.updatePointData(this.entryId(),e,t).catch(t=>this.container.server_editor_socket.emit(u.ERROR,`Could not patch point value. ${t.message}`))}createEntry(){const t=this.container.nodeItself(),e=t.container.nodeItself(),i=e.container.nodeItself(),s=i.container.nodeItself();if(!(t instanceof S&&t instanceof I)){const t="Error: Trying to create point, but point node does not exist inside a valid Group container hierarchy...";return console.log(t),Promise.reject(t)}return this.findFreeIdentifier().then(n=>this.backend.create({device_id:e.entryId(),point:{network:i.entryId(),edge:s.entryId(),code:n,unit:{type:"number"},enabled:!1}},t.entryId()))}updateEntry(t){return this.backend.update(t,this.entryId())}deleteEntry(){return this.backend.delete(this.entryId())}}e.PointNode=b,l.Container.registerNodeType(d.EDGES_PARENT_CONTAINER_TYPE,v,null,!1),l.Container.registerNodeType(d.EDGE_CONTAINER_TYPE,N,null,!1),l.Container.registerNodeType(d.NETWORK_CONTAINER_TYPE,T,null,!1),l.Container.registerNodeType(d.DEVICE_CONTAINER_TYPE,I,null,!1),l.Container.registerNodeType(d.GROUP_CONTAINER_TYPE,S,null,!1),l.Container.registerNodeType(d.POINT_NODE_TYPE,b,null,!1)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PointAPI=e.FolderAPI=e.DeviceAPI=e.NetworkAPI=e.EdgeAPI=void 0;const s=i(69),n=i(54);class o extends s.Api{list(t){return this.fetchMany("edge","edges")}get(t){return this.fetchOne(`edge/${t}`)}create(t){throw new Error("Method not implemented.")}update(t,e){return this.client.patch(`edge/${e}`,t)}delete(t){throw new Error("Method not implemented.")}factoryEntry(){return this.newEntry(n.Edge)}}e.EdgeAPI=o;class a extends s.Api{list(t){return this.fetchMany(`edge/${t}/network`,"networks")}get(t){return this.fetchOne(`network/${t}`)}create(t,e){return this.client.post(`edge/${e}/network`,t).then(this.extractData("resource"))}update(t,e){return this.client.patch(`network/${e}`,t)}delete(t){return this.client.delete(`network/${t}?_force=true`)}factoryEntry(){return this.newEntry(n.Network)}}e.NetworkAPI=a;class r extends s.Api{factoryEntry(){return this.newEntry(n.Device)}list(t){return this.client.get(`network/${t}/device`).then(this.extractData("devices")).then(t=>t.map(t=>t.device)).then(this.assignAllTo(()=>new n.Device))}get(t){return this.fetchOne(`device/${t}`)}create(t,e){return this.client.post(`network/${e}/device`,t).then(this.extractData("resource.device"))}update(t,e){return this.client.patch(`device/${e}`,t)}delete(t){return this.client.delete(`device/${t}?_force=true`)}}e.DeviceAPI=r;class u extends s.Api{list(t){return this.fetchMany(`device/${t}/folder`,"folders")}get(t){return this.fetchOne(`folder/${t}`)}create(t,e){return this.client.post(`device/${e}/folder`,t).then(this.extractData("resource"))}update(t,e){return this.client.patch(`folder/${e}`,t)}delete(t){return this.client.delete(`folder/${t}?_force=true`)}factoryEntry(){return this.newEntry(n.Folder)}}e.FolderAPI=u;class d extends s.Api{factoryEntry(){return this.newEntry(n.Point)}list(t){return this.fetchMany(`folder/${t}/point`,"points")}get(t){return this.fetchOne(`point/${t}`)}create(t,e){return this.client.post(`folder/${e}/point`,t).then(this.extractData("resource.point"))}update(t,e){return this.client.patch(`point/${e}`,t)}delete(t){return this.client.delete(`point/${t}?_force=true`)}fetchPointData(t){return this.client.get(`point/${t}/data`).then(this.extractData())}updatePointData(t,e,i){return this.client.put(`point/${t}/data`,{priority:e,value:i})}}e.PointAPI=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ServicesParentContainerNode=e.ModulesParentContainerNode=void 0;const s=i(17),n=i(112),o=i(36),a=i(12),r=i(0),u=i(5),d=i(1),l=i(113),p=i(42),h=i(71);class c extends h.default{constructor(){super(...arguments),this.title="Modules"}collectChildNodes(t){return t.filter(t=>t instanceof f)}initAPI(){return new n.ModuleAPI}fetchChildren(){return this.api.list()}childNodeType(){return[a.MODULE_NODE_TYPE]}}e.ModulesParentContainerNode=c;class g extends h.default{constructor(){super(...arguments),this.title="Services"}collectChildNodes(t){return t.filter(t=>t instanceof O)}initAPI(){return new n.ServiceAPI}fetchChildren(){return this.api.list()}childNodeType(){return[a.SERVICE_NODE_TYPE]}}e.ServicesParentContainerNode=g;class m extends l.default{constructor(){super(),this.required_settings=["service_id","service_name","version"],this.settingFields={service_id:d.SettingType.STRING,service_name:d.SettingType.STRING,version:d.SettingType.STRING,service_type:d.SettingType.STRING,published_by:d.SettingType.STRING,state:d.SettingType.STRING,deploy_id:d.SettingType.STRING,deploy_location:d.SettingType.STRING,created_at:d.SettingType.READONLY,modified_at:d.SettingType.READONLY},this.settingsHeaderComponent={props:["self"],template:'<div>  <v-alert v-if="self.properties.is_protected" type="warning">Waiting for required fields <br />'+`    <small>(${this.required_settings.join(", ")})</small>`+"  </v-alert></div>"},this.onAdded=p.default.prototype.onAdded.bind(this),this.onRemoved=p.default.prototype.onRemoved.bind(this),this.entryId=()=>this.entry()&&this.entry().service_id,this.syncWithBackend=()=>{},this.title=this.namePrefix()}onAfterSettingsChange(){this.side===u.Side.server&&this.areSettingsValid()&&(this.entry()?p.default.prototype.onAfterSettingsChange.call(this):o.singleton.process(()=>this.createEntry().then(t=>this.applyEntry(t)).then(()=>this.displayMessage(`${this.namePrefix()} entry created.`)).catch(t=>this.displayError(t,"Entry not created."))))}applyEntry(t){this.settingFields.service_id=d.SettingType.READONLY,p.default.prototype.applyEntry.call(this,t),this.properties.is_protected=!t,this.broadcastPropertiesToClients()}onCreated(){this.entry()?this.applyEntry(this.entry()):(this.properties.is_protected=!0,s.merge(this.settings,this.createSettingForm(null)))}createEntry(){const t=Object.keys(this.settingFields).map(t=>({[t]:this.settings[t].value})).reduce(s.merge);return this.backend.create(this.settings.service_id.value,t)}areSettingsValid(){return this.required_settings.map(t=>this.settings[t].value).reduce((t,e)=>t&&e)}}class f extends m{namePrefix(){return"Module"}initAPI(){return new n.ModuleAPI}}class O extends m{namePrefix(){return"Service"}initAPI(){return new n.ServiceAPI}}r.Container.registerNodeType(a.MODULES_PARENT_CONTAINER_TYPE,c,null,!1),r.Container.registerNodeType(a.SERVICES_PARENT_CONTAINER_TYPE,g,null,!1),r.Container.registerNodeType(a.MODULE_NODE_TYPE,f,null,!1),r.Container.registerNodeType(a.SERVICE_NODE_TYPE,O,null,!1)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ServiceAPI=e.ModuleAPI=void 0;const s=i(69),n=i(54);class o extends s.Api{list(t){return this.fetchMany(this.url(),"services")}get(t){return this.fetchOne(`${this.url()}/${t}`)}create(t,e){return this.client.post(this.url(),{obj:t}).then(()=>this.get(e))}update(t,e){return this.client.patch(`${this.url()}/${e}`,{service_id:e,obj:t})}delete(t){return this.client.delete(`${this.url()}/${t}`)}factoryEntry(){return this.newEntry(n.Service)}}e.ModuleAPI=class extends o{url(){return"modules"}};e.ServiceAPI=class extends o{url(){return"services"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3),n=i(1),o=i(42);class a extends s.Node{constructor(){super(),this.clonable=!1,this.removable=!1,this.movable=!1,this.entry=o.default.prototype.entry.bind(this),this.entryId=o.default.prototype.entryId.bind(this),this.deactivate=o.default.prototype.deactivate.bind(this),this.createSettingForm=o.default.prototype.createSettingForm.bind(this),this.getTakenIdentifiers=o.default.prototype.getTakenIdentifiers.bind(this),this.makeIdentifier=o.default.prototype.makeIdentifier.bind(this),this.findFreeIdentifier=o.default.prototype.findFreeIdentifier.bind(this),this.entryFactory=()=>this.backend.factoryEntry(),this.updateEntry=t=>this.backend.update(t,this.entryId()),this.deleteEntry=()=>this.backend.delete(this.entryId()),this.description="placeholder",this.backend=this.initAPI(),this.settings.name=n.NodeSetting.create({description:"Entry",value:this.title,type:n.SettingType.READONLY})}}e.default=a},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(e,"__esModule",{value:!0}),e.Dashboard=void 0;const n=i(72),o=i(13),a=i(52),r=o.create("dashboard",{color:o.Colors.Yellow});class u{constructor(t){this.socket=t,this.uiPanels=[]}loadFromDatabase(t){return this.db=t,a.AsyncDbHelper.noArgs(t,t.getUiPanels).then(t=>this.uiPanels=t).catch(t=>r.warn(t))}onNodeRemoved(t){t.isDashboardNode&&(this.removeElementForNode(t),this.removeEmptyPanels(),this.sendUiPanel(t.settings["ui-panel"].value))}onNodeChangePanelOrTitle(t,e,i){this.removeElementForNode(t);const s={title:i,type:t.uiElementType,cid:t.container.id,id:t.id,name:t.name,icon:t.icon};let n=this.getUiPanel(e);n?(n.subPanels[0].uiElements.push(s),this.db&&this.db.updateUiPanel(n.name,{$set:{subPanels:n.subPanels}})):(n=this.addUiPanel(e),n.subPanels[0].uiElements.push(s),this.db&&this.db.addUiPanel(n)),this.removeEmptyPanels(),this.socket.io.emit("getUiPanelsList",this.getUiPanelsList()),this.sendUiPanel(t.settings["ui-panel"].value)}sendUiPanel(t){this.socket.io.emit("getUiPanel",this.getUiPanel(t))}removeEmptyPanels(){let t=!1;for(let e=0;e<this.uiPanels.length;e++){let i=this.uiPanels[e];i.subPanels.every(t=>0==t.uiElements.length)&&(t=!0,this.uiPanels=this.uiPanels.filter(t=>t.name!=i.name),this.db&&this.db.removeUiPanel(i.name))}t&&this.socket.io.emit("getUiPanelsList",this.getUiPanelsList())}removeElementForNode(t){const e=this.getUiPanel(t.settings["ui-panel"].value);if(e)for(let i=0;i<e.subPanels.length;i++){const s=e.subPanels[i];for(let i=0;i<s.uiElements.length;i++){const n=s.uiElements[i];n.cid==t.container.id&&n.id==t.id&&(s.uiElements.splice(i,1),this.db&&this.db.updateUiPanel(e.name,{$set:{subPanels:e.subPanels}}))}}}getUiPanel(t){return this.uiPanels.find(e=>e.name===t)}getUiPanelsList(){let t=[];return this.uiPanels.forEach(e=>{t.push({name:e.name,title:e.title,icon:e.icon})}),t}addUiPanel(t){const e={name:t,title:t,icon:"label_outline",subPanels:[{title:"",name:"",uiElements:[]}]};return this.uiPanels.push(e),e}}s([n.default(100)],u.prototype,"sendUiPanel",null),e.Dashboard=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Server=void 0;const s=i(116),n=i(117),o=i(20),a=i(118),r=i(13),u=i(119),d=i(51),l=i(73),p=i(55),h=i(120),c=i(121),g=i(74),m=i(123),f=i(124),O=i(128),y=i(129),v=r.create("server",{color:r.Colors.Yellow});e.Server=class{constructor(t,e,s){this.port=e,this.loopInterval=s,this.express=o(),this.express.locals.moment=i(34),this.middleware(t),this.routes(),this.handleErrors(),this.configure(),this.start_io()}middleware(t){p.webServer.debug&&this.express.use(u("dev",{skip:function(t,e){return e.statusCode<400}})),this.express.use(s.json({limit:"5mb"})),this.express.use(s.urlencoded({extended:!1})),this.express.use(n()),this.express.use(y());const e=d.resolve(t,"public");v.info(`App Server Dir : '${e}'`),this.express.use("/",o.static(e))}routes(){this.express.use("/api/",(function(t,e,i){const s=e.send;e.send=function(t){[200,201].includes(e.statusCode)||v.warn(t),s.call(this,t)},i()})),this.express.use("/dashboard",g.authMiddleware(),i(130)),this.express.use("/api/dashboard",g.authMiddleware(),i(131)),this.express.use("/editor",g.authMiddleware(),i(132)),this.express.use("/api/editor",g.authMiddleware(),f.apiEditorSetup(this,this.loopInterval)),this.express.use("/api/wire-name",g.authMiddleware(),i(133)),this.express.use("/api/auth",i(135)),this.express.use("/api/help",g.authMiddleware(),i(137)),this.express.use("/api/platform",g.authMiddleware(),i(139))}handleErrors(){this.express.use((t,e)=>{e.status(404),e.json({error:{message:"Not Found"}})}),this.express.use((t,e,i,s)=>{v.warn(`${t}`),i.status(t.status||500),i.json({error:{message:t.message,error:{}}})})}configure(){const t=function(t){const e="string"==typeof t?parseInt(t,10):t;return isNaN(e)?t:e>=0&&e}(this.port);this.express.set("port",t),this.server=a.createServer(this.express),this.server.listen(t),this.server.on("error",(function(e){if("listen"!==e.syscall)throw e;const i="string"==typeof t?"Pipe "+t:"Port "+t;switch(e.code){case"EACCES":console.error(`${i} requires elevated privileges`),process.exit(1);break;case"EADDRINUSE":console.error(`${i} is already in use`),process.exit(1);break;default:throw e}})),this.server.on("listening",(function(){const t=e.server.address(),i="string"==typeof t?`pipe ${t}`:`port ${t.port}`;v.info(`Listening on ${i}`)}));const e=this}start_io(){const t=l(this.server);this.editorSocket=new c.EditorServerSocket(t),this.dashboardSocket=new h.DashboardServerSocket(t),this.wireNameSocket=new O.WireNameServerSocket(t),this.pingPongSocket=new m.PingPongServerSocket(this.server,t)}}},function(t,e){t.exports=require("body-parser")},function(t,e){t.exports=require("cookie-parser")},function(t,e){t.exports=require("http")},function(t,e){t.exports=require("morgan")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DashboardServerSocket=void 0;const s=i(27),n=i(0),o=i(18),a=i(38),r=i(22),u=i(53),d=i(29),l=i(16),p=i(9).server_logger;e.DashboardServerSocket=class{constructor(t){this.io_root=t;const e=this.io_root.of("/dashboard");this.io=e,e.on("connection",(function(t){p.debug("New client connected to dashboard"),t.on("disconnect",()=>{p.debug("Client disconnected from dashboard")}),t.on("getUiPanel",e=>{p.debug("getUiPanel: "+e),t.emit("getUiPanel",s.default.dashboard.getUiPanel(e))}),t.on("getUiPanelsList",()=>{t.emit("getUiPanelsList",s.default.dashboard.getUiPanelsList())}),t.on("nodeMessageToServerSide",t=>{let e=n.ContainerRegistry.instance().get(t.cid);if(!e)return void p.error(`Can't send node message to server-side. Container [${t.cid}] does not exist`);let i=e.getSubNode(t.id);i?i.onGetMessageToServerSide?i.onGetMessageToServerSide(t.message):p.error(`Can't send node message to server-side. Node ${i.getReadableId()} `+"dont have onGetMessageToServerSide method!"):p.error(`Can't send node message to server-side. Node [${l.IdGenerator.createNodeId(t.cid,t.id)}] does not exist`)}),t.on("nodeMessageToEditorSide",t=>{let e=n.ContainerRegistry.instance().get(t.cid);e?e.getSubNode(t.id)?s.default.server.editorSocket.io.in(t.cid).emit("nodeMessageToEditorSide",t):p.error(`Can't send node message to editor-side. Node [${l.IdGenerator.createNodeId(t.cid,t.id)}] does not exist`):p.error(`Can't send node message to editor-side. Container [${t.cid}] does not exist`)}),t.on("nodeMessageToDashboardSide",t=>{let e=n.ContainerRegistry.instance().get(t.cid);e?e.getSubNode(t.id)?s.default.server.dashboardSocket.io.in(t.cid).emit("nodeMessageToDashboardSide",t):p.error(`Can't send node message to dashboard-side. Node [${l.IdGenerator.createNodeId(t.cid,t.id)}] does not exist`):p.error(`Can't send node message to dashboard-side. Container [${t.cid}] does not exist`)}),t.on(d.UPDATE_NODE_SETTING,t=>{let e=n.ContainerRegistry.instance().get(t.cid);if(!e)return void p.error(`Can't update node settings. Container id [${t.cid}] does not exist`);let i=e.nodeRegistry().get(t.id);if(!i)return void p.error(`Can't update node settings. Node [${l.IdGenerator.createNodeId(t.cid,t.id)}] does not exist`);let h=i.name,c=i.icon,g=r.SerializableHelper.serialize(i.settings);a.NodeHookHelper.execute(i,"onBeforeSettingsChange",t.settings,t.name,t.icon);for(let e in t.settings){let s=t.settings[e];try{i.settings[e].value=s.value}catch(t){p.error(t)}}i.name=t.name,i.icon=t.icon,u.PubSubHelpers.renameFunction(i),Promise.resolve(a.NodeHookHelper.execute(i,"onAfterSettingsChange",g,h,c)).then(t=>o.createNodeDbHelper().updateAsync(n.ContainerRegistry.instance().rootContainer().db,t)).then(e=>{const n={id:t.id,cid:t.cid,name:t.name,icon:t.icon,settings:i.settings,oldName:h,oldIcon:c,oldSettings:g};s.default.server.editorSocket.io.emit(d.UPDATE_NODE_SETTING,n),i.isDashboardNode&&s.default.server.dashboardSocket.io.in(t.cid).emit(d.UPDATE_NODE_SETTING,n)})}),t.on("dashboardElementGetNodeState",e=>{let i=n.ContainerRegistry.instance().get(e.cid);if(!i)return void p.error(`Can't get dashboard element state. Container [${e.cid}] does not exist`);let s=i.getSubNode(e.id);if(s)if(s.onDashboardElementGetNodeState)s.onDashboardElementGetNodeState(e.options);else{let e={id:s.id,cid:s.container.id,state:s.properties.state};t.emit("dashboardElementGetNodeState",e)}else p.error(`Can't get dashboard element state. Node [${l.IdGenerator.createNodeId(e.cid,e.id)}] does not exist`)}),t.on("dashboardElementSetNodeState",t=>{let i=n.ContainerRegistry.instance().get(t.cid);if(!i)return void p.error(`Can't set node state from dashboard element. Container [${t.cid}] does not exist`);let s=i.getSubNode(t.id);if(s)if(s.onDashboardElementSetNodeState)s.onDashboardElementSetNodeState(t.state);else{s.properties.state=t.state;let i={id:s.id,cid:s.container.id,state:s.properties.state},n=this.settings["ui-panel"].value;e.in(""+n).emit("dashboardElementGetNodeState",i)}else p.error(`Can't set node state from dashboard element. Node [${l.IdGenerator.createNodeId(t.cid,t.id)}] does not exist`)}),t.on("join-room",e=>{null!=t.room?(p.debug("Leave dashboard room ["+t.room+"]"),t.leave(t.room,()=>{t.room=e,t.join(e,()=>{p.debug("Join to dashboard room ["+e+"]")})})):(t.room=e,t.join(e,()=>{p.debug("Join to dashboard room ["+e+"]")}))}),t.on("leave-room",e=>{t.leave(e,()=>{p.debug("Leave dashboard room ["+e+"]")}),t.room=null})}))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EditorServerSocket=void 0;const s=i(27),n=i(0),o=i(5),a=i(122),r=i(29),u=i(9).server_logger;class d{constructor(t){this.io_root=t;const e=t.of("/editor");this.io=e,e.on("connection",(function(t){u.debug("New client connected to editor"),t.on("disconnect",()=>{u.debug("Client disconnected from editor")}),t.on("room",(function(e){null!=t.room?t.leave(t.room,(function(){t.room=e,t.join(e,()=>{u.debug("Switch editor room to ["+e+"]")})})):(t.room=e,t.join(e,()=>{u.debug("Join to editor room ["+e+"]")}))})),t.on("nodeMessageToServerSide",(function(t){let e=d.checkContainerNodeValidity(t,o.Side.server);e&&e.onGetMessageToServerSide(t.message)})),t.on("nodeMessageToEditorSide",(function(t){d.checkContainerNodeValidity(t,o.Side.editor)&&s.default.server.editorSocket.io.in(t.cid).emit("nodeMessageToEditorSide",t)})),t.on("nodeMessageToDashboardSide",(function(t){d.checkContainerNodeValidity(t,o.Side.dashboard)&&s.default.server.dashboardSocket.io.in(t.cid).emit("nodeMessageToDashboardSide",t)}))})),setInterval(()=>this.sendSlotsValues(e),200)}static checkContainerNodeValidity(t,e){let i=n.ContainerRegistry.instance().get(t.cid);if(!i)return u.error(`Can't send node message to ${e}-side. Container id ["${t.cid}'] does not exist`),null;let s=i.getSubNode(t.id);return s||(u.error(`Can't send node message to ${e}-side. Node id ["${t.cid}'/'${t.id}'] does not exist`),null)}sendSlotsValues(t){const e=t.connected;for(let i of Object.keys(e)){const e=Object.keys(t.connected[i].rooms).filter(t=>t!==i)[0];let s=a.default.getNodesIOValues(e);t.to(e).emit(r.NODE_IO_VALUES,s)}}}e.EditorServerSocket=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(4);e.default=class{static getNodesIOValues(t){let e=s.ContainerRegistry.instance().get(t);if(!e||!e.subNodes())return;let i=[],o=[];for(let t of e.subNodes()){if(t.inputs)for(let e in t.inputs){let s=t.getInputData(Number(e));s=n.default.formatAndTrimValue(s),i.push({nodeId:t.id,inputId:e,type:t.type,data:s})}if(t.outputs)for(let e in t.outputs){let i=t.outputs[e].data;i=n.default.formatAndTrimValue(i),o.push({nodeId:t.id,outputId:e,type:t.type,data:i})}}return{cid:e.id,inputs:i,outputs:o}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PingPongServerSocket=void 0;const s=i(73),n=i(9);e.PingPongServerSocket=class{constructor(t,e){let i=null!=e?e:s(t,{path:"/heartbeat"});this.io=i.of(e?"/heartbeat":"/ping"),this.io.on("connect",t=>this.listen(t))}listen(t){n.heartbeat_logger.debug(`New client ${t.id} connected into server path ${t.server.path()}`),n.heartbeat_logger.debug(`Handshake: ${JSON.stringify(t.handshake)}`),t.on("disconnect",()=>{n.heartbeat_logger.debug(`Client ${t.id} is disconnected`)})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.apiEditorSetup=void 0;const s=i(20),n=i(0),o=i(6),a=i(125),r=i(127);class u{constructor(t){this.router=s.Router(),this.server=t}setup(t){return this.router.get("/c/:cid",(t,e)=>this.nodeHandler().onList(t,e)),this.router.delete("/c/:cid/n/",(t,e)=>this.nodeHandler().onRemove(t,e)),this.router.post("/c/:cid/n/",(t,e)=>this.nodeHandler().onCreate(t,e)),this.router.post("/c/:cid/move",(t,e)=>this.nodeHandler().onPackUp(t,e)),this.router.post("/c/:cid/export",(t,e)=>this.nodeHandler().onExport(t,e)),this.router.post("/c/:cid/clone",(t,e)=>this.nodeHandler().onClone(t,e)),this.router.post("/c/:cid/import",(t,e)=>this.nodeHandler().onImport(t,e)),this.router.post("/c/:cid/l",(t,e)=>this.linkHandler().onCreate(t,e)),this.router.put("/c/:cid/l",(t,e)=>this.linkHandler().onMove(t,e)),this.router.delete("/c/:cid/l",(t,e)=>this.linkHandler().onRemove(t,e)),setInterval(()=>function(t){if(!n.ContainerRegistry.instance().rootContainer())return;for(let e of n.ContainerRegistry.instance().list()){let i=[];for(let t of e.subNodes())t.isRecentlyActive&&(t.isRecentlyActive=!1,i.push(t.id));i.length>0&&t.editorSocket.io.in(""+e.id).emit("nodes-active",{ids:i,cid:e.id})}}(this.server),500),function(t,e,i){function s(){return n.ContainerRegistry.instance().rootContainer().db}return t.put("/c/:cid/n/:id/position",(function(t,i){let o=n.ContainerRegistry.instance().get(t.params.cid);if(!o)return i.status(404).send(`Can't update node position. Container id [${t.params.cid}] not found.`);let a=o.getSubNode(t.params.id);if(!a)return i.status(404).send(`Can't update node position. Node id [${t.params.cid}/${t.params.id}] not found.`);a.pos=t.body.position,s()&&s().updateNode(a.id,a.container.id,{$set:{pos:a.pos}}),e.editorSocket.io.emit("node-update-position",{id:t.params.id,cid:t.params.cid,pos:a.pos}),i.send(`Node position updated: type [${a.type}] id [${a.container.id}/${a.id}]`)})),t.put("/c/:cid/n/:id/size",(function(t,i){let o=n.ContainerRegistry.instance().get(t.params.cid);if(!o)return i.status(404).send(`Can't update node size. Container id [${t.params.cid}] not found.`);let a=o.getSubNode(t.params.id);if(!a)return i.status(404).send(`Can't update node size. Node id [${t.params.cid}/${t.params.id}] not found.`);a.size=t.body.size,s()&&s().updateNode(a.id,a.container.id,{$set:{size:a.size}}),e.editorSocket.io.emit("node-update-size",{id:t.params.id,cid:t.params.cid,size:a.size}),i.send(`Node size updated: type [${a.type}] id [${a.container.id}/${a.id}]`)})),t.put("/c/:cid/n/:id/collapse",(function(t,i){var o,a;let r=n.ContainerRegistry.instance().get(t.params.cid);if(!r)return i.status(404).send(`Can't update node collapse. Container id [${t.params.cid}] not found.`);let u=r.getSubNode(t.params.id);if(!u)return i.status(404).send(`Can't update node collapse. Node id [${t.params.cid}/${t.params.id}] not found.`);u.flags.collapsed=t.body.collapsed,s()&&s().updateNode(u.id,u.container.id,{$set:{"flags.collapsed":null===(o=u.flags)||void 0===o?void 0:o.collapsed}}),e.editorSocket.io.emit("node-update-collapsed",{id:t.params.id,cid:t.params.cid,"flags.collapsed":null===(a=u.flags)||void 0===a?void 0:a.collapsed}),i.send(`Node collapsed updated: type [${u.type}] id [${u.container.id}/${u.id}]`)})),t.get("/state",(function(t,e){let i={isRunning:n.ContainerRegistry.instance().rootContainer().isRunning};e.json(i)})),t.post("/run",(function(t,s){n.ContainerRegistry.instance().rootContainer().run(i),e.editorSocket.io.emit("container-run"),s.send("Run container")})),t.post("/stop",(function(t,i){n.ContainerRegistry.instance().rootContainer().stop(),e.editorSocket.io.emit("container-stop"),i.send("Stop container")})),t.post("/step",(function(t,i){n.ContainerRegistry.instance().rootContainer().runStep(),e.editorSocket.io.emit("container-run-step"),i.send("Run step container")})),t.get("/c/:cid/n/:id*",(function(t,e){let i=n.ContainerRegistry.instance().get(t.params.cid);if(!i)return e.status(404).send(`Can't send request to node. Container id [${t.params.cid}] not found.`);let s=i.getSubNode(t.params.id);return s?s.onEditorApiGetRequest?void s.onEditorApiGetRequest(t,e):e.status(404).send(`Can't send request to node. Node id [${t.params.cid}/${t.params.id}] does not accept requests.`):e.status(404).send(`Can't send request to node. Node id [${t.params.cid}/${t.params.id}] not found.`)})),t.post("/c/:cid/n/:id*",(function(t,e){let i=n.ContainerRegistry.instance().get(t.params.cid);if(!i)return e.status(404).send(`Can't send request to node. Container id [${t.params.cid}] not found.`);let s=i.getSubNode(t.params.id);return s?s.onEditorApiPostRequest?void s.onEditorApiPostRequest(t,e):e.status(404).send(`Can't send request to node. Node id [${t.params.cid}/${t.params.id}] does not accept requests.`):e.status(404).send(`Can't send request to node. Node id [${t.params.cid}/${t.params.id}] not found.`)})),t.post("/c/:cid/n-type",(function(t,e){let i=n.ContainerRegistry.instance().get(t.params.cid);if(!i)return e.status(404).send(`Can't receive request to node. Container id [${t.params.cid}] not found.`);let s=t.body.type;if(!s)return e.status(404).send("Can't receive request to node. Node type is not defined.");let o=1==t.body.subcontainers,a=i.getNodesByType(s,o);if(0==a.length)return e.status(404).send(`Can't receive request to node. Node type [${s}] not found in container [${t.params.cid}].`);a.forEach(i=>{if(!i.onEditorApiPostRequest)return e.status(404).send(`Can't receive request to node. Node type [${s}] does not accept requests.`);i.onEditorApiPostRequest(t,e)}),e.headersSent||e.status(400).send("No node has processed the request.")})),t}(this.router,this.server,t)}nodeHandler(){return o.isNull(this._nodeHandler)&&(this._nodeHandler=new r.ApiNodeHandler(this.server.editorSocket,this.server.dashboardSocket)),this._nodeHandler}linkHandler(){return o.isNull(this._linkHandler)&&(this._linkHandler=new a.ApiLinkHandler(this.server.editorSocket)),this._linkHandler}}e.apiEditorSetup=(t,e)=>new u(t).setup(e)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ApiLinkHandler=void 0;const s=i(19),n=i(29),o=i(126),a=i(75);class r extends a.ApiHandler{constructor(t){super(t),this.linkService=new o.NodeLinkService}onCreate(t,e){const{source:i,targets:s}=t.body;this.linkService.create(t.params.cid,i,...s).then(t=>this.emitSuccess(e,n.CREATE_LINK,t,201)).catch(t=>this.emitError(e,t,n.CREATE_LINK))}onRemove(t,e){const{source:i,targets:s}=t.body;this.linkService.remove(t.params.cid,i,...s).then(t=>this.emitSuccess(e,n.REMOVE_LINK,t)).catch(t=>this.emitError(e,t,n.REMOVE_LINK))}onMove(t,e){const i=t.params.cid,{type:o,source:a,targets:r,another:u}=t.body,d=s.createNodeLink(i,a,...r);this.linkService.move(o,d,u).then(t=>this.emitSuccess(e,n.MOVE_LINK,t)).catch(t=>this.emitError(e,t,n.MOVE_LINK))}}e.ApiLinkHandler=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NodeLinkService=void 0;const s=i(19),n=i(65),o=i(56);class a extends o.NodeService{constructor(t,e){super(t,e),this.handler=s.createLinkHandler(this.cRegistry)}create(t,e,...i){return Promise.resolve(s.createNodeLink(t,e,...i)).then(t=>this.handler.create(t)).then(t=>this.persist(t))}remove(t,e,...i){return Promise.resolve(s.createNodeLink(t,e,...i)).then(t=>this.handler.remove(t)).then(t=>this.persist(t))}move(t,e,i){return Promise.resolve(this.handler.move(t,e,i)).then(t=>this.persist(t))}disconnect(){return null}persist(t){return new n.BackendLinkVisitor(this.cRegistry).visit(t).then(t=>(this.logger.info(t.message),t))}}e.NodeLinkService=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ApiNodeHandler=void 0;const s=i(35),n=i(29),o=i(21),a=i(9),r=i(76),u=i(78),d=i(75);class l extends d.ApiHandler{constructor(t,e){super(t),this.crudService=new r.NodeCRUDService,this.etlService=new u.NodeETLService,this.dashboardSocket=e}onList(t,e){this.crudService.getNodes(t.params.cid).then(t=>e.status(200).json(t)).catch(i=>{a.reliability_logger.warn(i),e.status(500).json({id:t.params.cid,serializedNodes:[],err:i.msg})})}onCreate(t,e){this.crudService.createNode(t.params.cid,{type:t.body.type,pos:t.body.position}).then(i=>(i.isDashboardNode&&this.dashboardSocket.io.in(t.params.cid).emit(n.CREATE_NODE,i.result()),this.emitSuccess(e,n.CREATE_NODE,i,201))).catch(t=>this.emitError(e,t,n.CREATE_NODE,t=>t instanceof o.RegistryItemExistedError?409:400))}onRemove(t,e){this.crudService.removeNodes(t.params.cid,t.body,!0).then(t=>this.emitSuccess(e,n.REMOVE_NODES,t)).catch(t=>this.emitError(e,t,n.REMOVE_NODES))}onPackUp(t,e){const i=t.params.cid,{ids:s,pos:o}=t.body;this.etlService.packUpNodes(i,s,o).then(t=>(this.editorSocket.io.emit(n.REMOVE_NODES,t.cleanupResult.result()),this.emitSuccess(e,n.PACK_UP_NODES,t))).catch(t=>this.emitError(e,t,n.PACK_UP_NODES))}onClone(t,e){const{ids:i,pos:s}=t.body;this.etlService.cloneNodes(t.params.cid,i,s).then(t=>this.emitSuccess(e,n.CLONE_NODES,t)).catch(t=>this.emitError(e,t,n.CLONE_NODES))}onExport(t,e){this.etlService.exportNodes(t.params.cid,t.body).then(t=>e.status(200).json(t)).catch(t=>this.emitError(e,t,n.EXPORT_NODES))}onImport(t,e){const i=t.params.cid,{nodes:o,pos:a}=t.body,r=s.NodeValidator.NodeArrayValidator().validate(o,{allowUnknown:!0});if(r.error)return this.emitError(e,new Error(r.error),n.IMPORT_NODES);this.etlService.importNodes(i,o,a).then(t=>this.emitSuccess(e,n.IMPORT_NODES,t,201)).catch(t=>this.emitError(e,t,n.IMPORT_NODES))}}e.ApiNodeHandler=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WireNameServerSocket=void 0;const s=i(13),n=s.create("server",{color:s.Colors.Yellow});e.WireNameServerSocket=class{constructor(t){this.io_root=t;const e=t.of("/wire-name");this.io=e,e.on("connection",(function(t){n.debug("New client connected to wire"),t.on("disconnect",()=>{n.debug("Client disconnected from wire")})}))}}},function(t,e){t.exports=require("express-validator")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(20),n=i(0);let o=s.Router();o.get("/",(function(t,e,i){e.render("dashboard/index",{container_id:0})})),o.get("/c/:cid",(function(t,e,i){e.render("dashboard/index",{container_id:t.params.cid})})),o.get("/c/:cid/n/:id*",(function(t,e){let i=n.ContainerRegistry.instance().get(t.params.cid);if(!i)return e.status(404).send(`Can't send request to node. Container id [${t.params.cid}] not found.`);let s=i.getSubNode(t.params.id);return s?s.onDashboardGetRequest?void s.onDashboardGetRequest(t,e):e.status(404).send(`Can't send request to node. Node id [${t.params.cid}/${t.params.id}] does not accept requests.`):e.status(404).send(`Can't send request to node. Node id [${t.params.cid}/${t.params.id}] not found.`)})),o.post("/c/:cid/n/:id*",(function(t,e){let i=n.ContainerRegistry.instance().get(t.params.cid);if(!i)return e.status(404).send(`Can't send request to node. Container id [${t.params.cid}] not found.`);let s=i.getSubNode(t.params.id);return s?s.onDashboardPostRequest?void s.onDashboardPostRequest(t,e):e.status(404).send(`Can't send request to node. Node id [${t.params.cid}/${t.params.id}] does not accept requests.`):e.status(404).send(`Can't send request to node. Node id [${t.params.cid}/${t.params.id}] not found.`)})),t.exports=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(20),n=i(0);let o=s.Router();o.get("/c/:cid",(function(t,e){let i=n.ContainerRegistry.instance().get(t.params.cid);if(!i)return e.status(404).send(`Can't get container. Container id [${t.params.cid}] not found.`);let s=i.serialize();e.json(s)})),t.exports=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(20),n=i(55),o=i(0);let a=s.Router();a.get("/",(function(t,e){e.render("editor/index",{split:t.query.split,container_id:0,theme:n.nodeEditor.theme})})),a.get("/c/:cid",(function(t,e){let i=t.params.cid||0;if(!o.ContainerRegistry.instance().get(i))return e.redirect("/editor");e.render("editor/index",{split:t.query.split,container_id:i,theme:n.nodeEditor.theme})})),a.get("/split",(function(t,e){e.render("editor/split",{container_id:0})})),a.get("/split/c/:cid",(function(t,e){let i=t.params.cid||0;if(!o.ContainerRegistry.instance().get(i))return e.redirect("/editor/split");e.render("editor/split",{container_id:i})})),t.exports=a},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(20),o=i(27),a=i(134);let r=n.Router();r.get("",(function(t,e){return s(this,void 0,void 0,(function*(){try{const t=yield a.default.getWireName();e.json(t)}catch(t){e.status(500).send(t)}}))})),r.put("",(function({body:t},e){return s(this,void 0,void 0,(function*(){const{name:i}=t;try{yield a.default.changeWireName(i),o.default.server.wireNameSocket.io.emit("wire-name-update",i),e.status(201).send(t)}catch(t){e.status(500).send(t)}}))})),t.exports=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(43),n=i(10),o=i(44),a=i(9),r=`${n.default.dataDir}/wire-name.txt`;e.default=class{static getWireName(){return new Promise((t,e)=>{o.default.createFile(r).then(()=>{s.readFile(r,{encoding:"utf-8"},(i,s)=>{i?(a.db_logger.error(i.message),e(i)):t(s)})})})}static changeWireName(t){return new Promise((e,i)=>{o.default.createFile(r).then(()=>{s.writeFile(r,t,s=>{s?(a.db_logger.error(s.message),i(s)):e(t)})})})}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(20),o=i(27),a=i(74),r=i(31),u=i(66);let d=n.Router();const l=u.object({username:u.string().min(5),password:u.string().min(5)}),p=u.object({text:u.string().min(1)});d.route("/encrypt").post(a.schemaMiddleware(p,"body"),(t,e)=>s(void 0,void 0,void 0,(function*(){try{e.status(201).send({encryptedText:r.default.encrypt(t.body.text)})}catch(t){e.status(500).send(t)}}))),d.route("/user").post(a.schemaMiddleware(l,"body"),(t,e)=>s(void 0,void 0,void 0,(function*(){try{const i=yield o.default.db.addAuthUser(t.body);e.status(201).send(i)}catch(t){e.status(500).send(t)}}))),d.route("/user").get((t,e)=>s(void 0,void 0,void 0,(function*(){try{const t=yield o.default.db.getAuthUser();e.status(200).send(t)}catch(t){e.status(500).send(t)}}))),d.route("/users").delete(a.authMiddleware(),(t,e)=>s(void 0,void 0,void 0,(function*(){try{const t=yield o.default.db.deleteAuthUsers();e.status(200).send(t)}catch(t){e.status(500).send(t)}}))),d.route("/login").post(a.schemaMiddleware(l,"body"),(t,e)=>s(void 0,void 0,void 0,(function*(){try{const i=yield o.default.db.getAuthToken(t.body);e.status(200).send({token:i})}catch(t){e.status(500).send(t)}}))),t.exports=d},function(t,e){t.exports=require("crypto-js")},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(20),o=i(138);let a=n.Router();a.get("",(function(t,e){return s(this,void 0,void 0,(function*(){try{const t=yield o.default.getHelpComment();e.json(t)}catch(t){e.status(500).send(t)}}))})),a.put("",(function({body:t},e){return s(this,void 0,void 0,(function*(){const{stringHtml:i}=t;try{yield o.default.changeHelpComment(i),e.status(201).send("successful")}catch(t){e.status(500).send(t)}}))})),t.exports=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(43),n=i(10),o=i(44),a=i(9),r=`${n.default.dataDir}/help-comment.txt`;e.default=class{static getHelpComment(){return new Promise((t,e)=>{o.default.createFile(r).then(()=>{s.readFile(r,{encoding:"utf-8"},(i,s)=>{i?(a.db_logger.error(i.message),e(i)):t(s)})})})}static changeHelpComment(t){return new Promise((e,i)=>{o.default.createFile(r).then(()=>{s.writeFile(r,t,s=>{s?(a.db_logger.error(s.message),i(s)):e(t)})})})}}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(20),o=i(45),a=i(0),r=i(32);let u=n.Router();u.get("",(function(t,e){return s(this,void 0,void 0,(function*(){try{const t=yield o.default.getPlatform();e.json(t)}catch(t){e.status(500).send(t)}}))})),u.put("",(function({body:t},e){return s(this,void 0,void 0,(function*(){try{yield o.default.updatePlatform(t),e.status(201).send("successful")}catch(t){e.status(500).send(t)}}))})),u.get("/wires/download/nodes",(function(t,e){return s(this,void 0,void 0,(function*(){try{a.ContainerRegistry.instance().rootContainer().db.getNodes((t,i)=>{t?e.status(500):e.json(JSON.stringify(i))})}catch(t){e.status(500).send(t)}}))})),u.get("/host/info/disc",(function(t,e){return s(this,void 0,void 0,(function*(){try{r.default.fsSize().then(t=>{e.json(JSON.stringify(t))}).catch(t=>{e.status(500).send(t)})}catch(t){e.status(500).send(t)}}))})),t.exports=u},function(t,e){t.exports=require("os")},function(t,e){t.exports=require("systeminformation")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(143),i(144),i(145),i(146),i(147),i(148),i(149),i(150),i(151),i(152),i(153),i(154),i(155),i(156),i(157),i(158),i(159),i(160),i(161),i(162),i(163),i(79),i(164),i(165),i(166),i(167),i(168),i(169),i(170),i(171),i(173),i(174),i(175),i(176),i(177),i(178),i(179),i(180),i(181),i(182),i(183),i(184),i(185),i(186),i(189),i(190),i(191),i(192),i(193),i(194),i(195),i(196),i(197),i(198),i(199),i(200),i(201),i(202),i(203),i(204),i(205),i(206),i(207),i(208),i(209),i(210),i(211),i(212),i(213),i(214),i(217),i(218),i(219),i(220),i(221),i(222),i(223),i(225),i(226),i(227),i(228),i(229),i(230),i(231),i(232),i(233),i(234),i(235),i(236),i(237),i(238),i(239),i(240),i(241),i(242),i(243),i(244),i(245),i(246),i(247),i(248),i(249),i(250),i(251),i(252),i(253),i(254),i(255),i(256),i(257),i(258),i(259),i(260),i(261),i(262),i(263),i(264),i(265),i(266),i(267),i(268),i(269),i(270),i(271),i(272),i(273),i(274),i(275),i(276),i(277),i(278),i(280),i(281),i(282),i(284),i(285),i(286),i(287),i(288),i(289),i(290),i(291),i(292),i(293),i(294),i(295),i(296),i(297),i(298),i(299),i(302),i(304),i(305),i(306),i(309),i(310),i(311),i(312),i(313),i(314),i(315),i(89),i(316),i(317),i(320),i(321),i(324),i(325),i(326),i(327),i(328),i(330),i(331),i(332),i(334),i(335),i(336),i(337),i(338),i(339),i(340),i(341),i(342),i(343),i(344),i(345),i(346),i(347),i(348),i(349),i(350),i(351),i(352),i(353),i(354),i(355),i(356),i(357),i(358),i(359),i(360),i(361),i(362),i(363),i(364),i(365),i(366),i(367),i(368),i(369),i(370),i(371),i(372),i(373),i(374),i(375),i(376),i(377),i(378),i(379),i(380),i(382),i(383),i(384),i(385),i(386),i(388),i(389),i(390),i(391),i(392),i(393),i(394),i(396),i(397),i(398),i(399),i(400),i(401),i(402),i(403),i(404)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicSettingsExist=!1,this.dynamicInputsType=o.Type.BOOLEAN,this.title=a.NODE_INFO.boolean.and.title,this.description=a.NODE_INFO.boolean.and.description,this.addOutput("output",o.Type.BOOLEAN),this.addOutput("out not",o.Type.BOOLEAN),this.setOutputData(0,!1),this.setOutputData(1,!0)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getDefinedInputValues();if(0==t.length)return this.setOutputData(0,!1,!0),void this.setOutputData(1,!0,!0);const e=t.every(t=>!0===t);this.setOutputData(0,e,!0),this.setOutputData(1,!e,!0)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("boolean/and",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicSettingsExist=!1,this.dynamicInputsType=o.Type.BOOLEAN,this.title=a.NODE_INFO.boolean.or.title,this.description=a.NODE_INFO.boolean.or.description,this.addOutput("output",o.Type.BOOLEAN),this.addOutput("out not",o.Type.BOOLEAN)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getDefinedInputValues();if(0==t.length)return this.setOutputData(0,!1,!0),void this.setOutputData(1,!0,!0);const e=t.some(t=>1==t);this.setOutputData(0,e,!0),this.setOutputData(1,!e,!0)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("boolean/or",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(40),a=i(1),r=i(2);o.default.logicMainColour,o.default.logicAndIcon,o.default.logicOrIcon;class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.boolean.xor.title,this.description=r.NODE_INFO.boolean.xor.description,this.addInput("in 1",a.Type.BOOLEAN),this.addInput("in 2",a.Type.BOOLEAN),this.addOutput("output",a.Type.BOOLEAN),this.addOutput("out not",a.Type.BOOLEAN)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1);t&&!e||!t&&e?(this.setOutputData(0,!0,!0),this.setOutputData(1,!1,!0)):(this.setOutputData(0,!1,!0),this.setOutputData(1,!0,!0))}}s.Container.registerNodeType("boolean/xor",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(40),a=i(1),r=i(2);o.default.logicMainColour,o.default.logicNotIcon;class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.boolean.not.title,this.description=r.NODE_INFO.boolean.not.description,this.addInput("input",a.Type.BOOLEAN),this.addOutput("output",a.Type.BOOLEAN)}onAdded(){this.onInputUpdated()}onInputUpdated(){this.emitTransformedInput(t=>!t)}}s.Container.registerNodeType("boolean/not",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.state=!1,this.count=0,this.title=o.NODE_INFO.boolean.toggle.title,this.description=o.NODE_INFO.boolean.toggle.description,this.addInput("input",a.Type.BOOLEAN),this.addOutput("output",a.Type.BOOLEAN),this.settings["reset-on-disc"]=a.NodeSetting.create({description:"Reset on disconnected or input is null",value:!1,type:a.SettingType.BOOLEAN}),this.settings.toggleOnAny=a.NodeSetting.create({description:"Toggle on any input change",value:!1,type:a.SettingType.BOOLEAN})}onAdded(){this.setOutputData(0,!1),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);const e=this.settings.toggleOnAny.value,i=this.inputs[0].updated;if(e)i&&(this.properties.count++,this.setOutputData(0,!this.outputs[0].data));else{if(0===this.count?this.count=1:1===this.count&&(this.count=0),null==t||null==t)this.settings["reset-on-disc"].value&&(this.lastVal=!1,this.setOutputData(0,!1),this.state=!1);else if(t==this.lastVal)return;1==t&&(this.setOutputData(0,!this.state),this.state=!this.state),this.lastVal=t}}}s.Container.registerNodeType("boolean/toggle",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.boolean["one-shot"].title,this.description=r.NODE_INFO.boolean["one-shot"].description,this.addInput("trigger",o.Type.BOOLEAN),this.addInput("reset",o.Type.BOOLEAN),this.addInputWithSettings("interval",o.Type.NUMBER,1,"Interval (Max is 597 Hours)"),this.addOutput("output",o.Type.BOOLEAN),this.addOutput("remaining",o.Type.NUMBER),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:a.TIME_TYPE.MILLISECONDS,text:"Milliseconds"},{value:a.TIME_TYPE.SECONDS,text:"Seconds"},{value:a.TIME_TYPE.MINUTES,text:"Minutes"},{value:a.TIME_TYPE.HOURS,text:"Hours"}]},value:a.TIME_TYPE.SECONDS}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]}),this.settings.retrigger=o.NodeSetting.create({description:"Retrigger While Output is 'true'?",value:!0,type:o.SettingType.BOOLEAN})}onCreated(){}onAdded(){this.clearTimers(),this.setOutputData(0,!1),this.setOutputData(1,0),this.lastFireValue=!1,this.lastResetValue=!1,this.enabled=!1,this.onAfterSettingsChange()}onAfterSettingsChange(){this.timeUnits=this.settings.time.value,this.inputs[2].name=`[interval] (${this.settings.time.value})`,this.outputs[1].name=`[remaining] (${this.timeUnits})`,this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(1);null==t&&(t=!1),1==t&&t!=this.lastResetValue&&(this.clearTimers(),this.setOutputData(0,!1),this.setOutputData(1,0),this.enabled=!1),this.lastResetValue=t;let e=this.getInputData(0);if(null==e&&(e=!1),1==e&&e!=this.lastFireValue){if(this.settings.retrigger.value||!1===this.enabled){const t=this.getInputData(2),e=a.default.timeConvert(t,this.timeUnits);switch(this.clearTimers(),this.setOutputData(0,!0),this.setOutputData(1,t),this.enabled=!0,this.timeoutFunc=setTimeout(()=>{this.enabled=!1,this.setOutputData(0,!1),this.setOutputData(1,0),clearInterval(this.remainingFunc)},e),this.timeUnits){case a.TIME_TYPE.MILLISECONDS:this.remainingUpdateMillis=500,this.remainingUpdateSize=500;break;case a.TIME_TYPE.SECONDS:this.remainingUpdateMillis=1e3,this.remainingUpdateSize=1;break;case a.TIME_TYPE.MINUTES:this.remainingUpdateMillis=6e3,this.remainingUpdateSize=.1;break;case a.TIME_TYPE.HOURS:this.remainingUpdateMillis=36e4,this.remainingUpdateSize=.1}this.remainingFunc=setInterval(()=>{const t=this.outputs[1].data-this.remainingUpdateSize;this.setOutputData(1,t)},this.remainingUpdateMillis)}}this.lastFireValue=e,this.setOutputData(0,this.outputs[0].data,!0),this.setOutputData(1,this.outputs[1].data,!0)}clearTimers(){this.timeoutFunc&&clearTimeout(this.timeoutFunc),this.remainingFunc&&clearInterval(this.remainingFunc)}}s.Container.registerNodeType("boolean/one-shot",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(7),u=i(2);class d extends n.Node{constructor(){super(),this.title=u.NODE_INFO.boolean["min-on-off"].title,this.description=u.NODE_INFO.boolean["min-on-off"].description,this.addInput("input",o.Type.BOOLEAN),this.addInputWithSettings("minOn",o.Type.NUMBER,1,"Minimum On Time"),this.addInputWithSettings("minOff",o.Type.NUMBER,1,"Minimum Off Time"),this.addInput("reset",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN),this.addOutput("minOn active",o.Type.BOOLEAN),this.addOutput("minOff active",o.Type.BOOLEAN),this.settings.timeMinOn=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.settings.timeMinOff=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{minOn:{weight:2},timeMinOn:{}},{minOff:{weight:2},timeMinOff:{}}]}),this.timeOn=null,this.timeOff=null,this.minOnEnabled=!1,this.minOffEnabled=!1,this.lastResetValue=!1}onCreated(){}onAdded(){this.setOutputData(0,!1),this.setOutputData(1,!1,!0),this.setOutputData(2,!1,!0),this.inputs[1].name=`[minOn] (${this.settings.timeMinOn.value})`,this.inputs[2].name=`[minOff] (${this.settings.timeMinOff.value})`,this.onInputUpdated()}onExecute(){let t=null;this.minOnEnabled&&(t=Date.now()-this.timeOn,t>=this.minOnTime&&(this.minOnEnabled=!1,this.onInputUpdated(),this.setOutputData(1,!1,!0))),this.minOffEnabled&&(t=Date.now()-this.timeOff,t>=this.minOffTime&&(this.minOffEnabled=!1,this.onInputUpdated(),this.setOutputData(2,!1,!0))),this.setOutputData(1,this.outputs[1].data,!0),this.setOutputData(2,this.outputs[2].data,!0)}onInputUpdated(){let t=this.getInputData(3);null==t&&(t=!1),1==t&&t!=this.lastResetValue&&(this.setOutputData(0,!1),this.minOnEnabled=!1,this.minOffEnabled=!1,this.setOutputData(1,!1,!0),this.setOutputData(2,!1)),this.lastResetValue=t;let e=this.getInputData(1);e=r.default.timeConvert(e,this.settings.timeMinOn.value),this.minOnTime=e;let i=this.getInputData(2);i=r.default.timeConvert(i,this.settings.timeMinOff.value),this.minOffTime=i;let s=this.getInputData(0);a.default.hasInput(s)||(s=!1),this.minOnEnabled||this.minOffEnabled||(this.setOutputData(0,s),s&&s!=this.lastValue?(this.timeOn=Date.now(),this.minOnEnabled=!0,this.setOutputData(1,!1,!0)):s||s==this.lastValue||(this.timeOff=Date.now(),this.minOffEnabled=!0,this.setOutputData(2,!1)),this.lastValue=s)}onAfterSettingsChange(){this.inputs[1].name=`[minOn] (${this.settings.timeMinOn.value})`,this.inputs[2].name=`[minOff] (${this.settings.timeMinOff.value})`,this.onInputUpdated()}}s.Container.registerNodeType("boolean/min-on-off",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.enabled=!1,this.title=r.NODE_INFO.boolean["on-delay"].title,this.description=r.NODE_INFO.boolean["on-delay"].description,this.addInput("input",o.Type.BOOLEAN),this.addInputWithSettings("delay",o.Type.NUMBER,1,"On Delay Duration (Max 597 Hours)"),this.addInput("reset",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN),this.addOutput("onDelay active",o.Type.BOOLEAN),this.addOutput("remaining",o.Type.NUMBER),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:a.TIME_TYPE.MILLISECONDS,text:"Milliseconds"},{value:a.TIME_TYPE.SECONDS,text:"Seconds"},{value:a.TIME_TYPE.MINUTES,text:"Minutes"},{value:a.TIME_TYPE.HOURS,text:"Hours"}]},value:a.TIME_TYPE.SECONDS}),this.setSettingsConfig({groups:[{delay:{weight:2},time:{}}]})}onCreated(){this.setOutputData(0,!1),this.setOutputData(1,!1),this.setOutputData(2,0),this.lastInput=!1,this.lastReset=!1}onAdded(){this.onAfterSettingsChange()}onAfterSettingsChange(){this.timeUnits=this.settings.time.value,this.inputs[1].name=`[delay] (${this.timeUnits})`,this.outputs[2].name=`[remaining] (${this.timeUnits})`,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(1),e=a.default.timeConvert(t,this.timeUnits);let i=this.getInputData(0);!0!==i&&(i=!1);const s=this.getInputData(2);if(s&&this.inputs[2].updated&&!this.lastReset&&this.enabled&&(this.clearTimers(),this.setOutputData(0,i),this.setOutputData(1,!1),this.setOutputData(2,0),this.enabled=!1),this.lastReset=s,i&&this.inputs[0].updated&&!this.lastInput){switch(this.setOutputData(1,!0),this.setOutputData(2,t),this.enabled=!0,this.clearTimers(),this.timeoutFunc=setTimeout(()=>{this.enabled=!1,this.setOutputData(0,!0),this.setOutputData(1,!1),this.setOutputData(2,0),clearInterval(this.remainingFunc)},e),this.timeUnits){case a.TIME_TYPE.MILLISECONDS:this.remainingUpdateMillis=500,this.remainingUpdateSize=500;break;case a.TIME_TYPE.SECONDS:this.remainingUpdateMillis=1e3,this.remainingUpdateSize=1;break;case a.TIME_TYPE.MINUTES:this.remainingUpdateMillis=6e3,this.remainingUpdateSize=.1;break;case a.TIME_TYPE.HOURS:this.remainingUpdateMillis=36e4,this.remainingUpdateSize=.1}this.remainingFunc=setInterval(()=>{const t=this.outputs[2].data-this.remainingUpdateSize;this.setOutputData(2,t)},this.remainingUpdateMillis)}this.lastInput=i,i||(this.setOutputData(0,!1,!0),this.setOutputData(1,!1,!0),this.setOutputData(2,0,!0),this.inputs[0].updated&&this.enabled&&(this.clearTimers(),this.enabled=!1))}clearTimers(){this.timeoutFunc&&clearTimeout(this.timeoutFunc),this.remainingFunc&&clearInterval(this.remainingFunc)}}s.Container.registerNodeType("boolean/on-delay",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.enabled=!1,this.title=r.NODE_INFO.boolean["off-delay"].title,this.description=r.NODE_INFO.boolean["off-delay"].description,this.addInput("input",o.Type.BOOLEAN),this.addInputWithSettings("delay",o.Type.NUMBER,1,"Off Delay Duration (Max 597 Hours)"),this.addInput("reset",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN),this.addOutput("offDelay active",o.Type.BOOLEAN),this.addOutput("remaining",o.Type.NUMBER),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:a.TIME_TYPE.MILLISECONDS,text:"Milliseconds"},{value:a.TIME_TYPE.SECONDS,text:"Seconds"},{value:a.TIME_TYPE.MINUTES,text:"Minutes"},{value:a.TIME_TYPE.HOURS,text:"Hours"}]},value:a.TIME_TYPE.SECONDS}),this.setSettingsConfig({groups:[{delay:{weight:2},time:{}}]})}onCreated(){}onAdded(){this.clearTimers(),this.setOutputData(0,!1),this.setOutputData(1,!1),this.setOutputData(2,0),this.lastInput=!1,this.lastReset=!1,this.onAfterSettingsChange()}onAfterSettingsChange(){this.timeUnits=this.settings.time.value,this.inputs[1].name=`[delay] (${this.timeUnits})`,this.outputs[2].name=`[remaining] (${this.timeUnits})`,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(1),e=a.default.timeConvert(t,this.timeUnits);let i=this.getInputData(0);!0!==i&&(i=!1);const s=this.getInputData(2);if(s&&this.inputs[2].updated&&!this.lastReset&&this.enabled&&(this.clearTimers(),this.setOutputData(0,i),this.setOutputData(1,!1),this.setOutputData(2,0),this.enabled=!1),this.lastReset=s,!i&&this.inputs[0].updated&&this.lastInput){switch(this.setOutputData(1,!0),this.setOutputData(2,t),this.clearTimers(),this.enabled=!0,this.timeoutFunc=setTimeout(()=>{this.enabled=!1,this.setOutputData(0,!1),this.setOutputData(1,!1),this.setOutputData(2,0),clearInterval(this.remainingFunc)},e),this.timeUnits){case a.TIME_TYPE.MILLISECONDS:this.remainingUpdateMillis=500,this.remainingUpdateSize=500;break;case a.TIME_TYPE.SECONDS:this.remainingUpdateMillis=1e3,this.remainingUpdateSize=1;break;case a.TIME_TYPE.MINUTES:this.remainingUpdateMillis=6e3,this.remainingUpdateSize=.1;break;case a.TIME_TYPE.HOURS:this.remainingUpdateMillis=36e4,this.remainingUpdateSize=.1}this.remainingFunc=setInterval(()=>{const t=this.outputs[2].data-this.remainingUpdateSize;this.setOutputData(2,t)},this.remainingUpdateMillis)}this.lastInput=i,i&&(this.setOutputData(0,!0,!0),this.setOutputData(1,!1,!0),this.setOutputData(2,0,!0),this.inputs[0].updated&&this.enabled&&(this.clearTimers(),this.enabled=!1))}clearTimers(){this.timeoutFunc&&clearTimeout(this.timeoutFunc),this.remainingFunc&&clearInterval(this.remainingFunc)}}s.Container.registerNodeType("boolean/off-delay",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.lastInterval=1e3,this.state=!1,this.runState=!0,this.title=r.NODE_INFO.boolean.ticker.title,this.description=r.NODE_INFO.boolean.ticker.description,this.addInputWithSettings("enable",o.Type.BOOLEAN,!0,"Enable"),this.addInputWithSettings("interval",o.Type.NUMBER,1,"Interval"),this.addOutput("output",o.Type.BOOLEAN),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]}),this.settings.false=o.NodeSetting.create({description:"Generate False",value:!0,type:o.SettingType.BOOLEAN})}onAdded(){if(this.inputs[1].name=`[interval] (${this.settings.time.value})`,clearInterval(this.timeoutFunc),this.setOutputData(0,!1),!this.getInputData(0))return this.setOutputData(0,!1),void(this.runState=!1);let t=this.getInputData(1);t=a.default.timeConvert(t,this.settings.time.value),this.timeoutFunc=setInterval(()=>{this.state=!this.state,this.state||!this.settings.false.value?this.state&&this.setOutputData(0,!0):this.setOutputData(0,!1)},t/2),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(!t&&this.runState)return clearInterval(this.timeoutFunc),this.setOutputData(0,!1,!0),this.runState=!1,void(this.state=!1);if(!t&&!this.runState)return this.setOutputData(0,!1,!0),this.runState=!1,void(this.state=!1);if(t){let t=this.getInputData(1);if(t=a.default.timeConvert(t,this.settings.time.value),this.runState)return void(t!=this.lastInterval&&(this.lastInterval=t,clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>{this.state=!this.state,this.state||!this.settings.false.value?this.state&&this.setOutputData(0,!0):this.setOutputData(0,!1)},t/2)));this.runState||(this.runState=!0,this.state=!0,this.setOutputData(0,!0),this.timeoutFunc=setInterval(()=>{this.state=!this.state,this.state||!this.settings.false.value?this.state&&this.setOutputData(0,!0):this.setOutputData(0,!1)},t/2))}}onAfterSettingsChange(){this.inputs[1].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}}s.Container.registerNodeType("boolean/ticker",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.compare.equal.title,this.description=r.NODE_INFO.compare.equal.description,this.addInput("in 1",o.Type.ANY),this.addInputWithSettings("in 2",o.Type.ANY,null,"in 2"),this.addOutput("out equal",o.Type.BOOLEAN),this.addOutput("out not equal",o.Type.BOOLEAN)}onAdded(){this.setOutputData(0,!1),this.setOutputData(1,!0),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(!a.default.hasInput(t))return this.setOutputData(0,!1),void this.setOutputData(1,!0);t=(t||"").toString(),t===(this.getInputData(1)||"").toString()?(this.setOutputData(0,!0),this.setOutputData(1,!1)):(this.setOutputData(0,!1),this.setOutputData(1,!0))}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("compare/equal",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.compare["greater-than"].title,this.description=a.NODE_INFO.compare["greater-than"].description,this.addInput("in 1",o.Type.NUMBER),this.addInputWithSettings("in 2",o.Type.NUMBER,0,"In 2 Constant",!1),this.addOutput("out >",o.Type.BOOLEAN),this.addOutput("out >=",o.Type.BOOLEAN)}onAdded(){this.setOutputData(0,!1),this.setOutputData(1,!1),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);null!=t&&null!=e?(this.setOutputData(0,t>e),this.setOutputData(1,t>=e)):(this.setOutputData(0,!1,!0),this.setOutputData(1,!1,!0))}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("compare/greater-than",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.compare["less-than"].title,this.description=a.NODE_INFO.compare["less-than"].description,this.addInput("in 1",o.Type.NUMBER),this.addInputWithSettings("in 2",o.Type.NUMBER,0,"In 2 Constant",!1),this.addOutput("out <",o.Type.BOOLEAN),this.addOutput("out <=",o.Type.BOOLEAN)}onAdded(){this.setOutputData(0,!1),this.setOutputData(1,!1),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);if(null!=t&&null!=e)return this.setOutputData(0,t<e),void this.setOutputData(1,t<=e);this.setOutputData(0,!1,!0),this.setOutputData(1,!1,!0)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("compare/less-than",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.compare.between.title,this.description=a.NODE_INFO.compare.between.description,this.addInput("input",o.Type.NUMBER),this.addInputWithSettings("from",o.Type.NUMBER,0,"From Value",!1),this.addInputWithSettings("to",o.Type.NUMBER,1,"To Value",!1),this.addOutput("output",o.Type.BOOLEAN),this.addOutput("out not",o.Type.BOOLEAN)}onAdded(){this.setOutputData(0,!1),this.setOutputData(1,!0),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);null!=t&&null!=e&&null!=i&&t>=Math.min(e,i)&&t<=Math.max(e,i)?(this.setOutputData(0,!0,!0),this.setOutputData(1,!1,!0)):(this.setOutputData(0,!1,!0),this.setOutputData(1,!0,!0))}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("compare/between",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.compare.hysteresis.title,this.description=a.NODE_INFO.compare.hysteresis.description,this.addInput("input",o.Type.NUMBER),this.addInputWithSettings("risingEdge",o.Type.NUMBER,20,"Rising Edge",!1),this.addInputWithSettings("fallingEdge",o.Type.NUMBER,10,"Falling Edge",!1),this.addOutput("output",o.Type.BOOLEAN),this.addOutput("out not",o.Type.BOOLEAN)}onAdded(){this.setOutputData(0,!1),this.setOutputData(1,!0)}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);null!=e&&null!=i?e>i?(t<=i&&(this.setOutputData(0,!1),this.setOutputData(1,!0)),t>=e&&(this.setOutputData(0,!0),this.setOutputData(1,!1))):e<i&&(t>=i&&(this.setOutputData(0,!1),this.setOutputData(1,!0)),t<=e&&(this.setOutputData(0,!0),this.setOutputData(1,!1))):(this.setOutputData(0,!1,!0),this.setOutputData(1,!0,!0))}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("compare/hysteresis",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.compare["type-check"].title,this.description=o.NODE_INFO.compare["type-check"].description,this.addInput("input",a.Type.ANY),this.addOutput("output",a.Type.BOOLEAN),this.addOutput("isType",a.Type.STRING),this.settings.type=a.NodeSetting.create({description:"Type to check",type:a.SettingType.DROPDOWN,config:{items:[{value:a.Type.STRING,text:a.Type.STRING},{value:a.Type.NUMBER,text:a.Type.NUMBER},{value:a.Type.BOOLEAN,text:a.Type.BOOLEAN},{value:a.Type.JSON,text:a.Type.JSON}]},value:a.Type.STRING})}onAdded(){this.updateTitle(),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);void 0===t&&(this.setOutputData(0,null),this.setOutputData(1,null));const e=this.settings.type.value,i=typeof t;switch(this.setOutputData(1,i),e){case a.Type.STRING:this.setOutputData(0,typeof t===a.Type.STRING,!0);break;case a.Type.NUMBER:this.setOutputData(0,typeof t===a.Type.NUMBER,!0);break;case a.Type.BOOLEAN:this.setOutputData(0,typeof t===a.Type.BOOLEAN,!0);break;case a.Type.JSON:if("string"==typeof t)try{JSON.parse(t),this.setOutputData(0,!0)}catch(t){this.setOutputData(0,!1)}else if("object"==typeof t)try{JSON.parse(JSON.stringify(t)),this.setOutputData(0,!0)}catch(t){this.setOutputData(0,!1)}this.setOutputData(0,null===t)}}onAfterSettingsChange(){this.updateTitle(),this.onInputUpdated()}updateTitle(){switch(this.settings.type.value){case a.Type.STRING:this.title="Type Check (string)";break;case a.Type.NUMBER:this.title="Type Check (number)";break;case a.Type.BOOLEAN:this.title="Type Check (boolean)";break;case a.Type.JSON:this.title="Type Check (json)"}}}s.Container.registerNodeType("compare/type-check",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionLocalTransmitterNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(5),r=i(1);class u extends n.Node{constructor(){super(),this.title=o.NODE_INFO.connection["link-transmitter-single"].title,this.description=o.NODE_INFO.connection["link-transmitter-single"].description,this.iconImageUrl=o.NODE_INFO.connection["link-transmitter-single"].iconImageUrl,this.addInput("input",r.Type.ANY),this.addInputWithSettings("topic",r.Type.STRING,"1","Topic Name",!1),this.addInputWithSettings("enable",r.Type.BOOLEAN,!0,"Enable"),this.settings.ifNew=r.NodeSetting.create({description:"Only transmit on COV",value:!1,type:r.SettingType.BOOLEAN})}init(){this.properties.topic||(this.properties.topic=null)}onAdded(){this.onAfterSettingsChange(),this.updateTitle()}onInputUpdated(){if(this.side!==a.Side.server)return;this.properties.topic=this.getInputData(1),this.persistProperties(!1,!0);const t=this.getReceivers();if(this.inputs[1].updated&&this.updateTransmitterTopics(),!this.isEnable())return;const e=this.getInputData(0),i=this.getInputData(1),s=this.settings.ifNew.value;t.forEach(t=>{if(t.properties.topic===i){const i=t.settings.blockNull.value;!0===t.getInputData(0)&&(i&&null!=e||!i)&&(t.properties.val=e,t.persistProperties(!1,!0),t.setOutputData(0,t.properties.val,s))}}),this.updateTitle()}onAfterSettingsChange(){this.updateTransmitterTopics(),this.onInputUpdated()}onRemoved(){this.updateTransmitterTopics()}updateTransmitterTopics(){this.side===a.Side.server&&setTimeout(()=>{this.getReceivers().forEach(t=>{t.triggerTransmitterTopicUpdate()})},100)}getReceivers(){return s.ContainerRegistry.instance().rootContainer().getNodesByType("connection/link-receiver-single",!0)}isEnable(){return this.getInputData(2)}updateTitle(){this.title=`Link Transmitter Single [${this.properties.topic||this.getInputData(1)}]`,this.broadcastTitleToClients()}}e.ConnectionLocalTransmitterNode=u,s.Container.registerNodeType("connection/link-transmitter-single",u)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionLocalReceiverNode=void 0;const n=i(6),o=i(0),a=i(3),r=i(2),u=i(5),d=i(1);class l extends a.Node{constructor(){super(),this.topicList=[],this.inputEnable=0,this.inputNumTopic=1,this.title=r.NODE_INFO.connection["link-receiver-single"].title,this.description=r.NODE_INFO.connection["link-receiver-single"].description,this.iconImageUrl=r.NODE_INFO.connection["link-receiver-single"].iconImageUrl,this.addInputWithSettings("enable",d.Type.BOOLEAN,!0,"Enable"),this.settings.manualTopicOption=d.NodeSetting.create({description:"Set topic manually",value:!1,type:d.SettingType.BOOLEAN}),this.addInputWithSettings("topic",d.Type.STRING,"1","Set topic",!1),this.addOutput("output",d.Type.ANY),this.addOutput("topic",d.Type.STRING),this.properties.topic="",this.settings.topicDropdown=d.NodeSetting.create({description:"Select Topic",config:{items:[]},value:"",type:d.SettingType.DROPDOWN}),this.settings.blockNull=d.NodeSetting.create({description:"Block Null",value:!1,type:d.SettingType.BOOLEAN}),this.setSettingsConfig({conditions:{topicDropdown:t=>!1===t.manualTopicOption.value}})}init(){this.properties.val||(this.properties.val=null)}onAdded(){this.onAfterSettingsChange(),this.setOutputData(0,this.properties.val)}onCreated(){n.isNull(this.properties.topic)&&this.onAfterSettingsChange()}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){yield this.setTopic(),this.updateTitle(),this.side===u.Side.server&&(this.transmitterTopic(),this.updateChannel())}))}pushSettings(){const t=this.topicList.map(t=>({value:t,text:t}));this.settings.topicDropdown.config={items:t},this.persistProperties(!0),this.updateTitle(),this.updateChannel(),this.broadcastSettingsToClients(!1),this.broadcastTitleToClients(!1),this.broadcastOutputsToClients(!1)}transmitterTopic(){const t=o.ContainerRegistry.instance().rootContainer().getNodesByType("connection/link-transmitter-single",!0);this.topicList=[],t.forEach(t=>{this.topicList.push(t.getInputData(1)),this.properties.topic===t.getInputData(1)&&this.setOutputData(0,t.getInputData(0))}),this.pushSettings()}updateTitle(){this.title="Link Receiver Single ["+this.properties.topic+"]"}updateChannel(){this.setOutputData(1,this.properties.topic)}onInputUpdated(){this.side===u.Side.server&&this.onAfterSettingsChange()}setTopic(){return s(this,void 0,void 0,(function*(){const t=this.settings.manualTopicOption.value;t?this.properties.topic=this.getInputData(this.inputNumTopic):t||(this.properties.topic=this.settings.topicDropdown.value)}))}triggerTransmitterTopicUpdate(){this.side===u.Side.server&&this.transmitterTopic()}}e.ConnectionLocalReceiverNode=l,o.Container.registerNodeType("connection/link-receiver-single",l)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionLocalTransmitterNode=void 0;const s=i(0),n=i(3),o=i(5),a=i(1),r=i(4),u=i(2);class d extends n.Node{constructor(){super(),this.title=u.NODE_INFO.connection["link-transmitter"].title,this.description=u.NODE_INFO.connection["link-transmitter"].description,this.settings.channel=a.NodeSetting.create({description:"Channel Number",value:1,type:a.SettingType.NUMBER}),this.settings.inputsCount=a.NodeSetting.create({description:"Inputs Count",value:1,type:a.SettingType.NUMBER})}init(){this.properties.inputsCount=0,this.changeTopicsCount(this.settings.inputsCount.value)}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){for(let t in this.inputs){let e=this.inputs[t].data;null==e&&(e=null),s.ContainerRegistry.instance().rootContainer().getNodesByType("connection/link-receiver",!0).forEach(i=>{i.settings.channel.value==this.settings.channel.value&&i.outputs.hasOwnProperty(t)&&(i.setOutputData(+t,e,!0),""!==this.inputs[t].name&&(i.outputs[t].name=this.inputs[t].name))})}}onAfterSettingsChange(){this.updateTitle();let t=this.settings.inputsCount.value;t=r.default.clamp(t,1,100),t!==this.properties.inputsCount&&this.changeTopicsCount(t),this.renameInputs(),this.persistProperties(!0,!0,!0),this.onInputUpdated()}changeTopicsCount(t){let e=t-this.properties.inputsCount;if(0!=e){if(this.changeInputsCount(t,a.Type.ANY),e>0)for(let e=this.properties.inputsCount+1;e<=t;e++)this.settings["in"+e]=a.NodeSetting.create({description:"Input "+e,value:"",type:a.SettingType.STRING});else if(e<0)for(let e=this.properties.inputsCount;e>t;e--)delete this.settings["in"+e];this.properties.inputsCount=t}}renameInputs(){var t;for(let e=0;e<=this.properties.inputsCount-1;e++){let i=null===(t=this.settings["in"+(e+1)])||void 0===t?void 0:t.value;(null==i?void 0:i.length)>20&&(i="..."+i.substr(i.length-20,20)),this.inputs[String(e)].name=e+1+" | "+i}if(this.side==o.Side.editor){for(let t=0;t<=this.properties.inputsCount-1;t++)this.inputs[String(t)].label=this.inputs[String(t)].name;this.setDirtyCanvas(!0,!0)}}updateTitle(){this.title="Link Transmitter ["+this.settings.channel.value+"]"}}e.ConnectionLocalTransmitterNode=d,s.Container.registerNodeType("connection/link-transmitter",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionLocalReceiverNode=void 0;const s=i(0),n=i(8),o=i(2),a=i(1);class r extends n.FlexibleNode{constructor(){super(),this.dynamicOutputsExist=!0,this.dynamicInputsExist=!1,this.dynamicSettingsExist=!1,this.dynamicDefaultOutputs=1,this.dynamicMinOutputs=1,this.title=o.NODE_INFO.connection["link-receiver"].title,this.description=o.NODE_INFO.connection["link-receiver"].description,this.settings.channel=a.NodeSetting.create({description:"Channel Number",value:1,type:a.SettingType.NUMBER})}onCreated(){this.properties.channel=1}onAdded(){this.updateTitle(),this.onAfterSettingsChange()}onAfterSettingsChange(){super.onAfterSettingsChange(),this.updateTitle(),this.properties.channel!==this.settings.channel.value&&this.resetOutputs(),this.triggerTransmitterNodeUpdate()}triggerTransmitterNodeUpdate(){s.ContainerRegistry.instance().rootContainer().getNodesByType("connection/link-transmitter",!0).forEach(t=>{t.settings.channel.value==this.settings.channel.value&&t.onInputUpdated()})}resetOutputs(){for(let t in this.outputs)this.setOutputData(+t,null)}updateTitle(){this.title="Link Receiver ["+this.settings.channel.value+"]"}}e.ConnectionLocalReceiverNode=r,s.Container.registerNodeType("connection/link-receiver",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(2),a=i(1),r=i(4);class u extends n.FlexibleNode{constructor(){super(),this.dynamicSettingsExist=!1,this.dynamicInputsType=a.Type.ANY,this.title=o.NODE_INFO.connection.hub.title,this.description=o.NODE_INFO.connection.hub.description,this.addOutput("output",a.Type.ANY)}onAdded(){this.onInputUpdated(),this.size=this.computeSize()}onInputUpdated(){const t=this.getInputsCount();for(let e=this.dynamicInputStartPosition;e<t;e++){let t=this.getInputData(e);if(r.default.hasInput(t)&&this.inputs[e].updated)return void this.setOutputData(0,this.inputs[e].data)}}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("connection/hub",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FOLDER_INPUT=void 0;const s=i(6),n=i(18),o=i(2),a=i(1),r=i(19),u=i(11),d=i(81);class l extends d.AbstractFolderIONode{constructor(){super(o.NODE_INFO.container["folder-input"].title,o.NODE_INFO.container["folder-input"].description),this.addOutput("input",null)}onAdded(){if(super.onAdded(),!this.isUnderContainer()||this.hasItself("inputs"))return;const t=this.container.nodeItself(),e=t.addInput(this.name,a.Type.ANY,void 0,void 0,{subNodeId:this.id});this.name=t.inputs[e].name,r.createLegacyLinkHandler(t).recomputeInputLinks(t)}onRemoved(){if(!this.isUnderContainer()||!this.hasItself("inputs"))return;let t=this.container.nodeItself(),[e,i]=this.findParentIOById("inputs");t.removeInput(+e),r.createLegacyLinkHandler(t).recomputeInputLinks(t),n.createNodeDbHelper().update(t,["size"])}onAfterSettingsChange(){if(!this.isUnderContainer())return;const t=this.container.nodeItself();let[e,i]=this.findParentIOById("inputs");s.isNull(e)||(t.inputs[e].name=this.name,n.createNodeDbHelper().update(t,["inputs"]))}onExecute(){if(!this.isUnderContainer())return;let[t,e]=this.findParentIOById("inputs"),i=e;(null==i?void 0:i.updated)&&this.setOutputData(0,i.data)}correctParentIO(t,e){let i=t.inputs[e];s.isNull(i)||(i.subNodeId=this.id,n.createNodeDbHelper().update(t,["inputs"]))}}e.FOLDER_INPUT="container/folder-input",u.NodeTypeRegistry.registerNodeType(e.FOLDER_INPUT,l,null,!0,!1,!0)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FOLDER_OUTPUT=void 0;const s=i(6),n=i(18),o=i(2),a=i(1),r=i(19),u=i(11),d=i(81);class l extends d.AbstractFolderIONode{constructor(){super(o.NODE_INFO.container["folder-output"].title,o.NODE_INFO.container["folder-output"].description),this.addInput("output",null)}onAdded(){if(super.onAdded(),!this.isUnderContainer()||this.hasItself("outputs"))return;const t=this.container.nodeItself(),e=t.addOutput(this.name,a.Type.ANY,void 0,{subNodeId:this.id});this.name=t.outputs[e].name,r.createLegacyLinkHandler(t).recomputeOutputLinks(t)}onRemoved(){if(!this.isUnderContainer()||!this.hasItself("outputs"))return;let t=this.container.nodeItself(),[e,i]=this.findParentIOById("outputs");t.removeOutput(+e),r.createLegacyLinkHandler(t).recomputeOutputLinks(t),n.createNodeDbHelper().update(t,["size"])}onAfterSettingsChange(){if(!this.isUnderContainer())return;const t=this.container.nodeItself();let[e,i]=this.findParentIOById("outputs");s.isNull(e)||(t.outputs[e].name=this.name,n.createNodeDbHelper().update(t,["outputs"]))}onInputUpdated(){if(!this.isUnderContainer())return;let[t,e]=this.findParentIOById("outputs");s.isNull(t)||(this.isRecentlyActive=!0,this.container.nodeItself().setOutputData(+t,this.getInputData(0)))}correctParentIO(t,e){let i=t.outputs[e];s.isNull(i)||(i.subNodeId=this.id,n.createNodeDbHelper().update(t,["outputs"]))}}e.FOLDER_OUTPUT="container/folder-output",u.NodeTypeRegistry.registerNodeType(e.FOLDER_OUTPUT,l,null,!0,!1,!0)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.conversion["bit-mask-single"].title,this.description=r.NODE_INFO.conversion["bit-mask-single"].description,this.settings.bit=o.NodeSetting.create({description:"bit index (0-7)",type:o.SettingType.NUMBER,value:0}),this.settings.byte=o.NodeSetting.create({description:"Byte to read if Array",type:o.SettingType.NUMBER,value:0}),this.addInput("input",o.Type.ANY),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(null==t)return;const e=this.settings.bit.value,i=this.settings.byte.value;if("object"==typeof t){if(!t||!t.length||t.length<i+1)return;t=t[i]}this.setOutputData(0,t>>e&1)}onAfterSettingsChange(){this.settings.bit.value=a.default.clamp(this.settings.bit.value,0,7),this.onInputUpdated()}}s.Container.registerNodeType("conversion/bit-mask-single",u);class d extends n.Node{constructor(){super(),this.mask=0,this.title="Bit Mask Multiple",this.description="A node to mask certain bits of a byte",this.settings.bitStart=o.NodeSetting.create({description:"Lowest bit to start (0-7)",type:o.SettingType.NUMBER,value:0}),this.settings.maskLen=o.NodeSetting.create({description:"Mask length (1-8)",type:o.SettingType.NUMBER,value:1}),this.settings.byte=o.NodeSetting.create({description:"Byte to read if Array",type:o.SettingType.NUMBER,value:0}),this.addInput("input",o.Type.ANY),this.addOutput("output",o.Type.NUMBER),this.addOutput("error",o.Type.STRING)}init(){this.updateMask()}onAdded(){this.updateMask(),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(null==t)return;const e=this.settings.bitStart.value,i=this.settings.byte.value;if("object"==typeof t){if(!t||!t.length||t.length<i+1)return;t=t[i]}this.setOutputData(0,(t&this.mask)>>e)}onAfterSettingsChange(){this.settings.bitStart.value=a.default.clamp(this.settings.bitStart.value,0,7),this.settings.maskLen.value=a.default.clamp(this.settings.maskLen.value,1,8-this.settings.bitStart.value),this.updateMask(),this.onInputUpdated()}updateMask(){this.mask=0;for(let t=0;t<this.settings.maskLen.value;t++)this.mask|=1<<t;this.mask<<=this.settings.bitStart.value}}s.Container.registerNodeType("conversion/bit-mask-multiple",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.conversion["int-to-bits"].title,this.description=o.NODE_INFO.conversion["int-to-bits"].description,this.settings.start=a.NodeSetting.create({description:"Start index if Array",type:a.SettingType.NUMBER,value:0}),this.settings.bytes=a.NodeSetting.create({description:"Bytes to read if Array",type:a.SettingType.NUMBER,value:1}),this.addInput("input",a.Type.ANY)}init(){this.setNewOutputs()}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(null==t)return;"number"==typeof t&&(t=[t]);const e=this.settings.start.value,i=this.settings.bytes.value;if(!t||!t.length||t.length<i)return;let s=0;for(let n=0;n<i;n++)for(let i=0;i<8;i++)this.setOutputData(s++,t[e+n]>>i&1)}onAfterSettingsChange(){this.setNewOutputs(),this.onInputUpdated()}setNewOutputs(){let t=this.getOutputsCount();for(let e=0;e<t;e++)this.removeOutput(e);t=8*this.settings.bytes.value;for(let e=0;e<t;e++)this.addOutput(e.toString(),a.Type.NUMBER);this.updateNodeOutput(),this.onInputUpdated()}}s.Container.registerNodeType("conversion/int-to-bits",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.conversion["bool-to-int"].title,this.description=a.NODE_INFO.conversion["bool-to-int"].description,this.addInput("input",o.Type.BOOLEAN),this.addOutput("output",o.Type.NUMBER)}onInputUpdated(){this.setOutputData(0,this.inputs[0].data?1:0)}}s.Container.registerNodeType("conversion/bool-to-int",r);class u extends n.Node{constructor(){super(),this.title=a.NODE_INFO.conversion["int-to-bool"].title,this.description=a.NODE_INFO.conversion["int-to-bool"].description,this.addInput("input",o.Type.NUMBER),this.addOutput("output",o.Type.BOOLEAN)}onInputUpdated(){this.setOutputData(0,!!this.inputs[0].data)}}s.Container.registerNodeType("conversion/int-to-bool",u);class d extends n.Node{constructor(){super(),this.title=a.NODE_INFO.conversion["string-to-bool"].title,this.description=a.NODE_INFO.conversion["string-to-bool"].description,this.addInput("input",o.Type.STRING),this.addOutput("output",o.Type.BOOLEAN)}onInputUpdated(){const t=this.getInputData(0);"0"===t||"false"===t?this.setOutputData(0,!1,!0):"1"!==t&&"true"!==t||this.setOutputData(0,!0,!0)}}s.Container.registerNodeType("conversion/string-to-bool",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BufferToHexString=void 0;const s=i(3),n=i(1),o=i(0),a=i(2);class r extends s.Node{constructor(){super(),this.title=a.NODE_INFO.conversion["buffer-to-hex-string"].title,this.description=a.NODE_INFO.conversion["buffer-to-hex-string"].description,this.addInput("input",n.Type.ANY),this.addOutput("output",n.Type.STRING)}onInputUpdated(){let t=this.getInputData(0);if(!t||!Buffer.isBuffer(t))return;let e=t.toString("hex").toUpperCase();this.setOutputData(0,e)}}e.BufferToHexString=r,o.Container.registerNodeType("conversion/buffer-to-hex-string",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1),r=i(82);class u extends n.Node{constructor(){super(),this.value=null,this.title=o.NODE_INFO.conversion["buffer-to-num"].title,this.description=o.NODE_INFO.conversion["buffer-to-num"].description,this.addInput("in",a.Type.ANY),this.addOutput("out",a.Type.JSON),this.addOutput("out buffer",a.Type.JSON),this.settings.dataType=a.NodeSetting.create({description:"Set data type",type:a.SettingType.DROPDOWN,config:{items:[{value:0,text:"na"},{value:1,text:"INT-16"},{value:2,text:"UINT-16"},{value:3,text:"INT-32"},{value:4,text:"UINT-32"},{value:5,text:"FLOAT-32"},{value:8,text:"DOUBLE-64"}]},value:0}),this.settings.dataEndian=a.NodeSetting.create({description:"Set byte order",type:a.SettingType.DROPDOWN,config:{items:[{value:0,text:"LE-Byte BE-Word"},{value:1,text:"LE-Byte LE-Word"},{value:2,text:"BE-Byte LE-Word"},{value:3,text:"BE-Byte BE-Word"}]},value:0})}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.settings.dataEndian.value,i=this.settings.dataType.value;try{let s,n=JSON.parse(t);if(!n.length)return;if(1===n.length&&n[0]>255||2===n.length&&(n[0]>255||n[1]>255)){s=Buffer.alloc(2*n.length);let t=0;for(let i=0;i<n.length;i++)e>=2?s.writeUInt16BE(n[i],t):s.writeUInt16LE(n[i],t),t+=2}else{if(!(n.length<=4))return;s=Buffer.from(n)}const o=r.default.readByteOrder(s,0,i,e);this.setOutputData(0,JSON.stringify(o)),this.setOutputData(1,JSON.stringify(s))}catch(t){}}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("conversion/buffer-to-num",u)},function(t,e,i){"use strict";var s=this&&this.__rest||function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(t);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(i[s[n]]=t[s[n]])}return i};Object.defineProperty(e,"__esModule",{value:!0});const n=i(172),o=i(17),a=i(0),r=i(3),u=i(2),d=i(1);class l extends r.Node{constructor(){super(),this.title=u.NODE_INFO.conversion["convert-units"].title,this.description=u.NODE_INFO.conversion["convert-units"].description,this.addInput("in"),this.addOutput("converted"),this.settings["from-to"]=d.NodeSetting.create({description:"From / To unit",type:d.SettingType.TREE_SELECT,config:{items:[]}}),this.ensureFromToConfig()}onAdded(){this.updateTitle(),this.ensureFromToConfig()}ensureFromToConfig(){o.get(this,"settings['from-to'].config.items.length",0)||(this.settings["from-to"].config={items:this.createTreeSelectItems()}),this.settings["from-to"].toJSON=function(){const t=Object.assign({},this),{config:e=null}=t;return s(t,["config"])}}createTreeSelectItems(){const t=t=>({value:t,text:t});return n().measures().map(e=>({text:e,items:n().possibilities(e).map(t)})).map(t=>{return Object.assign(Object.assign({},t),{items:t.items.map((e=t.text,i=t.items,t=>Object.assign(Object.assign({},t),{items:i.map(i=>Object.assign(Object.assign({},i),{value:{type:e,from:t.value,to:i.value}}))})))});var e,i})}onInputUpdated(){if(!this.settings["from-to"].value)return;const{from:t,to:e}=this.settings["from-to"].value,i=parseFloat(this.inputs[0].data);this.setOutputData(0,n(i).from(t).to(e))}onAfterSettingsChange(){this.ensureFromToConfig(),this.onInputUpdated(),this.updateTitle()}updateTitle(){if(!this.settings["from-to"].value)return;const{from:t,to:e}=this.settings["from-to"].value;this.title="Unit converter ("+t+"/"+e+")"}}a.Container.registerNodeType("conversion/convert-units",l)},function(t,e){t.exports=require("convert-units")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HexStringToBuffer=void 0;const s=i(3),n=i(1),o=i(0),a=i(2);class r extends s.Node{constructor(){super(),this.title=a.NODE_INFO.conversion["hex-string-to-buffer"].title,this.description=a.NODE_INFO.conversion["hex-string-to-buffer"].description,this.addInput("input",n.Type.STRING),this.addOutput("output",n.Type.ANY)}onInputUpdated(){let t=this.getInputData(0);if(!t)return;let e=Buffer.from(t,"hex");this.setOutputData(0,e)}}e.HexStringToBuffer=r,o.Container.registerNodeType("conversion/hex-string-to-buffer",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(82),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.conversion["int-to-buffer"].title,this.description=r.NODE_INFO.conversion["int-to-buffer"].description,this.addInput("in 1",o.Type.ANY),this.addOutput("out",o.Type.JSON),this.addOutput("out data",o.Type.JSON),this.settings.dataType=o.NodeSetting.create({description:"Set data type",type:o.SettingType.DROPDOWN,config:{items:[{value:0,text:"na"},{value:1,text:"INT-16"},{value:2,text:"UINT-16"},{value:3,text:"INT-32"},{value:4,text:"UINT-32"},{value:5,text:"FLOAT-32"},{value:8,text:"DOUBLE-64"}]},value:0}),this.settings.dataEndian=o.NodeSetting.create({description:"Set byte order",type:o.SettingType.DROPDOWN,config:{items:[{value:0,text:"LE-Byte BE-Word"},{value:1,text:"LE-Byte LE-Word"},{value:2,text:"BE-Byte LE-Word"},{value:3,text:"BE-Byte BE-Word"}]},value:0})}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.settings.dataEndian.value,i=this.settings.dataType.value,s=a.default.writeValue(t,i,e);this.setOutputData(0,JSON.stringify(s)),this.setOutputData(1,JSON.parse(JSON.stringify(s)).data)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("conversion/int-to-buffer",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(0),o=i(3),a=i(2),r=i(1);class u extends o.Node{constructor(){super(),this.title=a.NODE_INFO.count["any-event-counter"].title,this.description=a.NODE_INFO.count["any-event-counter"].description,this.addInput("input"),this.addInput("reset",r.Type.BOOLEAN),this.addOutput("count",r.Type.NUMBER),this.addOutput("toggle",r.Type.NUMBER),this.settings.null=r.NodeSetting.create({description:"Stop count if input is null",value:!1,type:r.SettingType.BOOLEAN}),this.properties.count=0}onAdded(){this.setOutputData(0,0),this.setOutputData(1,!1),this.onInputUpdated()}onInputUpdated(){const t=this.inputs[0].updated,e=this.inputs[0].data,i=this.inputs[1].data;i&&1==i&&(this.properties.count=0),this.settings.null.value&&this.isNull(e)||(t&&(this.properties.count++,this.setOutputData(1,!this.outputs[1].data)),this.properties.count!==e&&(this.setOutputData(0,this.properties.count),this.persistProperties(!1,!0)))}isNull(t){return s.isNull(t)}}n.Container.registerNodeType("count/any-event-counter",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.count.counter.title,this.description=a.NODE_INFO.count.counter.description,this.addInputWithSettings("set value",o.Type.NUMBER,0,"Set Value"),this.addInput("count up",o.Type.BOOLEAN),this.addInput("count down",o.Type.BOOLEAN),this.addInput("reset",o.Type.BOOLEAN),this.addOutput("count",o.Type.NUMBER),this.properties.pointVal=0}onCreated(){}onAdded(){this.setOutputData(1,!1),this.setOutputData(2,!1),this.lastUp=!1,this.lastDown=!1,this.lastReset=!1,this.onInputUpdated()}onInputUpdated(){const t=this.outputs[0].data,e=this.getInputData(1)||!1,i=this.getInputData(2)||!1,s=this.getInputData(3)||!1;this.inputs[1].updated&&e&&!this.lastUp&&this.properties.pointVal++,this.lastUp=e,this.inputs[2].updated&&i&&!this.lastDown&&this.properties.pointVal--,this.lastDown=i;const n=this.getInputData(0);this.inputs[3].updated&&s&&!this.lastReset&&(this.properties.pointVal=n),this.lastReset=s,this.properties.pointVal!==t&&(this.setOutputData(0,this.properties.pointVal),this.properties.pointVal=this.properties.pointVal,this.persistProperties(!1,!0)),this.setOutputData(0,this.outputs[0].data)}}s.Container.registerNodeType("count/counter",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.count["triggered-ramp"].title,this.description=o.NODE_INFO.count["triggered-ramp"].description,this.addInput("trigger",a.Type.BOOLEAN),this.addInputWithSettings("min",a.Type.NUMBER,0,"min",!1),this.addInputWithSettings("max",a.Type.NUMBER,10,"max",!1),this.addInputWithSettings("step",a.Type.NUMBER,1,"Step Size",!1),this.addInput("reset",a.Type.BOOLEAN),this.addOutput("output",a.Type.NUMBER),this.settings.countOnFalse=a.NodeSetting.create({description:"Also count on true->false?",value:!1,type:a.SettingType.BOOLEAN}),this.settings.rampUpOnly=a.NodeSetting.create({description:"Ramp Up Only",value:!1,type:a.SettingType.BOOLEAN})}onAdded(){this.countUp=!1,this.lastTrigger=!1,this.lastReset=!1,this.currentVal=0,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(1),e=this.getInputData(2);this.currentVal=Number(this.currentVal),this.currentVal<t?this.currentVal=t:this.currentVal>e&&(this.currentVal=e);const i=this.getInputData(4);i&&!this.lastReset&&(this.currentVal=t),this.lastReset=i;const s=this.getInputData(0);if(s!=this.lastTrigger){if(this.settings.countOnFalse.value||s){const i=this.getInputData(3);this.countUp&&this.currentVal+i>e?this.settings.rampUpOnly.value?(this.countUp=!0,this.currentVal=t-i):this.countUp=!1:!this.countUp&&this.currentVal-i<t&&(this.countUp=!0),this.countUp?this.currentVal+=i:this.currentVal-=i}this.lastTrigger=s}this.setOutputData(0,this.currentVal,!0)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("count/triggered-ramp",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1),r=i(7);class u extends n.Node{constructor(){super(),this.title=o.NODE_INFO.count["interval-ramp"].title,this.description=o.NODE_INFO.count["interval-ramp"].description,this.addInputWithSettings("enable",a.Type.BOOLEAN,0,"Enable",!1),this.addInputWithSettings("min",a.Type.NUMBER,0,"min",!1),this.addInputWithSettings("max",a.Type.NUMBER,10,"max",!1),this.addInputWithSettings("step",a.Type.NUMBER,1,"Step Size",!1),this.addInputWithSettings("interval",a.Type.NUMBER,1,"Count Interval",!1),this.addInput("reset",a.Type.BOOLEAN),this.addOutput("output",a.Type.NUMBER),this.settings.time=a.NodeSetting.create({description:"Units",type:a.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]}),this.settings.rampUpOnly=a.NodeSetting.create({description:"Ramp Up Only",value:!1,type:a.SettingType.BOOLEAN})}onAdded(){this.countUp=!0,this.lastInterval=1e3,this.lastReset=!1,this.lastEnable=!0,this.currentVal=0,this.timeoutFunc=setInterval(()=>{const t=this.getInputData(1),e=this.getInputData(2);this.count(t,e),this.setOutputData(0,this.currentVal,!0)},this.lastInterval),this.inputs[4].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(1),e=this.getInputData(2);this.currentVal=Number(this.currentVal),this.currentVal<t?this.currentVal=t:this.currentVal>e&&(this.currentVal=e);const i=Boolean(this.getInputData(5));i&&!this.lastReset&&(this.currentVal=t),this.countUp=!0,this.lastReset=i;let s=this.getInputData(4);s=r.default.timeConvert(s,this.settings.time.value);const n=this.getInputData(0);n&&!this.lastEnable?this.timeoutFunc=setInterval(()=>{this.count(t,e),this.setOutputData(0,this.currentVal,!0)},s):!n&&this.lastEnable?(clearInterval(this.timeoutFunc),this.setOutputData(0,null)):n&&this.lastEnable&&s!==this.lastInterval&&(clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>{this.count(t,e),this.setOutputData(0,this.currentVal,!0)},s)),this.lastInterval=s,this.lastEnable=n}count(t,e){const i=this.getInputData(3);this.countUp&&this.currentVal+i>e?this.settings.rampUpOnly.value?(this.countUp=!0,this.currentVal=t-i):this.countUp=!1:!this.countUp&&this.currentVal-i<t&&(this.countUp=!0),this.countUp?this.currentVal+=i:this.currentVal-=i}onAfterSettingsChange(){this.inputs[4].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}}s.Container.registerNodeType("count/interval-ramp",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.count.waveform.title,this.description=r.NODE_INFO.count.waveform.description,this.addInputWithSettings("enable",o.Type.BOOLEAN,0,"min",!1),this.settings.signalType=o.NodeSetting.create({description:"Signal Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"Ramp",text:"Ramp"},{value:"Sine",text:"Sine"},{value:"Square",text:"Square"},{value:"Triangle",text:"Triangle"},{value:"Sawtooth",text:"Sawtooth"}]},value:"Ramp"}),this.addInputWithSettings("interval",o.Type.NUMBER,1,"Interval",!1),this.addInputWithSettings("period",o.Type.NUMBER,10,"Period",!1),this.addInputWithSettings("amplitude",o.Type.NUMBER,1,"Amplitude",!1),this.addInput("reset",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN),this.settings.intervalTime=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.settings.periodTime=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},intervalTime:{}},{period:{weight:2},periodTime:{}},{amplitude:{}}]}),this.settings.enable=o.NodeSetting.create({description:"Enable",value:!0,type:o.SettingType.BOOLEAN}),this.settings.invert=o.NodeSetting.create({description:"Invert Output",value:!1,type:o.SettingType.BOOLEAN})}onAdded(){this.updateTitle(),this.inputs[1].name=`[interval] (${this.settings.intervalTime.value})`,this.inputs[2].name=`[period] (${this.settings.periodTime.value})`,this.lastReset=!1,this.startTime=Date.now(),this.onInputUpdated()}onExecute(){if(!this.getInputData(0))return;let t=this.getInputData(1);t=a.default.timeConvert(t,this.settings.intervalTime.value);const e=Date.now();this.lastTime||(this.lastTime=e),e-this.lastTime>=t&&this.recalculate()}onInputUpdated(){const t=this.getInputData(4);t&&!this.lastReset&&(this.setOutputData(0,0,!1),this.startTime=Date.now()),this.lastReset=t,this.getInputData(0)&&this.recalculate()}recalculate(){const t=Date.now(),e=this.settings.signalType.value||"Ramp";let i=this.getInputData(2);i=a.default.timeConvert(i,this.settings.periodTime.value)/1e3;const s=this.getInputData(3),n=this.settings.invert.value?-1:1;let o=(t-this.startTime)/1e3%i/i,r=0;switch(e){case"Sine":r=Math.sin(2*Math.PI*o);break;case"Square":r=Math.sign(Math.sin(2*Math.PI*o)),-1===r&&(r=0);break;case"Triangle":r=1-4*Math.abs(Math.round(o-.25)-(o-.25));break;case"Sawtooth":r=o;break;case"Ramp":r=2*Math.abs(Math.round(o)-o)}r*=n*s,this.lastTime=t,this.setOutputData(0,r)}onAfterSettingsChange(){this.updateTitle(),this.inputs[1].name=`[interval] (${this.settings.intervalTime.value})`,this.inputs[2].name=`[period] (${this.settings.periodTime.value})`}updateTitle(){if(!this.settings.signalType.value)return;const t=this.settings.signalType.value;this.title="Waveform ("+t+")"}}s.Container.registerNodeType("count/waveform",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(5),r=i(1);i(14);class u extends n.Node{constructor(){super(),this.obj=[],this.title=o.NODE_INFO.csv["csv-merge-rows"].title,this.description=o.NODE_INFO.csv["csv-merge-rows"].description,this.addInput("original",r.Type.STRING),this.addInput("merge",r.Type.STRING),this.addOutput("output",r.Type.STRING)}onAdded(){this.setOutputData(0,""),this.onInputUpdated()}onInputUpdated(){if(this.side!==a.Side.server)return;if(!this.getInputData(0)||!this.getInputData(1))return;let t=this.getInputData(0).slice(0,this.getInputData(0).length-1),e=this.getInputData(1);e=e.slice(e.indexOf("\n"),e.length-1),t+=e,this.setOutputData(0,t)}}s.Container.registerNodeType("csv/csv-merge-rows",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(5),r=i(1);i(14);class u extends n.Node{constructor(){super(),this.obj=[],this.title=o.NODE_INFO.csv["csv-merge-columns"].title,this.description=o.NODE_INFO.csv["csv-merge-columns"].description,this.addInput("original",r.Type.STRING),this.addInput("merge",r.Type.STRING),this.addOutput("output",r.Type.STRING)}onAdded(){this.setOutputData(0,""),this.onInputUpdated()}onInputUpdated(){if(this.side!==a.Side.server)return;if(!this.getInputData(0)||!this.getInputData(1))return;let t=this.getInputData(0).split("\n"),e=this.getInputData(1).split("\n"),i="";const s=t[0].split(",").length,n=e[0].split(",").length;var o=0;for(o=0;o<Math.min(e.length,t.length)-1;o++)i+=t[o]+", "+e[o]+"\n";for(var r=0;o<t.length-1;){for(i+=t[o],r=s;r<s+n;)i+=", ",r++;i+="\n",o++}for(;o<e.length-1;){for(r=n;r<s+n;)i+=", ",r++;i+=e[o],i+="\n",o++}this.setOutputData(0,i)}}s.Container.registerNodeType("csv/csv-merge-columns",u)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),o=i(0),a=i(3),r=i(2),u=i(5),d=i(1),l=i(46),p=i(47);class h extends a.Node{constructor(){super(),this.title=r.NODE_INFO.cumulocity["cumulocity-device"].title,this.description=r.NODE_INFO.cumulocity["cumulocity-device"].description,this.addInput("createDevice",d.Type.BOOLEAN),this.addOutput("id",d.Type.NUMBER),this.addOutput("message",d.Type.STRING),this.settings.CumulocityDeviceName=d.NodeSetting.create({description:"Cumulocity Device Name",value:"",type:d.SettingType.STRING})}onAdded(){return s(this,void 0,void 0,(function*(){yield this.onAfterSettingsChange()}))}onInputUpdated(){return s(this,void 0,void 0,(function*(){this.side===u.Side.server&&this.getInputData(0)&&this.inputs[0].updated&&(this.outputs[0].data&&0==this.outputs[0].data.length&&(yield this.createDevice()),yield this.checkDeviceExists())}))}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){this.side===u.Side.server&&(yield this.checkDeviceExists())}))}getDeviceName(){let t=this.settings.CumulocityDeviceName.value||"unknownDevice";return t.startsWith("c8y_")||(t="c8y_"+t),t}checkDeviceExists(){return s(this,void 0,void 0,(function*(){let t=this.getDeviceName(),e=p.bsaClientConfig("device");e=Object.assign(Object.assign({},e),{method:"GET",url:`${e.url}?query=name+eq+${t}`});try{const t=yield n.default(e),i=[];t.data.managedObjects.forEach(t=>{i.push(Number(t.id))}),this.setOutputData(0,i),this.setOutputData(1,null)}catch(t){this.setOutputData(1,String(t))}}))}createDevice(){return s(this,void 0,void 0,(function*(){let t,e;try{t=yield l.default.getClientIdDb()}catch(e){t="unknownClientID"}try{e=yield l.default.getDeviceIdDb()}catch(t){e="unknownDeviceID"}let i=this.getDeviceName(),s=p.bsaClientConfig("device");s=Object.assign(Object.assign({},s),{method:"POST",data:{name:i,type:"c8y_nube",deviceid:e,clientid:t,c8y_IsDevice:{},com_cumulocity_model_Agent:{}}});try{yield n.default(s)}catch(t){this.setOutputData(1,String(t))}}))}}o.Container.registerNodeType("cumulocity/cumulocity-device",h)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),o=i(14),a=i(0),r=i(3),u=i(5),d=i(1),l=i(4),p=i(7),h=i(47),c=i(2);var g;!function(t){t[t.COV=0]="COV",t[t.PERIODIC=1]="PERIODIC",t[t.TRIGGER_ONLY=2]="TRIGGER_ONLY"}(g||(g={}));class m extends r.Node{constructor(){super(),this.valueInput=0,this.interval=-1,this.title=c.NODE_INFO.cumulocity["cumulocity-point"].title,this.description=c.NODE_INFO.cumulocity["cumulocity-point"].description,this.addInput("input",d.Type.ANY)}addHistoryConfiguration(){this.addInput("histTrigger",d.Type.BOOLEAN),this.addInput("clearStoredHis",d.Type.BOOLEAN),this.addOutput("histError",d.Type.ANY),this.addOutput("storedHistCount",d.Type.NUMBER),this.addOutput("lastHistExport",d.Type.STRING),this.settings.enable=d.NodeSetting.create({description:"History Enable",value:!1,type:d.SettingType.BOOLEAN}),this.settings.CumulocityDeviceID=d.NodeSetting.create({description:"Cumulocity Device ID (Number)",value:"",type:d.SettingType.STRING}),this.settings.CumulocityPointName=d.NodeSetting.create({description:"Measurement Name",value:"",type:d.SettingType.STRING}),this.settings.CumulocityPointType=d.NodeSetting.create({description:"Measurement Type",value:"",type:d.SettingType.STRING}),this.settings.CumulocitySeries=d.NodeSetting.create({description:"Series Name",value:"",type:d.SettingType.STRING}),this.settings.historyMode=d.NodeSetting.create({description:"History Logging Mode",type:d.SettingType.DROPDOWN,config:{items:[{value:g.COV,text:"Change Of Value (COV)"},{value:g.PERIODIC,text:"Periodic"},{value:g.TRIGGER_ONLY,text:"Trigger Only"}]},value:g.COV}),this.settings.dataType=d.NodeSetting.create({description:"Data type for storing",type:d.SettingType.DROPDOWN,config:{items:[{value:d.Type.NUMBER,text:"Number"},{value:d.Type.BOOLEAN,text:"Boolean"},{value:d.Type.STRING,text:"String"}]},value:d.Type.NUMBER}),this.settings.threshold=d.NodeSetting.create({description:"COV Threshold",value:0,type:d.SettingType.NUMBER}),this.settings.period=d.NodeSetting.create({description:"Logging Interval",value:15,type:d.SettingType.NUMBER}),this.settings.periodUnits=d.NodeSetting.create({description:"Units",type:d.SettingType.DROPDOWN,config:{items:[{value:p.TIME_TYPE.MILLISECONDS,text:"Milliseconds"},{value:p.TIME_TYPE.SECONDS,text:"Seconds"},{value:p.TIME_TYPE.MINUTES,text:"Minutes"},{value:p.TIME_TYPE.HOURS,text:"Hours"}]},value:p.TIME_TYPE.MINUTES}),this.settings["storage-limit"]=d.NodeSetting.create({description:"Local Storage Limit (Max 50)",value:25,type:d.SettingType.NUMBER}),this.settings.minuteRoundValue=d.NodeSetting.create({description:"Round minutes up in increments of",value:0,type:d.SettingType.NUMBER}),this.settings.decimals=d.NodeSetting.create({description:"Decimal Places (Limit 5)",value:3,type:d.SettingType.NUMBER}),this.settings.timeAsString=d.NodeSetting.create({description:"Display Timestamp as",type:d.SettingType.DROPDOWN,config:{items:[{value:!1,text:"Numeric"},{value:!0,text:"String"}]},value:!0}),this.settings.units=d.NodeSetting.create({description:"Units",value:"",type:d.SettingType.STRING}),this.properties.obj=[]}setup(){this.addHistoryConfiguration()}init(){this.assignInputsOutputs()}onAdded(){this.assignInputsOutputs(),this.resetOutputs(),this.doPeriodicHistoryFunctions()}onInputUpdated(){return s(this,void 0,void 0,(function*(){this.getInputData(this.clearStoredHisInput)&&(this.properties.obj=[],this.updateHistoryCountOutput()),yield this.doNonPeriodicHistoryFunctions()}))}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){yield this.doNonPeriodicHistoryFunctions(),this.doPeriodicHistoryFunctions()}))}onRemoved(){clearInterval(this.timeoutFunc)}assignInputsOutputs(){for(let t in this.inputs)this.inputs.hasOwnProperty(t)&&("histTrigger"==this.inputs[t].name&&(this.histTriggerInput=Number(t)),"clearStoredHis"==this.inputs[t].name&&(this.clearStoredHisInput=Number(t)));for(let t in this.outputs)this.outputs.hasOwnProperty(t)&&("histError"==this.outputs[t].name?this.histErrorOutput=Number(t):"storedHistCount"==this.outputs[t].name?this.storedHistCountOutput=Number(t):"lastHistExport"==this.outputs[t].name&&(this.lastHistExportOutput=Number(t)))}resetOutputs(){this.updateHistoryCountOutput()}doNonPeriodicHistoryFunctions(){return s(this,void 0,void 0,(function*(){if(this.side!==u.Side.server)return;if(!this.settings.enable.value)return;const t=this.getInputData(this.valueInput);this.checkTriggered()?yield this.storeLogEntry(t):this.checkCOV(t)&&(yield this.storeLogEntry(t)),this.properties.obj.length>0&&(yield this.trySendStoredData())}))}trySendStoredData(){return s(this,void 0,void 0,(function*(){let t=this.settings.decimals.value;t=l.default.clamp(t,0,5);const e=[];let i=this.settings.CumulocityPointName.value||"c8y_unknownPoint";i.startsWith("c8y_")||(i="c8y_"+i);let s=this.settings.CumulocityPointType.value||"c8y_unknownType";s.startsWith("c8y_")||(s="c8y_"+s);const a=this.settings.CumulocitySeries.value||"unknownSeries";this.properties.obj.forEach(n=>{const o=this.settings.dataType.value;n.payload=this.convertInput(n.payload,o,t),e.push({source:{id:this.settings.CumulocityDeviceID.value},time:n.timestamp,type:s,[i]:{[a]:{value:n.payload,unit:String(this.settings.units.value)||"undefined"}}})}),this.debugInfo(`SENDING DATA: ${JSON.stringify(e)}`);let r=h.bsaClientConfig("measurement");r=Object.assign(Object.assign({},r),{method:"POST",data:{measurements:e}});try{const t=yield n.default(r);this.debugInfo(`RESPONSE FROM SERVER: ${JSON.stringify(t.data)}`),this.properties.obj=[],this.persistProperties(!1,!0),this.setOutputData(this.histErrorOutput,""),this.settings.timeAsString.value?this.setOutputData(this.lastHistExportOutput,o().format(),!0):this.setOutputData(this.lastHistExportOutput,o().valueOf(),!0),this.updateHistoryCountOutput()}catch(t){this.debugErr(`ERROR: ${t}`),this.setOutputData(this.histErrorOutput,t)}}))}storeLogEntry(t){return s(this,void 0,void 0,(function*(){if(null==t)return;const e=l.default.clamp(this.settings["storage-limit"].value,0,50),i=l.default.clamp(this.settings.minuteRoundValue.value,0,60),s=i?p.default.nearestFutureMinutes(i,o()):o(),n={payload:t,timestamp:s.toISOString()};for(this.properties.obj.push(n);this.properties.obj.length>e;)this.properties.obj.shift();this.properties.lastHistoryValue=t,this.persistProperties(!1,!0),this.updateHistoryCountOutput()}))}checkTriggered(){return this.settings.historyMode.value===g.TRIGGER_ONLY&&this.getInputData(this.histTriggerInput)&&this.inputs[this.histTriggerInput].updated}checkCOV(t){if(this.settings.historyMode.value===g.COV){const e=this.settings.threshold.value;return isNaN(t)||isNaN(this.properties.lastHistoryValue)?t!==this.properties.lastHistoryValue:Math.abs(Number(t)-Number(this.properties.lastHistoryValue))>=e}return!1}doPeriodicHistoryFunctions(){if(this.side!==u.Side.server)return;const t=this.settings.enable.value,e=this.settings.historyMode.value===g.PERIODIC;if(t&&e||this.timeoutFunc&&(this.interval=-1,clearInterval(this.timeoutFunc),this.debugInfo("Clearing Periodic interval data insertion...")),t&&e){const t=p.default.timeConvert(this.settings.period.value,this.settings.periodUnits.value);this.interval!==t&&(clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>s(this,void 0,void 0,(function*(){const t=this.getInputData(this.valueInput);yield this.storeLogEntry(t),this.properties.obj.length>0&&(yield this.trySendStoredData())})),t),this.interval=t,this.debugInfo(`Setting Periodic Period of: ${t} ms`))}}updateHistoryCountOutput(){this.setOutputData(this.storedHistCountOutput,this.properties.obj&&this.properties.obj.length||0)}}a.Container.registerNodeType("cumulocity/cumulocity-point",m)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),o=i(17),a=i(0),r=i(3),u=i(5),d=i(1),l=i(47),p=i(2);let h=i(14);var c;!function(t){t.WARNING="WARNING",t.MINOR="MINOR",t.MAJOR="MAJOR",t.CRITICAL="CRITICAL"}(c||(c={}));const g={items:[{value:c.WARNING,text:c.WARNING},{value:c.MINOR,text:c.MINOR},{value:c.MAJOR,text:c.MAJOR},{value:c.CRITICAL,text:c.CRITICAL}]};class m extends r.Node{constructor(){super(),this.title=p.NODE_INFO.cumulocity["cumulocity-alarm"].title,this.description=p.NODE_INFO.cumulocity["cumulocity-alarm"].description,this.addInput("alarmInput",d.Type.BOOLEAN),this.addInputWithSettings("alarmText",d.Type.STRING,"No Alarm Message Available","Enter Alarm Message"),this.addInputWithSettings("alarmClass",d.Type.DROPDOWN,c.WARNING,"Alarm Class",!1,g),this.addOutput("status",d.Type.BOOLEAN),this.addOutput("error",d.Type.STRING),this.settings.enable=d.NodeSetting.create({description:"Alarm Enable",value:!0,type:d.SettingType.BOOLEAN}),this.settings.CumulocityDeviceID=d.NodeSetting.create({description:"Cumulocity Device ID (Number)",value:"",type:d.SettingType.STRING}),this.settings.CumulocityAlarmName=d.NodeSetting.create({description:"Alarm Name",value:"",type:d.SettingType.STRING})}onCreated(){o.isEmpty(this.properties.alarmRegistry)&&(this.properties.alarmRegistry={})}onInputUpdated(){return s(this,void 0,void 0,(function*(){this.side===u.Side.server&&this.settings.enable.value&&this.inputs[0].updated&&(yield this.postAlarm(this.getInputData(0)))}))}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){yield this.onInputUpdated()}))}postAlarm(t){return s(this,void 0,void 0,(function*(){let e=this.settings.CumulocityAlarmName.value||"c8y_unknownAlarm";e.startsWith("c8y_")||(e="c8y_"+e);let i=l.bsaClientConfig("alarm");if(t){i=Object.assign(Object.assign({},i),{method:"POST",data:{source:{id:this.settings.CumulocityDeviceID.value},text:this.getInputData(1),time:h().toISOString(),type:e,status:"ACTIVE",severity:this.getInputData(2)}});try{const t=yield n.default(i);this.setOutputData(0,!0),this.setOutputData(1,!1),this.properties.alarmRegistry[e]=t.data.id,this.debugInfo(`ALARM_REGISTRY ${JSON.stringify(this.properties.alarmRegistry)}`)}catch(t){this.debugErr(t),this.setOutputData(0,!1),this.setOutputData(1,t)}}else if(!t){const t=this.properties.alarmRegistry[e];if(!t)return;i=Object.assign(Object.assign({},i),{method:"PUT",url:`alarm/alarms/${t}`,data:{status:"CLEARED"}});try{yield n.default(i),this.setOutputData(0,!1),this.setOutputData(1,!1),delete this.properties.alarmRegistry[e],this.debugInfo(`Cleared alarm ${e}`),this.debugInfo(`ALARM_REGISTRY ${JSON.stringify(this.properties.alarmRegistry)}`)}catch(t){this.debugErr(`ERROR ${t}`),this.setOutputData(0,!1),this.setOutputData(1,t)}}this.persistProperties(!1,!0)}))}}a.Container.registerNodeType("cumulocity/cumulocity-alarm",m)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),o=i(0),a=i(3),r=i(2),u=i(5),d=i(1),l=i(4),p=i(7),h=i(47);class c extends a.Node{constructor(){super(),this.ENABLESLOT=0,this.TRIGGERSLOT=1,this.OUTPUTSTARTSLOT=3,this.title=r.NODE_INFO.cumulocity["cumulocity-operation"].title,this.description=r.NODE_INFO.cumulocity["cumulocity-operation"].description,this.addInputWithSettings("enable",d.Type.BOOLEAN,!0,"Enable"),this.addInput("trigger",d.Type.BOOLEAN),this.addOutput("error",d.Type.BOOLEAN),this.addOutput("message",d.Type.STRING),this.addOutput("numExecuting",d.Type.NUMBER),this.settings.CumulocityDeviceID=d.NodeSetting.create({description:"Cumulocity Device ID (Number)",value:"",type:d.SettingType.STRING}),this.settings.interval=d.NodeSetting.create({description:"Update Interval (min 15 seconds)",type:d.SettingType.NUMBER,value:1}),this.settings.time=d.NodeSetting.create({description:"Units",type:d.SettingType.DROPDOWN,config:{items:[{value:p.TIME_TYPE.SECONDS,text:"Seconds"},{value:p.TIME_TYPE.MINUTES,text:"Minutes"},{value:p.TIME_TYPE.HOURS,text:"Hours"}]},value:p.TIME_TYPE.MINUTES}),this.settings.operationsCount=d.NodeSetting.create({description:"Number of Operations",value:1,type:d.SettingType.NUMBER}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]})}init(){this.EXECUTE_INTERVAL=Math.max(15e3,p.default.timeConvert(this.settings.interval.value,this.settings.time.value)),this.properties.operationsCount=0,this.changeTopicsCount(this.settings.operationsCount.value),this.setOutputData(this.OUTPUTSTARTSLOT,null)}onCreated(){}onAdded(){this.side===u.Side.server&&(this.EXECUTE_INTERVAL=Math.max(15e3,p.default.timeConvert(this.settings.interval.value,this.settings.time.value)),this.restoreOperationValues(),this.onAfterSettingsChange())}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){if(this.side!==u.Side.server)return;let t=this.settings.operationsCount.value;t=l.default.clamp(t,1,100),this.changeTopicsCount(t),this.renameOutputs(),this.broadcastOutputsToClients(),this.checkOperationsExist(),this.checkOperationsExecuting(),this.storeOperationValues()}))}onInputUpdated(){return s(this,void 0,void 0,(function*(){this.side===u.Side.server&&this.getInputData(this.ENABLESLOT)&&this.getInputData(this.TRIGGERSLOT)&&this.inputs[this.TRIGGERSLOT]&&this.checkOperationsExecuting()}))}onExecute(){console.log("onExecute()"),this.getInputData(0)&&this.checkOperationsExecuting()}checkOperationsExist(){return s(this,void 0,void 0,(function*(){const t=yield this.getDeviceOperations("ALL");console.log("ALLoperations",t);const e=this.properties.operationsArray||[],i=this.makeOperationsArray();console.log("OPERATIONS ARRAY",i),this.setNewOperationsToNull(e,i),i.length>0&&i.forEach((e,n)=>s(this,void 0,void 0,(function*(){if(null!=e&&"undefined"!=e&&""!=e){t.some(t=>t.c8y_control.measurementName==e)||(console.log(`CREATING OPERATION ${i[n]}`),yield this.createOperation(i[n]),this.setOutputData(this.OUTPUTSTARTSLOT+n,null))}})))}))}createOperation(t){return s(this,void 0,void 0,(function*(){const e=this.settings.CumulocityDeviceID.value;let i=h.bsaClientConfig("operation");i=Object.assign(Object.assign({},i),{method:"POST",data:{deviceId:e,deviceName:this.properties.CumulocityDeviceName,c8y_control:{originalValue:"",assetName:"Nube-io Wires",measurementName:t,changedValue:""},description:t}});try{yield n.default(i).then((function(t){}))}catch(t){this.setOutputData(0,!0),this.setOutputData(1,String(t)),console.log("AXIOS Response: ",t)}}))}makeOperationsArray(){let t=[];for(var e=1;e<=this.properties.operationsCount;e++)t.push(this.settings["operation"+e].value);return this.properties.operationsArray=t,t}checkOperationsExecuting(){return s(this,void 0,void 0,(function*(){const t=this.makeOperationsArray(),e=yield this.getDeviceOperations("EXECUTING");this.setOutputData(2,e.length),console.log("EXECUTING OPERATIONS",e),e.length>0&&e.forEach(e=>s(this,void 0,void 0,(function*(){var i=e.c8y_control.measurementName;const s=e.c8y_control.changedValue,n=e.id;var o=-1;t.includes(i)&&(o=t.indexOf(i)),o>=0&&(this.setOutputData(this.OUTPUTSTARTSLOT+o,s),yield this.operationSuccess(n))}))),this.storeOperationValues()}))}getDeviceOperations(t){return s(this,void 0,void 0,(function*(){if("EXECUTING"!=t&&"PENDING"!=t&&"ALL"!=t)return[];let e=this.settings.CumulocityDeviceID.value,i=h.bsaClientConfig("operation");i.headers={},i=Object.assign(Object.assign({},i),{method:"GET"}),"EXECUTING"==t?i.url=`${i.url}?status=EXECUTING&deviceId=${e}`:"ALL"==t&&(i.url=`${i.url}?deviceId=${e}`);let s=!1;this.properties[`${t}operations`]=[];try{var n=i;do{n=yield this.readNextOperation(this,n,t)}while(n)}catch(s){this.setOutputData(0,!0),this.setOutputData(1,String(s))}return this.properties[`${t}operations`]}))}readNextOperation(t,e,i){return s(this,void 0,void 0,(function*(){if("EXECUTING"!=i&&"PENDING"!=i&&"ALL"!=i)return!1;var o=!1,a="";return yield n.default(e).then((function(n){return s(this,void 0,void 0,(function*(){n.data.hasOwnProperty("operations")&&n.data.operations.length>0?(t.properties[`${i}operations`]=t.properties[`${i}operations`].concat(n.data.operations),a="https://bsaautomation"+n.data.next.slice(n.data.next.indexOf(".apj.cumulocity.com")),e=Object.assign(Object.assign({},e),{method:"GET",url:a}),o=e):o=!1}))})).catch((function(t){throw console.log("AXIOS Error: ",t),t})),o}))}operationSuccess(t){return s(this,void 0,void 0,(function*(){this.settings.CumulocityDeviceID.value;let e=h.bsaClientConfig("operation");e=Object.assign(Object.assign({},e),{method:"PUT",data:{status:"SUCCESSFUL"}}),e.url=e.url+"/"+t;try{yield n.default(e).then((function(t){}))}catch(t){this.setOutputData(0,!0),this.setOutputData(1,String(t)),console.log("AXIOS Response: ",t)}}))}restoreOperationValues(){this.properties.operationsValues.forEach((t,e)=>{this.setOutputData(this.OUTPUTSTARTSLOT+e,t)})}storeOperationValues(){let t=[];this.properties.operationsArray.forEach((e,i)=>{this.outputs[this.OUTPUTSTARTSLOT+i].hasOwnProperty("data")?t.push(this.outputs[this.OUTPUTSTARTSLOT+i].data):t.push(null)}),this.properties.operationsValues=t,this.persistProperties(!0,!0)}setNewOperationsToNull(t,e){e.forEach((e,i)=>{(i>=t.length||t[i]!=e)&&this.setOutputData(this.OUTPUTSTARTSLOT+i,null)})}changeTopicsCount(t){this.properties.operationsCount=this.getOutputsCount()-this.OUTPUTSTARTSLOT;const e=t-this.properties.operationsCount;if(0!=e){if(this.changeOutputsCount(t+this.OUTPUTSTARTSLOT,d.Type.ANY),e>0)for(let e=this.properties.operationsCount+1;e<=t;e++)this.settings["operation"+e]=d.NodeSetting.create({description:"Operation "+e,value:"",type:d.SettingType.STRING});else if(e<0)for(let e=this.properties.operationsCount;e>t;e--)delete this.settings["operation"+e];this.properties.operationsCount=t}}renameOutputs(){var t;for(let e=0;e<=this.properties.operationsCount-1;e++){let i=(null===(t=this.settings["operation"+(e+1)])||void 0===t?void 0:t.value)||"undefined";(null==i?void 0:i.length)>20&&(i="..."+i.substr(i.length-20,20)),this.outputs[String(e+this.OUTPUTSTARTSLOT)].name=e+1+" | "+i}}}o.Container.registerNodeType("cumulocity/cumulocity-operation",c)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FunctionNode=void 0;const s=i(0),n=i(187),o=i(2);class a extends n.BaseFunctionNode{constructor(){super(o.NODE_INFO["custom-function"].function.title,o.NODE_INFO["custom-function"].function.description),this.mixinScriptSetting("// message is the received value\nreturn message;")}getScriptInput(){return this.getInputData(0)}}e.FunctionNode=a,s.Container.registerNodeType("custom-function/function",a)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseFunctionNode=void 0;const s=i(188),n=i(6),o=i(3),a=i(5),r=i(1);class u extends o.Node{constructor(t,e){super(),this.title=t,this.description=e,this.addInput("message"),this.addOutput("output"),this.addOutput("error")}onCreated(){}onAdded(){}onInputUpdated(){try{this.executeConfiguredScript(this.getScriptInput()).then(t=>this.emitResult(t)).catch(t=>this.emitError(t))}catch(t){this.emitError(t)}}onAfterSettingsChange(){this.onInputUpdated()}executeConfiguredScript(...t){const e=this.settings.script.value;if(this.side!==a.Side.server||n.isEmpty(e))return;let i=new s.NodeVM({timeout:1e3,sandbox:{}}).run(`module.exports = function(message, ...args) {\n${e}\n};`);return Promise.resolve(i(...t))}emitResult(t){this.setOutputData(0,t),this.setOutputData(1,null)}emitError(t){this.setOutputData(0,null),this.debugErr(`Error when executing function node ${t.stack}`),this.setOutputData(1,t)}mixinScriptSetting(t){this.settings.script=r.NodeSetting.create({description:"Function Code",value:t,type:r.SettingType.CODE_AREA})}}e.BaseFunctionNode=u},function(t,e){t.exports=require("vm2")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(83),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["custom-function"].uuid.title,this.description=a.NODE_INFO["custom-function"].uuid.description,this.addInput("trigger"),this.addOutput("uuid-out-8"),this.addOutput("uuid-out-12"),this.addOutput("uuid-out-28")}onInputUpdated(){const t=o.default.create8DigId(),e=o.default.create12DigId(),i=o.default.createUUID();this.setOutputData(0,t),this.setOutputData(1,e),this.setOutputData(2,i)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("custom-function/uuid",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiLabelNode=void 0;const s=i(0),n=i(2),o=i(4),a=i(23);class r extends a.UiNode{constructor(t,e,i){super("Label","UiLabelNode",i),this.title=n.NODE_INFO.dashboard.label.title,this.description=n.NODE_INFO.dashboard.label.description,this.addInput("input"),this.UPDATE_INPUTS_INTERVAL=100}onInputUpdated(){const t=o.default.formatValue(this.getInputData(0));this.setState(t),this.isRecentlyActive=!0}}e.UiLabelNode=r,s.Container.registerNodeType("dashboard/label",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiButtonNode=void 0;const s=i(0),n=i(2),o=i(5),a=i(1),r=i(23);class u extends r.UiNode{constructor(t,e,i){super("Button","UiButtonNode",i),this.interval=null,this.title=n.NODE_INFO.dashboard.button.title,this.description=n.NODE_INFO.dashboard.button.description,this.addOutput("output",a.Type.BOOLEAN),this.settings["button-text"]=a.NodeSetting.create({description:"Button Text",value:"ON",type:a.SettingType.STRING}),this.setState({buttonText:"ON"})}onAfterSettingsChange(){this.side,o.Side.server}onRemoved(){super.onRemoved()}onGetMessageToServerSide(){this.setOutputData(0,!0),this.sendIOValuesToEditor()}}e.UiButtonNode=u,s.Container.registerNodeType("dashboard/button",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiSwitchNode=void 0;const s=i(0),n=i(5),o=i(1),a=i(23),r=i(2);class u extends a.UiNode{constructor(t,e,i){super("Switch","UiSwitchNode",i),this.title=r.NODE_INFO.dashboard.switch.title,this.description=r.NODE_INFO.dashboard.switch.description,this.setState(!1),this.addInput("input",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN)}onAdded(){super.onAdded(),this.side==n.Side.server&&this.setOutputData(0,this.getState())}onGetMessageToServerSide(t){this.setValue(t.state)}onInputUpdated(){let t=this.getInputData(0);this.setValue(t)}setValue(t){this.setOutputData(0,t),this.sendIOValuesToEditor(),this.isRecentlyActive=!0,this.getState()!=t&&this.setState(t)}}e.UiSwitchNode=u,s.Container.registerNodeType("dashboard/switch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiProgressNode=void 0;const s=i(0),n=i(2),o=i(1),a=i(23);class r extends a.UiNode{constructor(t,e,i){super("Progress","UiProgressNode",i),this.title=n.NODE_INFO.dashboard.progress.title,this.description=n.NODE_INFO.dashboard.progress.description,this.addInput("input",o.Type.NUMBER),this.UPDATE_INPUTS_INTERVAL=100,this.setState(0)}onInputUpdated(){let t=this.getInputData(0);t>100&&(t=100),t<0&&(t=0),this.setState(t),this.isRecentlyActive=!0}}e.UiProgressNode=r,s.Container.registerNodeType("dashboard/progress",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiSliderNode=void 0;const s=i(0),n=i(2),o=i(5),a=i(1),r=i(23);class u extends r.UiNode{constructor(t,e,i){super("Slider","UiSliderNode",i),this.title=n.NODE_INFO.dashboard.slider.title,this.description=n.NODE_INFO.dashboard.slider.description,this.addInput("input",a.Type.NUMBER),this.addOutput("output",a.Type.NUMBER),this.UPDATE_INPUTS_INTERVAL=100,this.setState(0)}onAdded(){super.onAdded(),this.side==o.Side.server&&this.setOutputData(0,this.getState())}onGetMessageToServerSide(t){this.setValue(t.state)}onInputUpdated(){let t=this.getInputData(0);this.setValue(t)}setValue(t){t>100&&(t=100),t<0&&(t=0),this.setOutputData(0,t),this.sendIOValuesToEditor(),this.isRecentlyActive=!0,this.getState()!=t&&this.setState(t)}}e.UiSliderNode=u,s.Container.registerNodeType("dashboard/slider",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiTextBoxNode=void 0;const s=i(0),n=i(5),o=i(1),a=i(23),r=i(2);class u extends a.UiNode{constructor(t,e,i){super("TextBox","UiTextBoxNode",i),this.title=r.NODE_INFO.dashboard["text-box"].title,this.description=r.NODE_INFO.dashboard["text-box"].description,this.setState(""),this.addInput("input",o.Type.STRING),this.addOutput("output",o.Type.STRING)}onAdded(){super.onAdded(),this.side==n.Side.server&&this.setOutputData(0,this.getState())}onGetMessageToServerSide(t){this.setValue(t.state)}onInputUpdated(){let t=this.getInputData(0);this.setValue(t)}setValue(t){this.setOutputData(0,t),this.sendIOValuesToEditor(),this.isRecentlyActive=!0,this.getState()!=t&&this.setState(t)}}e.UiTextBoxNode=u,s.Container.registerNodeType("dashboard/text-box",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiLogNode=void 0;const s=i(0),n=i(2),o=i(5),a=i(1),r=i(23);class u extends r.UiNode{constructor(t,e,i){super("Log","UiLogNode",i),this.messagesPerSec=0,this.title=n.NODE_INFO.dashboard.log.title,this.description=n.NODE_INFO.dashboard.log.description,this.properties.log=[],this.settings.maxRecords=a.NodeSetting.create({description:"Max Records",value:10,type:a.SettingType.NUMBER}),this.settings.maxRecordsPerSec=a.NodeSetting.create({description:"Max records/sec limit",value:11,type:a.SettingType.NUMBER}),this.settings.saveToDb=a.NodeSetting.create({description:"Save log to DB",value:!1,type:a.SettingType.BOOLEAN}),this.addInput("input")}onAdded(){super.onAdded(),this.side==o.Side.server&&this.updateMessPerSec()}onAfterSettingsChange(t){this.side==o.Side.server&&t.maxRecords!=this.settings.maxRecords&&(this.removeOldRecords(),this.sendMessageToDashboardSide({maxRecords:this.settings.maxRecords.value}))}onDbReaded(){let t=[];this.properties.log.forEach(e=>t.unshift(e)),this.properties.log=t}removeOldRecords(){let t=this.properties.log||[],e=this.settings.maxRecords.value,i=t.length-e;t.splice(t.length-i,i)}updateMessPerSec(){setInterval(()=>{if(this.messagesPerSec>this.settings.maxRecordsPerSec.value){let t=this.messagesPerSec-this.settings.maxRecordsPerSec.value,e={date:Date.now(),value:"Dropped "+t+" records (rec/sec limit)"};this.properties.log.unshift(e),this.sendMessageToDashboardSide({record:e})}this.messagesPerSec=0},1e3)}onInputUpdated(){if(!this.inputs[0].link)return;let t=this.getInputData(0);if(this.isRecentlyActive=!0,this.messagesPerSec++,this.messagesPerSec<=this.settings.maxRecordsPerSec.value){let e={date:Date.now(),value:t};this.properties.log&&this.properties.log.unshift(e),this.removeOldRecords(),this.sendMessageToDashboardSide({record:e});let i=this.settings.maxRecords.value;this.container.db&&this.settings.saveToDb.value&&this.container.db.updateNode(this.id,this.container.id,{$push:{"properties.log":{$each:[e],$slice:-i}}})}}onGetMessageToServerSide(t){"getLog"==t?this.sendMessageToDashboardSide({log:this.properties.log,maxRecords:this.settings.maxRecords.value}):"clearLog"==t&&(this.isRecentlyActive=!0,this.properties.log=[],this.sendMessageToDashboardSide({log:[]}),this.container.db&&this.container.db.updateNode(this.id,this.container.id,{$unset:{"properties.log":!0}}))}}e.UiLogNode=u,s.Container.registerNodeType("dashboard/log",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UiChartNode=void 0;const s=i(0),n=i(1),o=i(23),a=i(2);class r extends o.UiNode{constructor(t,e,i){super("Chart","UiChartNode",i),this.UPDATE_INPUTS_INTERVAL=100,this.title=a.NODE_INFO.dashboard.chart.title,this.description=a.NODE_INFO.dashboard.chart.description,this.properties.log=[],this.settings.maxRecords=n.NodeSetting.create({description:"Max Records",value:100,type:n.SettingType.NUMBER}),this.settings.saveToDb=n.NodeSetting.create({description:"Save data to DB",value:!1,type:n.SettingType.BOOLEAN}),this.settings.style=n.NodeSetting.create({description:"Style",value:"bars",type:n.SettingType.STRING}),this.settings.autoscroll=n.NodeSetting.create({description:"Auto scroll",value:"continuous",type:n.SettingType.STRING}),this.addInput("input")}onInputUpdated(){let t=this.getInputData(0),e=this.properties.log,i={x:Date.now(),y:t};e.push(i);let s=this.settings.maxRecords.value;e.splice(0,e.length-s),this.sendMessageToDashboardSide({record:i}),this.container.db&&this.settings.saveToDb.value&&this.container.db.updateNode(this.id,this.container.id,{$push:{"properties.log":{$each:[i],$slice:-s}}})}onGetMessageToServerSide(t){"clear"==t&&(this.isRecentlyActive=!0,this.properties.log=[],this.sendMessageToDashboardSide({log:[]}),this.container.db&&this.settings.saveToDb.value&&this.container.db.updateNode(this.id,this.container.id,{$unset:{"properties.log":!0}})),t.style&&(this.settings.style.value=t.style,this.sendMessageToDashboardSide({style:t.style})),"getLog"==t&&this.sendMessageToDashboardSide({log:this.properties.log,maxRecords:this.settings.maxRecords.value})}}e.UiChartNode=r,s.Container.registerNodeType("dashboard/chart",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConsoleNode=void 0;const s=i(13),n=i(0),o=i(3),a=i(5),r=i(1),u=i(2),d=s.create("node",{color:s.Colors.Magenta});class l extends o.Node{constructor(){super(),this.MAX_MESS_PER_SEC=11,this.messagesPerSec=0,this.title=u.NODE_INFO.debug.console.title,this.description=u.NODE_INFO.debug.console.description,this.addInput("input",r.Type.ANY)}onAdded(){this.side==a.Side.server&&this.updateMessPerSec()}updateMessPerSec(){let t=this;this.timer=setInterval((function(){if(t.messagesPerSec>t.MAX_MESS_PER_SEC){let e=t.messagesPerSec-t.MAX_MESS_PER_SEC;d.info("CONSOLE NODE ["+t.container.id+"/"+t.id+"]: dropped "+e+" messages (data rate limitation)"),t.sendMessageToEditorSide({dropped:e})}t.messagesPerSec=0}),1e3)}onInputUpdated(){if(!this.inputs[0].link)return;let t=this.getInputData(0);this.isRecentlyActive=!0,this.messagesPerSec++,this.messagesPerSec<=this.MAX_MESS_PER_SEC&&(d.info("CONSOLE NODE ["+this.container.id+"/"+this.id+"]: "+t),this.sendMessageToEditorSide({value:t}))}onRemoved(){this.timer&&clearInterval(this.timer)}onGetMessageToEditorSide(t){null!=t.value&&d.info("CONSOLE NODE ["+this.container.id+"/"+this.id+"]: "+t.value),t.dropped&&d.info("CONSOLE NODE ["+this.container.id+"/"+this.id+"]: dropped "+t.dropped+" messages (data rate limitation)")}}e.ConsoleNode=l,n.Container.registerNodeType("debug/console",l)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2);class a extends n.Node{constructor(){super(),this.title=o.NODE_INFO.debug.comments.title,this.description=o.NODE_INFO.debug.comments.description}onAdded(){this.nodeColour()}nodeColour(){this.setNodeState(n.NodeState.INFO)}}s.Container.registerNodeType("debug/comments",a)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WatchNode=void 0;const s=i(0),n=i(3),o=i(5),a=i(1),r=i(2);class u extends n.Node{constructor(){super(),this.dataUpdated=!1,this.UPDATE_INTERVAL=300,this.title=r.NODE_INFO.debug.watch.title,this.description=r.NODE_INFO.debug.watch.description,this.addInput("input",a.Type.ANY)}onAdded(){this.side==o.Side.server&&this.startSending()}startSending(){let t=this;this.timer=setInterval((function(){t.dataUpdated&&(t.dataUpdated=!1,t.sendMessageToEditorSide({value:t.lastData}))}),this.UPDATE_INTERVAL)}onInputUpdated(){this.lastData=this.getInputData(0),this.dataUpdated=!0}onRemoved(){this.timer&&clearInterval(this.timer)}onGetMessageToEditorSide(t){this.lastData=t.value,this.showValueOnInput(t.value)}showValueOnInput(t){this.inputs[0].label=t,this.setDirtyCanvas(!0,!1)}updateInputsLabels(){this.showValueOnInput(this.lastData)}}e.WatchNode=u,s.Container.registerNodeType("debug/watch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LinkErrorCheckNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(1),r=i(19);class u extends n.Node{constructor(){super(),this.title=o.NODE_INFO.error["link-check"].title,this.description=o.NODE_INFO.error["link-check"].description,this.addInput("trigger",a.Type.BOOLEAN),this.addOutput("errorsCount",a.Type.NUMBER),this.addOutput("errorsJSON",a.Type.STRING),this.settings.allContainer=a.NodeSetting.create({description:"Search All Containers?",value:!0,type:a.SettingType.BOOLEAN}),this.settings.subContainers=a.NodeSetting.create({description:"Search Sub-Containers?",value:!0,type:a.SettingType.BOOLEAN}),this.setSettingsConfig({groups:[],conditions:{subContainers:t=>!t.allContainer.value}})}init(){}onCreated(){}onAdded(){this.properties.errors={},this.properties.errorsCount=0,this.lastTrigger=!1,this.setOutputData(0,0),this.setOutputData(1,"{}")}onInputUpdated(){let t=this.getInputData(0);if(t&&!this.lastTrigger){this.properties.errors={},this.properties.errorsCount=0;const t=this.settings.allContainer.value?s.ContainerRegistry.instance().rootContainer():s.ContainerRegistry.instance().get(this.cid),e=!!this.settings.allContainer.value||this.settings.subContainers.value;this.checkLinksForInputOutputData(t,e)}this.lastTrigger=t}onAfterSettingsChange(){}checkLinksForInputOutputData(t,e=!1,i=!0){const n=t.id;let o=[],a=0;const u=t.getAllNodes(),d=u.length;for(let e=0;e<d;e++){if(console.log(e,u[e]),u[e].isContainer){o.push(u[e].id);continue}const i=t.getNodeById(Number(u[e].id));if(!i.hasOwnProperty("outputs"))continue;let s=i.outputs,d=[];for(const t in s)null!=s[t].links&&(console.log("links",t,s[t].links),d.push([t,s[t].data,s[t].links.map(t=>r.Link.create(t))]));console.log("outputLinks",d),d.forEach(s=>{console.log("linkInfo",s),s[2].map(t=>r.Link.create(t)).forEach(o=>{try{let r=!1;const d=t.getNodeById(o.nodeId);console.log("receiver.inputs",d.inputs),d.inputs[o.ioId].data!=s[1]&&(console.log("LINK ERROR: output data does not match input data."),r=!0),d.inputs[o.ioId].link.slot!=s[0]&&d.inputs[o.ioId].link.nodeId!=u[e].id&&(console.log("LINK ERROR: output link reference does not match input link reference."),r=!0),r&&(a++,console.log("ERROR"),this.properties.errors.hasOwnProperty(n)||(this.properties.errors[n]={containerName:t.name,containerErrors:{}}),this.properties.errors[n].containerErrors.hasOwnProperty(u[e].id)||(this.properties.errors[n].containerErrors[u[e].id]={nodeName:u[e].name,nodeErrors:{}}),this.properties.errors[n].containerErrors[u[e].id].nodeErrors[s[0]]={outputName:i.outputs[s[0]].name,outputNum:s[0],inputNode:d.id,inputNodeName:d.name,inputNodeSlot:d.inputs[o.ioId].link.slot})}catch(i){a++,console.log("UNKNOWN ERROR"),this.properties.errors.hasOwnProperty(n)||(this.properties.errors[n]={containerName:t.name,containerErrors:{}}),this.properties.errors[n].containerErrors.hasOwnProperty(u[e].id)||(this.properties.errors[n].containerErrors[u[e].id]={nodeName:u[e].name,nodeErrors:{}})}})})}this.properties.errorsCount+=a,this.properties.errors.hasOwnProperty(n)&&(this.properties.errors[n].errorsCount=a),e&&o.forEach(t=>{this.checkLinksForInputOutputData(s.ContainerRegistry.instance().get(t),e,!1)}),i&&(this.setOutputData(0,this.properties.errorsCount),this.properties.errors.totalErrors=this.properties.errorsCount,this.setOutputData(1,JSON.stringify(this.properties.errors)))}}e.LinkErrorCheckNode=u,s.Container.registerNodeType("error/link-check",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OutputErrorCheckNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.error["output-check"].title,this.description=o.NODE_INFO.error["output-check"].description,this.addInput("trigger",a.Type.BOOLEAN),this.addOutput("errorsCount",a.Type.NUMBER),this.addOutput("errorsJSON",a.Type.STRING),this.settings.allContainer=a.NodeSetting.create({description:"Search All Containers?",value:!0,type:a.SettingType.BOOLEAN}),this.settings.subContainers=a.NodeSetting.create({description:"Search Sub-Containers?",value:!0,type:a.SettingType.BOOLEAN}),this.setSettingsConfig({groups:[],conditions:{subContainers:t=>!t.allContainer.value}})}init(){}onCreated(){}onAdded(){this.properties.errors={},this.properties.errorsCount=0,this.lastTrigger=!1,this.setOutputData(0,0),this.setOutputData(1,"{}")}onInputUpdated(){let t=this.getInputData(0);if(t&&!this.lastTrigger){this.properties.errors={},this.properties.errorsCount=0;const t=this.settings.allContainer.value?s.ContainerRegistry.instance().rootContainer():s.ContainerRegistry.instance().get(this.cid),e=!!this.settings.allContainer.value||this.settings.subContainers.value;this.checkForOutputsWithNoData(t,e)}this.lastTrigger=t}onAfterSettingsChange(){}checkForOutputsWithNoData(t,e=!1,i=!0){const n=t.id;let o=[],a=0;const r=t.getAllNodes(),u=r.length;for(let e=0;e<u;e++){if(r[e].isContainer){o.push(r[e].id);continue}const i=t.getNodeById(Number(r[e].id)).outputs;for(const s in i)i[s].hasOwnProperty("data")&&void 0!==i[s].data||(a++,this.properties.errors.hasOwnProperty(n)||(this.properties.errors[n]={containerName:t.name,containerErrors:{}}),this.properties.errors[n].containerErrors.hasOwnProperty(r[e].id)||(this.properties.errors[n].containerErrors[r[e].id]={nodeName:r[e].name,nodeErrors:{}}),this.properties.errors[n].containerErrors[r[e].id].nodeErrors[s]={outputName:i[s].name,outputNum:s})}this.properties.errorsCount+=a,this.properties.errors.hasOwnProperty(n)&&(this.properties.errors[n].errorsCount=a),e&&o.forEach(t=>{this.checkForOutputsWithNoData(s.ContainerRegistry.instance().get(t),e,!1)}),i&&(this.setOutputData(0,this.properties.errorsCount),this.properties.errors.totalErrors=this.properties.errorsCount,this.setOutputData(1,JSON.stringify(this.properties.errors)))}}e.OutputErrorCheckNode=r,s.Container.registerNodeType("error/output-check",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.filter["only-true"].title,this.description=a.NODE_INFO.filter["only-true"].description,this.addInput("input",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN)}onAdded(){this.setOutputData(0,null),this.onInputUpdated()}onInputUpdated(){!0===this.getInputData(0)&&this.setOutputData(0,!0)}}s.Container.registerNodeType("filter/only-true",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.filter["only-false"].title,this.description=a.NODE_INFO.filter["only-false"].description,this.addInput("input",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN)}onAdded(){this.setOutputData(0,null),this.onInputUpdated()}onInputUpdated(){!1===this.getInputData(0)&&this.setOutputData(0,!1)}}s.Container.registerNodeType("filter/only-false",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.filter["only-between"].title,this.description=a.NODE_INFO.filter["only-between"].description,this.addInput("value",o.Type.NUMBER),this.addInputWithSettings("min",o.Type.NUMBER,0,"min",!1),this.addInputWithSettings("max",o.Type.NUMBER,10,"max",!1),this.addOutput("value",o.Type.NUMBER),this.properties.value}onAdded(){this.setOutputData(0,this.properties.value||null),this.onInputUpdated()}onAfterSettingsChange(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);null==t||null==e||null==i?this.setOutputData(0,null):t>=e&&t<=i&&(this.setOutputData(0,t),this.properties.value=t,this.persistProperties(!1,!0))}}s.Container.registerNodeType("filter/only-between",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.filter["only-greater"].title,this.description=a.NODE_INFO.filter["only-greater"].description,this.addInput("input",o.Type.NUMBER),this.addInputWithSettings("threshold",o.Type.NUMBER,0,"threshold",!1),this.addOutput("output",o.Type.NUMBER),this.properties.value}onAdded(){this.setOutputData(0,this.properties.value||null),this.onInputUpdated()}onAfterSettingsChange(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);null==t||null==e?this.setOutputData(0,null):t>e&&(this.setOutputData(0,t),this.properties.value=t,this.persistProperties(!1,!0))}}s.Container.registerNodeType("filter/only-greater",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.filter["only-lower"].title,this.description=a.NODE_INFO.filter["only-lower"].description,this.addInput("input",o.Type.NUMBER),this.addInputWithSettings("threshold",o.Type.NUMBER,0,"threshold",!1),this.addOutput("output",o.Type.NUMBER),this.properties.value}onAdded(){this.setOutputData(0,this.properties.value||null),this.onInputUpdated()}onAfterSettingsChange(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);null==t||null==e?this.setOutputData(0,null):t<e&&(this.setOutputData(0,t),this.properties.value=t,this.persistProperties(!1,!0))}}s.Container.registerNodeType("filter/only-lower",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.filter["only-equal"].title,this.description=a.NODE_INFO.filter["only-equal"].description,this.addInput("input",o.Type.ANY),this.addInputWithSettings("match",o.Type.ANY,"","Match Value"),this.addOutput("output",o.Type.ANY),this.properties.value}onAdded(){this.setOutputData(0,this.properties.value||null),this.onInputUpdated()}onAfterSettingsChange(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1),i=!1;if("string"==typeof t&&"string"==typeof e)try{t=JSON.stringify(JSON.parse(t)),e=JSON.stringify(JSON.parse(e)),i=t===e}catch(t){}else if("object"==typeof t&&"object"==typeof e)try{t=JSON.stringify(t),e=JSON.stringify(e),i=t===e}catch(t){}i||(t=(t||"").toString(),"false"==t?t=!1:"true"==t&&(t=!0),e=(this.getInputData(1)||"").toString(),"false"==e?e=!1:"true"==e&&(e=!0)),(i||t==e)&&(this.setOutputData(0,t),this.properties.value=t,this.persistProperties(!1,!0))}}s.Container.registerNodeType("filter/only-equal",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(0),o=i(3),a=i(2);class r extends o.Node{constructor(){super(),this.title=a.NODE_INFO.filter["prevent-null"].title,this.description=a.NODE_INFO.filter["prevent-null"].description,this.addInput("input"),this.addOutput("output"),this.properties.value}onAdded(){this.setOutputData(0,this.properties.value),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);s.isNotNull(t)&&""!==t&&(this.setOutputData(0,t),this.properties.value=t,this.persistProperties(!1,!0))}}n.Container.registerNodeType("filter/prevent-null",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.filter["prevent-equal"].title,this.description=a.NODE_INFO.filter["prevent-equal"].description,this.addInput("input",o.Type.ANY),this.addInputWithSettings("match",o.Type.ANY,null,"Match Value"),this.addOutput("output",o.Type.ANY),this.properties.value}onAdded(){this.setOutputData(0,this.properties.value||null),this.onInputUpdated()}onAfterSettingsChange(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1),i=!1;if("string"==typeof t&&"string"==typeof e)try{t=JSON.stringify(JSON.parse(t)),e=JSON.stringify(JSON.parse(e)),i=t===e}catch(t){}else if("object"==typeof t&&"object"==typeof e)try{t=JSON.stringify(t),e=JSON.stringify(e),i=t===e}catch(t){}i||(t=(t||"").toString(),"false"==t?t=!1:"true"==t&&(t=!0),e=(this.getInputData(1)||"").toString(),"false"==e?e=!1:"true"==e&&(e=!0)),i||t==e||(this.setOutputData(0,t),this.properties.value=t,this.persistProperties(!1,!0))}}s.Container.registerNodeType("filter/prevent-equal",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2);class a extends n.Node{constructor(){super(),this.title=o.NODE_INFO.filter["prevent-duplicates"].title,this.description=o.NODE_INFO.filter["prevent-duplicates"].description,this.addInput("input"),this.addOutput("output"),this.properties.value}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);""===t&&(t=null);let e=!1;if("string"==typeof t)try{t=JSON.stringify(JSON.parse(t)),e=t===this.lastVal}catch(t){}else if("object"==typeof t)try{t=JSON.stringify(t),e=t===this.lastVal}catch(t){}e||this.lastVal==t||(this.lastVal=t,this.setOutputData(0,t,!0),this.properties.value=t,this.persistProperties(!1,!0))}}s.Container.registerNodeType("filter/prevent-duplicates",a)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(5),a=i(1),r=i(4),u=i(7),d=i(2),l=i(14);class p extends n.Node{constructor(){super(),this.title=d.NODE_INFO.history["data-store"].title,this.description=d.NODE_INFO.history["data-store"].description,this.addInput("input",a.Type.ANY),this.addInput("clear",a.Type.BOOLEAN),this.addOutput("output",a.Type.ANY),this.addOutput("storedCount",a.Type.NUMBER),this.settings["time-conversation-enable"]=a.NodeSetting.create({description:"Timestamp in system timezone?",value:!1,type:a.SettingType.BOOLEAN}),this.settings["storage-limit"]=a.NodeSetting.create({description:"Storage Limit (Max 50)",value:25,type:a.SettingType.NUMBER}),this.settings["date-iso"]=a.NodeSetting.create({description:"Typestamp Format",type:a.SettingType.DROPDOWN,config:{items:[{value:0,text:"YYYY-MM-DD HH:mm:ss TZ (ISO8601)"},{value:1,text:"YYYY-MM-DD HH:mm:ss"},{value:2,text:"MM-DD-YYYY HH:mm:ss"},{value:3,text:"DD-MM-YYYY HH:mm:ss"},{value:4,text:"DAY, Month DD, YYYY HH:MM AM/PM"},{value:5,text:"Month DD, YYYY HH:MM AM/PM"},{value:6,text:"Unix timestamp in Milliseconds"}]},value:0}),this.settings.outputFormat=a.NodeSetting.create({description:"Output Format",type:a.SettingType.DROPDOWN,config:{items:[{value:"Array",text:"Array"},{value:"CSV",text:"CSV"},{value:"JSON",text:"JSON"}]},value:"Array"}),this.settings.pointName=a.NodeSetting.create({description:"Point Name",value:"",type:a.SettingType.STRING}),this.settings.minuteRoundValue=a.NodeSetting.create({description:"Round minutes up in increments of",value:0,type:a.SettingType.NUMBER}),this.setSettingsConfig({conditions:{pointName:t=>"Array"!=t.outputFormat.value}})}onCreated(){this.properties.historyLog=[]}onAdded(){this.setOutputData(0,this.properties.historyLog),this.setOutputData(1,this.properties.historyLog?this.properties.historyLog.length:0)}nearestFutureMinutes(t,e){const i=Math.ceil(e.minute()/t)*t;return e.clone().minute(i).second(0)}formatOutputs(){const t=this.settings["time-conversation-enable"].value?Intl.DateTimeFormat().resolvedOptions().timeZone:"Etc/UTC";let e=null;const i=this.settings.pointName.value;let s=this.properties.historyLog.map(t=>t);switch(s=s.reverse().map(i=>{switch(this.settings["date-iso"].value){case 0:e=l(i.timestamp).tz(t).format();break;case 1:e=l(i.timestamp).tz(t).format("YYYY-MM-DD HH:mm:ss");break;case 2:e=l(i.timestamp).tz(t).format("MM-DD-YYYY HH:mm:ss");break;case 3:e=l(i.timestamp).tz(t).format("DD-MM-YYYY HH:mm:ss");break;case 4:e=l(i.timestamp).tz(t).format("LLLL");break;case 5:e=l(i.timestamp).tz(t).format("LLL");break;case 6:e=l(i.timestamp).tz(t).valueOf();break;default:e=l(i.timestamp).tz(t).format()}return{payload:i.payload,timestamp:e}}),this.settings.outputFormat.value){case"Array":return s;case"CSV":let t="name, timestamp, payload\n";return s.forEach(e=>{t+=`${i}, ${e.timestamp}, ${e.payload} \n`}),t;case"JSON":return JSON.stringify({[i]:s})}}onInputUpdated(){if(this.side!==o.Side.server)return;if(this.getInputData(1)&&this.inputs[1].updated&&(this.properties.historyLog=[],this.setOutputData(0,this.properties.historyLog.reverse()),this.setOutputData(1,this.properties.historyLog.length)),null==this.getInputData(0)||!this.inputs[0].updated)return;const t=r.default.clamp(this.settings["storage-limit"].value,0,50),e=r.default.clamp(this.settings.minuteRoundValue.value,0,60),i=e?u.default.nearestFutureMinutes(e,l()):l();let s={payload:this.getInputData(0),timestamp:i._d};for(this.properties.historyLog.push(s);this.properties.historyLog.length>t;)this.properties.historyLog.shift();this.persistProperties(!0,!0);const n=this.formatOutputs()||[];this.setOutputData(0,n),this.setOutputData(1,this.properties.historyLog.length)}onAfterSettingsChange(){this.outputs[0].name=`output (${this.settings.outputFormat.value})`,this.broadcastOutputsToClients();const t=this.formatOutputs()||[];this.setOutputData(0,t),this.setOutputData(1,this.properties.historyLog.length)}}s.Container.registerNodeType("history/data-store",p)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(10),n=i(6),o=i(0),a=i(3),r=i(2),u=i(5),d=i(1);let l=i(14);const p=i(57);class h extends a.Node{constructor(){super(),this.inName=0,this.inJsonInput=1,this.outError=0,this.outLastExport=1,this.outMsg=2,this.title=r.NODE_INFO.history["influx-db"].title,this.description=r.NODE_INFO.history["influx-db"].description,this.addInput("[name]",d.Type.STRING),this.addInput("json-input",d.Type.JSON),this.addOutput("error",d.Type.BOOLEAN),this.addOutput("outLastExport",d.Type.STRING),this.addOutput("outMsg",d.Type.STRING),this.settings.enable=d.NodeSetting.create({description:"Enable",value:!1,type:d.SettingType.BOOLEAN}),this.settings.useEnv=d.NodeSetting.create({description:"Dont use env settings",value:!1,type:d.SettingType.BOOLEAN}),this.settings.host=d.NodeSetting.create({description:"Host",value:"0.0.0.0",type:d.SettingType.STRING}),this.settings.port=d.NodeSetting.create({description:"Port",value:"8086",type:d.SettingType.STRING}),this.settings.authentication=d.NodeSetting.create({description:"Use Authentication",value:!1,type:d.SettingType.BOOLEAN}),this.settings.user=d.NodeSetting.create({description:"Username",value:"",type:d.SettingType.STRING}),this.settings.password=d.NodeSetting.create({description:"Password",value:"",type:d.SettingType.STRING}),this.settings.databaseName=d.NodeSetting.create({description:"Database Name",value:"",type:d.SettingType.STRING}),this.setSettingsConfig({groups:[{host:{weight:3},port:{weight:1}},{user:{},password:{}},{period:{weight:2},periodUnits:{}}],conditions:{host:t=>!!t.useEnv.value,port:t=>!!t.useEnv.value,authentication:t=>!!t.useEnv.value,databaseName:t=>!!t.useEnv.value,user:t=>!!t.authentication.value,password:t=>!!t.authentication.value}})}onAdded(){this.createClient()}createClient(){let{protocol:t,host:e,port:i,databaseName:n,username:o,password:a}=s.default.influxDb;this.settings.useEnv.value?(e=this.settings.host.value,i=this.settings.port.value,this.client=new p.InfluxDB({host:e||"localhost",port:+(i||8086),protocol:"http",database:this.settings.databaseName.value||"undefined",username:this.settings.authentication.value?this.settings.user.value:"",password:this.settings.authentication.value?this.settings.password.value:""})):this.client=new p.InfluxDB({host:e,port:+i,protocol:"https"===t?"https":"http",database:n,username:o,password:a})}onInputUpdated(){if(this.side!==u.Side.server)return;if(!this.client)return;if(!this.settings.enable.value)return void this.setOutputData(this.outMsg,"INFLUX-DB NODE: not not enabled",!0);if(this.inputs[0].updated){let t=this.getInputData(this.inName);n.isNull(t)||(this.name=t,this.broadcastNameToClients())}let t=this.getInputData(this.inJsonInput);if(n.isNull(t))return;const e=t.hasOwnProperty("measurement"),i=t.hasOwnProperty("tags"),s=t.hasOwnProperty("fields");return n.isNull(t.tags)?(this.setOutputData(this.outError,!1,!0),void this.setOutputData(this.outMsg,"!tags! is empty,",!0)):n.isNull(t.measurement)?(this.setOutputData(this.outError,!1,!0),void this.setOutputData(this.outMsg,"!measurement! is empty,",!0)):n.isNull(t.fields)?(this.setOutputData(this.outError,!1,!0),void this.setOutputData(this.outMsg,"!fields! is empty,",!0)):void(e&&i&&s?(this.setOutputData(this.outError,!1,!0),this.setOutputData(this.outLastExport,l().format()),this.setOutputData(this.outMsg,"influx write to DB",!0),Object.keys(t.tags).forEach(e=>{t.tags[e]||delete t.tags[e]}),this.client.writePoints([t]).catch(t=>{this.debugInfo(`INFLUX-DB NODE: error on influx write, ${t}`),this.setOutputData(this.outError,!0,!0),this.setOutputData(this.outMsg,`error on influx write, ${t}`,!0)})):(this.debugInfo("INFLUX-DB NODE: input.hasOwnProperty is missing"),this.setOutputData(this.outError,!0,!0),this.setOutputData(this.outMsg,"input.hasOwnProperty is missing",!0)))}onAfterSettingsChange(){this.side===u.Side.server&&(this.createClient(),this.onInputUpdated())}}o.Container.registerNodeType("history/influx-db",h)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(10),n=i(6),o=i(11),a=i(3),r=i(2),u=i(5),d=i(1),l=i(45);let p=i(14);const{InfluxDB:h,Point:c,HttpError:g}=i(215),{SetupAPI:m}=i(216);class f extends a.Node{constructor(){super(),this.inEnable=0,this.inJsonInput=1,this.outError=0,this.outLastExport=1,this.outMsg=2,this.title=r.NODE_INFO.history["influx-db-2"].title,this.description=r.NODE_INFO.history["influx-db-2"].description,this.addInputWithSettings("enable",d.Type.BOOLEAN,!1,"Enable"),this.addInput("json-input",d.Type.JSON),this.addOutput("error",d.Type.BOOLEAN),this.addOutput("outLastExport",d.Type.STRING),this.addOutput("outMsg",d.Type.STRING),this.settings.useDefaultTags=d.NodeSetting.create({description:"useDefaultTags",value:!1,type:d.SettingType.BOOLEAN}),this.settings.dontUseEnv=d.NodeSetting.create({description:"Dont use env settings",value:!1,type:d.SettingType.BOOLEAN}),this.settings.url=d.NodeSetting.create({description:"URL",value:"",type:d.SettingType.STRING}),this.settings.token=d.NodeSetting.create({description:"Token",value:"",type:d.SettingType.STRING}),this.settings.org=d.NodeSetting.create({description:"Org",value:"",type:d.SettingType.STRING}),this.settings.bucket=d.NodeSetting.create({description:"Bucket",value:"",type:d.SettingType.STRING}),this.setSettingsConfig({groups:[{period:{weight:2},periodUnits:{}}],conditions:{url:t=>!!t.dontUseEnv.value,token:t=>!!t.dontUseEnv.value,org:t=>!!t.dontUseEnv.value,bucket:t=>!!t.dontUseEnv.value}})}onAdded(){}createClient(){let{url:t,token:e,org:i,bucket:n}=s.default.influxDb2;this.settings.dontUseEnv.value&&(t=this.settings.url.value,e=this.settings.token.value,i=this.settings.org.value,n=this.settings.bucket.value),this.client=new h({url:t,token:e}).getWriteApi(i,n)}onInputUpdated(){if(this.side!==u.Side.server)return;if(!this.getInputData(this.inEnable))return void this.setOutputData(this.outMsg,"INFLUX-DB-2 NODE: not enabled",!0);let t=this.getInputData(this.inJsonInput);if(n.isNull(t))return;const e=t.hasOwnProperty("measurement"),i=t.hasOwnProperty("tags"),s=t.hasOwnProperty("fields");if(n.isNull(t.tags))return this.setOutputData(this.outError,!1,!0),void this.setOutputData(this.outMsg,"!tags! is empty,",!0);if(n.isNull(t.measurement))return this.setOutputData(this.outError,!1,!0),void this.setOutputData(this.outMsg,"!measurement! is empty,",!0);if(n.isNull(t.fields))return this.setOutputData(this.outError,!1,!0),void this.setOutputData(this.outMsg,"!fields! is empty,",!0);if(e&&i&&s){this.setOutputData(this.outError,!1,!0),this.setOutputData(this.outLastExport,p().format()),this.setOutputData(this.outMsg,"influx write to DB",!0),Object.keys(t.tags).forEach(e=>{t.tags[e]||delete t.tags[e]}),l.default.getPlatform().then(t=>{this.setOutputData(2,t)}).catch(t=>{this.debugInfo(`INFLUXDB-2 NODE: try/catch  getPlatform info, ${t}`)}),this.createClient(),this.settings.useDefaultTags.value&&this.client.useDefaultTags({location:"test"});const e=new c(t.measurement);e.timestamp(new Date);for(const i in t.tags)e.tag(i,t.tags[i]);for(const i in t.fields)switch(typeof t.fields[i]){case"number":e.floatField(i,t.fields[i]);break;case"string":e.stringField(i,t.fields[i]);break;case"boolean":e.booleanField(i,t.fields[i]);break;default:if(null==t.fields[i])break;e.floatField(i,t.fields[i])}this.client.writePoint(e),this.client.close().then(()=>{}).catch(t=>{console.error(t),t instanceof g&&401===t.statusCode&&console.log("INFLUXDB-2: Run ./onboarding.js to setup a new InfluxDB database."),console.log("\n INFLUXDB-2:  Finished ERROR"),this.setOutputData(this.outError,!0,!0),this.setOutputData(this.outMsg,`error on influx write, ${t}`,!0)})}else this.debugInfo("INFLUX-DB NODE: input.hasOwnProperty is missing"),this.setOutputData(this.outError,!0,!0),this.setOutputData(this.outMsg,"input.hasOwnProperty is missing",!0)}onAfterSettingsChange(){this.side===u.Side.server&&this.onInputUpdated()}}o.NodeTypeRegistry.registerNodeType("history/influx-db-2",f)},function(t,e){t.exports=require("@influxdata/influxdb-client")},function(t,e){t.exports=require("@influxdata/influxdb-client-apis")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PointPersistence=void 0;const s=i(6),n=i(0),o=i(3),a=i(2),r=i(1),u=i(7);class d extends o.Node{constructor(){super(),this.lastInterval=1e3,this.runState=!0,this.title=a.NODE_INFO.history.persistence.title,this.description=a.NODE_INFO.history.persistence.description,this.addInputWithSettings("enable",r.Type.BOOLEAN,!0,"Enable value resend timer"),this.addInput("input",r.Type.ANY),this.addInputWithSettings("interval",r.Type.NUMBER,30,"Interval"),this.addInput("trigger",r.Type.BOOLEAN),this.addOutput("output",r.Type.ANY),this.properties.output=null,this.settings.preventDuplicates=r.NodeSetting.create({description:"Prevent Duplicates)",value:!0,type:r.SettingType.BOOLEAN}),this.settings.time=r.NodeSetting.create({description:"Units",type:r.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]})}onAdded(){if(clearInterval(this.timeoutFunc),this.inputs[2].name=`[interval] (${this.settings.time.value})`,!this.getInputData(0))return this.setOutputData(0,this.properties.output),void(this.runState=!1);let t=this.getInputData(2);t=u.default.timeConvert(t,this.settings.time.value),this.timeoutFunc=setInterval(()=>{this.getInputData(1);this.setOutputData(0,this.properties.output)},t),this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(3);const e=this.getInputData(1);if(null!=e&&e.length&&(this.properties.output=e,this.setOutputData(0,this.properties.output)),t&&void 0!==this.properties.output&&null!==this.properties.output&&this.properties.output.length&&this.setOutputData(0,this.properties.output),this.inputs[1].updated){const t=this.settings.preventDuplicates.value;s.isNull(e)||(this.properties.output=e,this.setOutputData(0,this.properties.output,t))}const i=this.getInputData(0);if(!i&&this.runState)return clearInterval(this.timeoutFunc),this.setOutputData(0,this.properties.output),void(this.runState=!1);if(!i&&!this.runState)return this.setOutputData(0,this.properties.output),void(this.runState=!1);if(i){let t=this.getInputData(2);if(t=u.default.timeConvert(t,this.settings.time.value),this.runState)return void(t!=this.lastInterval&&(this.lastInterval=t,clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>{this.setOutputData(0,this.properties.output)},t)));this.runState||(this.runState=!0,this.timeoutFunc=setInterval(()=>{this.setOutputData(0,this.properties.output)},t))}}onAfterSettingsChange(){this.inputs[2].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}}e.PointPersistence=d,n.Container.registerNodeType("history/persistence",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.hvac.deadband.title,this.description=o.NODE_INFO.hvac.deadband.description,this.addInput("input",a.Type.NUMBER),this.addInputWithSettings("setpoint",a.Type.NUMBER,0,"Setpoint"),this.addInputWithSettings("deadband",a.Type.NUMBER,0,"Deadband"),this.addOutput("out",a.Type.BOOLEAN),this.addOutput("out not",a.Type.BOOLEAN),this.settings.invert=a.NodeSetting.create({description:"Reverses ON direction when true",value:!1,type:a.SettingType.BOOLEAN})}onAdded(){this.setOutputData(0,!1)}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1);let i=this.getInputData(2);1==this.settings.invert.value&&(i*=-1);const s=e+i/2,n=e-i/2;s>n?(t<=n&&this.setOutputData(0,!1,!0),t>=s&&this.setOutputData(0,!0,!0)):s<n&&(t>=n&&this.setOutputData(0,!1,!0),t<=s&&this.setOutputData(0,!0,!0))}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("hvac/deadband",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.hvac.thermostat.title,this.description=a.NODE_INFO.hvac.thermostat.description,this.addInput("input",o.Type.NUMBER),this.addInputWithSettings("enable",o.Type.BOOLEAN,!0,"Enable"),this.addInputWithSettings("setpoint",o.Type.NUMBER,20,"Setpoint"),this.addInputWithSettings("CLG offset",o.Type.NUMBER,1,"CLG offset"),this.addInputWithSettings("HTG offset",o.Type.NUMBER,1,"HTG offset"),this.addOutput("CLG Mode",o.Type.BOOLEAN),this.addOutput("HTG Mode",o.Type.BOOLEAN),this.setOutputData(0,!1),this.setOutputData(1,!1),this.clgMode=!1,this.htgMode=!1}onAdded(){this.setOutputData(0,!1),this.setOutputData(1,!1),this.onInputUpdated()}onInputUpdated(){if(!this.getInputData(1))return this.setOutputData(0,!1),this.setOutputData(1,!1),this.clgMode=!1,void(this.htgMode=!1);const t=this.getInputData(0),e=this.getInputData(2),i=e+this.getInputData(3);t<e-this.getInputData(4)?(this.setOutputData(0,!1,!0),this.setOutputData(1,!0,!0),this.htgMode=!0,this.clgMode=!1):t>i?(this.setOutputData(0,!0,!0),this.setOutputData(1,!1,!0),this.clgMode=!0,this.htgMode=!1):(this.clgMode&&t<e||this.htgMode&&t>e)&&(this.setOutputData(0,!1,!0),this.setOutputData(1,!1,!0),this.clgMode=!1,this.htgMode=!1)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("hvac/thermostat",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(3),o=i(2),a=i(1),r=i(7);class u extends n.Node{constructor(){super(),this.ENABLESLOT=0,this.ROTATESLOT=1,this.UPSLOT=2,this.DOWNSLOT=3,this.DELAYSLOT=4,this.MINONSLOT=5,this.FAULTSTARTSLOT=6,this.JSONSLOT=0,this.ORDERSLOT=1,this.STAGESLOT=2,this.OUTPUTSTARTSLOT=3,this.title=o.NODE_INFO.hvac["lead-lag-staging"].title,this.description=o.NODE_INFO.hvac["lead-lag-staging"].description,this.addInputWithSettings("enable",a.Type.BOOLEAN,!0,"Enable"),this.addInput("rotateLead",a.Type.BOOLEAN),this.addInput("stageUp",a.Type.BOOLEAN),this.addInput("stageDown",a.Type.BOOLEAN),this.settings.numUnits=a.NodeSetting.create({description:"Number of Units",value:2,type:a.SettingType.NUMBER}),this.addInputWithSettings("stageUpDelay (minutes)",a.Type.NUMBER,10,"Stage Up Delay (Minutes)"),this.addInputWithSettings("minOnTime (minutes)",a.Type.NUMBER,5,"Minimum On Time (Minutes)"),this.settings.stageUpOnFault=a.NodeSetting.create({description:"Stage Up On Running Unit Fault?",value:!1,type:a.SettingType.BOOLEAN}),this.addOutput("outputJSON",a.Type.JSON),this.addOutput("order",a.Type.STRING),this.addOutput("currentStage",a.Type.NUMBER),this.setSettingsConfig({groups:[],conditions:{}})}init(){this.properties.currentOrder=[1,2],this.properties.orderIndex=0,this.properties.rotationsList}onCreated(){this.onAfterSettingsChange()}onAdded(){this.EXECUTE_INTERVAL=1e4,this.onAfterSettingsChange()}onExecute(){this.onInputUpdated()}onAfterSettingsChange(){this.updateCount(),this.onInputUpdated()}onInputUpdated(){this.initializeOutputJSON();const t=this.getInputData(this.ENABLESLOT),e=this.getInputData(this.ROTATESLOT);if(e&&!this.lastRotate&&(this.properties.orderIndex++,this.properties.orderIndex>=this.properties.rotationsList.length&&(this.properties.orderIndex=0),this.properties.lastRotateTime=Date.now()),this.lastRotate=e,this.properties.currentOrder=this.properties.rotationsList[this.properties.orderIndex],t){this.lastEnable||(this.properties.currentStage=1,this.properties.stageStartTime=Date.now());const t=this.getInputData(this.UPSLOT),e=this.getInputData(this.DOWNSLOT),a=r.default.timeConvert(this.getInputData(this.DELAYSLOT),r.TIME_TYPE.MINUTES),u=r.default.timeConvert(this.getInputData(this.MINONSLOT),r.TIME_TYPE.MINUTES),d=this.properties.currentStage;var i=0;if(t&&!e&&d<this.properties.numEnableOutputs&&Date.now()>this.properties.stageStartTime+a&&i++,e&&!t&&d>1&&Date.now()>this.properties.stageStartTime+u&&i--,this.settings.stageUpOnFault.value){for(var s,n=[],o=0;o<this.settings.numUnits.value;o++)s=this.getInputData(this.FAULTSTARTSLOT+o),n[this.properties.currentOrder.indexOf(this.convertNumToLetter(o))]=!!s;for(this.properties.outputJSON.faultArray=n;d+i<this.properties.numEnableOutputs&&n[d+i-1];)i++}0!==i&&(this.properties.currentStage+i>this.properties.numEnableOutputs?this.properties.currentStage=this.properties.numEnableOutputs:this.properties.currentStage+=i,this.properties.stageStartTime=Date.now()),this.setOutputs()}else this.resetController();this.lastEnable=t,this.setOutputJSON()}resetController(){this.properties.currentStage=0,this.properties.stageStartTime=null,this.setOutputData(this.ORDERSLOT,this.properties.currentOrder.toString()),this.setOutputData(this.STAGESLOT,0);for(var t=0;t<this.properties.numEnableOutputs;t++)this.setOutputData(t+this.OUTPUTSTARTSLOT,!1)}setOutputs(){var t,e;this.setOutputData(this.ORDERSLOT,this.properties.currentOrder.toString()),this.setOutputData(this.STAGESLOT,this.properties.currentStage);for(var i=0;i<this.properties.numEnableOutputs;i++)e=this.properties.currentOrder.indexOf(this.convertNumToLetter(i)),t=this.properties.currentStage>=e+1,this.setOutputData(i+this.OUTPUTSTARTSLOT,t)}updateCount(){this.properties.numEnableOutputs===this.settings.numUnits.value&&this.properties.numFaultInputs===this.settings.numUnits.value||(this.properties.orderIndex=0),this.updateOutputsCount(),this.updateInputsCount(),this.generateRotations(),this.properties.currentOrder=this.properties.rotationsList[this.properties.orderIndex]}generateRotations(){var t=[];const e=this.properties.numEnableOutputs;for(var i=0;i<e;i++)t.push(this.convertNumToLetter(i));var s,n=[];n.push(Array.from(t));for(var o=1;o<e;o++)s=t.shift(),t.push(s),n.push(Array.from(t));this.properties.rotationsList=n}updateOutputsCount(){this.settings.numUnits.value=Math.min(Math.max(2,this.settings.numUnits.value),10),this.properties.numEnableOutputs=this.getOutputsCount()-this.OUTPUTSTARTSLOT;const t=this.settings.numUnits.value-this.properties.numEnableOutputs;if(0==t)return;let e=null;if(t>0)for(let i=0;i<t;i++)e=this.addOutput("Unit"+this.convertNumToLetter(this.properties.numEnableOutputs+i),a.Type.BOOLEAN),this.setOutputData(e,!1);if(t<0){let e=Object.keys(this.outputs);for(let i=0;i>t;i--){let t=e[e.length+i-1];this.removeOutput(+t)}}this.properties.numEnableOutputs=this.settings.numUnits.value,this.properties.currentStage>this.properties.numUnits&&(this.properties.currentStage=this.properties.numUnits)}updateInputsCount(){this.settings.numUnits.value=Math.min(Math.max(2,this.settings.numUnits.value),10),this.properties.numFaultInputs=this.getInputsCount()-this.FAULTSTARTSLOT;var t=0;this.settings.stageUpOnFault.value&&(t=this.settings.numUnits.value);const e=t-this.properties.numFaultInputs;if(0==e)return;let i=null;if(e>0)for(let t=0;t<e;t++)i=this.addInput("Fault"+this.convertNumToLetter(this.properties.numFaultInputs+t),a.Type.BOOLEAN);if(e<0){let t=Object.keys(this.inputs);for(let i=0;i>e;i--){let e=t[t.length+i-1];this.removeInput(+e)}}this.settings.stageUpOnFault.value?this.properties.numFaultInputs=this.settings.numUnits.value:this.properties.numFaultInputs=0}convertNumToLetter(t=0){return String.fromCharCode(65+t)}initializeOutputJSON(){this.properties.outputJSON={enableInput:this.getInputData(this.ENABLESLOT),rotateInput:this.getInputData(this.ROTATESLOT),stageUpInput:this.getInputData(this.UPSLOT),stageDownInput:this.getInputData(this.DOWNSLOT),stageUpDelay:this.getInputData(this.DELAYSLOT),minOnTime:this.getInputData(this.MINONSLOT),order:null,orderIndex:null,numUnits:null,currentStage:null,stageArray:[],useFaultInputs:null,faultArray:[],currentTime:null,stageStartTime:null}}setOutputJSON(){this.properties.outputJSON.order=this.properties.currentOrder,this.properties.outputJSON.orderIndex=this.properties.orderIndex,this.properties.outputJSON.numUnits=this.settings.numUnits.value,this.properties.outputJSON.currentStage=this.properties.currentStage,this.properties.outputJSON.useFaultInputs=this.settings.stageUpOnFault.value;for(var t=0;t<this.properties.numEnableOutputs;t++)this.properties.outputJSON.stageArray.push(this.outputs[String(t+this.OUTPUTSTARTSLOT)].data);this.properties.outputJSON.stageStartTime=this.properties.stageStartTime,this.properties.outputJSON.currentTime=Date.now(),this.setOutputData(this.JSONSLOT,this.properties.outputJSON)}}s.NodeTypeRegistry.registerNodeType("hvac/lead-lag-staging",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.hvac["lead-lag-switch"].title,this.description=o.NODE_INFO.hvac["lead-lag-switch"].description,this.addInput("rotateLead",a.Type.BOOLEAN),this.addInput("unit1",a.Type.BOOLEAN),this.addInput("unit2",a.Type.BOOLEAN),this.addOutput("leadUnit",a.Type.STRING),this.addOutput("enableA",a.Type.BOOLEAN),this.addOutput("enableB",a.Type.BOOLEAN)}init(){this.properties.currentOrder=!0}onAdded(){this.onAfterSettingsChange()}onAfterSettingsChange(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);t&&!this.lastRotate&&(this.properties.currentOrder=!this.properties.currentOrder),this.lastRotate=t;const e=this.getInputData(1),i=this.getInputData(2);this.properties.currentOrder?(this.setOutputData(0,"A"),this.setOutputData(1,!!e),this.setOutputData(2,!!i)):(this.setOutputData(0,"B"),this.setOutputData(1,!!i),this.setOutputData(2,!!e))}}s.NodeTypeRegistry.registerNodeType("hvac/lead-lag-switch",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(3),o=i(2),a=i(1),r=i(4),u=i(7);class d extends n.Node{constructor(){super(),this.ENABLESLOT=0,this.ZTSLOT=1,this.SPSLOT=2,this.CLGOFSTSLOT=3,this.HTGOFSTSLOT=4,this.STGUPSLOT=5,this.MDLYSLOT=6,this.ECONOASLOT=7,this.OATSLOT=8,this.ECONHISLOT=9,this.ECONLOSLOT=10,this.FSSLOT=11,this.CLGLOCKSLOT=12,this.HTGLOCKSLOT=13,this.JSONSLOT=0,this.CLGMSLOT=1,this.HTGMSLOT=2,this.COMPSTGSLOT=3,this.ECONOMSLOT=4,this.OADMPSLOT=5,this.RVSLOT=6,this.COMPSTARTSLOT=7,this.title=o.NODE_INFO.hvac["pac-unit-control"].title,this.description=o.NODE_INFO.hvac["pac-unit-control"].description,this.addInputWithSettings("enable",a.Type.BOOLEAN,!0,"Enable"),this.addInput("zoneTemp",a.Type.NUMBER),this.addInputWithSettings("setpoint",a.Type.NUMBER,20,"Setpoint"),this.settings.straddleSP=a.NodeSetting.create({description:"Setpoint Logic",value:!0,type:a.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Condition to Setpoint"},{value:!1,text:"Condition past Setpoint"}]}}),this.addInputWithSettings("CLG offset",a.Type.NUMBER,1,"CLG offset"),this.addInputWithSettings("HTG offset",a.Type.NUMBER,1,"HTG offset"),this.addInputWithSettings("stageUpDelay (minutes)",a.Type.NUMBER,10,"Stage Up Delay (Minutes)"),this.addInputWithSettings("modeDelay (minutes)",a.Type.NUMBER,15,"Mode Change Delay (Minutes)"),this.addInputWithSettings("econoAllow",a.Type.BOOLEAN,!0,"Allow Economy Mode"),this.addInput("OATemp",a.Type.NUMBER),this.settings.compStages=a.NodeSetting.create({description:"# Compressor Stages",value:2,type:a.SettingType.NUMBER}),this.addInputWithSettings("econoHigh",a.Type.NUMBER,22,"Econo OA High Temp"),this.addInputWithSettings("econoLow",a.Type.NUMBER,10,"Econo OA Low Temp"),this.settings.econoDB=a.NodeSetting.create({description:"Economy Conditions Deadband",value:1,type:a.SettingType.NUMBER}),this.settings.requireFS=a.NodeSetting.create({description:"Require Fan Status?",value:!0,type:a.SettingType.BOOLEAN}),this.settings.FSdelay=a.NodeSetting.create({description:"Fan Status OFF Delay (Seconds)",value:20,type:a.SettingType.NUMBER}),this.addInput("fanStatus",a.Type.BOOLEAN),this.addInputWithSettings("clgLockout",a.Type.BOOLEAN,!1,"Lockout Cooling Mode"),this.addInputWithSettings("htgLockout",a.Type.BOOLEAN,!1,"Lockout Heating Mode"),this.addOutput("outputJSON",a.Type.JSON),this.addOutput("CLG Mode",a.Type.BOOLEAN),this.addOutput("HTG Mode",a.Type.BOOLEAN),this.addOutput("compStage",a.Type.NUMBER),this.addOutput("econoMode",a.Type.BOOLEAN),this.addOutput("OADamper",a.Type.NUMBER),this.addOutput("RV",a.Type.BOOLEAN),this.addOutput("Comp1",a.Type.BOOLEAN),this.addOutput("Comp2",a.Type.BOOLEAN),this.setSettingsConfig({groups:[{"CLG offset":{},"HTG offset":{}},{"stageUpDelay (minutes)":{},"modeDelay (minutes)":{}},{econoLow:{},econoHigh:{}}],conditions:{}})}onCreated(){this.EXECUTE_INTERVAL=1e4,this.properties.FSInput=!0,this.properties.fanStatus=!1,this.properties.fanStatusOffTime=null,this.properties.clgModeEnd=null,this.properties.htgModeEnd=null,this.resetController(),this.onAfterSettingsChange()}onAdded(){this.EXECUTE_INTERVAL=1e4,this.setOutputData(0,this.properties.clgMode),this.setOutputData(1,this.properties.htgMode),this.setOutputData(2,this.properties.compStage),this.setOutputData(3,this.properties.econoConditions),this.onAfterSettingsChange()}onExecute(){this.onInputUpdated()}onAfterSettingsChange(){this.updateStageCount(),this.updateFSInput(),this.onInputUpdated()}onInputUpdated(){this.initializeOutputJSON();const t=this.getInputData(this.ENABLESLOT);this.properties.outputJSON.enableInput=t;var e=!0;if(this.settings.requireFS.value){const t=this.getInputData(this.FSSLOT);this.properties.outputJSON.fanStatusActual=t,this.properties.outputJSON.fanStatusEffective=!0,t?(e=!0,this.properties.fanStatus=!0):(this.properties.fanStatus&&(this.properties.fanStatusOffTime=Date.now()+u.default.timeConvert(this.settings.FSdelay.value,u.TIME_TYPE.SECONDS)),this.properties.fanStatus=t,this.properties.fanStatusOffTime<=Date.now()&&(e=!1,this.properties.outputJSON.fanStatusEffective=!1),this.properties.outputJSON.fanStatusOffTime=this.properties.fanStatusOffTime)}var i=!1;(!t||this.settings.requireFS.value&&!e)&&(i=!0);const s=this.getInputData(this.ZTSLOT);if(this.properties.outputJSON.zoneTemp=s,null!=s&&null!=s||(i=!0),i)this.resetController();else{const t=this.getInputData(this.SPSLOT),e=this.getInputData(this.CLGOFSTSLOT),i=this.getInputData(this.HTGOFSTSLOT),a=t+e,r=t-i,d=this.getInputData(this.CLGLOCKSLOT),l=this.getInputData(this.HTGLOCKSLOT);if(!l&&!this.properties.clgMode&&!this.properties.htgMode&&s<r?(null==this.properties.clgModeEnd||this.properties.clgModeEnd+u.default.timeConvert(this.getInputData(this.MDLYSLOT),u.TIME_TYPE.MINUTES)<=Date.now())&&(this.properties.htgMode=!0,this.properties.compStage=0):!d&&!this.properties.htgMode&&!this.properties.clgMode&&s>a&&(null==this.properties.htgModeEnd||this.properties.htgModeEnd+u.default.timeConvert(this.getInputData(this.MDLYSLOT),u.TIME_TYPE.MINUTES)<=Date.now())&&(this.properties.clgMode=!0,this.properties.compStage=0),this.properties.htgMode)if(this.properties.econoConditions=!1,l)this.properties.compStage=0,this.properties.htgMode=!1,this.properties.htgModeEnd=Date.now(),this.properties.stageStartTime=null;else if(s<r)0===this.properties.compStage?(this.properties.compStage=1,this.properties.stageStartTime=Date.now()):this.properties.compStage>0&&this.properties.stageStartTime+u.default.timeConvert(this.getInputData(this.STGUPSLOT),u.TIME_TYPE.MINUTES)<=Date.now()&&this.properties.compStage<this.properties.numComps&&(this.properties.compStage++,this.properties.stageStartTime=Date.now());else{var n=i/this.properties.numComps;if(this.settings.straddleSP.value)for(var o=this.properties.compStage;o>0;o--)s>=t-n*(o-1)&&(this.properties.compStage--,this.properties.stageStartTime=Date.now());else if(!this.settings.straddleSP.value){n=2*i/this.properties.numComps;for(o=this.properties.compStage;o>0;o--)s>=t+i-n*(o-1)&&(this.properties.compStage--,this.properties.stageStartTime=Date.now())}0===this.properties.compStage&&(this.properties.htgMode=!1,this.properties.htgModeEnd=Date.now(),this.properties.stageStartTime=null)}else if(this.properties.clgMode){if(d)this.properties.compStage=0,this.properties.clgMode=!1,this.properties.clgModeEnd=Date.now(),this.properties.stageStartTime=null;else if(s>a)0===this.properties.compStage?(this.properties.compStage=1,this.properties.stageStartTime=Date.now()):this.properties.compStage>0&&this.properties.stageStartTime+u.default.timeConvert(this.getInputData(this.STGUPSLOT),u.TIME_TYPE.MINUTES)<=Date.now()&&this.properties.compStage<this.properties.numComps&&(this.properties.compStage++,this.properties.stageStartTime=Date.now());else{n=e/this.properties.numComps;if(this.settings.straddleSP.value)for(o=this.properties.compStage;o>0;o--)s<=t+n*(o-1)&&(this.properties.compStage--,this.properties.stageStartTime=Date.now());else if(!this.settings.straddleSP.value){n=2*e/this.properties.numComps;for(o=this.properties.compStage;o>0;o--)s<=t-e+n*(o-1)&&(this.properties.compStage--,this.properties.stageStartTime=Date.now())}0===this.properties.compStage&&(this.properties.clgMode=!1,this.properties.clgModeEnd=Date.now(),this.properties.stageStartTime=null)}if(this.getInputData(this.ECONOASLOT)){const t=this.getInputData(this.OATSLOT);t&&this.checkEconoConditions(t)?this.properties.econoConditions=!0:this.properties.econoConditions=!1}else this.properties.econoConditions=!1}this.setOutputs(s,t,a)}this.properties.outputJSON.disable=i,this.setOutputJSON()}setOutputs(t,e,i){if(this.setOutputData(this.CLGMSLOT,this.properties.clgMode,!0),this.setOutputData(this.HTGMSLOT,this.properties.htgMode,!0),this.setOutputData(this.COMPSTGSLOT,this.properties.compStage,!0),this.setOutputData(this.ECONOMSLOT,this.properties.econoConditions,!0),this.properties.econoConditions&&this.properties.clgMode){const s=r.default.remap(t,e,i,0,100);this.setOutputData(this.OADMPSLOT,s,!0),this.properties.outputJSON.OADamper=s}else this.setOutputData(this.OADMPSLOT,0,!0),this.properties.outputJSON.OADamper=0;this.setOutputData(this.RVSLOT,this.properties.htgMode,!0);for(var s=0;s<this.properties.numComps;s++)this.properties.compStage>=s+1?this.setOutputData(s+this.COMPSTARTSLOT,!0):this.setOutputData(s+this.COMPSTARTSLOT,!1)}checkEconoConditions(t){const e=this.getInputData(this.ECONHISLOT),i=this.getInputData(this.ECONLOSLOT),s=this.settings.econoDB.value;return e<=i+s||null==e||null==i||null==s?(this.properties.econoConditions=!1,!1):t<i||t>e?(this.properties.econoConditions=!1,!1):(t<=e-s&&t>=i+s&&(this.properties.econoConditions=!0),this.properties.econoConditions)}updateFSInput(){this.settings.requireFS.value!=this.properties.FSInput&&(this.settings.requireFS.value?this.addInput("fanStatus",a.Type.BOOLEAN):this.removeInput(11)),this.properties.FSInput=this.settings.requireFS.value}updateStageCount(){Math.min(Math.max(1,this.settings.compStages.value),20);this.settings.compStages.value<1&&(this.settings.compStages.value=1),this.properties.numComps=this.getOutputsCount()-this.COMPSTARTSLOT;const t=this.settings.compStages.value-this.properties.numComps;if(0==t)return;let e=null;if(t>0)for(let i=0;i<t;i++)e=this.addOutput("Comp"+(this.properties.numComps+i+1),a.Type.BOOLEAN),this.setOutputData(e,!1);if(t<0){let e=Object.keys(this.outputs);for(let i=0;i>t;i--){let t=e[e.length+i-1];this.removeOutput(+t)}}this.properties.numComps=this.settings.compStages.value,this.properties.compStage>this.properties.numComps&&(this.properties.compStage=this.properties.numComps)}resetController(){this.properties.clgMode=!1,this.properties.htgMode=!1,this.properties.compStage=0,this.properties.econoMode=!1,this.properties.econoConditions=!1,this.properties.stageStartTime=null,this.setOutputData(this.CLGMSLOT,this.properties.clgMode),this.setOutputData(this.HTGMSLOT,this.properties.htgMode),this.setOutputData(this.COMPSTGSLOT,this.properties.compStage),this.setOutputData(this.ECONOMSLOT,this.properties.econoMode),this.setOutputData(this.OADMPSLOT,0),this.setOutputData(this.RVSLOT,!1);for(var t=0;t<this.properties.numComps;t++)this.setOutputData(t+this.COMPSTARTSLOT,!1)}initializeOutputJSON(){this.properties.outputJSON={disable:null,enableInput:null,zoneTemp:null,setpoint:this.getInputData(this.SPSLOT),clgOffset:this.getInputData(this.CLGOFSTSLOT),htgOffset:this.getInputData(this.HTGOFSTSLOT),stageUpDelay:this.getInputData(this.STGUPSLOT),modeChangeDelay:this.getInputData(this.MDLYSLOT),econoAllow:this.getInputData(this.ECONOASLOT),OATemp:this.getInputData(this.OATSLOT),econoHighLimit:this.getInputData(this.ECONHISLOT),econoLowLimit:this.getInputData(this.ECONLOSLOT),htgLockout:this.getInputData(this.HTGLOCKSLOT),clgLockout:this.getInputData(this.CLGLOCKSLOT),fanStatusActual:null,fanStatusEffective:null,fanStatusOffTime:null,clgMode:null,htgMode:null,compStage:null,econoMode:null,OADamper:null,RV:null,compArray:[],setpointMode:this.settings.straddleSP.value?"Condition to Setpoint":"Condition past Setpoint",numCompressors:this.properties.numComps,econoConditionsDB:this.settings.econoDB.value,requireFanStatus:this.settings.requireFS.value,fanStatusOffDelay:this.settings.FSdelay.value,currentTime:null,stageStartTime:null,htgModeEnd:null,clgModeEnd:null}}setOutputJSON(){this.properties.outputJSON.clgMode=this.properties.clgMode,this.properties.outputJSON.htgMode=this.properties.htgMode,this.properties.outputJSON.compStage=this.properties.compStage,this.properties.outputJSON.econoMode=this.properties.econoConditions,this.properties.outputJSON.OADamper=this.properties.clgMode,this.properties.outputJSON.RV=this.properties.htgMode;for(var t=0;t<this.properties.numComps;t++)this.properties.compStage>=t+1?this.properties.outputJSON.compArray.push(!0):this.properties.outputJSON.compArray.push(!1);this.properties.outputJSON.stageStartTime=this.properties.stageStartTime,this.properties.outputJSON.clgModeEnd=this.properties.clgModeEnd,this.properties.outputJSON.htgModeEnd=this.properties.htgModeEnd,this.properties.outputJSON.currentTime=Date.now(),this.setOutputData(this.JSONSLOT,this.properties.outputJSON,!0)}}s.NodeTypeRegistry.registerNodeType("hvac/pac-unit-control",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2),u=i(224);class d extends n.Node{constructor(){super(),this.lastResetVal=!1,this.pid=new u(1,1,1,0,0,"reverse"),this.title=r.NODE_INFO.hvac.PID.title,this.description=r.NODE_INFO.hvac.PID.description,this.addInput("enable",o.Type.BOOLEAN),this.addInput("processVariable",o.Type.NUMBER),this.addInputWithSettings("setpoint",o.Type.NUMBER,1,"setpoint"),this.addInputWithSettings("minOut",o.Type.NUMBER,0,"minOut"),this.addInputWithSettings("maxOut",o.Type.NUMBER,100,"maxOut"),this.addInputWithSettings("inP",o.Type.NUMBER,1,"P"),this.addInputWithSettings("inI",o.Type.NUMBER,0,"I"),this.addInputWithSettings("inD",o.Type.NUMBER,0,"D"),this.addInputWithSettings("direction",o.Type.BOOLEAN,!0,"Direction (OFF = Reverse, ON = Direct)"),this.addInputWithSettings("interval",o.Type.NUMBER,1,"Interval (min 500ms)"),this.addInputWithSettings("bias",o.Type.NUMBER,0,"Bias"),this.addInputWithSettings("manual",o.Type.NUMBER,0,"Manual ('output' value on disabled)"),this.addInput("reset",o.Type.BOOLEAN),this.addOutput("output",o.Type.NUMBER),this.settings.time=o.NodeSetting.create({description:"Time",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{minOut:{},maxOut:{}},{inP:{},inI:{},inD:{}},{time:{},interval:{weight:2}}]}),this.startTime=Date.now(),this.pid.setSampleTime(1e3),this.pid.setOutputLimits(0,100),this.pid.setMode("MANUAL"),this.pid.setOutput(0),this.pid.setBias(0)}onAdded(){this.inputs[9].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}onExecute(){this.pid.compute()&&this.setOutputData(0,this.pid.getOutput().toFixed(1),!0)}onInputUpdated(){const t=this.getInputData(12);if(t&&!this.lastResetVal&&this.pid.initialize(),this.lastResetVal=t,!this.getInputData(0)){this.pid.setMode("MANUAL");const t=this.getInputData(11)||0;return this.setOutputData(0,t.toFixed(1)),void this.pid.setOutput(t)}let e=this.getInputData(1);if(null==e||typeof e!==o.Type.NUMBER){this.pid.setMode("MANUAL");const t=this.getInputData(11)||0;return this.setOutputData(0,t.toFixed(1),!0),void this.pid.setOutput(t)}const i=this.getInputData(2),s=this.getInputData(3),n=this.getInputData(4),r=this.getInputData(5),u=this.getInputData(6),d=this.getInputData(7);let l=this.getInputData(8);l=1==l?"direct":"reverse";let p=this.getInputData(9);p=a.default.timeConvert(p,this.settings.time.value),p=Math.max(500,p);const h=this.getInputData(10);this.pid.setBias(h),this.pid.setSampleTime(p),this.pid.setOutputLimits(s,n),this.pid.setPoint(i),this.pid.setTunings(r,u,d),this.pid.setControllerDirection(l),this.pid.setMode("auto"),this.pid.setInput(e),this.pid.compute(),this.setOutputData(0,this.calculatePidOutput(),!0)}onAfterSettingsChange(){this.inputs[9].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}calculatePidOutput(){return this.pid.getOutput().toFixed(1)}}s.Container.registerNodeType("hvac/PID",d)},function(t,e,i){"use strict";var s=function(t,e,i,s,n,o){this.input=t,this.mySetpoint=e,this.inAuto=!1,this.setOutputLimits(0,255),this.SampleTime=100,this.setTunings(i,s,n),this.setControllerDirection(o),this.lastTime=this.millis()-this.SampleTime,this.myBias=0,this.ITerm=0,this.myOutput=0};s.prototype.setInput=function(t){this.input=Number(t)},s.prototype.setPoint=function(t){this.mySetpoint=Number(t)},s.prototype.setBias=function(t){t>this.outMax?t=this.outMax:t<this.outMin&&(t=this.outMin),this.myBias=Number(t)},s.prototype.millis=function(){return(new Date).getTime()},s.prototype.compute=function(){if(!this.inAuto)return!1;var t=this.millis();if(t-this.lastTime>=this.SampleTime){var e=this.input,i=e-this.mySetpoint;i*=this.setDirection,this.ITerm+=this.ki*i,this.ITerm>this.outMax-this.myBias?this.ITerm=this.outMax-this.myBias:this.ITerm<this.outMin-this.myBias&&(this.ITerm=this.outMin-this.myBias);var s=e-this.lastInput,n=this.kp*i+this.ITerm-this.kd*s+this.myBias;return n>this.outMax?n=this.outMax:n<this.outMin&&(n=this.outMin),this.myOutput=n,this.lastInput=e,this.lastTime=t,!0}return!1},s.prototype.setTunings=function(t,e,i){t<0||e<0||i<0||(this.dispKp=t,this.dispKi=e,this.dispKd=i,this.SampleTimeInSec=this.SampleTime/1e3,this.kp=t,this.ki=e*this.SampleTimeInSec,this.kd=i/this.SampleTimeInSec)},s.prototype.setSampleTime=function(t){if(t>0){var e=t/(1*this.SampleTime);this.ki*=e,this.kd/=e,this.SampleTime=Math.round(t)}},s.prototype.setOutput=function(t){t>this.outMax?t=this.outMax:t<this.outMin&&(t=this.outMin),this.myOutput=t},s.prototype.setOutputLimits=function(t,e){t>=e||(this.outMin=t,this.outMax=e,this.inAuto&&(this.myOutput>this.outMax?this.myOutput=this.outMax:this.myOutput<this.outMin&&(this.myOutput=this.outMin),this.ITerm>this.outMax-this.myBias?this.ITerm=this.outMax-this.myBias:this.ITerm<this.outMin-this.myBias&&(this.ITerm=this.outMin-this.myBias)))},s.prototype.setMode=function(t){var e;if(0==t||"automatic"==t.toString().toLowerCase()||"auto"==t.toString().toLowerCase())e=1;else{if(1!=t&&"manual"!=t.toString().toLowerCase())throw new Error("Incorrect Mode Chosen");e=0}this.inAuto=e},s.prototype.initialize=function(){this.ITerm=0,this.myOutput=this.myBias,this.lastInput=this.input},s.prototype.setControllerDirection=function(t){if(0==t||"direct"==t.toString().toLowerCase())this.setDirection=1;else{if(1!=t&&"reverse"!=t.toString().toLowerCase())throw new Error("Incorrect Controller Direction Chosen");this.setDirection=-1}},s.prototype.getKp=function(){return this.dispKp},s.prototype.getKd=function(){return this.dispKd},s.prototype.getKi=function(){return this.dispKi},s.prototype.getMode=function(){return this.inAuto?"Auto":"Manual"},s.prototype.getDirection=function(){return this.controllerDirection},s.prototype.getOutput=function(){return this.myOutput},s.prototype.getInput=function(){return this.input},s.prototype.getSetPoint=function(){return this.mySetpoint},s.prototype.getBias=function(){return this.myBias},t.exports=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.hvac["toggle-duration"].title,this.description=r.NODE_INFO.hvac["toggle-duration"].description,this.addInput("pushButton",o.Type.BOOLEAN),this.addInputWithSettings("runtime",o.Type.NUMBER,120,"Runtime"),this.addOutput("output",o.Type.BOOLEAN),this.addOutput("remainingRuntime",o.Type.NUMBER),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:a.TIME_TYPE.SECONDS,text:"Seconds"},{value:a.TIME_TYPE.MINUTES,text:"Minutes"},{value:a.TIME_TYPE.HOURS,text:"Hours"}]},value:a.TIME_TYPE.MINUTES}),this.settings.useOffDelay=o.NodeSetting.create({description:"Long Hold for OFF?",value:!1,type:o.SettingType.BOOLEAN}),this.settings.offDelay=o.NodeSetting.create({description:"OFF Push Delay (Seconds)",value:20,type:o.SettingType.NUMBER}),this.setSettingsConfig({groups:[{runtime:{weight:2},time:{}}],conditions:{offDelay:t=>!!t.useOffDelay.value}})}onCreated(){this.setOutputData(0,!1),this.lastTrigger=!1,this.onAfterSettingsChange()}onAdded(){this.inputs[1].name=`[runtime] (${this.settings.time.value})`,this.EXECUTE_INTERVAL=1e4,this.onAfterSettingsChange()}onExecute(){if(this.runState){const t=16667e-9*(this.runtimeVal-((new Date).valueOf()-this.startTime));this.setOutputData(1,t.toFixed(1)),t<=0&&this.stop()}}onInputUpdated(){let t=this.getInputData(0);if(null==t&&(this.lastTrigger=!1),t){if(t&&!this.lastTrigger){let t=this.getInputData(1);t=a.default.timeConvert(t,this.settings.time.value),this.runState?this.settings.useOffDelay.value&&null==this.properties.offPushStartTime?this.startCountdown():this.stop():this.start(t)}}else this.properties.offPushStartTime=null;this.lastTrigger=t}startCountdown(){this.properties.offPushStartTime=Date.now(),this.timeoutFunc=setInterval(()=>{const t=this.getInputData(0);console.log("checking if the button is till held"),t&&this.settings.useOffDelay.value?this.properties.offPushStartTime+a.default.timeConvert(this.settings.offDelay.value,a.TIME_TYPE.SECONDS)<=Date.now()&&(this.properties.offPushStartTime=null,clearInterval(this.timeoutFunc),this.stop()):(this.properties.offPushStartTime=null,clearInterval(this.timeoutFunc))},1e3)}start(t){this.runState=!0,this.runtimeVal=t,this.EXECUTE_INTERVAL=Math.max(Math.min(1e4,t/10),250),this.startTime=(new Date).valueOf(),this.setOutputData(0,!0),this.onExecute()}stop(){this.runState=!1,this.setOutputData(0,!1),this.setOutputData(1,0)}onAfterSettingsChange(){this.inputs[1].name=`[runtime] (${this.settings.time.value})`,this.onInputUpdated()}}s.NodeTypeRegistry.registerNodeType("hvac/toggle-duration",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2),u=i(58);class d extends n.Node{constructor(){super(),this.psychro=new u,this.title=r.NODE_INFO.hvac.psychrometrics.title,this.description=r.NODE_INFO.hvac.psychrometrics.description,this.addInput("DryBulb",o.Type.NUMBER),this.addInput("RelHum(0-1)",o.Type.NUMBER),this.addInput("Pressure",o.Type.NUMBER),this.addOutput("HumRatio",o.Type.NUMBER),this.addOutput("TWetBulb",o.Type.NUMBER),this.addOutput("TDewPoint",o.Type.NUMBER),this.addOutput("VapPres",o.Type.NUMBER),this.addOutput("MoistAirEnthalpy",o.Type.NUMBER),this.addOutput("MoistAirVolume",o.Type.NUMBER),this.addOutput("DegreeOfSaturation",o.Type.NUMBER),this.addOutput("error",o.Type.STRING),this.settings.units=o.NodeSetting.create({description:"Select Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"SI",text:"Metric/SI"},{value:"IP",text:"Imperial/IP"}]},value:"SI"}),this.settings.inputsSelect=o.NodeSetting.create({description:"Select Inputs",type:o.SettingType.DROPDOWN,config:{items:[{value:"DB_RH_P",text:"Dry Bulb, Rel. Humidity, Pressure"},{value:"DB_WB_P",text:"Dry Bulb, Wet Bulb, Pressure"},{value:"DB_DP_P",text:"Dry Bulb, Dew Point, Pressure "}]},value:"DB_RH_P"}),this.settings.precision=o.NodeSetting.create({description:"Precision",type:o.SettingType.NUMBER,value:4}),this.psychro.SetUnitSystem(this.psychro.SI)}onAdded(){this.setConversionFunction()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.setConversionFunction(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){const t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);if(!a.default.hasInput(t)||!a.default.hasInput(e)||!a.default.hasInput(i))return this.clearOutputs(),void this.setOutputData(7,null);let s;try{s=this.conversionFunction(t,e,i)}catch(t){return this.clearOutputs(),void this.setOutputData(7,String(t))}const n=Math.abs(this.settings.precision.value);this.setOutputData(0,Number(s[0]).toFixed(n)),this.setOutputData(1,Number(s[1]).toFixed(n)),this.setOutputData(2,Number(s[2]).toFixed(n)),this.setOutputData(3,Number(s[3]).toFixed(n)),this.setOutputData(4,Number(s[4]).toFixed(n)),this.setOutputData(5,Number(s[5]).toFixed(n)),this.setOutputData(6,Number(s[6]).toFixed(n)),this.setOutputData(7,null)}clearOutputs(){this.setOutputData(0,null),this.setOutputData(1,null),this.setOutputData(2,null),this.setOutputData(3,null),this.setOutputData(4,null),this.setOutputData(5,null),this.setOutputData(6,null)}setConversionFunction(){switch("IP"==this.settings.units.value?(this.psychro.SetUnitSystem(this.psychro.IP),this.title="Psychrometric Calcs (Imperial/IP)"):(this.psychro.SetUnitSystem(this.psychro.SI),this.title="Psychrometric Calcs (Metric/SI)"),this.settings.inputsSelect.value){case"DB_RH_P":this.inputs[0].name="DryBulb",this.inputs[1].name="RelHum(0-1)",this.inputs[2].name="Pressure",this.outputs[0].name="HumRatio",this.outputs[1].name="TWetBulb",this.outputs[2].name="TDewPoint",this.conversionFunction=(t,e,i)=>this.psychro.CalcPsychrometricsFromRelHum(t,e,i);break;case"DB_WB_P":this.inputs[0].name="DryBulb",this.inputs[1].name="TWetBulb",this.inputs[2].name="Pressure",this.outputs[0].name="HumRatio",this.outputs[1].name="TDewPoint",this.outputs[2].name="RelHum",this.conversionFunction=(t,e,i)=>this.psychro.CalcPsychrometricsFromTWetBulb(t,e,i);break;case"DB_DP_P":this.inputs[0].name="DryBulb",this.inputs[1].name="TDewPoint",this.inputs[2].name="Pressure",this.outputs[0].name="HumRatio",this.outputs[1].name="TWetBulb",this.outputs[2].name="RelHum",this.conversionFunction=(t,e,i)=>this.psychro.CalcPsychrometricsFromTDewPoint(t,e,i);break;default:this.inputs[0].name="DryBulb",this.inputs[1].name="RelHum(0-1)",this.inputs[2].name="Pressure",this.outputs[0].name="HumRatio",this.outputs[1].name="TWetBulb",this.outputs[2].name="TDewPoint",this.conversionFunction=(t,e,i)=>this.psychro.CalcPsychrometricsFromRelHum(t,e,i)}}}s.Container.registerNodeType("hvac/psychrometrics",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.hvac["energy-conversion"].title,this.description=r.NODE_INFO.hvac["energy-conversion"].description,this.addInput("W·h",o.Type.NUMBER),this.addOutput("kW·h",o.Type.NUMBER),this.addOutput("Btu",o.Type.NUMBER),this.addOutput("cal",o.Type.NUMBER),this.addOutput("J",o.Type.NUMBER),this.addOutput("kJ",o.Type.NUMBER),this.settings.inputType=o.NodeSetting.create({description:"Input Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"W·h",text:"watt-hour (W·h)"},{value:"kW·h",text:"kilowatt-hour (kW·h)"},{value:"Btu",text:"British Thermal Unit (Btu)"},{value:"cal",text:"calorie (cal)"},{value:"J",text:"joule(J)"},{value:"kJ",text:"kilojoule(kJ)"}]},value:"W·h"}),this.settings.precision=o.NodeSetting.create({description:"Precision",type:o.SettingType.NUMBER,value:"4"})}onAdded(){this.setConversionFunction()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.setConversionFunction(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){const t=this.getInputData(0);if(!a.default.hasInput(t))return this.setOutputData(0,null),this.setOutputData(1,null),this.setOutputData(2,null),this.setOutputData(3,null),void this.setOutputData(4,null);const e=this.conversionFunction(t),i=Math.abs(this.settings.precision.value);this.setOutputData(0,Number(e[0]).toFixed(i)),this.setOutputData(1,Number(e[1]).toFixed(i)),this.setOutputData(2,Number(e[2]).toFixed(i)),this.setOutputData(3,Number(e[3]).toFixed(i)),this.setOutputData(4,Number(e[4]).toFixed(i))}setConversionFunction(){switch(this.settings.inputType.value){case"W·h":this.title="Energy Conversion (W·h)",this.inputs[0].name="W·h",this.outputs[0].name="kW·h",this.outputs[1].name="Btu",this.outputs[2].name="cal",this.outputs[3].name="J",this.outputs[4].name="kJ",this.conversionFunction=t=>{let e=[null,null,null,null,null];return e[0]=.001*t,e[1]=3.4121416331*t,e[2]=859.8456*t,e[3]=3600*t,e[4]=3.6*t,e};break;case"kW·h":this.title="Energy Conversion (kW·h)",this.inputs[0].name="kW·h",this.outputs[0].name="W·h",this.outputs[1].name="Btu",this.outputs[2].name="cal",this.outputs[3].name="J",this.outputs[4].name="kJ",this.conversionFunction=t=>{let e=[null,null,null,null,null];return e[0]=1e3*t,e[1]=3412.1416331279*t,e[2]=859845.6*t,e[3]=36e5*t,e[4]=3600*t,e};break;case"Btu":this.title="Energy Conversion (Btu)",this.inputs[0].name="Btu",this.outputs[0].name="W·h",this.outputs[1].name="kW·h",this.outputs[2].name="cal",this.outputs[3].name="J",this.outputs[4].name="kJ",this.conversionFunction=t=>{let e=[null,null,null,null,null];return e[0]=.2930710702*t,e[1]=.0002930711*t,e[2]=251.99587*t,e[3]=1055.05585262*t,e[4]=1.0550558526*t,e};break;case"cal":this.title="Energy Conversion (cal)",this.inputs[0].name="cal",this.outputs[0].name="W·h",this.outputs[1].name="kW·h",this.outputs[2].name="Btu",this.outputs[3].name="J",this.outputs[4].name="kJ",this.conversionFunction=t=>{let e=[null,null,null,null,null];return e[0]=.0011629995*t,e[1]=1163e-9*t,e[2]=.003968319*t,e[3]=4.1867982*t,e[4]=.0041867982*t,e};break;case"J":this.title="Energy Conversion (J)",this.inputs[0].name="J",this.outputs[0].name="W·h",this.outputs[1].name="kW·h",this.outputs[2].name="Btu",this.outputs[3].name="cal",this.outputs[4].name="kJ",this.conversionFunction=t=>{let e=[null,null,null,null,null];return e[0]=.0002777778*t,e[1]=2.777778e-7*t,e[2]=.0009478171*t,e[3]=.238846*t,e[4]=.001*t,e};break;case"kJ":this.title="Energy Conversion (kJ)",this.inputs[0].name="kJ",this.outputs[0].name="W·h",this.outputs[1].name="kW·h",this.outputs[2].name="Btu",this.outputs[3].name="cal",this.outputs[4].name="J",this.conversionFunction=t=>{let e=[null,null,null,null,null];return e[0]=.2777777778*t,e[1]=.0002777778*t,e[2]=.9478171203*t,e[3]=238.846*t,e[4]=1e3*t,e};break;default:this.title="Energy Conversion (W·h)",this.inputs[0].name="W·h",this.outputs[0].name="kW·h",this.outputs[1].name="Btu",this.outputs[2].name="cal",this.outputs[3].name="J",this.outputs[4].name="kJ",this.conversionFunction=t=>{let e=[null,null,null,null,null];return e[0]=.001*t,e[1]=3.4121416331*t,e[2]=859.8456*t,e[3]=3600*t,e[4]=3.6*t,e}}}}s.Container.registerNodeType("hvac/energy-conversion",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.hvac["power-conversion"].title,this.description=r.NODE_INFO.hvac["power-conversion"].description,this.addInput("kW",o.Type.NUMBER),this.addOutput("tons",o.Type.NUMBER),this.addOutput("Btu/h",o.Type.NUMBER),this.addOutput("hp",o.Type.NUMBER),this.settings.inputType=o.NodeSetting.create({description:"Input Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"kW",text:"kilowatt (kW)"},{value:"tons",text:"Tons of Refrigeration (tons)"},{value:"Btu/h",text:"British Thermal Unit per hour (Btu/h)"},{value:"hp",text:"Electrical Horsepower (hp)"}]},value:"kW"}),this.settings.precision=o.NodeSetting.create({description:"Precision",type:o.SettingType.NUMBER,value:"4"})}onAdded(){this.setConversionFunction()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.setConversionFunction(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){const t=this.getInputData(0);if(!a.default.hasInput(t))return this.setOutputData(0,null),this.setOutputData(1,null),void this.setOutputData(2,null);const e=this.conversionFunction(t),i=Math.abs(this.settings.precision.value);this.setOutputData(0,Number(e[0]).toFixed(i)),this.setOutputData(1,Number(e[1]).toFixed(i)),this.setOutputData(2,Number(e[2]).toFixed(i))}setConversionFunction(){switch(this.settings.inputType.value){case"kW":this.title="Power Conversion (kW)",this.inputs[0].name="kW",this.outputs[0].name="tons",this.outputs[1].name="Btu/h",this.outputs[2].name="hp",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=.284345*t,e[1]=3412.141635133076*t,e[2]=1.340482573727*t,e};break;case"tons":this.title="Power Conversion (tons)",this.inputs[0].name="tons",this.outputs[0].name="kW",this.outputs[1].name="Btu/h",this.outputs[2].name="hp",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=3.51685*t,e[1]=12e3*t,e[2]=4.71427613941*t,e};break;case"Btu/h":this.title="Power Conversion (Btu/h)",this.inputs[0].name="Btu/h",this.outputs[0].name="kW",this.outputs[1].name="tons",this.outputs[2].name="hp",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=.00029307107*t,e[1]=833333332843549e-19*t,e[2]=.000392856662*t,e};break;case"hp":this.title="Power Conversion (hp)",this.inputs[0].name="hp",this.outputs[0].name="kW",this.outputs[1].name="tons",this.outputs[2].name="Btu/h",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=.746*t,e[1]=2545.457659809275*t,e[2]=.21212147*t,e};break;default:this.title="Power Conversion (kW)",this.inputs[0].name="kW",this.outputs[0].name="tons",this.outputs[1].name="Btu/h",this.outputs[2].name="hp",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=.284345*t,e[1]=3412.141635133076*t,e[2]=1.340482573727*t,e}}}}s.Container.registerNodeType("hvac/power-conversion",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.hvac["volume-conversion"].title,this.description=r.NODE_INFO.hvac["volume-conversion"].description,this.addInput("L",o.Type.NUMBER),this.addOutput("M³",o.Type.NUMBER),this.addOutput("ft³",o.Type.NUMBER),this.addOutput("gal",o.Type.NUMBER),this.settings.inputType=o.NodeSetting.create({description:"Input Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"L",text:"Litre (L)"},{value:"m³",text:"Cubic Metre (m³)"},{value:"ft³",text:"Cubic Foot (ft³)"},{value:"gal",text:"Gallon (gal)"}]},value:"L"}),this.settings.precision=o.NodeSetting.create({description:"Precision",type:o.SettingType.NUMBER,value:"4"})}onAdded(){this.setConversionFunction()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.setConversionFunction(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){const t=this.getInputData(0);if(!a.default.hasInput(t))return this.setOutputData(0,null),this.setOutputData(1,null),void this.setOutputData(2,null);const e=this.conversionFunction(t),i=Math.abs(this.settings.precision.value);this.setOutputData(0,Number(e[0]).toFixed(i)),this.setOutputData(1,Number(e[1]).toFixed(i)),this.setOutputData(2,Number(e[2]).toFixed(i))}setConversionFunction(){switch(this.settings.inputType.value){case"L":this.title="Volume Conversion (L)",this.inputs[0].name="L",this.outputs[0].name="m³",this.outputs[1].name="ft³",this.outputs[2].name="gal",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=.001*t,e[1]=.0353147*t,e[2]=.2642*t,e};break;case"m³":this.title="Volume Conversion (m³)",this.inputs[0].name="m³",this.outputs[0].name="L",this.outputs[1].name="ft³",this.outputs[2].name="gal",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=1e3*t,e[1]=35.3147*t,e[2]=264.2*t,e};break;case"ft³":this.title="Volume Conversion (ft³)",this.inputs[0].name="ft³",this.outputs[0].name="m³",this.outputs[1].name="L",this.outputs[2].name="gal",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=.0283168*t,e[1]=28.3168*t,e[2]=7.481*t,e};break;case"gal":this.title="Volume Conversion (gal)",this.inputs[0].name="gal",this.outputs[0].name="m³",this.outputs[1].name="L",this.outputs[2].name="ft³",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=.00378541*t,e[1]=3.78541*t,e[2]=.133681*t,e};break;default:this.title="Volume Conversion (L)",this.inputs[0].name="L",this.outputs[0].name="m³",this.outputs[1].name="ft³",this.outputs[2].name="gal",this.conversionFunction=t=>{const e=[null,null,null];return e[0]=.001*t,e[1]=.0353147*t,e[2]=.2642*t,e}}}}s.Container.registerNodeType("hvac/volume-conversion",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2),u=i(58);class d extends n.Node{constructor(){super(),this.psychro=new u,this.title=r.NODE_INFO.hvac["temperature-conversion"].title,this.description=r.NODE_INFO.hvac["temperature-conversion"].description,this.addInput("input",o.Type.NUMBER),this.addOutput("output",o.Type.NUMBER),this.settings.convertType=o.NodeSetting.create({description:"Conversion Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"C_to_F",text:"Celsius to Fahrenheit"},{value:"C_to_K",text:"Celsius to Kelvin"},{value:"C_to_R",text:"Celsius to Rankine"},{value:"F_to_C",text:"Fahrenheit to Celsius"},{value:"F_to_K",text:"Fahrenheit to Kelvin"},{value:"F_to_R",text:"Fahrenheit to Rankine"},{value:"K_to_C",text:"Kelvin to Celsius"},{value:"K_to_F",text:"Kelvin to Fahrenheit"},{value:"K_to_R",text:"Kelvin to Rankine"},{value:"R_to_C",text:"Rankine to Celsius"},{value:"R_to_F",text:"Rankine to Fahrenheit"},{value:"R_to_K",text:"Rankine to Kelvin"}]},value:"C_to_F"}),this.settings.precision=o.NodeSetting.create({description:"Precision",type:o.SettingType.NUMBER,value:2})}onAdded(){this.setConversionFunction()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.setConversionFunction(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){const t=Number(this.getInputData(0));if(!a.default.hasInput(t))return void this.setOutputData(0,null);const e=Math.abs(this.settings.precision.value),i=Number(this.conversionFunction(t)).toFixed(e);this.setOutputData(0,i)}setConversionFunction(){const t=this.settings.convertType.value;switch(console.log(t,": converstion"),t){case"C_to_F":this.title="Temperature Conversion (C-> F)",this.conversionFunction=this.psychro.GetTFahrenheitFromTCelsius;break;case"C_to_K":this.title="Temperature Conversion (C-> K)",console.log("C_to_K"),this.conversionFunction=this.psychro.GetTKelvinFromTCelsius;break;case"C_to_R":this.title="Temperature Conversion (C-> R)",this.conversionFunction=this.psychro.GetTRankineFromTCelsius;break;case"F_to_C":this.title="Temperature Conversion (F-> C)",this.conversionFunction=this.psychro.GetTCelsiusFromTFahrenheit;break;case"F_to_K":this.title="Temperature Conversion (F-> K)",this.conversionFunction=this.psychro.GetTKelvinFromTFahrenheit;break;case"F_to_R":this.title="Temperature Conversion (F-> R)",this.conversionFunction=this.psychro.GetTRankineFromTFahrenheit;break;case"K_to_C":this.title="Temperature Conversion (K-> C)",this.conversionFunction=this.psychro.GetTCelsiusFromTKelvin;break;case"K_to_F":this.title="Temperature Conversion (K-> F)",this.conversionFunction=this.psychro.GetTFahrenheitFromTKelvin;break;case"K_to_R":this.title="Temperature Conversion (K-> R)",this.conversionFunction=this.psychro.GetTRankineFromTKelvin;break;case"R_to_C":this.title="Temperature Conversion (R-> C)",this.conversionFunction=this.psychro.GetTCelsiusFromTRankine;break;case"R_to_F":this.title="Temperature Conversion (R-> F)",this.conversionFunction=this.psychro.GetTFahrenheitFromTRankine;break;case"R_to_K":this.title="Temperature Conversion (R-> K)",this.conversionFunction=this.psychro.GetTKelvinFromTRankine;break;default:this.title="Temperature Conversion (C-> F)",this.conversionFunction=this.psychro.GetTFahrenheitFromTCelsius}}}s.Container.registerNodeType("hvac/temperature-conversion",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2),u=i(58);class d extends n.Node{constructor(){super(),this.psychro=new u,this.title=r.NODE_INFO.hvac["atmospheric-pressure"].title,this.description=r.NODE_INFO.hvac["atmospheric-pressure"].description,this.addInput("altitude",o.Type.NUMBER),this.addOutput("pressure",o.Type.NUMBER),this.settings.units=o.NodeSetting.create({description:"Select Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"SI",text:"Metric/SI (Meters-> Pa)"},{value:"IP",text:"Imperial/IP (Feet-> Psi)"}]},value:"SI"}),this.settings.precision=o.NodeSetting.create({description:"Precision",type:o.SettingType.NUMBER,value:2}),this.psychro.SetUnitSystem(this.psychro.SI)}onAdded(){this.updateTitleAndFunction(),this.onInputUpdated()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.updateTitleAndFunction(),this.onInputOrSettingsChange()}updateTitleAndFunction(){"IP"==this.settings.units.value?(this.title="Atmospheric Pressure (Feet-> Psi)",this.psychro.SetUnitSystem(this.psychro.IP)):(this.title="Atmospheric Pressure (Meters-> Pa)",this.psychro.SetUnitSystem(this.psychro.SI))}onInputOrSettingsChange(){const t=this.getInputData(0);if(!a.default.hasInput(t))return void this.setOutputData(0,null);const e=this.psychro.GetStandardAtmPressure(t),i=Math.abs(this.settings.precision.value);this.setOutputData(0,Number(e).toFixed(i))}}s.Container.registerNodeType("hvac/atmospheric-pressure",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.hvac["pressure-conversion"].title,this.description=r.NODE_INFO.hvac["pressure-conversion"].description,this.addInput("Pa",o.Type.NUMBER),this.addOutput("atm",o.Type.NUMBER),this.addOutput("bar",o.Type.NUMBER),this.addOutput("lbf/in2",o.Type.NUMBER),this.settings.inputType=o.NodeSetting.create({description:"Input Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"Pa",text:"Pascal (Pa)"},{value:"atm",text:"Standard Atmosphere (atm)"},{value:"bar",text:"Bar (bar)"},{value:"lbf/in2",text:"Pound-force per square inch (lbf/in2)"}]},value:"Pa"}),this.settings.precision=o.NodeSetting.create({description:"Precision",type:o.SettingType.NUMBER,value:"2"})}onAdded(){this.setConversionFunction()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.setConversionFunction(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){const t=this.getInputData(0);if(!a.default.hasInput(t))return this.setOutputData(0,null),this.setOutputData(1,null),void this.setOutputData(2,null);const e=this.conversionFunction(t),i=Math.abs(this.settings.precision.value);this.setOutputData(0,Number(e[0]).toFixed(i)),this.setOutputData(1,Number(e[1]).toFixed(i)),this.setOutputData(2,Number(e[2]).toFixed(i))}setConversionFunction(){switch(this.settings.inputType.value){case"Pa":this.title="Pressure Conversion (Pa)",this.inputs[0].name="Pa",this.outputs[0].name="atm",this.outputs[1].name="bar",this.outputs[2].name="lbf/in2",this.conversionFunction=t=>{let e=[null,null,null];return e[0]=98692e-10*t,e[1]=1e-5*t,e[2]=145038e-9*t,e};break;case"atm":this.title="Pressure Conversion (atm)",this.inputs[0].name="atm",this.outputs[0].name="Pa",this.outputs[1].name="bar",this.outputs[2].name="lbf/in2",this.conversionFunction=t=>{let e=[null,null,null];return e[0]=101325*t,e[1]=1.01325*t,e[2]=14.6959*t,e};break;case"bar":this.title="Pressure Conversion (bar)",this.inputs[0].name="bar",this.outputs[0].name="Pa",this.outputs[1].name="atm",this.outputs[2].name="lbf/in2",this.conversionFunction=t=>{let e=[null,null,null];return e[0]=1e5*t,e[1]=.986923*t,e[2]=14.5038*t,e};break;case"lbf/in2":this.title="Pressure Conversion (lbf/in2)",this.inputs[0].name="lbf/in2",this.outputs[0].name="Pa",this.outputs[1].name="atm",this.outputs[2].name="bar",this.conversionFunction=t=>{let e=[null,null,null];return e[0]=6894.76*t,e[1]=.068046*t,e[2]=.0689476*t,e};break;default:this.title="Pressure Conversion (Pa)",this.inputs[0].name="Pa",this.outputs[0].name="atm",this.outputs[1].name="bar",this.outputs[2].name="lbf/in2",this.conversionFunction=t=>{let e=[null,null,null];return e[0]=98692e-10*t,e[1]=1e-5*t,e[2]=145038e-9*t,e}}}}s.Container.registerNodeType("hvac/pressure-conversion",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.hvac["actuator-sizing"].title,this.description=r.NODE_INFO.hvac["actuator-sizing"].description,this.addInput("damperArea(m²)",o.Type.NUMBER),this.addOutput("torque(Nm)",o.Type.NUMBER),this.addOutput("torque(lbf-in)",o.Type.NUMBER),this.settings.units=o.NodeSetting.create({description:"Input Units",type:o.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Square Meters (m²)"},{value:!1,text:"Square Feet (ft²)"}]},value:!0}),this.settings.type=o.NodeSetting.create({description:"Damper Type",type:o.SettingType.DROPDOWN,config:{items:[{value:6,text:"No Seals (Low Resistance)"},{value:7,text:"With Seals (Medium Resistance)"},{value:8,text:"Fire/Smoke (High Resistance)"}]},value:6})}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.updateTitles(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){var t=this.getInputData(0);if(!a.default.hasInput(t))return this.setOutputData(0,null),void this.setOutputData(1,null);this.settings.units.value&&(t*=10.7639);const e=this.settings.type.value,i=t*e*.112985,s=t*e;this.setOutputData(0,i.toFixed(2)),this.setOutputData(1,s.toFixed(2))}updateTitles(){this.settings.units.value?this.inputs[0].name="ductArea(m²)":this.inputs[0].name="ductArea(ft²)"}}s.NodeTypeRegistry.registerNodeType("hvac/actuator-sizing",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.hvac["k-factor"].title,this.description=a.NODE_INFO.hvac["k-factor"].description,this.addInput("ductArea(m²)",o.Type.NUMBER),this.addInput("diffPressure(Pa)",o.Type.NUMBER),this.addInput("airflow(L/s)",o.Type.NUMBER),this.addOutput("Kfactor",o.Type.NUMBER),this.settings.areaUnits=o.NodeSetting.create({description:"Duct Area Units",type:o.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Square Meters (m²)"},{value:!1,text:"Square Feet (ft²)"}]},value:!0}),this.settings.DPUnits=o.NodeSetting.create({description:"Differential Pressure Units",type:o.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Pascals (Pa)"},{value:!1,text:"Inches of Water (in. w.g.)"}]},value:!0}),this.settings.airflowUnits=o.NodeSetting.create({description:"Airflow Units",type:o.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Litres per Second (L/s)"},{value:!1,text:"Cubic Feet per Minute (cfm)"}]},value:!0})}onAdded(){this.setOutputData(0,null)}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.updateTitles(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){var t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);if(null==t||null==e||null==i)return void this.setOutputData(0,null);this.settings.areaUnits.value&&(t*=10.7639),this.settings.DPUnits.value&&(e*=.00401865),this.settings.airflowUnits.value&&(i*=2.11888);const s=e*Math.pow(4005*t/i,2);this.setOutputData(0,s.toFixed(2))}updateTitles(){this.settings.areaUnits.value?this.inputs[0].name="ductArea(m²)":this.inputs[0].name="ductArea(ft²)",this.settings.areaUnits.value?this.inputs[1].name="diffPressure(Pa)":this.inputs[1].name="diffPressure(in. w.g)",this.settings.areaUnits.value?this.inputs[0].name="airflow(L/s)":this.inputs[2].name="airflow(cfm)"}}s.NodeTypeRegistry.registerNodeType("hvac/k-factor",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.hvac["dp-airflow"].title,this.description=a.NODE_INFO.hvac["dp-airflow"].description,this.addInput("ductArea(m²)",o.Type.NUMBER),this.addInput("diffPressure(Pa)",o.Type.NUMBER),this.addInput("Kfactor",o.Type.NUMBER),this.addOutput("airflow(L/s)",o.Type.NUMBER),this.addOutput("airflow(cfm)",o.Type.NUMBER),this.settings.areaUnits=o.NodeSetting.create({description:"Duct Area Units",type:o.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Square Meters (m²)"},{value:!1,text:"Square Feet (ft²)"}]},value:!0}),this.settings.DPUnits=o.NodeSetting.create({description:"Differential Pressure Units",type:o.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Pascals (Pa)"},{value:!1,text:"Inches of Water (in. w.g.)"}]},value:!0})}onAdded(){this.setOutputData(0,null)}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.updateTitles(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){var t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);if(null==t||null==e||null==i)return void this.setOutputData(0,null);this.settings.areaUnits.value&&(t*=10.7639),this.settings.DPUnits.value&&(e*=.00401865);const s=4005*t*Math.sqrt(e/i),n=.4719474*s;this.setOutputData(0,n.toFixed(2)),this.setOutputData(1,s.toFixed(2))}updateTitles(){this.settings.areaUnits.value?this.inputs[0].name="ductArea(m²)":this.inputs[0].name="ductArea(ft²)",this.settings.areaUnits.value?this.inputs[1].name="diffPressure(Pa)":this.inputs[1].name="diffPressure(in. w.g)"}}s.NodeTypeRegistry.registerNodeType("hvac/dp-airflow",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.STRING,this.title=a.NODE_INFO.json["array-builder"].title,this.description=a.NODE_INFO.json["array-builder"].description,this.addOutput("out",o.Type.STRING)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){let t=[];for(let e=this.dynamicInputStartPosition;e<this.getInputsCount();e++)t.push(this.getInputData(e));this.setOutputData(0,t)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("json/array-builder",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,this.title=a.NODE_INFO.json["array-builder-number"].title,this.description=a.NODE_INFO.json["array-builder-number"].description,this.addOutput("out",o.Type.STRING)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){let t=[];for(let e=this.dynamicInputStartPosition;e<this.getInputsCount();e++)t.push(this.getInputData(parseInt(e)));this.setOutputData(0,t)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("json/array-builder-number",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ArrayCombineNode=void 0;const s=i(3),n=i(0),o=i(1),a=i(6),r=i(2);class u extends s.Node{constructor(){super(),this.title=r.NODE_INFO.json["array-combine"].title,this.description=r.NODE_INFO.json["array-combine"].description,this.addInput("input-1",o.Type.JSON),this.addInput("input-2",o.Type.JSON),this.addOutput("output-array",o.Type.JSON),this.addOutput("output-object",o.Type.JSON)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t={};const e=this.getInputData(0),i=this.getInputData(1);if(!a.isNull(e)&&!a.isNull(i)){try{t=[...e,...i],this.setOutputData(0,t)}catch(t){this.debugInfo(`ARRY-COMBINE NODE: try/catch concat, ${t}`)}try{const t=Object.assign({},e,i);this.setOutputData(1,t)}catch(t){this.debugInfo(`ARRY-COMBINE NODE: try/catch assign, ${t}`)}}}onAfterSettingsChange(){this.onInputUpdated()}}e.ArrayCombineNode=u,n.Container.registerNodeType("json/array-combine",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JSONBuilderNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.filterKeys=[],this.title=o.NODE_INFO.json["json-builder"].title,this.description=o.NODE_INFO.json["json-builder"].description,this.settings.definition=a.NodeSetting.create({description:"payload definition (JSON)",type:a.SettingType.STRING,value:""}),this.addInput("trigger",a.Type.BOOLEAN),this.addOutput("output",a.Type.JSON)}init(){this.addInputs()}onAdded(){this.filterKeys=this.getFilterKeys()}onInputUpdated(){let t={};for(let e=this.dynamicOutputStartPosition();e<this.getInputsCount();e++)t=Object.assign(Object.assign({},t),{[this.filterKeys[e-1]]:this.inputs[e].data});this.setOutputData(0,t)}onAfterSettingsChange(){this.updateInputs(),this.onInputUpdated()}updateInputs(){var t;const e=this.getFilterKeys();let i=Math.min(this.filterKeys.length,e.length);for(let s=0;s<e.length;s++)if((null===(t=this.filterKeys)||void 0===t?void 0:t[s])!=e[s]){i=s;break}const s=this.getInputsCount();for(let t=i+this.dynamicOutputStartPosition();t<s;t++)this.removeInput(t);this.addInputs(i)}addInputs(t=0){this.filterKeys=this.getFilterKeys();for(let e=t;e<this.filterKeys.length;e++){let t=this.filterKeys[e];this.addInput(t.toString(),a.Type.ANY)}}getFilterKeys(){return this.settings.definition.value.replace(/\s+/g,"").split(",").filter(t=>!!t)}dynamicOutputStartPosition(){return 1}}e.JSONBuilderNode=r,s.Container.registerNodeType("json/json-builder",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.JSONEnumBuilderNode=void 0;const s=i(6),n=i(0),o=i(3),a=i(2),r=i(1);class u extends o.Node{constructor(){super(),this.filterKeys=[],this.title=a.NODE_INFO.json["json-enum-builder"].title,this.description=a.NODE_INFO.json["json-enum-builder"].description,this.addInput("trigger",r.Type.BOOLEAN),this.addInputWithSettings("definition",r.Type.JSON,'{"pointOne":22, "pointTwo":33}',"JSON value"),this.addOutput("output",r.Type.ANY),this.addOutput("valid-json",r.Type.BOOLEAN),this.settings.json=r.NodeSetting.create({description:"Select output",type:r.SettingType.DROPDOWN,value:""})}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){this.getInputData(0),this.onAfterSettingsChange()}onAfterSettingsChange(){const t=this.getInputData(1);if(!s.isNull(t))if(s.isJSON(t)&&!s.isEmpty(t)){const e=Object.entries(t).map(t=>({value:t[1],text:t[0]}));if(e){this.settings.json.config={items:e};const t=this.settings.json.value;this.setOutputData(0,t),this.setOutputData(1,!0),this.broadcastSettingsToClients()}}else this.setOutputData(1,!1)}}e.JSONEnumBuilderNode=u,n.Container.registerNodeType("json/json-enum-builder",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.json["json-filter"].title,this.description=o.NODE_INFO.json["json-filter"].description,this.addInput("input",a.Type.JSON),this.addOutput("output",a.Type.JSON),this.addOutput("output-key",a.Type.STRING),this.settings.filter=a.NodeSetting.create({description:"Example: key",value:"key",type:a.SettingType.STRING})}onInputUpdated(){let t=this.getInputData(0);if(null!==t)try{const e=this.settings.filter.value,i=t[0][e];this.setOutputData(0,i)}catch(t){this.setOutputData(0,null)}else this.setOutputData(0,null)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("json/json-filter",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.json["json-obj-filter"].title,this.description=o.NODE_INFO.json["json-obj-filter"].description,this.addInput("input",a.Type.JSON),this.addOutput("output",a.Type.JSON),this.settings.key=a.NodeSetting.create({description:"Example: key",value:"key",type:a.SettingType.STRING}),this.settings.filter=a.NodeSetting.create({description:"Example: value",value:"value",type:a.SettingType.STRING})}onInputUpdated(){const t=this.getInputData(0);if(null!==t)try{const e=this.settings.key.value,i=this.settings.filter.value,s=t.filter(t=>t[e]===i);this.setOutputData(0,s)}catch(t){this.setOutputData(0,null)}else this.setOutputData(0,null)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("json/json-obj-filter",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(84),r=i(2);var u;!function(t){t.Equals="Equals",t.NotEquals="Not Equal",t.GreaterThanEqual="Greater Than Equal",t.GreaterThan="Greater Than",t.LessThanEqual="Less Than Equal",t.LessThan="Less Than",t.Includes="Includes",t.startsWith="Starts With",t.endsWith="Ends With"}(u||(u={}));class d extends n.Node{constructor(){super(),this.title=r.NODE_INFO.json["json-filter-compare"].title,this.description=r.NODE_INFO.json["json-filter-compare"].description,this.addInput("input",o.Type.STRING),this.addInputWithSettings("comparison-to",o.Type.STRING,"","Comparison Value"),this.addOutput("output",o.Type.STRING),this.addOutput("output-key",o.Type.STRING),this.addOutput("match",o.Type.BOOLEAN),this.settings.filter=o.NodeSetting.create({description:"Example: msg.myKey",value:"myKey",type:o.SettingType.STRING}),this.settings.function=o.NodeSetting.create({description:"Comparison Type",type:o.SettingType.DROPDOWN,config:{items:[{value:u.Equals,text:u.Equals},{value:u.NotEquals,text:u.NotEquals},{value:u.GreaterThanEqual,text:u.GreaterThanEqual},{value:u.GreaterThan,text:u.GreaterThan},{value:u.LessThanEqual,text:u.LessThanEqual},{value:u.LessThan,text:u.LessThan},{value:u.Includes,text:u.Includes},{value:u.startsWith,text:u.startsWith},{value:u.endsWith,text:u.endsWith}]},value:u.Equals}),this.settings.isNumber=o.NodeSetting.create({description:"Comparison value is a number",value:!1,type:o.SettingType.BOOLEAN}),this.settings.passNull=o.NodeSetting.create({description:"Send null if not a match",value:!1,type:o.SettingType.BOOLEAN})}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){const t=this.getInputData(0);if(null==t)return this.setOutputData(0,null),this.setOutputData(1,null),void this.setOutputData(2,null);try{const e=JSON.parse(t),i=this.settings.filter.value;let s=a.default.findVal(e,i);const n=this.getInputData(1);a.default.compare(this,s.value,n)?(this.setOutputData(0,s.value),this.setOutputData(1,s.valueWithKey),this.setOutputData(2,!0)):!0===this.settings.passNull.value?(this.setOutputData(0,null),this.setOutputData(1,null),this.setOutputData(2,!1)):this.setOutputData(2,!1)}catch(t){this.setOutputData(0,null),this.setOutputData(1,null),this.setOutputData(2,!0)}}onAfterSettingsChange(){this.onInputUpdated();const t=this.settings.function.value;this.title=`Json Comparison Compare (${t})`,this.broadcastTitleToClients()}}s.Container.registerNodeType("json/json-filter-compare",d)},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(e,"__esModule",{value:!0});const n=i(17),o=i(28),a=i(0),r=i(3),u=i(2),d=i(1),l=i(4);class p extends r.Node{constructor(){super(),this.outputsCount=0,this.filterKeys=[],this.inInput=0,this.outError=0,this.outJsonOutput=1,this.title=u.NODE_INFO.json["json-filter-multiple"].title,this.description=u.NODE_INFO.json["json-filter-multiple"].description,this.addInput("input",d.Type.JSON),this.addOutput("error",d.Type.STRING),this.addOutput("json-output",d.Type.JSON),this.settings.outputs_count=d.NodeSetting.create({description:"Number of Outputs",value:1,type:d.SettingType.NUMBER}),this.setSettingsConfig({groups:[{outputs_count:{}}]})}init(){this.changeOutputsAndSettings()}onCreated(){this.renameInputsOutputs()}onAdded(){this.outputsCount=this.settings.outputs_count.value,this.onAfterSettingsChange()}onInputUpdated(){const t=this.getInputData(this.inInput);if(null!=t)try{const e={};for(let i=0;i<this.filterKeys.length;i++){let s=n.get(t,this.filterKeys[i]);void 0!==s&&(e[this.filterKeys[i]]=s,this.setOutputData(i+this.dynamicOutputStartPosition(),s))}this.setOutputData(this.outJsonOutput,e),this.setOutputData(this.outError,null)}catch(t){this.setOutputData(this.outError,t.toString())}else this.setOutputData(this.outError,null)}onAfterSettingsChange(){this.changeOutputsAndSettings(),this.renameInputsOutputs(),this.container.db&&this.container.db.updateNode(this.id,this.container.id,{$set:{outputs:this.outputs,settings:this.settings}}),this.onInputUpdated()}changeOutputsAndSettings(){let t=this.settings.outputs_count.value;t=l.default.clamp(t,1,10),this.settings.outputs_count.value=t,this.outputsCount!=t&&this.changeMyOutputsCount(t)}changeMyOutputsCount(t){const e=t-this.outputsCount;if(0!=e){if(this.changeOutputsCount(t+this.dynamicOutputStartPosition(),d.Type.STRING),e>0)for(let e=this.outputsCount+this.dynamicOutputStartPosition();e<t+this.dynamicOutputStartPosition();e++)this.settings["output"+this.getOutputNumber(e)]=d.NodeSetting.create({description:"Output "+this.getOutputNumber(e),value:"",type:d.SettingType.STRING});else if(e<0)for(let e=this.outputsCount+this.dynamicOutputStartPosition()-1;e>=t+this.dynamicOutputStartPosition();e--)delete this.settings["output"+this.getOutputNumber(e)];this.outputsCount=t}}renameInputsOutputs(){this.filterKeys=[];for(let t=this.dynamicOutputStartPosition();t<this.outputsCount+this.dynamicOutputStartPosition();t++){this.filterKeys.push(this.settings["output"+this.getOutputNumber(t)].value);const e=this.settings["output"+this.getOutputNumber(t)].value||"";this.outputs[t].name=this.getOutputNumber(t)+" | "+e,this.setOutputData(t,"")}}getOutputNumber(t){return t-this.dynamicOutputStartPosition()+1}dynamicOutputStartPosition(){return 2}}s([o.ErrorHandler],p.prototype,"changeOutputsAndSettings",null),s([o.ErrorHandler],p.prototype,"changeMyOutputsCount",null),s([o.ErrorHandler],p.prototype,"renameInputsOutputs",null),a.Container.registerNodeType("json/json-filter-multiple",p)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.json["json-checker"].title,this.description=a.NODE_INFO.json["json-checker"].description,this.addInput("input",o.Type.STRING),this.addOutput("output",o.Type.BOOLEAN),this.addOutput("msg",o.Type.STRING)}onAdded(){this.onInputUpdated()}isJson(t){t="string"!=typeof t?JSON.stringify(t):t;try{t=JSON.parse(t)}catch(t){return!1}return"object"==typeof t&&null!==t}onInputUpdated(){const t=this.getInputData(0);try{this.isJson(t)?(this.setOutputData(0,!0),this.setOutputData(1,"valid JSON")):(this.setOutputData(0,!1),this.setOutputData(1,"invalid JSON"))}catch(t){this.setOutputData(0,!1),this.setOutputData(1,t)}}}s.Container.registerNodeType("json/json-checker",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(0),o=i(3),a=i(2),r=i(1);class u extends o.Node{constructor(){super(),this.title=a.NODE_INFO.json["json-parse"].title,this.description=a.NODE_INFO.json["json-parse"].description,this.addInput("json-input",r.Type.JSON),this.addOutput("output",r.Type.JSON)}onInputUpdated(){let t=this.getInputData(0);if(!s.isNull(t))try{this.setOutputData(0,t)}catch(t){this.debugInfo(`JSON PARSE: try/catch , ${t}`)}}onAfterSettingsChange(){this.onInputUpdated()}}n.Container.registerNodeType("json/json-parse",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1),r=i(6);class u extends n.Node{constructor(){super(),this.getChanges=function(t,e){return JSON.stringify(t)!==JSON.stringify(e)},this.title=o.NODE_INFO.json["json-prevent-duplicates"].title,this.description=o.NODE_INFO.json["json-prevent-duplicates"].description,this.addInput("input",a.Type.JSON),this.addOutput("output",a.Type.JSON)}onInputUpdated(){const t=this.getInputData(0);if(null!==t)try{r.isNull(this.older)&&(this.setOutputData(0,t),this.older=t);const e=this.getChanges(this.older,t);if(0==e)return;1==e&&(this.older=t,this.setOutputData(0,t))}catch(t){this.setOutputData(0,null)}else this.setOutputData(0,null)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("json/json-prevent-duplicates",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(6),r=i(2),u=i(48);class d extends n.Node{constructor(){super(),this.title=r.NODE_INFO.json["json-query"].title,this.description=r.NODE_INFO.json["json-query"].description,this.addInput("input",o.Type.JSON),this.addInputWithSettings("query",o.Type.STRING,"deviceID &  ', ' & clientId","Query",!1),this.addOutput("output",o.Type.JSON),this.addOutput("error",o.Type.STRING)}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);if(!a.isNull(t)&&!a.isNull(e))try{let i=u(e).evaluate(t);this.setOutputData(0,i),this.setOutputData(1,null)}catch(t){this.setOutputData(0,null),this.setOutputData(1,t)}}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("json/json-query",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.latch["any-latch"].title,this.description=r.NODE_INFO.latch["any-latch"].description,this.addInput("input",o.Type.ANY),this.addInput("latch",o.Type.BOOLEAN),this.addOutput("output",o.Type.ANY),this.settings.passOnly=o.NodeSetting.create({description:"Only if input value is updated",value:!1,type:o.SettingType.BOOLEAN})}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.settings.passOnly.value;let e=this.getInputData(1);if(null!=e){if(e!=this.lastLatchValue&&(this.lastLatchValue=e,1==e)){let e=this.getInputData(0);if(!a.default.hasInput(e))return void(t?this.setOutputData(0,null,!0):this.setOutputData(0,null));""===e&&(e=null),t?this.setOutputData(0,e,!0):this.setOutputData(0,e)}}else t?this.setOutputData(0,null,!0):this.setOutputData(0,null)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("latch/any-latch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.latch["bool-latch"].title,this.description=r.NODE_INFO.latch["bool-latch"].description,this.addInput("input",o.Type.BOOLEAN),this.addInput("latch",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN),this.setOutputData(0,!1)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(1);if(null!=t){if(t!=this.lastLatchValue&&(this.lastLatchValue=t,1==t)){let t=this.getInputData(0);if(!a.default.hasInput(t))return void this.setOutputData(0,null,!0);this.setOutputData(0,t)}}else this.setOutputData(0,null,!0)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("latch/bool-latch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.latch["num-latch"].title,this.description=r.NODE_INFO.latch["num-latch"].description,this.addInput("input",o.Type.NUMBER),this.addInput("latch",o.Type.BOOLEAN),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(1);if(null!=t){if(t!=this.lastLatchValue&&(this.lastLatchValue=t,1==t)){let t=this.getInputData(0);if(!a.default.hasInput(t))return void this.setOutputData(0,null,!0);""===t&&(t=null),this.setOutputData(0,t)}}else this.setOutputData(0,null,!0)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("latch/num-latch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.latch["string-latch"].title,this.description=r.NODE_INFO.latch["string-latch"].description,this.addInput("input",o.Type.STRING),this.addInput("latch",o.Type.BOOLEAN),this.addOutput("output",o.Type.STRING)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(1);if(null!=t){if(t!=this.lastLatchValue&&(this.lastLatchValue=t,1==t)){let t=this.getInputData(0);if(!a.default.hasInput(t))return void this.setOutputData(0,null,!0);""===t&&(t=null),this.setOutputData(0,t,!0)}}else this.setOutputData(0,null,!0)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("latch/string-latch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.out=null,this.title=o.NODE_INFO.latch["set-reset"].title,this.description=o.NODE_INFO.latch["set-reset"].description,this.addInput("set",a.Type.BOOLEAN),this.addInput("reset",a.Type.BOOLEAN),this.addOutput("output",a.Type.BOOLEAN),this.settings.lock=a.NodeSetting.create({description:"Reset when set=true",value:!0,type:a.SettingType.BOOLEAN})}onAdded(){this.setOutputData(0,!1),this.onInputUpdated()}onInputUpdated(){let t=this.inputs[0].data,e=this.inputs[1].data,i=this.settings.lock.value,s=this.out;t&&!e?(this.setOutputData(0,!0,!0),this.out=!0):i&&e&&s&&t?(this.setOutputData(0,!1,!0),this.out=!1):!t&&s&&e&&(this.setOutputData(0,!1,!0),this.out=!1)}}s.Container.registerNodeType("latch/set-reset",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,this.title=a.NODE_INFO.math.add.title,this.description=a.NODE_INFO.math.add.description,this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputsCount();let e=0;for(let i=this.dynamicInputStartPosition;i<t;i++)e+=this.getInputData(i);this.settingOutput(e)}settingOutput(t){return this.setOutputData(0,t),t}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("math/add",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,this.title=a.NODE_INFO.math.subtract.title,this.description=a.NODE_INFO.math.subtract.description,this.addOutput("output",o.Type.NUMBER)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputsCount();let e=this.getInputData(0);for(let i=this.dynamicInputStartPosition+1;i<t;i++)e-=this.getInputData(i);this.setOutputData(0,e)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("math/subtract",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,this.title=a.NODE_INFO.math.multiply.title,this.description=a.NODE_INFO.math.multiply.description,this.addOutput("output",o.Type.NUMBER)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputsCount();let e=1;for(let i=this.dynamicInputStartPosition;i<t;i++)e*=this.getInputData(i);this.setOutputData(0,e)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("math/multiply",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,this.title=a.NODE_INFO.math.divide.title,this.description=a.NODE_INFO.math.divide.description,this.addOutput("output",o.Type.NUMBER)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputsCount();let e=1,i=0;for(let s=this.dynamicInputStartPosition;s<t;s++){if(i=this.getInputData(s),!i)return void this.setOutputData(0,0);s===this.dynamicInputStartPosition?e=i:e/=i}this.setOutputData(0,e)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("math/divide",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(40),a=i(1),r=i(2);o.default.uiMainIcon,o.default.uiMainColour;class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.math.absolute.title,this.description=r.NODE_INFO.math.absolute.description,this.addInput("input",a.Type.NUMBER),this.addOutput("output",a.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.abs(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math/absolute",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.math.modulus.title,this.description=a.NODE_INFO.math.modulus.description,this.addInputWithSettings("in 1",o.Type.NUMBER,0,"in 1"),this.addInputWithSettings("in 2",o.Type.NUMBER,1,"in 2"),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1);null!=t&&null!=e?this.setOutputData(0,t%e):this.setOutputData(0,null)}}s.Container.registerNodeType("math/modulus",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.math.power.title,this.description=a.NODE_INFO.math.power.description,this.addInputWithSettings("in 1",o.Type.NUMBER,0,"in 1"),this.addInputWithSettings("in 2",o.Type.NUMBER,1,"in 2"),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);null!=t&&null!=e?this.setOutputData(0,Math.pow(t,e)):this.setOutputData(0,null)}}s.Container.registerNodeType("math/power",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].acos.title,this.description=a.NODE_INFO["math-advanced"].acos.description,this.addInput("x",o.Type.NUMBER),this.addOutput("acos(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.acos(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/acos",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].asin.title,this.description=a.NODE_INFO["math-advanced"].asin.description,this.addInput("x",o.Type.NUMBER),this.addOutput("asin(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.asin(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/asin",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].atan.title,this.description=a.NODE_INFO["math-advanced"].atan.description,this.addInput("x",o.Type.NUMBER),this.addOutput("atan(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.atan(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/atan",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].cbrt.title,this.description=a.NODE_INFO["math-advanced"].cbrt.description,this.addInput("x",o.Type.NUMBER),this.addOutput("cbrt(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.cbrt(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/cbrt",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].cos.title,this.description=a.NODE_INFO["math-advanced"].cos.description,this.addInput("x",o.Type.NUMBER),this.addOutput("cos(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.cos(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/cos",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].exp.title,this.description=a.NODE_INFO["math-advanced"].exp.description,this.addInput("x",o.Type.NUMBER),this.addOutput("exp(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.exp(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/exp",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].log.title,this.description=a.NODE_INFO["math-advanced"].log.description,this.addInput("x",o.Type.NUMBER),this.addOutput("log(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.log(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/log",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].log10.title,this.description=a.NODE_INFO["math-advanced"].log10.description,this.addInput("x",o.Type.NUMBER),this.addOutput("log10(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.log10(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/log10",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].sin.title,this.description=a.NODE_INFO["math-advanced"].sin.description,this.addInput("x",o.Type.NUMBER),this.addOutput("sin(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.sin(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/sin",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].sqrt.title,this.description=a.NODE_INFO["math-advanced"].sqrt.description,this.addInput("x",o.Type.NUMBER),this.addOutput("sqrt(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.sqrt(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/sqrt",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-advanced"].tan.title,this.description=a.NODE_INFO["math-advanced"].tan.description,this.addInput("x",o.Type.NUMBER),this.addOutput("tan(x)",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,Math.tan(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("math-advanced/tan",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,super.dynamicInputStartPosition=1,this.title=a.NODE_INFO["math-trigger"]["trigger-add"].title,this.description=a.NODE_INFO["math-trigger"]["trigger-add"].description,this.addInput("trigger",o.Type.BOOLEAN),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.size=this.computeSize(),this.lastTrigger=!1,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(t&&!this.lastTrigger){const t=this.getInputsCount();let e=0;for(let i=this.dynamicInputStartPosition;i<t;i++)e+=this.getInputData(i);this.setOutputData(0,e)}this.lastTrigger=t}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("math-trigger/trigger-add",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,super.dynamicInputStartPosition=1,this.title=a.NODE_INFO["math-trigger"]["trigger-subtract"].title,this.description=a.NODE_INFO["math-trigger"]["trigger-subtract"].description,this.addInput("trigger",o.Type.BOOLEAN),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.lastTrigger=!1,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(t&&!this.lastTrigger){const t=this.getInputsCount();let e=this.getInputData(1);for(let i=this.dynamicInputStartPosition+1;i<t;i++)e-=this.getInputData(i);this.setOutputData(0,e)}this.lastTrigger=t}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("math-trigger/trigger-subtract",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,super.dynamicInputStartPosition=1,this.title=a.NODE_INFO["math-trigger"]["trigger-multiply"].title,this.description=a.NODE_INFO["math-trigger"]["trigger-multiply"].description,this.addInput("trigger",o.Type.BOOLEAN),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.size=this.computeSize(),this.lastTrigger=!1,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(t&&!this.lastTrigger){const t=this.getInputsCount();let e=1;for(let i=this.dynamicInputStartPosition;i<t;i++)e*=this.getInputData(i);this.setOutputData(0,e)}this.lastTrigger=t}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("math-trigger/trigger-multiply",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,super.dynamicInputStartPosition=1,this.title=a.NODE_INFO["math-trigger"]["trigger-divide"].title,this.description=a.NODE_INFO["math-trigger"]["trigger-divide"].description,this.addInput("trigger",o.Type.BOOLEAN),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.size=this.computeSize(),this.lastTrigger=!1,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(t&&!this.lastTrigger){const t=this.getInputsCount();let e=1,i=0;for(let s=this.dynamicInputStartPosition;s<t;s++){if(i=this.getInputData(s),0===i)return void this.setOutputData(0,0);s===this.dynamicInputStartPosition?e=i:e/=i}this.setOutputData(0,e)}this.lastTrigger=t}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("math-trigger/trigger-divide",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-trigger"]["trigger-modulus"].title,this.description=a.NODE_INFO["math-trigger"]["trigger-modulus"].description,this.addInput("trigger",o.Type.BOOLEAN),this.addInputWithSettings("in 1",o.Type.NUMBER,0,"in 1"),this.addInputWithSettings("in 2",o.Type.NUMBER,2,"in 2"),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.lastTrigger=!1,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(t&&!this.lastTrigger){let t=this.getInputData(1),e=this.getInputData(2);null!=t&&null!=e?this.setOutputData(0,t%e):this.setOutputData(0,null)}this.lastTrigger=t}dynamicInputStartPosition(){return 1}}s.Container.registerNodeType("math-trigger/trigger-modulus",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["math-trigger"]["trigger-power"].title,this.description=a.NODE_INFO["math-trigger"]["trigger-power"].description,this.addInput("trigger",o.Type.BOOLEAN),this.addInputWithSettings("in 1",o.Type.NUMBER,0,"in 1"),this.addInputWithSettings("in 2",o.Type.NUMBER,2,"in 2"),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.lastTrigger=!1,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(t&&!this.lastTrigger){const t=this.getInputData(1),e=this.getInputData(2);null!=t&&null!=e?this.setOutputData(0,Math.pow(t,e)):this.setOutputData(0,null)}this.lastTrigger=t}dynamicInputStartPosition(){return 1}}s.Container.registerNodeType("math-trigger/trigger-power",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(6),r=i(279),u=i(2);class d extends n.Node{constructor(){super(),this.outputsCount=0,this.title=u.NODE_INFO.miscellaneous["geo-hash"].title,this.description=u.NODE_INFO.miscellaneous["geo-hash"].description,this.addInputWithSettings("encode",o.Type.JSON,"151.1677778, -34.0316667","Lon at Lat Values Encode"),this.addInputWithSettings("decode",o.Type.STRING,"ww8p1r4t8, ","Hash Decode"),this.addOutput("encode-out",o.Type.STRING),this.addOutput("decode-out",o.Type.JSON)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1);a.isNull(t)||this.setOutputData(0,r.encode(parseInt(t[0]),parseInt(t[1]))),a.isNull(e)||this.setOutputData(1,r.decode(e))}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("miscellaneous/geo-hash",d)},function(t,e){t.exports=require("ngeohash")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NumSeriesGenerator=void 0;const s=i(0),n=i(8),o=i(2),a=i(1);class r extends n.FlexibleNode{constructor(){super(),this.dynamicOutputsExist=!0,this.dynamicInputsExist=!1,this.dynamicSettingsExist=!0,super.dynamicOutputsType=a.Type.NUMBER,this.title=o.NODE_INFO.miscellaneous["num-series-generator"].title,this.description=o.NODE_INFO.miscellaneous["num-series-generator"].description,this.addInputWithSettings("startVal",a.Type.NUMBER,0,"Start Value"),this.addInputWithSettings("addVal",a.Type.NUMBER,1,"Added Value "),this.settings.factor=a.NodeSetting.create({description:"Multiply factor",value:0,type:a.SettingType.NUMBER})}onInputUpdated(){let t=this.getInputData(0),e=this.settings.factor.value;if(void 0!==t&&"number"==typeof t){const i=this.getOutputsCount();let s=this.getInputData(1);"number"!=typeof s&&(s=1);for(let n=0;n<i;n++)this.setOutputData(n,n+t*s+n*e)}}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}e.NumSeriesGenerator=r,s.Container.registerNodeType("miscellaneous/num-series-generator",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.outputsCount=0,this.title=r.NODE_INFO.miscellaneous["append-to-strings"].title,this.description=r.NODE_INFO.miscellaneous["append-to-strings"].description,this.addInputWithSettings("prepend",o.Type.STRING,"","Prepend Value"),this.addInputWithSettings("append",o.Type.STRING,"","Append Value"),this.settings.outputs_count=o.NodeSetting.create({description:"Number of Outputs",value:1,type:o.SettingType.NUMBER}),this.setSettingsConfig({groups:[{outputs_count:{}}]})}init(){this.changeOutputsAndSettings()}onCreated(){this.renameInputsOutputs()}onAdded(){this.outputsCount=this.settings.outputs_count.value,this.onAfterSettingsChange()}onInputUpdated(){this.renameInputsOutputs()}onAfterSettingsChange(){this.changeOutputsAndSettings(),this.renameInputsOutputs(),this.container.db&&this.container.db.updateNode(this.id,this.container.id,{$set:{outputs:this.outputs,settings:this.settings}})}changeOutputsAndSettings(){let t=this.settings.outputs_count.value;t=a.default.clamp(t,1,100),this.settings.outputs_count.value=t,this.outputsCount!=t&&this.changeMyOutputsCount(t)}changeMyOutputsCount(t){const e=t-this.outputsCount;if(0!=e){if(this.changeOutputsCount(t+1,o.Type.STRING),e>0)for(let e=this.outputsCount+1;e<=t;e++){this.settings["output"+e]=o.NodeSetting.create({description:"Output "+e,value:"",type:o.SettingType.STRING});for(let e=this.outputsCount+1;e<=t;e++)this.settingConfigs.groups.push({[`output${e}`]:{weight:5}})}else if(e<0)for(let e=this.outputsCount;e>t;e--)delete this.settings["output"+e],this.settingConfigs.groups.pop();this.outputsCount=t}}renameInputsOutputs(){const t=this.getInputData(0),e=this.getInputData(1);for(let i=1;i<=this.outputsCount;i++){const s=this.settings["output"+i].value||"";this.outputs[i].name=i+" | "+s,this.setOutputData(i,""+t+s+e)}}}s.Container.registerNodeType("miscellaneous/append-to-strings",u)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),o=i(10),a=i(0),r=i(3),u=i(2),d=i(5),l=i(1),p=i(7),h=i(46),c=i(283);class g extends r.Node{constructor(){super(),this.title=u.NODE_INFO.nube["get-schedules"].title,this.description=u.NODE_INFO.nube["get-schedules"].description,this.addInputWithSettings("enable",l.Type.BOOLEAN,!0,"Enable"),this.addOutput("data",l.Type.JSON),this.addOutput("error",l.Type.BOOLEAN),this.settings.interval=l.NodeSetting.create({description:"Update Interval (min 10 seconds)",type:l.SettingType.NUMBER,value:60}),this.settings.time=l.NodeSetting.create({description:"Units",type:l.SettingType.DROPDOWN,config:{items:[{value:p.TIME_TYPE.SECONDS,text:"Seconds"},{value:p.TIME_TYPE.MINUTES,text:"Minutes"},{value:p.TIME_TYPE.HOURS,text:"Hours"}]},value:p.TIME_TYPE.SECONDS}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]})}onAdded(){return s(this,void 0,void 0,(function*(){this.properties.scheduleData&&this.setOutputData(0,this.properties.scheduleData),yield this.onAfterSettingsChange()}))}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){this.setExecuteInterval(),yield this.onInputUpdated()}))}onInputUpdated(){return s(this,void 0,void 0,(function*(){yield this.getDittoSchedules()}))}onExecute(){return s(this,void 0,void 0,(function*(){yield this.getDittoSchedules()}))}getDittoSchedules(){return s(this,void 0,void 0,(function*(){if(this.side===d.Side.server&&this.getInputData(0))try{const t=yield h.default.getDeviceIdDb(),{username:e,password:i}=o.default.ditto,s=o.default.ditto.baseURL,a=yield n.default({method:"get",url:s+t+"/features/schedules/properties",headers:{"Content-Type":"application/json",Authorization:`Basic ${c(`${e}:${i}`)}`}});this.setOutputData(0,a.data,!1),this.setOutputData(1,!1),this.properties.scheduleData=a.data,this.persistProperties(!1,!0)}catch(t){return this.setOutputData(0,null),this.setOutputData(1,t),void this.debugErr(t)}}))}setExecuteInterval(){let t=this.settings.interval.value;t=p.default.timeConvert(t,this.settings.time.value),t=Math.max(t,1e4),this.EXECUTE_INTERVAL=t}}a.Container.registerNodeType("nube/get-schedules",g)},function(t,e){t.exports=require("btoa")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO["num-transform"].round.title,this.description=o.NODE_INFO["num-transform"].round.description,this.addInput("input",a.Type.NUMBER),this.addOutput("output",a.Type.NUMBER),this.settings.decimals=a.NodeSetting.create({description:"Decimal Places (Limit 5)",value:1,type:a.SettingType.NUMBER})}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.settings.decimals.value;t>5&&(t=5),this.emitTransformedInput(e=>e.toFixed(t))}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("num-transform/round",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["num-transform"].floor.title,this.description=a.NODE_INFO["num-transform"].floor.description,this.addInput("input",o.Type.NUMBER),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){this.emitTransformedInput(t=>Math.floor(t))}}s.Container.registerNodeType("num-transform/floor",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["num-transform"].ceil.title,this.description=a.NODE_INFO["num-transform"].ceil.description,this.addInput("input",o.Type.NUMBER),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){this.emitTransformedInput(t=>Math.ceil(t))}}s.Container.registerNodeType("num-transform/ceil",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["num-transform"].limit.title,this.description=a.NODE_INFO["num-transform"].limit.description,this.addInput("input",o.Type.NUMBER),this.addInputWithSettings("min",o.Type.NUMBER,0,"min",!1),this.addInputWithSettings("max",o.Type.NUMBER,5,"max",!1),this.addOutput("output",o.Type.NUMBER)}onCreated(){this.setOutputData(0,this.settings.min.value)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);t>=i?this.setOutputData(0,i):t<=e?this.setOutputData(0,e):this.setOutputData(0,t)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("num-transform/limit",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.interval=250,this.title=r.NODE_INFO["num-transform"].scale.title,this.description=r.NODE_INFO["num-transform"].scale.description,this.addInput("input",o.Type.NUMBER),this.addInputWithSettings("in-min",o.Type.NUMBER,0,"Minimum Input",!1),this.addInputWithSettings("in-max",o.Type.NUMBER,100,"Maximum Input",!1),this.addInputWithSettings("out-min",o.Type.NUMBER,0,"Minimum Output",!1),this.addInputWithSettings("out-max",o.Type.NUMBER,10,"Maximum Output",!1),this.addOutput("output",o.Type.NUMBER),this.lastTime=Date.now()}onAdded(){this.onInputUpdated()}onAfterSettingsChange(){this.onInputUpdated()}onInputUpdated(){let t=Date.now();if(t-this.lastTime>=this.interval){this.lastTime=t;let e=this.getInputData(0);const i=this.getInputData(1),s=this.getInputData(2),n=this.getInputData(3),o=this.getInputData(4);null==e?this.setOutputData(0,0):(e=a.default.remap(e,i,s,n,o),this.setOutputData(0,e.toFixed(1)))}}}s.Container.registerNodeType("num-transform/scale",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(5),a=i(1),r=i(4),u=i(2);class d extends n.Node{constructor(){super(),this.title=u.NODE_INFO["num-transform"]["linear-shaper"].title,this.description=u.NODE_INFO["num-transform"]["linear-shaper"].description,this.addInput("input",a.Type.NUMBER),this.settings.inputs=a.NodeSetting.create({description:"Inflection Points Count",value:3,type:a.SettingType.NUMBER}),this.settings.in1=a.NodeSetting.create({description:"output value @ input = 0",value:0,type:a.SettingType.NUMBER}),this.settings.in2=a.NodeSetting.create({description:"output value @ input = 50",value:0,type:a.SettingType.NUMBER}),this.settings.in3=a.NodeSetting.create({description:"output value @ input = 100",value:0,type:a.SettingType.NUMBER}),this.addInput("[0]",a.Type.NUMBER),this.addInput("[50]",a.Type.NUMBER),this.addInput("[100]",a.Type.NUMBER),this.addOutput("output",a.Type.NUMBER)}onAfterSettingsChange(){const t=this.getInputsCount();let e=this.settings.inputs.value;if(e=r.default.clamp(e,3,100),e+=1,e!=t){if(this.changeInputsCount(e,a.Type.NUMBER),e>4)for(let t=4;t<e;t++)this.settings["in"+t]||(this.settings["in"+t]=a.NodeSetting.create({description:"in "+t,value:0,type:a.SettingType.NUMBER}));for(let i=e;i<t;i++)delete this.settings["in"+i];this.renameInputsAndSettings(e),this.side==o.Side.editor&&this.updateInputsLabels(),this.onInputUpdated()}}renameInputsAndSettings(t){t-=1,this.inputs[1].name="[0]";for(let e=1;e<t;e++){let i=(100/(t-1)*e).toFixed(2).replace(/[.,]00$/,"");this.inputs[e+1].name="["+i+"]",this.settings["in"+(e+1)]=a.NodeSetting.create({description:"output value @ input = "+i,value:0,type:a.SettingType.NUMBER})}this.updateNodeInput()}onInputUpdated(){const t=this.getInputData(0);if(null==t)return void this.setOutputData(0,null,!0);const e=r.default.clamp(t,0,100),i=100/(this.getInputsCount()-1-1),s=e/i;if(e%i==0){let t=this.getInputData(s+1);return r.default.hasInput(t)||(t=this.settings["in"+(s+1)].value),t=Number(t),void this.setOutputData(0,t)}const n=s-Math.floor(s),o=Math.floor(s);console.log(s,"stepIndex"),console.log(o,"startValueIndex"),console.log("in"+(o+1),"'in' + (startValueIndex + 1)");let a=this.getInputData(o+1);r.default.hasInput(a)||(a=this.settings["in"+(o+1)].value);let u=this.getInputData(o+2);r.default.hasInput(u)||(u=this.settings["in"+(o+2)].value);let d=r.default.remap(n,0,1,a,u);this.setOutputData(0,d,!0)}}s.Container.registerNodeType("num-transform/linear-shaper",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.updateInterval=500,this.title=r.NODE_INFO["num-transform"].fade.title,this.description=r.NODE_INFO["num-transform"].fade.description,this.addInput("enable",o.Type.BOOLEAN),this.addInputWithSettings("interval",o.Type.NUMBER,1,"Interval",!1),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]}),this.addInputWithSettings("from",o.Type.NUMBER,0,"To Value",!1),this.addInputWithSettings("to",o.Type.NUMBER,100,"From Value",!1),this.addOutput("output"),this.addOutput("out=to"),this.updateInterval=250}onAdded(){this.lastEnable=!1,this.timerFinished=!1,this.setOutputData(1,!1),this.inputs[1].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}onAfterSettingsChange(){this.inputs[1].name=`[interval] (${this.settings.time.value})`}onInputUpdated(){const t=this.getInputData(0);if(!t&&this.lastEnable)return clearInterval(this.timeoutFunc),this.setOutputData(0,0),this.setOutputData(1,!1),this.timerFinished=!1,void(this.lastEnable=t);if(!t)return this.setOutputData(0,0),void this.setOutputData(1,!1);const e=this.getInputData(3);if(t&&this.timerFinished)return this.setOutputData(0,e),void this.setOutputData(1,!0);const i=this.getInputData(2);let s=this.getInputData(1);s=a.default.timeConvert(s,this.settings.time.value),t&&!this.lastEnable?(this.stepSize=(e-i)/(s/this.updateInterval),this.currentVal=i,this.timeoutFunc=setInterval(()=>{this.update()},this.updateInterval)):!t&&this.lastEnable&&(clearInterval(this.timeoutFunc),this.setOutputData(0,0),this.timerFinished=!1),this.lastEnable=t}update(){let t=this.getInputData(3);const e=this.currentVal+this.stepSize;if(e>=t)return clearInterval(this.timeoutFunc),this.setOutputData(0,t),this.setOutputData(1,!0),this.timerFinished=!0,void(this.currentVal=0);this.currentVal=e,this.setOutputData(0,e)}}s.Container.registerNodeType("num-transform/fade",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO["num-transform"]["rate-limit"].title,this.description=r.NODE_INFO["num-transform"]["rate-limit"].description,this.addInput("input",o.Type.NUMBER),this.addInputWithSettings("enable",o.Type.BOOLEAN,!0,"Enable",!1),this.addInputWithSettings("step",o.Type.NUMBER,1,"Step Size",!1),this.addInputWithSettings("interval",o.Type.NUMBER,1,"Update Interval",!1),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]}),this.addOutput("output",o.Type.NUMBER),this.lastInterval=1e3,this.lastEnable=!0,this.currentVal=0}onAdded(){this.lastInterval=1e3,this.lastEnable=!0,this.currentVal=0,this.setOutputData(0,null),this.inputs[3].name=`[interval] (${this.settings.time.value})`,this.timeoutFunc=setInterval(()=>{this.step()},this.lastInterval)}onInputUpdated(){if(null==this.getInputData(0))return clearInterval(this.timeoutFunc),this.setOutputData(0,null),void(this.lastEnable=!1);let t=this.getInputData(3);t=a.default.timeConvert(t,this.settings.time.value);const e=this.getInputData(1);e&&!this.lastEnable?(this.currentVal=0,this.timeoutFunc=setInterval(()=>{this.step()},t)):!e&&this.lastEnable?(clearInterval(this.timeoutFunc),this.setOutputData(0,null)):e&&this.lastEnable&&t!==this.lastInterval&&(clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>{this.step()},t)),this.lastInterval=t,this.lastEnable=e}step(){const t=this.getInputData(2);let e=this.getInputData(0);e>=this.currentVal?(this.currentVal=this.currentVal+t,this.currentVal>e&&(this.currentVal=e),this.setOutputData(0,this.currentVal)):e<this.currentVal&&(this.currentVal=this.currentVal-t,this.currentVal<e&&(this.currentVal=e),this.setOutputData(0,this.currentVal))}onAfterSettingsChange(){this.inputs[3].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}}s.Container.registerNodeType("num-transform/rate-limit",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(5),r=i(1);class u extends n.Node{constructor(){super(),this.title=o.NODE_INFO.point["bool-constant"].title,this.description=o.NODE_INFO.point["bool-constant"].description,this.settings.value=r.NodeSetting.create({description:"Payload",type:r.SettingType.DROPDOWN,config:{items:[{value:!1,text:"false"},{value:!0,text:"true"},{value:null,text:"null"}]},value:null}),this.addOutput("output",r.Type.BOOLEAN)}onAdded(){if(this.side!=a.Side.server)return;let t=this.settings.value.value;this.setOutputData(0,t)}onExecute(){}onAfterSettingsChange(){let t=this.settings.value.value;this.setOutputData(0,t)}}s.Container.registerNodeType("point/bool-constant",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.point["num-constant"].title,this.description=r.NODE_INFO.point["num-constant"].description,this.settings.value=o.NodeSetting.create({description:"Value",value:null,type:o.SettingType.NUMBER}),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onAfterSettingsChange()}onExecute(){}onAfterSettingsChange(){const t=this.settings.value.value;this.setOutputData(0,a.default.parseValue(t,o.Type.NUMBER))}}s.Container.registerNodeType("point/num-constant",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1),r=i(4);class u extends n.Node{constructor(){super(),this.title=o.NODE_INFO.point["string-constant"].title,this.description=o.NODE_INFO.point["string-constant"].description,this.settings.value=a.NodeSetting.create({description:"Value",value:"",type:a.SettingType.STRING}),this.addOutput("output",a.Type.STRING)}onAdded(){this.onAfterSettingsChange()}onExecute(){}onAfterSettingsChange(){const t=this.settings.value.value;this.setOutputData(0,r.default.parseValue(t,a.Type.STRING))}}s.Container.registerNodeType("point/string-constant",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(0),o=i(3),a=i(2),r=i(1);class u extends o.Node{constructor(){super(),this.title=a.NODE_INFO.point["json-constant"].title,this.description=a.NODE_INFO.point["json-constant"].description,this.addInputWithSettings("value",r.Type.JSON,'{ "measurement": 22 }',"JSON value"),this.settings.passNull=r.NodeSetting.create({description:"Send null if not a match",value:!1,type:r.SettingType.BOOLEAN}),this.addOutput("output",r.Type.JSON),this.addOutput("valid-json",r.Type.BOOLEAN),this.addOutput("msg",r.Type.STRING)}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){let t=this.getInputData(0);const e=this.settings.passNull.value;try{s.isJSON(t)&&!s.isEmpty(t)?(this.setOutputData(0,t),this.setOutputData(1,!0),this.setOutputData(2,"valid JSON")):e?(this.setOutputData(0,null),this.setOutputData(1,!1),this.setOutputData(2,"invalid JSON")):(this.setOutputData(1,!1),this.setOutputData(2,"invalid JSON"))}catch(t){this.setOutputData(1,!1),this.setOutputData(2,t)}}onAfterSettingsChange(){this.onInputUpdated()}}n.Container.registerNodeType("point/json-constant",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.BOOLEAN,this.title=a.NODE_INFO.point["bool-writable"].title,this.description=a.NODE_INFO.point["bool-writable"].description,this.addOutput("out",o.Type.BOOLEAN)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputsCount();for(let e=this.dynamicInputStartPosition;e<t;e++){let t=this.getInputData(e);if(null!=t)return void this.setOutputData(0,t)}this.setOutputData(0,null)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("point/bool-writable",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.NUMBER,this.title=a.NODE_INFO.point["num-writable"].title,this.description=a.NODE_INFO.point["num-writable"].description,this.addOutput("out",o.Type.NUMBER)}onAdded(){this.onInputUpdated(),this.size=this.computeSize()}onInputUpdated(){const t=this.getInputsCount();for(let e=this.dynamicInputStartPosition;e<t;e++){let t=this.getInputData(e);if(null!=t)return void this.setOutputData(0,t)}this.setOutputData(0,null)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("point/num-writable",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.STRING,this.title=a.NODE_INFO.point["string-writable"].title,this.description=a.NODE_INFO.point["string-writable"].description,this.addOutput("out",o.Type.STRING)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){for(let t=this.dynamicInputStartPosition;t<this.getInputsCount();t++){let e=this.getInputData(t);if(e)return void this.setOutputData(0,e)}this.setOutputData(0,"")}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("point/string-writable",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(5),a=i(300),r=i(301),u=i(2);class d extends n.Node{constructor(){super(),this.title=u.NODE_INFO.point["generic-point"].title,this.description=u.NODE_INFO.point["generic-point"].description,r.default.addPrioritySettings(this),a.default.addHistorySettings(this),this.setSettingsConfig({groups:[],conditions:{}}),r.default.addPrioritySettingsConfig(this),a.default.addHistorySettingsConfig(this,0,!1)}onCreated(){r.default.priorityOnCreated(this),a.default.historyOnCreated(this)}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){r.default.doPriorityFunctions(this),this.side===o.Side.server&&a.default.doHistoryFunctions(this)}onAfterSettingsChange(){r.default.priorityFunctionsForAfterSettingsChange(this),a.default.historyFunctionsForAfterSettingsChange(this,this.settings.pointName.value),r.default.doPriorityFunctions(this),this.side===o.Side.server&&a.default.doHistoryFunctions(this)}}s.Container.registerNodeType("point/generic-point",d)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(5),o=i(1),a=i(4),r=i(7),u=i(85),d=i(31),l=i(86),p=i(15),h=i(10),c=i(46),g=i(57),m=i(14);class f{static addHistorySettings(t){t.addInput("histTrigger",o.Type.BOOLEAN),t.addOutput("histError",o.Type.ANY),t.addOutput("storedHistCount",o.Type.NUMBER),t.addOutput("lastHistExport",o.Type.STRING);for(let e in t.inputs)t.inputs.hasOwnProperty(e)&&"histTrigger"==t.inputs[e].name&&(t.histTriggerInput=e);for(let e in t.outputs)t.outputs.hasOwnProperty(e)&&("histError"==t.outputs[e].name?t.histErrorOutput=e:"storedHistCount"==t.outputs[e].name?t.storedHistCountOutput=e:"lastHistExport"==t.outputs[e].name&&(t.lastHistExportOutput=e));t.settings.history_group={description:"History Settings",value:"",type:o.SettingType.GROUP},t.settings.databaseType={description:"Database Type",type:o.SettingType.DROPDOWN,config:{items:[{value:0,text:"Nube DB (Postgres)"},{value:1,text:"InfluxDB"}]},value:0},t.settings.enable={description:"History Enable",value:!1,type:o.SettingType.BOOLEAN},t.settings.host={description:"Host",value:"",type:o.SettingType.STRING},t.settings.port={description:"Port",value:"",type:o.SettingType.STRING},t.settings.authentication={description:"Use Authentication",value:!1,type:o.SettingType.BOOLEAN},t.settings.user={description:"Username",value:"",type:o.SettingType.STRING},t.settings.password={description:"Password",value:"",type:o.SettingType.STRING},t.settings.databaseName={description:"Database Name",value:"",type:o.SettingType.STRING},t.settings.tableName={description:"Measurement Name",value:"",type:o.SettingType.STRING},t.settings.pointName={description:"Point Name",value:"",type:o.SettingType.STRING},t.settings.historyMode={description:"History Logging Mode",type:o.SettingType.DROPDOWN,config:{items:[{value:0,text:"Change Of Value (COV)"},{value:1,text:"Periodic"},{value:2,text:"Trigger Only"}]},value:0},t.settings.threshold={description:"COV Threshold",value:0,type:o.SettingType.NUMBER},t.settings.period={description:"Logging Interval",value:15,type:o.SettingType.NUMBER},t.settings.periodUnits={description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"minutes"},t.settings["storage-limit"]={description:"Local Storage Limit (Max 50)",value:25,type:o.SettingType.NUMBER},t.settings.minuteRoundValue={description:"Round minutes up in increments of",value:0,type:o.SettingType.NUMBER},t.settings.decimals={description:"Decimal Places (Limit 5)",value:3,type:o.SettingType.NUMBER},t.settings.timeAsString={description:"Display Timestamp as:",type:o.SettingType.DROPDOWN,config:{items:[{value:!1,text:"Numeric"},{value:!0,text:"String"}]},value:!0},t.settings.alarm_group={description:"Alarm Settings",value:"",type:o.SettingType.GROUP},t.settings.alarms_count={description:"Alarms Count (Max 10)",value:0,type:o.SettingType.NUMBER},t.settings.tags_group={description:"Tag Settings",value:"",type:o.SettingType.GROUP},t.settings.tags_count={description:"Tag Count (Max 10)",value:0,type:o.SettingType.NUMBER}}static addHistorySettingsConfig(t,e=0,i=!0){t.settingConfigs.hasOwnProperty("groups")||t.settingConfigs.hasOwnProperty("conditions")||t.setSettingsConfig({groups:[],conditions:{}}),t.settingConfigs.groups.push({history_group:{}}),t.settingConfigs.groups.push({databaseType:{}}),t.settingConfigs.groups.push({host:{weight:3},port:{weight:1}}),t.settingConfigs.groups.push({user:{},password:{}}),t.settingConfigs.groups.push({period:{weight:2},periodUnits:{}}),t.settingConfigs.conditions.authentication=t=>1==t.databaseType.value,t.settingConfigs.conditions.host=t=>1==t.databaseType.value,t.settingConfigs.conditions.port=t=>1==t.databaseType.value,t.settingConfigs.conditions.databaseName=t=>1==t.databaseType.value,t.settingConfigs.conditions.tableName=t=>1==t.databaseType.value,t.settingConfigs.conditions.user=t=>!!t.authentication.value&&1==t.databaseType.value,t.settingConfigs.conditions.password=t=>!!t.authentication.value&&1==t.databaseType.value,t.settingConfigs.conditions.threshold=t=>!t.historyMode.value,t.settingConfigs.conditions.period=t=>1==t.historyMode.value,t.settingConfigs.conditions.periodUnits=t=>1==t.historyMode.value,t.settingConfigs.conditions.alarm_group=t=>1==t.databaseType.value,t.settingConfigs.conditions.alarms_count=t=>1==t.databaseType.value,t.settingConfigs.conditions.tags_group=t=>1==t.databaseType.value,t.settingConfigs.conditions.tags_count=t=>1==t.databaseType.value,t.settings.authentication&&(t.settingConfigs.groups.push({host:{weight:3},port:{weight:1}}),t.settingConfigs.groups.push({user:{},password:{}}),t.settingConfigs.conditions.user=t=>!!t.authentication.value,t.settingConfigs.conditions.password=t=>!!t.authentication.value),t.properties.alarmsCount=t.settings.alarms_count.value,t.properties.tagsCount=t.settings.tags_count.value,t.properties.valueInput=e||0,t.properties.isOutput=i}static historyOnCreated(t){t.useInterval=!1,t.properties.alarmsCount=0,t.properties.tagsCount=0,t.properties.valueInput=0,t.properties.isOutput=!0,t.properties.pointName="undefined",t.properties.obj=[],t.properties.lastHistoryValue=null,t.properties.dynamicInputStartPosition=2}static doHistoryFunctions(t){return s(this,void 0,void 0,(function*(){let e=null;e=t.properties.isOutput?t.getInputData(t.properties.valueInput):t.outputs[t.properties.valueInput].data,t.getInputData(t.histTriggerInput)&&t.inputs[t.histTriggerInput].updated?yield f.storeLogEntry(t,e):null!=e&&(yield f.checkCOV(t,e))&&(yield f.storeLogEntry(t,e)),t.properties.obj.length>0&&(yield f.trySendStoredData(t)),t.setOutputData(t.storedHistCountOutput,t.properties.obj.length)}))}static trySendStoredData(t){return s(this,void 0,void 0,(function*(){let e=t.settings.decimals.value;e>5&&(e=5);var i=[];t.properties.obj.forEach(s=>{"number"==typeof s.payload&&(s.payload=s.payload.toFixed(e));var n={};n.point=t.properties.pointName||"undefined";for(var o=2;o<Object.keys(s).length-1;o++){var a=Object.keys(s)[o];n[a]=s[a]}for(var r=0;r<10;r++)n["tag"+(r+1)]=s.tags[r]||null;i.push({measurement:t.getInputData(2),fields:{val:s.payload},tags:n,time:s.timestamp})});var s=!1;if(0==t.settings.databaseType.value){var n=[];const e=yield c.default.getDeviceIdDb(),u=yield c.default.getDeviceIdDb();let d=!1,l=!1;var o,a,r;"string"==typeof u&&(d=!0),"string"==typeof u&&(l=!0);const g=h.default.pg.baseURL;i.forEach(t=>{o=t.fields.val,r="string"===(a=typeof o)||"boolean"===a?Number(t.fields.val):o,n.push({deviceid:d?u:"unknownDeviceID",clientid:l?e:"unknownClientID",val:r,point:t.tags.point,ts:m(t.time)._d})}),p.default({method:"post",url:g,data:n}).then((function(){})).catch((function(e){t.setOutputData(t.histErrorOutput,String(e)),s=!0}))}if(1==t.settings.databaseType.value){t.settings.host.value,t.settings.port.value;var u=new g.InfluxDB({host:t.settings.host.value||"localhost",port:t.settings.port.value||8086,protocol:"http",database:t.settings.databaseName.value||"undefined",username:t.settings.authentication.value?t.settings.user.value:"",password:t.settings.authentication.value?d.default.decrypt(t.settings.password.value):""});yield u.writePoints(i,{}).catch(e=>{t.setOutputData(t.histErrorOutput,String(e.code)),s=!0})}s||(t.properties.obj=[],t.setOutputData(t.histErrorOutput,""),t.settings.timeAsString.value?t.setOutputData(t.lastHistExportOutput,m().format(),!0):t.setOutputData(t.lastHistExportOutput,m().valueOf(),!0))}))}static historyFunctionsForAfterSettingsChange(t,e,i=!0){t.properties.pointName=e,0==t.settings.databaseType.value&&(t.settings.alarms_count.value=0,t.settings.tags_count.value=0),f.changeAlarmsCount(t,t.settings.alarms_count.value),setTimeout(()=>{f.renameAlarmInputs(t)},100),f.changeTagsCount(t,t.settings.tags_count.value),f.setPeriodicLogging(t),i&&l.default.persistProperties(t,!0,!0,!0),t.properties.isOutput&&t.onInputUpdated()}static storeLogEntry(t,e){return s(this,void 0,void 0,(function*(){if(null==e)return-1;const i=a.default.clamp(t.settings["storage-limit"].value,0,50),s=a.default.clamp(t.settings.minuteRoundValue.value,0,60),n=s?yield t.nearestFutureMinutes(s,m()):m();let o={payload:e,timestamp:n._d};for(var r=t.properties.dynamicInputStartPosition;r<t.properties.dynamicInputStartPosition+Number(t.properties.alarmsCount);r++){let e=r-t.properties.dynamicInputStartPosition+1;o[t.settings["alarm"+e].value||"alarm"+e]=t.getInputData(r)||"null"}for(var u=[],d=1;d<=Number(t.properties.tagsCount);)t.settings["tag"+d].value&&u.push(t.settings["tag"+d].value),d++;for(o.tags=u,t.properties.obj.push(o);t.properties.obj.length>i;)t.properties.obj.shift();return t.properties.lastHistoryValue=e,l.default.persistProperties(t,!0,!0,!0),t.properties.obj.length}))}static checkCOV(t,e){return s(this,void 0,void 0,(function*(){if(!t.settings.historyMode.value){if(0===t.settings.threshold.value&&e!==t.properties.lastHistoryValue)return!0;const i="number"==typeof e;if(e!==t.properties.lastHistoryValue&&("number"!=typeof t.properties.lastHistoryValue||!i||i&&Math.abs(e-t.properties.lastHistoryValue)>=t.settings.threshold.value))return!0}return!1}))}static setPeriodicLogging(t){if(1!=t.settings.historyMode.value||t.useInterval)1!=t.settings.historyMode.value&&t.useInterval&&(t.useInterval=!1,clearInterval(t.timeoutFunc));else{t.useInterval=!0;let e=t.settings.period.value;e=r.default.timeConvert(e,t.settings.periodUnits.value),t.timeoutFunc=setInterval(()=>s(this,void 0,void 0,(function*(){let e=null;e=t.properties.isOutput?t.getInputData(t.properties.valueInput):t.outputs[t.properties.valueInput].data,yield f.storeLogEntry(t,e),t.properties.obj.length>0&&(yield f.trySendStoredData(t)),t.setOutputData(t.storedHistCountOutput,t.properties.obj.length)})),e)}}static nearestFutureMinutes(t,e){const i=Math.ceil(e.minute()/t)*t;return e.clone().minute(i).second(0)}static changeAlarmsCount(t,e){e>10?(e=10,t.settings.alarms_count.value=10):e<0&&(e=0,t.settings.alarms_count.value=0),t.properties.alarmsCount=Number(t.properties.alarmsCount);let i=e-t.properties.alarmsCount;if(0!=i){t.changeInputsCount(e+t.properties.dynamicInputStartPosition,o.Type.STRING);var s={};if(i>0){for(let i=t.properties.alarmsCount+1;i<=e;i++)s["alarm"+i]={description:"Alarm "+i,value:"",type:o.SettingType.STRING};t.properties.alarmsCount<=0?t.settings=u.default.insertIntoObjectAtPosition(t.settings,s,"alarms_count"):t.settings=u.default.insertIntoObjectAtPosition(t.settings,s,"alarm"+t.properties.alarmsCount)}else if(i<0)for(let i=t.properties.alarmsCount;i>e;i--)delete t.settings["alarm"+i];t.properties.alarmsCount=e}}static renameAlarmInputs(t){for(let e=1;e<=t.properties.alarmsCount;e++){let i=t.settings["alarm"+e].value;i.length>20&&(i="..."+i.substr(i.length-20,20)),t.inputs[t.properties.dynamicInputStartPosition+e-1].name="alarm"+e+" | "+i}if(t.side==n.Side.editor){for(let e=1;e<=t.properties.alarmsCount;e++)t.inputs[t.properties.dynamicInputStartPosition+e-1].label=t.inputs[t.properties.dynamicInputStartPosition+e-1].name;t.setDirtyCanvas(!0,!0)}}static changeTagsCount(t,e){e>10?(e=10,t.settings.tags_count.value=10):e<0&&(e=0,t.settings.tags_count.value=0),t.properties.tagsCount=Number(t.properties.tagsCount);let i=e-t.properties.tagsCount;if(0!=i){var s={};if(i>0){for(let i=t.properties.tagsCount+1;i<=e;i++)s["tag"+i]={description:"Tag "+i,value:"",type:o.SettingType.STRING};0==t.properties.tagsCount?t.settings=u.default.insertIntoObjectAtPosition(t.settings,s,"tags_count"):t.settings=u.default.insertIntoObjectAtPosition(t.settings,s,"tag"+t.properties.tagsCount)}else if(i<0)for(let i=t.properties.tagsCount;i>e;i--)delete t.settings["tag"+i];t.properties.tagsCount=e}}static findMainContainer(t){return t.hasOwnProperty("container")?f.findMainContainer(t.container):t}static persistProperties(t){t.container.db&&t.container.db.updateNode(t.id,t.container.id,{$set:{properties:t.properties,inputs:t.inputs,settings:t.settings}})}}e.default=f},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(1),o=i(86);class a{static addPrioritySettings(t){t.properties.priorityStartInput=t.getFreeInputId(),t.properties.priorityStartOutput=t.getFreeOutputId(),t.addInput("inputValue",n.Type.ANY),t.addInput("inputPriority",n.Type.NUMBER),t.addOutput("outputValue",n.Type.ANY),t.addOutput("outputPriority",n.Type.NUMBER),t.addOutput("outputJSON",n.Type.STRING);for(let e in t.inputs)"inputValue"==t.inputs[e].name?t.properties.valueInput=e:"inputPriority"==t.inputs[e].name&&(t.properties.priorityInput=e);for(let e in t.outputs)"outputValue"==t.outputs[e].name?t.properties.valueOutput=e:"outputPriority"==t.outputs[e].name?t.properties.priorityOutput=e:"outputJSON"==t.outputs[e].name&&(t.properties.jsonOutput=e);t.settings.input_group={description:"Input Settings",value:"",type:n.SettingType.GROUP},t.settings.decimals={description:"Decimal Places (Limit 5)",value:3,type:n.SettingType.NUMBER},t.settings.inputMethod={description:"Input Method",type:n.SettingType.DROPDOWN,config:{items:[{value:0,text:"Value and Priority"},{value:1,text:"Priority Array"},{value:2,text:"JSON"}]},value:0},t.properties.priorityLevelItems=Array(16).fill(null).map((t,e)=>({value:e+1,text:(e+1).toString()})),t.settings.priorityLevel={description:"Write Priority Level",type:n.SettingType.DROPDOWN,config:{items:t.properties.priorityLevelItems},value:16},t.settings.in1={description:"in1",value:!1,type:n.SettingType.BOOLEAN},t.settings.in2={description:"in2",value:!1,type:n.SettingType.BOOLEAN},t.settings.in3={description:"in3",value:!1,type:n.SettingType.BOOLEAN},t.settings.in4={description:"in4",value:!1,type:n.SettingType.BOOLEAN},t.settings.in5={description:"in5",value:!1,type:n.SettingType.BOOLEAN},t.settings.in6={description:"in6",value:!1,type:n.SettingType.BOOLEAN},t.settings.in7={description:"in7",value:!1,type:n.SettingType.BOOLEAN},t.settings.in8={description:"in8",value:!1,type:n.SettingType.BOOLEAN},t.settings.in9={description:"in9",value:!1,type:n.SettingType.BOOLEAN},t.settings.in10={description:"in10",value:!1,type:n.SettingType.BOOLEAN},t.settings.in11={description:"in11",value:!1,type:n.SettingType.BOOLEAN},t.settings.in12={description:"in12",value:!1,type:n.SettingType.BOOLEAN},t.settings.in13={description:"in13",value:!1,type:n.SettingType.BOOLEAN},t.settings.in14={description:"in14",value:!1,type:n.SettingType.BOOLEAN},t.settings.in15={description:"in15",value:!1,type:n.SettingType.BOOLEAN},t.settings.in16={description:"in16",value:!1,type:n.SettingType.BOOLEAN}}static addPrioritySettingsConfig(t){t.settingConfigs.hasOwnProperty("groups")||t.settingConfigs.hasOwnProperty("conditions")||t.setSettingsConfig({groups:[],conditions:{}}),t.settingConfigs.groups.push({input_group:{}}),t.settingConfigs.conditions.priorityLevel=t=>0==t.inputMethod.value,t.settingConfigs.conditions.in1=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in2=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in3=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in4=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in5=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in6=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in7=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in8=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in9=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in10=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in11=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in12=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in13=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in14=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in15=t=>1==t.inputMethod.value,t.settingConfigs.conditions.in16=t=>1==t.inputMethod.value,t.properties.priorityArray={};for(var e=1;e<16;e++)t.properties.priorityArray[String(e)]=null;t.properties.inputMethod=t.settings.inputMethod.value,t.properties.prioritySettingsArray=new Array(16).fill(!1)}static priorityOnCreated(t){t.properties.dynamicInputStartPosition=t.getInputsCount(),o.default.persistProperties(t,!0,!0,!0,!0)}static doPriorityFunctions(t){return s(this,void 0,void 0,(function*(){let e=null,i=null;switch(t.properties.inputMethod){case 0:e=t.getInputData(t.properties.priorityStartInput),null==e&&(e=null),i=t.getInputData(t.properties.priorityStartInput+1)||16,(i>16||null==i)&&(i=16),t.properties.priorityArray[String(i)]=e;break;case 1:var s=0;t.properties.prioritySettingsArray.forEach(t=>{t&&s++});for(var n=0;n<s;n++){e=t.getInputData(t.properties.priorityStartInput+n),null==e&&(e=null);const i=t.inputs[t.properties.priorityStartInput+n].name;if(i.startsWith("in")){const s=Number(i.replace(/\D/g,""));isNaN(s)||(t.properties.priorityArray[`${s}`]=e)}}break;case 2:if(e=t.getInputData(t.properties.priorityStartInput),"string"==typeof e)try{t.properties.priorityArray=JSON.parse(e)}catch(t){console.log("PRIORITY ARRAY JSON ERROR: ",t)}}const o=Object.values(t.properties.priorityArray).findIndex(t=>null!=t)+1;o<=0?(t.setOutputData(t.properties.priorityStartOutput,null),t.setOutputData(t.properties.priorityStartOutput+1,null),t.setOutputData(t.properties.priorityStartOutput+2,null)):(t.setOutputData(t.properties.priorityStartOutput,t.properties.priorityArray[String(o)]),t.setOutputData(t.properties.priorityStartOutput+1,o),t.setOutputData(t.properties.priorityStartOutput+2,t.properties.priorityArray))}))}static priorityFunctionsForAfterSettingsChange(t){return s(this,void 0,void 0,(function*(){if(t.properties.inputMethod!==t.settings.inputMethod.value)switch(a.initializePriorityArray(t),t.settings.inputMethod.value){case 0:2==t.properties.inputMethod?t.removeInputAtPosition(t.properties.priorityStartInput):1==t.properties.inputMethod&&a.updatePriorityInputsFromSettings(t,!0),t.addInputAtPosition(t.properties.priorityStartInput,"inputValue",n.Type.ANY),t.addInputAtPosition(t.properties.priorityStartInput+1,"inputPriority",n.Type.NUMBER);break;case 1:2==t.properties.inputMethod?t.removeInputAtPosition(t.properties.priorityStartInput):0==t.properties.inputMethod&&(t.removeInputAtPosition(t.properties.priorityStartInput),t.removeInputAtPosition(t.properties.priorityStartInput)),a.updatePriorityInputsFromSettings(t);break;case 2:1==t.properties.inputMethod?a.updatePriorityInputsFromSettings(t,!0):0==t.properties.inputMethod&&(t.removeInputAtPosition(t.properties.priorityStartInput),t.removeInputAtPosition(t.properties.priorityStartInput)),t.addInputAtPosition(t.properties.priorityStartInput,"inputJSON",n.Type.ANY)}else 1==t.properties.inputMethod&&a.updatePriorityInputsFromSettings(t);t.properties.inputMethod=t.settings.inputMethod.value,o.default.persistProperties(t,!0,!0,!0)}))}static updatePriorityInputsFromSettings(t,e=!1){return s(this,void 0,void 0,(function*(){const i=t.properties.priorityStartInput;for(var s=new Array(16).fill(!1),o=new Array(16).fill(-1),a=0;a<16;a++){if(s[a]=!e&&t.settings["in"+(a+1)].value,t.inputs.hasOwnProperty(`${i+a}`)){const e=t.inputs[`${i+a}`].name;if(e.startsWith("in")){const t=Number(e.replace(/\D/g,""));isNaN(t)||(o[a]=t)}}t.properties.prioritySettingsArray=s}for(var r=0;r<16;r++)if(s[r])for(var u=0;u<=r;u++){const e=o[u];if(e==r+1)break;if(-1==e||e>r+1){t.addInputAtPosition(i+u,"in"+(r+1),n.Type.ANY),o.splice(u,0,r+1),o.pop();break}}else if(!s[r])for(var d=0;d<=r;d++){const e=o[d];if(-1==e||e>r+1)break;if(o[d]==r+1){t.removeInputAtPosition(i+d),o.splice(d,1),o.push(-1);break}}}))}static initializePriorityArray(t){return s(this,void 0,void 0,(function*(){t.properties.priorityArray={};for(var e=1;e<16;e++)t.properties.priorityArray[String(e)]=null}))}}e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(303),n=i(0),o=i(3),a=i(2),r=i(5),u=i(1),d=i(4),l=i(31);class p extends o.Node{constructor(){super(),this.services=["Gmail","Hotmail","Outlook365","Yahoo"].map(t=>({value:t,text:t})),this.title=a.NODE_INFO["protocols/misc"].email.title,this.description=a.NODE_INFO["protocols/misc"].email.description,this.settings.service=u.NodeSetting.create({description:"Service",value:this.services[0].value,type:u.SettingType.DROPDOWN,config:{items:this.services}}),this.settings.user=u.NodeSetting.create({description:"Email",value:"",type:u.SettingType.STRING}),this.settings.pass=u.NodeSetting.create({description:"Password",value:"",type:u.SettingType.PASSWORD}),this.addInput("trigger",u.Type.BOOLEAN),this.addInputWithSettings("recipient",u.Type.STRING,"","To",!1),this.addInputWithSettings("subject",u.Type.STRING,"","Subject",!1),this.addInputWithSettings("message",u.Type.STRING,"","Message",!1),this.addOutput("response",u.Type.STRING),this.addOutput("error",u.Type.STRING)}onInputUpdated(){if(this.side!==r.Side.server)return;let t=this.getInputData(0);if(d.default.hasInput(t)||(t=!1),t==this.lastTrigger)return;if(this.lastTrigger=t,0==t)return;const e=this.settings.service.value,i=this.settings.user.value,n=i,o=this.settings.pass.value,a=this.getInputData(1),u=this.getInputData(2),p=this.getInputData(3);s.createTransport({service:e,auth:{user:i,pass:l.default.decrypt(o)}}).sendMail({from:n,to:a,subject:u,text:p},t=>{t?this.emitError(t.message):this.emitResult(!0)})}emitResult(t){this.setOutputData(0,t),this.setOutputData(1,null)}emitError(t){this.setOutputData(0,null),this.setOutputData(1,t)}}n.Container.registerNodeType("protocols/misc/email",p)},function(t,e){t.exports=require("nodemailer")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(15),n=i(0),o=i(3),a=i(2),r=i(1);var u;!function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t.PATCH="PATCH"}(u||(u={}));class d extends o.Node{constructor(){super(),this.title=a.NODE_INFO["protocols/http"]["http-client"].title,this.description=a.NODE_INFO["protocols/http"]["http-client"].description,this.addInput("request body"),this.addOutput("response"),this.settings.enable=r.NodeSetting.create({description:"Enable",value:!0,type:r.SettingType.BOOLEAN}),this.settings.method=r.NodeSetting.create({description:"Request Method",value:u.GET,type:r.SettingType.DROPDOWN,config:{items:Object.keys(u)}}),this.settings.url=r.NodeSetting.create({description:"HTTP URL",value:"http://",type:r.SettingType.STRING})}onInputUpdated(){if(!this.isEnabled())return;const t=[u.PATCH,u.PUT,u.POST].map(t=>t.toString().toLowerCase()),e=this.getSanitizedUrl(),i=this.getSanitizedMethod(),n=this.inputs[0].data,o=t.includes(i)&&"object"==typeof n?n:void 0;try{this.validateMethod(i),s.default.request({url:e,method:i,data:o}).then(t=>this.setOutputData(0,t.data),t=>this.debugErr(t.message))}catch(t){this.debugErr(t.message)}}isEnabled(){return this.settings.enable.value}getSanitizedUrl(){return this.settings.url.value.trim()}getSanitizedMethod(){return this.settings.method.value.trim().toLowerCase()}validateMethod(t){if(-1===Object.keys(u).indexOf(t.toUpperCase()))throw new Error("Unknown HTTP request method: "+t)}onCreated(){}onAdded(){}onAfterSettingsChange(){}}n.Container.registerNodeType("protocols/http-client",d)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),o=i(12),a=i(0),r=i(25),u=i(2),d=i(5),l=i(1),p=i(4),h=i(7),c=i(37),g=i(49);class m extends r.ContainerNode{constructor(){super(),this.pointNodes=[],this.inAlarmTrigger=0,this.inHistoryTrigger=1,this.inInput=2,this.outVal=0,this.outError=1,this.outMessageJson=2,this.outAlarm=3,this.lastInterval=1e3,this.runState=!0,this._ui="ui",this._di="di",this.title=u.NODE_INFO["protocols/nube"]["edge-28-network"].title,this.description=u.NODE_INFO["protocols/nube"]["edge-28-network"].description,this.side!==d.Side.server&&(this.iconImageUrl=u.NODE_INFO["protocols/nube"]["edge-28-network"].iconImageUrl),this.addInputWithSettings("enable",l.Type.BOOLEAN,!0,"Enable"),this.addInputWithSettings("interval",l.Type.NUMBER,2,"Polling Interval"),this.addOutput("connected",l.Type.BOOLEAN),this.addOutput("error",l.Type.STRING),this.headerColor="#184840",this.settings.time=l.NodeSetting.create({description:"Polling Interval Time Setting",type:l.SettingType.DROPDOWN,config:{items:[{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]})}fetchPointValue(t,e,i,o){return s(this,void 0,void 0,(function*(){const s=`${p.default.buildUrl(t,e)}/api/${i}/read/all/${o}`;return(yield n.default.get(s)).data}))}onAdded(){const t=Object.create(null,{onAdded:{get:()=>super.onAdded}});return s(this,void 0,void 0,(function*(){if(t.onAdded.call(this),this.inputs[1].name=`[interval] (${this.settings.time.value})`,clearInterval(this.UI_timeoutFunc),clearInterval(this.DI_timeoutFunc),!this.getInputData(0))return this.setOutputData(0,!1),void(this.runState=!1);let e=this.getInputData(1);e=h.default.timeConvert(e,this.settings.time.value),this.startInputPolling(e),yield this.onInputUpdated()}))}onRemoved(){const t=Object.create(null,{onRemoved:{get:()=>super.onRemoved}});return s(this,void 0,void 0,(function*(){t.onRemoved.call(this),clearInterval(this.UI_timeoutFunc),clearInterval(this.DI_timeoutFunc)}))}startInputPolling(t){this.side===d.Side.server&&(this.UI_timeoutFunc=setInterval(()=>s(this,void 0,void 0,(function*(){yield this.pollUIs(),this.sendPayloadToPointNodesFunc()})),t),this.DI_timeoutFunc=setInterval(()=>s(this,void 0,void 0,(function*(){yield this.pollDIs(),this.sendPayloadToPointNodesFunc()})),t+5))}pollUIs(){return s(this,void 0,void 0,(function*(){try{this.edgeReadUI_Store=yield this.fetchPointValue(c.edgeIp,c.edgePort,c.edgeApiVer,this._ui),this.setOutputData(0,!0),this.setOutputData(1,!1)}catch(t){this.debugInfo(`ERROR: getting edge point type: ${this._ui} ${t}`),this.setOutputData(0,!1),this.setOutputData(1,!0)}}))}pollDIs(){return s(this,void 0,void 0,(function*(){try{this.edgeReadDI_Store=yield this.fetchPointValue(c.edgeIp,c.edgePort,c.edgeApiVer,this._di),this.setOutputData(0,!0),this.setOutputData(1,!1)}catch(t){this.debugInfo(`ERROR: getting edge point type: ${this._di} ${t}`),this.setOutputData(0,!1),this.setOutputData(1,!0)}}))}pollInputsAndSend(){return s(this,void 0,void 0,(function*(){this.side===d.Side.server&&(yield this.pollUIs(),yield this.pollDIs(),this.sendPayloadToPointNodesFunc())}))}sendPayloadToPointNodesFunc(){if(this.side===d.Side.server)for(let t of this.pointNodes)g.default.sendPayloadToChild(t,{pointsDI:this.edgeReadDI_Store,pointsUI:this.edgeReadUI_Store})}subscribe({action:t,payload:e}){switch(t){case c.ADD_POINT:this.pointNodes.push(e);break;case c.REMOVE_POINT:this.pointNodes=this.pointNodes.filter(t=>t.id!==e.id);break;default:this.debugWarn("Request action doesn't match")}}onInputUpdated(){return s(this,void 0,void 0,(function*(){if(this.side!==d.Side.server)return;let t=this.getInputData(0);if(!t&&this.runState)return clearInterval(this.UI_timeoutFunc),clearInterval(this.DI_timeoutFunc),this.setOutputData(0,!1,!0),void(this.runState=!1);if(!t&&!this.runState)return this.setOutputData(0,!1,!0),void(this.runState=!1);if(t){let t=this.getInputData(1);if(t=h.default.timeConvert(t,this.settings.time.value),this.runState)return void(t!=this.lastInterval&&(this.lastInterval=t,clearInterval(this.UI_timeoutFunc),clearInterval(this.DI_timeoutFunc),this.startInputPolling(t)));if(!this.runState)return this.runState=!0,void this.startInputPolling(t);yield this.pollInputsAndSend()}}))}onAfterSettingsChange(t){const e=Object.create(null,{onAfterSettingsChange:{get:()=>super.onAfterSettingsChange}});return s(this,void 0,void 0,(function*(){e.onAfterSettingsChange.call(this,t),this.side===d.Side.server&&(yield this.onInputUpdated())}))}}a.Container.registerNodeType(o.EDGE_28_NETWORK,m)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(12),o=i(0),a=i(3),r=i(2),u=i(5),d=i(1),l=i(4),p=i(307),h=i(59),c=i(308),g=i(37),m=i(87),f=i(49);var O,y;!function(t){t[t.DIGITAL=1]="DIGITAL",t[t.UI_DIGITAL=2]="UI_DIGITAL",t[t._0_10DC=3]="_0_10DC",t[t._0_20MA=4]="_0_20MA",t[t._4_20MA=5]="_4_20MA",t[t._10K_THERMISTOR=6]="_10K_THERMISTOR"}(O||(O={})),function(t){t.DIGITAL="Digital",t.UI_DIGITAL="UI-Digital",t._0_10DC="0-10dc",t._0_20MA="0-20ma",t._4_20MA="4-20ma",t._10K_THERMISTOR="10k-thermistor"}(y||(y={}));class v extends h.default{constructor(){super(),this.title=r.NODE_INFO["protocols/nube"]["edge-28-input"].title,this.description=r.NODE_INFO["protocols/nube"]["edge-28-input"].description,this.addOutput("output",d.Type.NUMBER),this.addOutput("output-json",d.Type.STRING),this.addOutput("error",d.Type.STRING),this.settings.pointEnable=d.NodeSetting.create({description:"Point enable",value:!1,type:d.SettingType.BOOLEAN}),this.settings.pointDebug=d.NodeSetting.create({description:"Point Debug",value:!1,type:d.SettingType.BOOLEAN}),this.settings.pointNumber=d.NodeSetting.create({description:"Point",value:"DI1",type:d.SettingType.DROPDOWN,config:{items:[{value:"DI1",text:"DI1"},{value:"DI2",text:"DI2"},{value:"DI3",text:"DI3"},{value:"DI4",text:"DI4"},{value:"DI5",text:"DI5"},{value:"DI6",text:"DI6"},{value:"DI7",text:"DI7"},{value:"UI1",text:"UI1"},{value:"UI2",text:"UI2"},{value:"UI3",text:"UI3"},{value:"UI4",text:"UI4"},{value:"UI5",text:"UI5"},{value:"UI6",text:"UI6"},{value:"UI7",text:"UI7"}]}}),this.settings.pointType=d.NodeSetting.create({description:"Point Type",value:1,type:d.SettingType.DROPDOWN,config:{items:[{value:O.DIGITAL,text:"Digital"},{value:O.UI_DIGITAL,text:"UI-Digital"},{value:O._0_10DC,text:"0-10dc"},{value:O._0_20MA,text:"0-20ma"},{value:O._4_20MA,text:"4-20ma"},{value:O._10K_THERMISTOR,text:"10k-thermistor"}],value:O.DIGITAL}}),this.settings.value_group=d.NodeSetting.create({description:"Point Settings",value:"",type:d.SettingType.GROUP}),this.settings.lowScale=d.NodeSetting.create({description:"Low scale",value:0,type:d.SettingType.NUMBER}),this.settings.highScale=d.NodeSetting.create({description:"High scale",value:100,type:d.SettingType.NUMBER}),this.settings.decimals=d.NodeSetting.create({description:"Out value precision",value:2,type:d.SettingType.NUMBER}),this.settings.offset=d.NodeSetting.create({description:"Out value offset",value:0,type:d.SettingType.NUMBER}),this.settings.mathFunc=d.NodeSetting.create({description:"Math on output value (optional)",type:d.SettingType.DROPDOWN,config:{items:[{value:p.MATH_FUNC_TYPE.NA,text:"na"},{value:p.MATH_FUNC_TYPE.ADD,text:"add"},{value:p.MATH_FUNC_TYPE.SUBTRACT,text:"subtract"},{value:p.MATH_FUNC_TYPE.MULTIPLY,text:"multiply"},{value:p.MATH_FUNC_TYPE.DIVIDE,text:"divide"},{value:p.MATH_FUNC_TYPE.NUMBER_INVERT,text:"invert"}]},value:p.MATH_FUNC_TYPE.NA}),this.settings.mathValue=d.NodeSetting.create({description:"Enter a value",value:1,type:d.SettingType.NUMBER});const t=[O.DIGITAL,O.UI_DIGITAL];this.setSettingsConfig({groups:[{pointEnable:{},pointDebug:{}},{pointNumber:{},pointType:{}},{decimals:{},offset:{}},{lowScale:{},highScale:{}},{mathFunc:{},mathValue:{}}],conditions:{decimals:e=>{const i=e.pointType.value;return!t.includes(i)},offset:e=>{const i=e.pointType.value;return!t.includes(i)},lowScale:e=>{const i=e.pointType.value;return!t.includes(i)},highScale:e=>{const i=e.pointType.value;return!t.includes(i)},mathValue:t=>{const e=t.mathFunc.value;return![p.MATH_FUNC_TYPE.NUMBER_INVERT,p.MATH_FUNC_TYPE.NA].includes(e)}}}),this.addHistorySettingsConfig(0,!1)}onAdded(){const t=Object.create(null,{onAdded:{get:()=>super.onAdded}});return s(this,void 0,void 0,(function*(){this.updateTitle(),t.onAdded.call(this),this.side===u.Side.server&&(yield l.default.sleep(1e3),f.default.addPoint(this.getParentNode(),this))}))}onAfterSettingsChange(){const t=Object.create(null,{onAfterSettingsChange:{get:()=>super.onAfterSettingsChange}});return s(this,void 0,void 0,(function*(){yield t.onAfterSettingsChange.call(this),this.side===u.Side.server&&(this.updateTitle(),this.sendPointValue(this.out),this.broadcastSettingsToClients(),setTimeout(()=>{this.settings.pointDebug.value=!1},12e4))}))}onRemoved(){super.onRemoved(),f.default.removePoint(this.getParentNode(),this)}sendJson(){return{name:this.name,pointValue:this.out,enable:this.settings.pointEnable.value,units:this.settings.units.value,pointNumber:this.settings.pointNumber.value,pointType:this.settings.pointType.value,pointOffset:this.settings.offset.value}}nodeColour(){!1===this.settings.pointEnable.value?this.setNodeState(a.NodeState.INFO):this.setNodeState(a.NodeState.NORMAL)}sendPointValue(t){this.settings.pointDebug.value;this.setOutputData(0,t),this.setOutputData(1,this.sendJson())}pointOffset(t){let e=this.settings.offset.value;return null===e&&(e=0),parseFloat(t)+parseFloat(e)}pointTypeText(t){switch(t){case O.DIGITAL:return y.DIGITAL;case O.UI_DIGITAL:return y.UI_DIGITAL;case O._0_10DC:return y._0_10DC;case O._0_20MA:return y._0_20MA;case O._4_20MA:return y._4_20MA;case O._10K_THERMISTOR:return y._10K_THERMISTOR;default:this.debugWarn("Unknown type of object")}}updateTitle(){const t=this.settings.pointNumber.value;this.title=`Edge-28-Input: (${t} as ${this.pointTypeText(this.settings.pointType.value)})`,this.broadcastTitleToClients()}pointCalcs(t){const e=this.settings.mathFunc.value,i=this.settings.mathValue.value,s=this.settings.decimals.value,n=this.settings.pointType.value,o=[O.DIGITAL,O.UI_DIGITAL];p.default.validateNumbers(t,i)&&(e!==p.MATH_FUNC_TYPE.NA?o.includes(n)?(this.out=p.default.mathSwitch(e,t,i),this.out=this.pointOffset(this.out),this.sendPointValue(this.out)):(this.out=p.default.mathSwitch(e,t,i),this.out=p.default.decimals(this.out,s),this.out=this.pointOffset(this.out),this.sendPointValue(this.out)):(o.includes(n)?this.out=t:(this.out=p.default.decimals(t,s),this.out=this.pointOffset(this.out)),this.sendPointValue(this.out)))}uiType(t,e,i,s){const n=this.settings.lowScale.value,o=this.settings.highScale.value;switch(t){case O.DIGITAL:this.pointCalcs(m.default.diInvert(e));break;case O.UI_DIGITAL:this.pointCalcs(m.default.uiAsDI(e));break;case O._0_10DC:const t=l.default.clamp(e,0,o);this.pointCalcs(m.default.scaleFromGPIOValue(t,n,o));break;case O._0_20MA:const a=l.default.clamp(e,0,o);this.pointCalcs(m.default.scaleFromGPIOValue(a,n,o));break;case O._4_20MA:const r=m.default.scaleUI420ma(e,i,s);this.pointCalcs(m.default.scale420maToRange(r,n,o));break;case O._10K_THERMISTOR:this.pointCalcs(c.default.calc10kThermistor(e))}}subscribe({action:t,payload:e}){switch(t){case g.SEND_PAYLOAD_TO_CHILD:if(!1===this.settings.pointEnable.value)return;const t=this.settings.pointType.value,i=this.settings.pointNumber.value;let s,n,o;if(t===O.DIGITAL){if(!["DI1","DI2","DI3","DI4","DI5","DI6","DI7"].includes(i))return;try{for(let t of[e])s=t.pointsDI["4_val"][this.settings.pointNumber.value].val;this.uiType(t,s,e)}catch(t){this.debugErr(t)}}else{if(!["UI1","UI2","UI3","UI4","UI5","UI6","UI7"].includes(i))return;try{for(let t of[e])s=t.pointsUI["4_val"][this.settings.pointNumber.value].val,n=t.pointsUI["6_min_range"][this.settings.pointNumber.value],o=t.pointsUI["7_max_range"][this.settings.pointNumber.value];this.uiType(t,s,n,o)}catch(t){this.debugErr(t)}}break;default:this.debugWarn("Request action doesn't match")}}}o.Container.registerNodeType(n.EDGE_28_INPUT,v,n.EDGE_28_NETWORK)},function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.MATH_FUNC_TYPE=void 0,function(t){t[t.NA=0]="NA",t[t.ADD=1]="ADD",t[t.SUBTRACT=2]="SUBTRACT",t[t.MULTIPLY=3]="MULTIPLY",t[t.DIVIDE=4]="DIVIDE",t[t.REMAINDER=5]="REMAINDER",t[t.EXP=6]="EXP",t[t.BOOL_INVERT=7]="BOOL_INVERT",t[t.ONE_TO_TRUE=8]="ONE_TO_TRUE",t[t.TRUE_TO_ONE=9]="TRUE_TO_ONE",t[t.NUMBER_INVERT=10]="NUMBER_INVERT"}(s=e.MATH_FUNC_TYPE||(e.MATH_FUNC_TYPE={}));class n{static clamp(t,e,i){return Math.min(Math.max(t,e),i)}static decimals(t,e){if(isNaN(t))return;const i=t.toFixed(n.clamp(e,0,5));return parseFloat(i),i}static numInvert(t){return 1^t}static trueToOne(t){if("boolean"==typeof t)return t?1:0}static oneToTrue(t){if("number"==typeof t)return!!t}static invert(t){if("boolean"==typeof t)return!t}static mathSwitch(t,e,i){let o;switch(t){case s.NA:o=0;break;case s.ADD:o=e+i;break;case s.SUBTRACT:o=e-i;break;case s.MULTIPLY:o=e*i;break;case s.DIVIDE:o=e/i;break;case s.REMAINDER:case s.EXP:o=1;break;case s.BOOL_INVERT:o=n.invert(e);break;case s.ONE_TO_TRUE:o=n.oneToTrue(e);break;case s.TRUE_TO_ONE:o=n.trueToOne(e);break;case s.NUMBER_INVERT:o=n.numInvert(e)}return o}}e.default=n,n.validateNumbers=(...t)=>t.every(t=>!isNaN(t))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}e.default=s,s.calc10kThermistor=t=>{const e=[.9556905617,.9540427367,.9523006917,.9504602339,.9485172744,.946467535,.944306865,.9420290739,.9396319594,.9371093311,.9344568928,.9316708217,.9287447039,.9256742939,.9224557261,.91908403,.9155539628,.9118616967,.9080003267,.9039690867,.8997620283,.8953731717,.8908015628,.8860418194,.8810918183,.8759457717,.8706035044,.8650596894,.8593146611,.8533643761,.8472041872,.8408402328,.8342674089,.8274824028,.8204910228,.8132897394,.8058858472,.7982715539,.7904548383,.7824349294,.7742229339,.7658146322,.7572185678,.7484302572,.7394743383,.73033582,.7210303644,.7115748456,.7019597739,.6922074256,.6823111222,.6722912061,.6621575094,.6519178717,.6415775039,.6311526306,.6206437806,.6100630156,.5994548717,.588779615,.5780593139,.5673369194,.5565970278,.5458604304,.5351246092,.5244065761,.513722581,.5030878249,.4924882451,.4819615594,.4714876446,.4611024332,.450811465,.4405833684,.4304850415,.4204801987,.4106001113,.4008382911,.3912252038,.3817085907,.3723569356,.3631557389,.3540861978,.3451724444,.3363907538,.3277628108,.3193109318,.3110054108,.3028656927,.2949116408,.2871070734,.2794687028,.272013505,.264698569,.2575375869,.2505444204,.2437330494,.2370527064,.2305799944,.2242619327,.2180410733,.2119941474,.2061319159,.2003937116,.1948594611,.1893929343,.1841473882,.1789825137,.1739791116,.1691445094,.1644078283,.1597735289,.1553259162,.1509105486,.1466923378,.1425957094,.1386248913,.1347001575,.1309926256,.1273378137,.1237375067,.1202802759,.116969961,.1137221844,.1105386486,.107421042,.1044610471,.1015715166,.09875404639,.09610194494,.09343384,.09084241711,.0884225005,.08598938206,.08363729444,.08136762256,.07918171356,.07698514917,.07497021833,.07294627961,.07091327239,.06906601989,.06721124833,.06544711883,.06367616028,.061997282,.06041153422,.05882030111,.05722355406,.05572157039,.05431530289,.05290475159,.05148989689,.05017223272,.04895260508,.04762772774,.04640141447,.045274458,.04414477874,.04301236682,.04187721228,.04084286529,.03980623591,.03887131178,.03793452726,.03699587678,.03605535477,.03511295563,.03427368709,.03343292697,.03269603518,.03185246761,.03111311315,.03037260522,.02963094111,.02888811812,.02825048826,.02761200327,.02697266141,.02633246097,.02569140021,.02504947741,.02451388196,.02397768566,.02333345552,.02279593374,.02236548142,.02182687151,.02128765566,.02085584601,.02042364737],i=[-40,-39,-38,-37,-36,-35,-34,-33,-32,-31,-30,-29,-28,-27,-26,-25,-24,-23,-22,-21,-20,-19,-18,-17,-16,-15,-14,-13,-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150];let s=t;for(let t=0;t<190;t++)if(s<=e[t]&&s>e[t+1]){s=i[t+1]-(s-e[t+1])/(e[t]-e[t+1]);break}return s}},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(6),o=i(12),a=i(0),r=i(2),u=i(5),d=i(1),l=i(59),p=i(37),h=i(87),c=i(49);var g,m;!function(t){t[t.DO=1]="DO",t[t.UO_AS_DIGITAL=2]="UO_AS_DIGITAL",t[t.UO_AS_0_10DC=3]="UO_AS_0_10DC"}(g||(g={})),function(t){t.DO="DO",t.UO_AS_DIGITAL="UO As Digital",t.UO_AS_0_10DC="UO As 0-10dc"}(m||(m={}));class f extends l.default{constructor(){super(),this.uuid=null,this.deviceContainerID=null,this.topic=null,this.newSetting=!1,this.resendTime=12e4,this.inInput=0,this.inAlarmTrigger=1,this.inHistoryTrigger=2,this.title=r.NODE_INFO["protocols/nube"]["edge-28-output"].title,this.description=r.NODE_INFO["protocols/nube"]["edge-28-output"].description,this.addInput("input",d.Type.ANY),this.addOutput("output",d.Type.NUMBER),this.addOutput("output-json",d.Type.JSON),this.properties.pointVal=null,this.settings.pointEnable=d.NodeSetting.create({description:"Point enable",value:!1,type:d.SettingType.BOOLEAN}),this.settings.pointType=d.NodeSetting.create({description:"Point Type",value:g.DO,type:d.SettingType.DROPDOWN,config:{items:[{value:g.DO,text:m.DO},{value:g.UO_AS_DIGITAL,text:m.UO_AS_DIGITAL},{value:g.UO_AS_0_10DC,text:m.UO_AS_0_10DC}]}}),this.settings.inputType=d.NodeSetting.create({description:"Input Type",value:!0,type:d.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Percent (0-100 -> 0-10vdc)"},{value:!1,text:"Voltage (0-10 -> 0-10vdc)"}]}}),this.settings.pointNumber=d.NodeSetting.create({description:"Point",value:"UO1",type:d.SettingType.DROPDOWN,config:{items:[{value:"UO1",text:"UO1"},{value:"UO2",text:"UO2"},{value:"UO3",text:"UO3"},{value:"UO4",text:"UO4"},{value:"UO5",text:"UO5"},{value:"UO6",text:"UO6"},{value:"UO7",text:"UO7"},{value:"DO1",text:"DO1"},{value:"DO2",text:"DO2"},{value:"DO3",text:"DO3"},{value:"DO4",text:"DO4"},{value:"DO5",text:"DO5"},{value:"R1",text:"R1"},{value:"R2",text:"R2"}]}}),this.setSettingsConfig({groups:[{pointNumber:{},pointType:{}},{mathFunc:{},mathValue:{}}],conditions:{mathValue:t=>{const e=t.mathFunc.value;return![10,0].includes(e)},inputType:t=>t.pointType.value===g.UO_AS_0_10DC}}),this.addHistorySettingsConfig()}onAdded(){super.onAdded(),this.updateTitle(),this.side===u.Side.server&&(this.EXECUTE_INTERVAL=6e4,this.lastSendTime=(new Date).valueOf(),this.lastInput=null,this.inputChange())}onExecute(){return s(this,void 0,void 0,(function*(){this.side===u.Side.server&&(new Date).valueOf()-this.resendTime>this.lastSendTime&&(this.lastInput=null,yield this.onInputUpdated())}))}pointType(t){switch(t){case g.DO:return"do";case g.UO_AS_DIGITAL:case g.UO_AS_0_10DC:return"uo";default:this.debugWarn("Unknown type of object")}}pointTypeText(t){switch(t){case g.DO:return m.DO;case g.UO_AS_DIGITAL:return m.UO_AS_DIGITAL;case g.UO_AS_0_10DC:return m.UO_AS_0_10DC;default:this.debugWarn("Unknown type of object")}}onInputUpdated(){const t=Object.create(null,{onInputUpdated:{get:()=>super.onInputUpdated}});return s(this,void 0,void 0,(function*(){yield t.onInputUpdated.call(this),this.inputChange()}))}onRemoved(){super.onRemoved()}onAfterSettingsChange(){const t=Object.create(null,{onAfterSettingsChange:{get:()=>super.onAfterSettingsChange}});return s(this,void 0,void 0,(function*(){yield t.onAfterSettingsChange.call(this),this.updateTitle(),this.broadcastSettingsToClients(),this.inputChange()}))}inputChange(){if(this.side!==u.Side.server)return;const t=this.getInputData(this.inInput);null!=this.lastInput&&t===this.lastInput||this.apiCall(t)}updateTitle(){const t=this.settings.pointNumber.value;if(this.settings.pointType.value==g.UO_AS_0_10DC){const e=this.settings.inputType.value?"0-100 -> 0-10vdc":"0-10 -> 0-10vdc";this.title=`Edge-28-Output: [${t}] ${this.pointTypeText(this.settings.pointType.value)} (${e})`}else this.title=`Edge-28-Output: [${t}] ${this.pointTypeText(this.settings.pointType.value)}`;this.broadcastTitleToClients()}sendJson(){var t=null;return this.settings.pointType.value==g.UO_AS_0_10DC&&(t=this.settings.inputType.value?"Percent (0-100 -> 0-10vdc)":"Voltage (0-10 -> 0-10vdc)"),{name:this.name,pointValue:this.properties.pointVal,enable:this.settings.pointEnable.value,units:this.settings.units.value,pointNumber:this.settings.pointNumber.value,pointType:this.settings.pointType.value,inputType:t}}apiCall(t){if(this.lastInput=t,this.side!==u.Side.server)return;if(!1===this.settings.pointEnable.value)return;const e=this.settings.pointNumber.value;let i=null;const s=t;if(null==t)return;if(this.settings.pointType.value===g.DO?"boolean"==typeof t?i=t?1:0:"string"==typeof t?"1"===t||"true"===t?i=1:"0"!==t&&"false"!==t||(i=0):"number"==typeof t?t>=1?i=1:t<1&&(i=0):this.debugInfo("ERROR: input value must be a int 1 or 0 or a bool"):this.settings.pointType.value===g.UO_AS_DIGITAL?"boolean"==typeof t?i=t?0:100:"string"==typeof t?"1"===t||"true"===t?i=0:"0"!==t&&"false"!==t||(i=100):"number"==typeof t?t>=1?i=0:t<1&&(i=100):this.debugInfo("ERROR: input value must be a int 1 or 0 or a bool"):this.settings.pointType.value===g.UO_AS_0_10DC&&("number"==typeof t?(this.settings.inputType.value||(t*=10),t>=100?i=h.default.scaleToGPIOValue(100,0,100):(t*=.9839,i=h.default.scaleToGPIOValue(t,0,100))):"string"==typeof t&&this.debugInfo("ERROR: input value must be a float")),n.isNull(i))return;const o=this.pointType(this.settings.pointType.value);c.default.writePointValue(p.edgeIp,p.edgePort,p.edgeApiVer,o,e,i,16).then(t=>{this.properties.pointVal=s,this.setOutputData(0,s),this.setOutputData(1,this.sendJson()),this.lastSendTime=(new Date).valueOf()}).catch(t=>{this.debugInfo(`ERROR: getting edge point type: ${o} ${t}`)})}}a.Container.registerNodeType(o.EDGE_28_OUTPUT,f,o.EDGE_28_NETWORK)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Edge28LORAResetNode=void 0;const n=i(15),o=i(0),a=i(3),r=i(2),u=i(5),d=i(1),l=i(4),p=i(7),h=i(37),c=i(49);class g extends a.Node{constructor(){super(),this.title=r.NODE_INFO["protocols/nube"]["edge-28-lora-reset"].title,this.description=r.NODE_INFO["protocols/nube"]["edge-28-lora-reset"].description,this.addInputWithSettings("enableInterval",d.Type.BOOLEAN,!1,"Enable Interval Reset"),this.addInputWithSettings("interval",d.Type.NUMBER,15,"Interval"),this.addInput("trigger",d.Type.BOOLEAN),this.addOutput("lastReset"),this.settings.time=d.NodeSetting.create({description:"Units",type:d.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"minutes"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]})}writePointValue(t,e,i,o,a,r,u){return s(this,void 0,void 0,(function*(){const s=`${l.default.buildUrl(t,e)}/api/${i}/write/${o}/${a}/${r}/${u}`;return(yield n.default.get(s)).data}))}onAdded(){if(this.inputs[1].name=`[interval] (${this.settings.time.value})`,this.side!==u.Side.server)return;let t=this.getInputData(1);t=p.default.timeConvert(t,this.settings.time.value),this.EXECUTE_INTERVAL=t;try{c.default.addPoint(this.getParentNode(),this)}catch(t){}}onExecute(){this.side===u.Side.server&&this.getInputData(0)&&this.resetLORAConnect()}onInputUpdated(){if(this.side!==u.Side.server)return;let t=this.getInputData(1);t=p.default.timeConvert(t,this.settings.time.value),this.EXECUTE_INTERVAL=t;let e=this.getInputData(2);e&&!this.lastTrigger&&this.resetLORAConnect(),this.lastTrigger=e}resetLORAConnect(){if(this.side!==u.Side.server)return;this.writePointValue(h.edgeIp,h.edgePort,h.edgeApiVer,"do","lc",0,16).then(t=>{this.setOutputData(0,(new Date).valueOf(),!0),this.timeoutFunc=setTimeout(()=>{this.writePointValue(h.edgeIp,h.edgePort,h.edgeApiVer,"do","lc",1,16)},2e3)}).catch(t=>this.debugInfo(`ERROR: LoRa Edge-28 Reset - ${t}`))}onAfterSettingsChange(){this.inputs[1].name=`[interval] (${this.settings.time.value})`,this.side===u.Side.server&&this.onInputUpdated()}}e.Edge28LORAResetNode=g,o.Container.registerNodeType("protocols/nube/edge-28-lora-reset",g)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BACnetNetwork=void 0;const s=i(88),n=i(12),o=i(0),a=i(25),r=i(2),u=i(5),d=i(1),l=i(50),p=i(60);class h extends a.ContainerNode{constructor(){super(),this.bacnetClient=null,this.deviceNodes=[],this.inNetworkEnable=0,this.inDiscover=1,this.outMsg=0,this.title=r.NODE_INFO["protocols/bacnet"]["bacnet-network"].title,this.description=r.NODE_INFO["protocols/bacnet"]["bacnet-network"].description,this.addInputWithSettings("enable",d.Type.BOOLEAN,!1,"Network Enable",!1),this.addInput("discover",d.Type.BOOLEAN),this.addOutput("msg",d.Type.STRING),this.settings.interface=d.NodeSetting.create({description:"interface",value:"0.0.0.0",type:d.SettingType.STRING}),this.settings.port=d.NodeSetting.create({description:"port",value:47808,type:d.SettingType.NUMBER}),this.settings.broadcastAddress=d.NodeSetting.create({description:"broadcastAddress",value:"255.255.255.255",type:d.SettingType.STRING}),this.settings.apduTimeout=d.NodeSetting.create({description:"BACnet apduTimeout",value:6e3,type:d.SettingType.NUMBER}),this.settings.networkNumber=d.NodeSetting.create({description:"BACnet network Number (Set to -1 to disable)",value:-1,type:d.SettingType.NUMBER}),this.settings.networkNumberWhoIs=d.NodeSetting.create({description:"BACnet Network Number for Discover",type:d.SettingType.DROPDOWN,config:{items:[{value:0,text:"This network number"},{value:1,text:"Global (0xFFFF)"},{value:2,text:"Blank"}]},value:0}),this.settings.devicePolling=d.NodeSetting.create({description:"Polling time setting in ms",value:2e3,type:d.SettingType.NUMBER})}onAdded(){super.onAdded(),this.initializeBacnetClient()}onAfterSettingsChange(t){super.onAfterSettingsChange(t),this.side===u.Side.server&&this.initializeBacnetClient()}onInputUpdated(){this.inputs[this.inDiscover].updated&&(this.iAm(),this.whoIs()),this.inputs[this.inNetworkEnable].updated&&this.initializeBacnetClient()}whoIs(){if(this.side!==u.Side.server)return;const t=this.settings.interface.value,e=this.settings.networkNumber.value,i=this.settings.networkNumberWhoIs.value;this.bacnetClient?0===i?(this.bacnetClient.whoIs({net:e,interface:t}),this.setOutputData(this.outMsg,`INFO: Send a WhoIs on net: ${e} interface: ${t}`)):1===i?(this.bacnetClient.whoIs({net:65535,interface:t}),this.setOutputData(this.outMsg,`INFO: Send a WhoIs on net: 65535 interface: ${t}`)):2===i&&(this.bacnetClient.whoIs({interface:t}),this.setOutputData(this.outMsg,`INFO: Send a WhoIs on net: BLANK interface: ${t}`)):this.setOutputData(this.outMsg,"ERROR: Failed to send whoIs")}iAm(){this.side===u.Side.server&&(this.setOutputData(this.outMsg,"INFO: On iAm replay"),this.bacnetClient.on("iAm",t=>{this.setOutputData(this.outMsg,`INFO: On iAm replay from device: ${t.payload.deviceId}`)}))}subscribe({action:t,payload:e}){switch(t){case l.ADD_DEVICE:this.deviceNodes.push(e);break;case l.REMOVE_DEVICE:this.deviceNodes=this.deviceNodes.filter(t=>t.id!==e.id);break;case l.GET_BACNET_CLIENT:return this.bacnetClient;case l.GET_NETWORK_NODE:return this;default:this.debugWarn("Request action doesn't match")}}onRemoved(){super.onRemoved(),this.closeBacnetClient()}closeBacnetClient(){this.bacnetClient&&(this.setOutputData(this.outMsg,"INFO: Closing BACnet client..."),this.bacnetClient.close())}initializeBacnetClient(){if(this.side===u.Side.server){this.closeBacnetClient(),this.setOutputData(this.outMsg,"INFO: Initializing BACnet..."),this.bacnetClient=new s({apduTimeout:this.settings.apduTimeout.value,interface:this.settings.interface.value,port:this.settings.port.value,broadcastAddress:this.settings.broadcastAddress.value}),this.bacnetClient?this.setOutputData(this.outMsg,"INFO: Started BACnet Stack :)"):this.setOutputData(this.outMsg,"ERROR: Failed to started BACnet Stack :(");for(let t of this.deviceNodes)p.default.sendPayloadToChild(t,{bacnetClient:this.bacnetClient,networkNode:this})}}}e.BACnetNetwork=h,o.Container.registerNodeType(n.BACNET_NETWORK,h)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(88),o=i(12),a=i(0),r=i(25),u=i(2),d=i(5),l=i(1),p=i(4),h=i(50),c=i(60);var g;!function(t){t[t.STOP=0]="STOP",t[t.START=1]="START"}(g||(g={}));class m extends r.ContainerNode{constructor(){super(),this.bacnetClient=null,this.networkNode=null,this.points=[],this.pointNodes=[],this.isFirst=!0,this.isPolling=!1,this.shouldPoll=!0,this.delayBetweenDevice=100,this.delayBetweenPoint=30,this.networkNumber=null,this.title=u.NODE_INFO["protocols/bacnet"]["bacnet-device"].title,this.description=u.NODE_INFO["protocols/bacnet"]["bacnet-device"].description,this.addInput("get-point-list",l.Type.BOOLEAN),this.addOutput("out",l.Type.STRING),this.addOutput("out msg",l.Type.STRING),this.addOutput("error",l.Type.STRING),this.addOutput("points-discovered",l.Type.STRING),this.addOutput("points-to-poll",l.Type.STRING),this.properties.pointsList=null,this.settings.deviceEnable=l.NodeSetting.create({description:"Device enable",value:!1,type:l.SettingType.BOOLEAN}),this.settings.ip=l.NodeSetting.create({description:"ip",value:"192.168.13.13",type:l.SettingType.STRING}),this.settings.deviceId=l.NodeSetting.create({description:"deviceId",value:2508,type:l.SettingType.NUMBER}),this.settings.port=l.NodeSetting.create({description:"port",value:47808,type:l.SettingType.NUMBER}),this.settings.deviceTypeMstp=l.NodeSetting.create({description:"BACnet MS/TP device",value:!1,type:l.SettingType.BOOLEAN}),this.settings.macAddress=l.NodeSetting.create({description:"BACnet Mac address",value:1,type:l.SettingType.NUMBER}),this.settings.networkNumber=l.NodeSetting.create({description:"BACnet network number ",type:l.SettingType.READONLY})}onAdded(){const t=Object.create(null,{onAdded:{get:()=>super.onAdded}});return s(this,void 0,void 0,(function*(){t.onAdded.call(this),yield p.default.sleep(1e3),this.setBacnetClient(),this.setPayloadsToPointNodes(),this.side===d.Side.server&&(c.default.addDevice(this.getParentNode(),this),this.updateNetworkSettings(),yield this.requestPoll())}))}onAfterSettingsChange(t){super.onAfterSettingsChange(t),this.setPayloadsToPointNodes(),this.requestPoll().then()}onRemoved(){super.onRemoved(),this.shouldPoll=!1,c.default.removeDevice(this.getParentNode(),this)}updateNetworkSettings(){this.side===d.Side.server&&(this.networkNode=c.default.getNetworkNode(this.getParentNode()),this.networkNumber=this.networkNode.settings.networkNumber.value,this.settings.networkNumber.value=this.networkNumber,this.broadcastSettingsToClients(),this.persistSettings())}onInputUpdated(){let t=[];for(let e of this.pointNodes){const i=e.settings;let s={id:e.id,cid:e.id,name:e.name,settings:i};t.push(s)}this.setOutputData(4,JSON.stringify(t)),this.setOutputData(3,JSON.stringify(this.points))}requestPoll(){return s(this,void 0,void 0,(function*(){this.currentPollValue()!==g.START||this.isPolling||(this.isPolling=!0,yield this.polling())}))}currentPollValue(){return this.settings.deviceEnable.value&&this.networkNode.getInputData(this.networkNode.inNetworkEnable)?g.START:g.STOP}setPayloadsToPointNodes(){this.side===d.Side.server&&(this.setOutputData(this.outputMsg,"INFO: Scan devices"),c.singleton.process(()=>this.scanDeviceFunc()).then(t=>{this.points=t,this.sendPayloadToPointNodesFunc()}),c.singleton.process(()=>s(this,void 0,void 0,(function*(){return yield p.default.sleep(this.delayBetweenDevice)}))).then())}sendPayloadToPointNodesFunc(){for(let t of this.pointNodes)c.default.sendPayloadToChild(t,{points:this.points,networkNode:this.networkNode})}setBacnetClient(){this.side===d.Side.server&&(this.bacnetClient=c.default.getBacnetClient(this.getParentNode()))}writePresentValue(t,e,i,s,n,o){this.bacnetClient&&(this.settings.deviceTypeMstp.value?this.bacnetClient.writeProperty({address:t,net:this.networkNumber,adr:[this.settings.macAddress.value]},{type:e,instance:i},85,[{type:o,value:s}],{priority:n},(t,e)=>{console.log(t,e)}):this.bacnetClient.writeProperty(t,{type:e,instance:i},85,[{type:o,value:s}],{priority:n},(t,e)=>{}))}readObjectList(t,e,i){const s=[{objectId:{type:n.enum.ObjectType.DEVICE,instance:e},properties:[{id:n.enum.PropertyIdentifier.OBJECT_LIST}]}];this.bacnetClient&&(this.settings.deviceTypeMstp.value?this.bacnetClient.readPropertyMultiple({address:t,net:this.networkNumber,adr:[this.settings.macAddress.value]},s,s,i):this.bacnetClient.readPropertyMultiple(t,s,i))}readObjectFull(t,e){return this.readObject(t,e,[{id:n.enum.PropertyIdentifier.OBJECT_IDENTIFIER},{id:n.enum.PropertyIdentifier.OBJECT_NAME},{id:n.enum.PropertyIdentifier.OBJECT_TYPE},{id:n.enum.PropertyIdentifier.DESCRIPTION},{id:n.enum.PropertyIdentifier.UNITS},{id:n.enum.PropertyIdentifier.PRESENT_VALUE}])}readObject(t,e,i){return new Promise(s=>{const n=[{objectId:{type:e.type,instance:e.instance},properties:i}];this.bacnetClient&&(this.settings.deviceTypeMstp.value?this.bacnetClient.readPropertyMultiple({address:t,net:this.networkNumber,adr:[this.settings.macAddress.value]},n,(t,e)=>{s({error:t,value:e})}):this.bacnetClient.readPropertyMultiple(t,n,(t,e)=>{s({error:t,value:e})}))})}readProperty(t,e){return new Promise(i=>{this.settings.deviceTypeMstp.value?this.bacnetClient.readProperty({address:t,net:this.networkNumber,adr:[this.settings.macAddress.value]},{type:e.type,instance:e.instance},n.enum.PropertyIdentifier.PRESENT_VALUE,(t,e)=>{i({error:t,value:e})}):this.bacnetClient.readProperty(t,{type:e.type,instance:e.instance},n.enum.PropertyIdentifier.PRESENT_VALUE,(t,e)=>{i({error:t,value:e})})})}readPresentValue(t){return this.readProperty(this.settings.ip.value,t)}findValueById(t,e){const i=t.find((function(t){return t.id===e}));return i&&i.value&&i.value.length>0?i.value[0].value.errorClass?null:i.value[0].value:null}mapToDeviceObject(t){if(!t||!t.values)return null;const e=t.values[0].objectId.instance,i=t.values[0].values;return{objectInfo:e,name:this.findValueById(i,n.enum.PropertyIdentifier.OBJECT_NAME),description:this.findValueById(i,n.enum.PropertyIdentifier.DESCRIPTION),type:this.findValueById(i,n.enum.PropertyIdentifier.OBJECT_TYPE),units:this.findValueById(i,n.enum.PropertyIdentifier.UNITS),presentValue:this.findValueById(i,n.enum.PropertyIdentifier.PRESENT_VALUE)}}scanDeviceFunc(){return s(this,void 0,void 0,(function*(){const t={deviceId:this.settings.deviceId.value,address:this.settings.ip.value};return this.setOutputData(1,`INFO: Scan device ID: ${JSON.stringify(t)}`),this.setOutputData(2,""),new Promise((e,i)=>{this.readObjectList(t.address,t.deviceId,(n,o)=>s(this,void 0,void 0,(function*(){if(n)this.setOutputData(1,""),this.setOutputData(2,`ERROR: while fetching objects: ${JSON.stringify(n)}`),i(n);else{const s=o.values[0].values[0].value;this.setOutputData(1,`INFO: Scan device ID: ${JSON.stringify(t)}`),this.setOutputData(2,"");const n=[];for(const e of s){try{const i=yield this.readObjectFull(t.address,{type:e.value.type,instance:e.value.instance});n.push(i)}catch(t){this.setOutputData(1,""),this.setOutputData(2,`ERROR: while fetching objects: ${JSON.stringify(t)}`),i(t)}yield p.default.sleep(this.delayBetweenDevice)}const a=n.filter(t=>!t.error).map(t=>this.mapToDeviceObject(t.value));this.debugInfo(`BACNET-NETWORK-POINT-NODE: msg from device ${JSON.stringify(a)}`),this.setOutputData(1,`INFO: Scan device ID: ${JSON.stringify(a)}`),e(a)}})))})}))}subscribe({action:t,payload:e}){switch(t){case h.ADD_POINT:this.pointNodes.push(e);break;case h.REMOVE_POINT:this.pointNodes=this.pointNodes.filter(t=>t.id!==e.id);break;case h.GET_NETWORK_NODE:return c.default.getNetworkNode(this.getParentNode());case h.GET_POINTS:return this.points;case h.GET_PRESENT_VALUE:return this.readPresentValue(e);case h.SEND_PAYLOAD_TO_CHILD:this.bacnetClient=e.bacnetClient,this.networkNode=e.networkNode,this.updateNetworkSettings(),this.isFirst||this.setPayloadsToPointNodes(),this.isFirst=!1,this.requestPoll().then();break;case h.WRITE_PRESENT_VALUE:this.writePresentValue(this.settings.ip.value,e[0],e[1],e[2],e[3],e[4]);break;default:this.debugWarn("Request action doesn't match")}}persistSettings(){this.container.db&&this.container.db.updateNode(this.id,this.container.id,{$set:{settings:this.settings,properties:this.properties}})}polling(){return s(this,void 0,void 0,(function*(){this.currentPollValue()===g.START&&this.shouldPoll?(yield c.singleton.process(()=>this.pollingFuncOrTimeout()),yield c.singleton.process(()=>s(this,void 0,void 0,(function*(){return yield p.default.sleep(this.delayBetweenDevice)}))),yield p.default.sleep(this.networkNode.settings.devicePolling.value),yield this.polling()):this.isPolling=!1}))}pollingFuncOrTimeout(){const t=this;return Promise.race([this.pollingFunc(),new Promise((t,e)=>setTimeout(()=>e(new Error("timeout")),this.networkNode.settings.devicePolling.value))]).catch((function(e){t.debugErr(`Error: ${e}`)}))}pollingFunc(){return s(this,void 0,void 0,(function*(){for(let t of this.pointNodes){let e=t.settings.pointsList.value;const i=t.settings.manualPoint.value,s=t.settings.objectType.value,n=t.settings.objectInstance.value;if(i&&(e={type:s,instance:n}),e){const i=yield this.readPresentValue(e);this.debugInfo(`BACNET-NETWORK-DEVICE-NODE: msg from readPresentValue ${JSON.stringify(i)}`),c.default.sendPointValue(t,i),yield p.default.sleep(this.delayBetweenPoint)}}}))}}a.Container.registerNodeType(o.BACNET_DEVICE,m,o.BACNET_NETWORK)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(6),o=i(12),a=i(0),r=i(2),u=i(5),d=i(1),l=i(4),p=i(59),h=i(50),c=i(60);class g extends p.default{constructor(){super(),this.points=[],this.pollCount=0,this.pollCountFail=0,this.inputInNum=0,this.outputOutNum=0,this.jsonOutNum=1,this.errorOutNum=2,this.logsOutNum=3,this.title=r.NODE_INFO["protocols/bacnet"]["bacnet-point"].title,this.description=r.NODE_INFO["protocols/bacnet"]["bacnet-point"].description,this.addInput("input",d.Type.ANY),this.addOutput("output",d.Type.STRING),this.addOutput("output json",d.Type.STRING),this.addOutput("error",d.Type.STRING),this.addOutput("logs",d.Type.STRING),this.settings.pointEnable=d.NodeSetting.create({description:"Point enable",value:!1,type:d.SettingType.BOOLEAN}),this.settings.pointWriteEnable=d.NodeSetting.create({description:"Point write enable",value:!1,type:d.SettingType.BOOLEAN}),this.settings.manualPoint=d.NodeSetting.create({description:"Add point manually",value:!1,type:d.SettingType.BOOLEAN}),this.settings.pointsList=d.NodeSetting.create({description:"Select a point",value:null,type:d.SettingType.DROPDOWN,config:{items:[]}}),this.settings.objectType=d.NodeSetting.create({description:"Output type",type:d.SettingType.DROPDOWN,config:{items:[{value:0,text:"analog-input"},{value:1,text:"analog-output"},{value:2,text:"analog-value"},{value:3,text:"binary-input"},{value:4,text:"binary-output"},{value:5,text:"binary-value"},{value:13,text:"multi-state-input"},{value:14,text:"multi-state-output"},{value:19,text:"multi-state-value"}]},value:0}),this.settings.objectTag=d.NodeSetting.create({description:"Data type value to be written",type:d.SettingType.DROPDOWN,config:{items:[{value:0,text:"NULL(0)"},{value:1,text:"BOOLEAN(1)"},{value:2,text:"UNSIGNED_INTEGER(2)"},{value:3,text:"SIGNED_INTEGER(3)"},{value:4,text:"REAL(4)"},{value:5,text:"DOUBLE(5)"},{value:6,text:"OCTET_STRING(6)"},{value:7,text:"CHARACTER_STRING(7)"},{value:8,text:"BIT_STRING(8)"},{value:9,text:"ENUMERATED(9)"},{value:10,text:"DATE(10)"},{value:11,text:"TIME(11)"},{value:12,text:"OBJECTIDENTIFIER(12)"}]},value:1}),this.settings.objectInstance=d.NodeSetting.create({description:"Point ID",value:1,type:d.SettingType.NUMBER}),this.settings.priority=d.NodeSetting.create({description:"Priority Number",value:16,type:d.SettingType.NUMBER}),this.settings.logs=d.NodeSetting.create({description:"Return full bacnet payload",value:!1,type:d.SettingType.BOOLEAN}),this.setSettingsConfig({conditions:{pointsList:t=>!t.manualPoint.value,objectType:t=>t.manualPoint.value}}),this.addHistorySettingsConfig(0,!1)}onAdded(){const t=Object.create(null,{onAdded:{get:()=>super.onAdded}});return s(this,void 0,void 0,(function*(){t.onAdded.call(this),this.side===u.Side.server&&(yield l.default.sleep(2e3),this.points=c.default.getPoints(this.getParentNode()),this.setPointsListItems(),this.getPresentValue(),c.default.addPoint(this.getParentNode(),this))}))}onInputUpdated(){const t=Object.create(null,{onInputUpdated:{get:()=>super.onInputUpdated}});return s(this,void 0,void 0,(function*(){if(yield t.onInputUpdated.call(this),this.side!==u.Side.server)return;let e,i;const s=this.getInputData(0),o=this.settings.priority.value,a=this.settings.manualPoint.value,r=this.settings.pointsList.value,d=this.settings.objectTag.value;let l=this.settings.pointWriteEnable.value;a&&(e=this.settings.objectType.value,i=this.settings.objectInstance.value),r&&(e=r.type,i=r.instance),n.isNull(s)||!1!==l&&c.default.writePresentValue(this.getParentNode(),[e,i,s,o,d])}))}onAfterSettingsChange(){const t=Object.create(null,{onAfterSettingsChange:{get:()=>super.onAfterSettingsChange}});var e,i,n,o;return s(this,void 0,void 0,(function*(){yield t.onAfterSettingsChange.call(this),this.getPresentValue();const s=c.default.getNetworkNode(this.getParentNode());(null===(i=null===(e=s.settings)||void 0===e?void 0:e.networkNumber)||void 0===i?void 0:i.value)&&(this.networkNumber=null===(o=null===(n=s.settings)||void 0===n?void 0:n.networkNumber)||void 0===o?void 0:o.value)}))}onRemoved(){super.onRemoved(),c.default.removePoint(this.getParentNode(),this)}getPresentValue(){if(this.side!==u.Side.server)return;let t=this.settings.pointsList.value;const e=this.settings.manualPoint.value,i=this.settings.objectType.value,s=this.settings.objectInstance.value;e&&(t={type:i,instance:s}),t&&c.default.getPresentValue(this.getParentNode(),t).then(t=>{this.setPointValue(t)})}setPointValue(t){var e,i,s;if(this.settings.logs.value&&(this.setOutputData(this.logsOutNum,!0,!0),this.debugInfo(`BACNET-NETWORK-POINT-NODE: msg from device ${JSON.stringify(t)}`)),void 0===(null===(s=null===(i=null===(e=null==t?void 0:t.value)||void 0===e?void 0:e.values)||void 0===i?void 0:i[0])||void 0===s?void 0:s.value))return this.setOutputData(this.errorOutNum,!0,!0),void this.debugErr(`BACNET-NETWORK-POINT-NODE: msg from device node is invalid ${JSON.stringify(t)}`);let n,o,a=t.value.values[0].value,r=this.settings.pointEnable.value,u=this.settings.pointWriteEnable.value;const d=this.settings.priority.value,l=this.settings.manualPoint.value,p=this.settings.pointsList.value,h=this.settings.pointsList.config.items;let c;if(l&&(n=this.settings.objectType.value,o=this.settings.objectInstance.value),p&&(n=p.type,o=p.instance,h)){let t=h;for(let e in t)t.hasOwnProperty(e)&&t[e].value.type===p.type&&t[e].value.instance===p.instance&&(c=t[e])}if(t.value){this.pollCount++;const t={name:this.name,pointValue:a,enable:r,pointWriteEnable:u,objectType:n,objectInstance:o,priority:d,bacnetPointName:c,pollCount:this.pollCount,pollCountFail:this.pollCountFail};this.setOutputData(this.outputOutNum,a),this.setJsonOutput(t),this.setOutputData(this.errorOutNum,null,!0)}else this.setOutputData(this.outputOutNum,null,!0),this.setJsonOutput(null),t.error&&(this.setOutputData(this.errorOutNum,"Error on reading value"),this.pollCountFail++)}setJsonOutput(t){return this.setOutputData(this.jsonOutNum,t),t}setPointsListItems(){this.settings.pointsList.config.items=this.points.map(t=>({value:{type:t.type,instance:t.objectInfo},text:t.name})),this.persistConfiguration(),this.broadcastSettingsToClients()}subscribe({action:t,payload:e}){switch(t){case h.SEND_PAYLOAD_TO_CHILD:this.points=e.points,this.setPointsListItems();break;case h.SEND_POINT_VALUE:this.setPointValue(e);break;default:this.debugWarn("Request action doesn't match")}}}a.Container.registerNodeType(o.BACNET_POINT,g,o.BACNET_DEVICE)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BACnetServerRest=void 0;const n=i(4),o=i(6),a=i(0),r=i(3),u=i(2),d=i(1),l=i(5),p=i(10),h=i(15),c=i(61),g=i(62);class m extends r.Node{constructor(){super(),this.inputFault=0,this.inputOneNum=1,this.inputTwoNum=2,this.inputThreeNum=3,this.outConnection=0,this.outNum=1,this.outJson=2,this.messageQueue=[],this.rateLimitMS=200,this.lastInput=null,this.resendTime=Math.floor(60*Math.random())+1,this.host="0.0.0.0",this.port=1717,this.enableDebug=!1,this.title=u.NODE_INFO["protocols/bacnet-server"]["bacnet-server-api"].title,this.description=u.NODE_INFO["protocols/bacnet-server"]["bacnet-server-api"].description,this.properties.pointObject=null,this.settings.selected_point=d.NodeSetting.create({description:"Point Object Id",value:"",type:d.SettingType.READONLY}),this.settings.selected_point_name=d.NodeSetting.create({description:"Point Name",value:"",type:d.SettingType.READONLY}),this.settings.pointsList=d.NodeSetting.create({description:"Points List",type:d.SettingType.AUTOCOMPLETE,config:{items:[]}}),this.settings.enable=d.NodeSetting.create({description:"Enable",value:!0,type:d.SettingType.BOOLEAN}),this.addInput("fault",d.Type.BOOLEAN),this.addInput("in 1",d.Type.NUMBER),this.addInput("in 10",d.Type.NUMBER),this.addInput("in 16",d.Type.NUMBER),this.addOutput("connection",d.Type.ANY),this.addOutput("output",d.Type.ANY),this.addOutput("output-json",d.Type.JSON)}setTopic(){return s(this,void 0,void 0,(function*(){const t=this.getObjectIdentifier();this.topic=`bacnet/server/points/ao/${t}`}))}getTopic(){return this.topic}getPointUUID(){const t=this.getPointObject();if(!o.isNull(t))return t.uuid}getPoints(){return s(this,void 0,void 0,(function*(){yield this.fetchPoints(this.host,this.port)}))}setEnable(){return s(this,void 0,void 0,(function*(){this.enable=this.settings.enable.value}))}getEnable(){return this.enable}getPointObject(){return this.properties.pointObject}setSelectedPoint(){return s(this,void 0,void 0,(function*(){const t=this.getPointObject();if(o.isNull(t))return;const e=t.object_name,i=t.object_type,s=t.address,n=`${i}-${s}`,a=`${i}`;this.setAddress(s),this.setObjectType(a),this.setObjectIdentifier(n),this.pointName=`${n} -> ${e}`,this.settings.selected_point_name.value=e,this.broadcastSettingsToClients()}))}getAddress(){return this.address}setAddress(t){this.address=t}getObjectType(){return this.objectType}setObjectType(t){this.objectType=t}getSelectedPoint(){return this.selectedPoint}setObjectIdentifier(t){this.settings.selected_point.value=t}getObjectIdentifier(){return this.settings.selected_point.value}updateTitle(){this.title=`BACnet-Server: ${this.pointName}`,this.broadcastTitleToClients()}onExecute(){if(this.side!==l.Side.server)return;const t=this.getInputData(this.inputFault),e=this.getInputData(this.inputOneNum),i=this.getInputData(this.inputTwoNum),s=this.getInputData(this.inputThreeNum);this.doPointWrite(e,i,s,t)}doPointWrite(t,e,i,s){const n=this.host,a=this.port,r=this.getAddress(),u=this.getObjectType();this.enableDebug&&this.debugInfo(`BACNET-SERVER NODE: doPointWrite ${[n,a,u,r,t,e,i,s]}`),o.isNull(r)||o.isNull(u)||this.writePointValue(n,a,u,r,t,e,i,s).then(t=>{this.enableDebug&&this.debugInfo(`BACNET-SERVER NODE: doPointWrite did HTTP post ${t}`)}).catch(t=>{this.enableDebug&&this.debugInfo(`BACNET-SERVER NODE: doPointWrite tried HTTP POTS AND GOT ERROR ${t}`)})}inputChange(){if(this.side!==l.Side.server)return;const t=this.getInputData(this.inputFault),e=this.getInputData(this.inputOneNum),i=this.getInputData(this.inputTwoNum),s=this.getInputData(this.inputThreeNum);if(null==this.lastInput||s!==this.lastInput){const n=this.getPointUUID();if(o.isNull(n))return;this.doPointWrite(e,i,s,t)}}onInputUpdated(){this.inputChange()}persistSettings(){this.container.db&&this.container.db.updateNode(this.id,this.container.id,{$set:{settings:this.settings,properties:this.properties}})}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){const t=this.settings.pointsList.value;yield this.setEnable(),this.properties.pointObject=t,yield this.setSelectedPoint(),yield this.setTopic();const e=this.getEnable();this.side==l.Side.server&&(this.disconnectFromBroker(),e&&(this.connectToBroker(),this.enableDebug&&this.debugInfo("BACNET-SERVER NODE: connect to Broker from settings"))),this.getPoints(),this.updateTitle(),this.inputChange()}))}onRemoved(){this.disconnectFromBroker()}fetchPoints(t,e){return s(this,void 0,void 0,(function*(){if(this.side!==l.Side.server)return;const i=`${n.default.buildUrl(t,e)}/api/bacnet/points`;const s=(yield h.default.get(i)).data.points.map(t=>({value:t,text:t.object_name}));this.settings.pointsList.config.items=s,o.isNull(s)||this.broadcastSettingsToClients()}))}writePointValue(t,e,i,o,a,r,u,d){return s(this,void 0,void 0,(function*(){if(this.side!==l.Side.server)return;const s=`${n.default.buildUrl(t,e)}/api/bacnet/points/obj/${i}/${o}`;this.lastInput=a;let r={};return r=!0===d?{event_state:"fault",priority_array_write:{_16:u}}:{event_state:"normal",priority_array_write:{_16:u}},this.enableDebug&&this.debugInfo(`BACNET-SERVER NODE:  writePointValue, url:${s} body:${r} host:${t} port:${e} lastInput:${this.lastInput}`),yield h.default.patch(s,r,{headers:{"Content-Type":"application/json"}}),null}))}onAdded(){if(this.onAfterSettingsChange(),this.side!==l.Side.server)return;const t=1e3*this.resendTime+2e5;this.EXECUTE_INTERVAL=t}processMessage(t){const e=this.topic;c(e,t.topic)&&(this.setOutputData(this.outNum,t.message),this.setOutputData(this.outJson,t))}connectToBroker(){let{host:t,port:e,username:i,password:s}=p.default.mqtt,n={};o.isNull(t)||o.isNull(e)||o.isNull(this.getTopic())||!1!==this.getEnable()&&(n.host=t,n.port=e,this.disconnectFromBroker(),this.client=g.connect(n),this.client.on("connect",()=>{this.enableDebug&&this.debugInfo(`BACNET-SERVER NODE: this.client = mqtt.connect options: ${JSON.stringify(n)}`),this.setOutputData(this.outConnection,!0,!0);let t=this.getTopic();o.isNull(t)||(this.enableDebug&&this.debugInfo(`BACNET-SERVER NODE:  subscribe on node input topic ${t}`),this.client.subscribe(t))}),this.client.on("close",()=>{this.enableDebug&&this.debugInfo("BACNET-SERVER NODE:  MQTT CLIENT close WAS CALLED"),this.setOutputData(this.outConnection,!1,!0)}),this.client.on("error",t=>{this.debugWarn(t)}),this.client.on("message",(t,e)=>{let i={topic:t,message:e.toString()};this.enableDebug&&this.debugInfo(`BACNET-SERVER NODE:  this.client.on('message' ${JSON.stringify(i)}`),this.processMessage(i)}))}disconnectFromBroker(){this.client&&this.client.end()}}e.BACnetServerRest=m,a.Container.registerNodeType("protocols/bacnet-server/bacnet-server-api",m)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoraSensorDecoderNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(1),r=i(7);var u;!function(t){t.Droplet="Droplet",t.MicroEdge="MicroEdge"}(u||(u={}));class d extends n.Node{constructor(){super(),this.watchdogDelay=36e5,this.nodeID="",this.title=o.NODE_INFO["protocols/lora-raw"]["lora-sensor-decoder"].title,this.description=o.NODE_INFO["protocols/lora-raw"]["lora-sensor-decoder"].description,this.settings.sensorType=a.NodeSetting.create({description:"LORA Sensor Type",type:a.SettingType.DROPDOWN,config:{items:[{value:u.Droplet,text:u.Droplet},{value:u.MicroEdge,text:u.MicroEdge}]},value:u.Droplet}),this.addInput("rawInput",a.Type.STRING),this.addInputWithSettings("nodeID",a.Type.STRING,"","NodeID"),this.addInputWithSettings("topic",a.Type.STRING,"","Set topic for use elsewhere in wires"),this.addOutput("json",a.Type.STRING),this.addOutput("id",a.Type.STRING),this.addOutput("voltage",a.Type.NUMBER),this.addOutput("rssi",a.Type.NUMBER),this.addOutput("lowBatteryAlm",a.Type.BOOLEAN),this.addOutput("watchdog",a.Type.BOOLEAN),this.addOutput("temperature",a.Type.NUMBER),this.addOutput("humidity",a.Type.NUMBER),this.addOutput("lux",a.Type.NUMBER),this.addOutput("pressure",a.Type.NUMBER),this.addOutput("movement",a.Type.BOOLEAN),this.settings.microEdgeA1=a.NodeSetting.create({description:"MicroEdge a1 Input Type",type:a.SettingType.DROPDOWN,config:{items:[{value:"10k",text:"10k Thermistor"},{value:"10vdc",text:"0-10vdc"},{value:"digital",text:"Digital"}]},value:"10vdc"}),this.settings.microEdgeA2=a.NodeSetting.create({description:"MicroEdge a2 Input Type",type:a.SettingType.DROPDOWN,config:{items:[{value:"10k",text:"10k Thermistor"},{value:"10vdc",text:"0-10vdc"},{value:"digital",text:"Digital"}]},value:"10vdc"}),this.settings.microEdgeA3=a.NodeSetting.create({description:"MicroEdge a3 Input Type",type:a.SettingType.DROPDOWN,config:{items:[{value:"10k",text:"10k Thermistor"},{value:"10vdc",text:"0-10vdc"},{value:"digital",text:"Digital"}]},value:"10vdc"}),this.settings["battery-warn"]=a.NodeSetting.create({description:"Low battery warning voltage",value:3.5,type:a.SettingType.NUMBER}),this.settings.watchdog=a.NodeSetting.create({description:"Watchdog (No message warning) Delay",value:60,type:a.SettingType.NUMBER}),this.settings.time=a.NodeSetting.create({description:"Time",type:a.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"minutes"}),this.setSettingsConfig({groups:[{time:{},watchdog:{weight:2}}],conditions:{microEdgeA1:t=>t.sensorType.value===u.MicroEdge,microEdgeA2:t=>t.sensorType.value===u.MicroEdge,microEdgeA3:t=>t.sensorType.value===u.MicroEdge}})}onAdded(){this.sensorType=this.settings.sensorType.value,this.sensorType===u.MicroEdge&&this.removeOutput(10),this.clearOutputs();let t=this.getInputData(1).toUpperCase()||"";t!=this.nodeID&&(this.nodeID=t),this.updateTitle()}onInputUpdated(){const t=this.settings.sensorType.value;let e=this.getInputData(1).toUpperCase()||"";e!=this.nodeID&&(this.nodeID=e,this.updateTitle(),this.broadcastTitleToClients(),this.clearOutputs(),this.resetWatchdog());let i=this.getInputData(0)||"";i&&(i.length%2!=1||"\r"!==i[i.length-1]&&"\n"!==i[i.length-1]?"\r\n"===i.substring(i.length-2,i.length)&&(i=i.substring(0,i.length-2)):i=i.substring(0,i.length-1),36!==i.length&&44!==i.length&&"AA"!==i.substring(2,4)&&"B0"!==i.substring(2,4)&&"B1"!==i.substring(2,4)&&"B2"!==i.substring(2,4)||e!=i.substring(0,8)&&""!=e||(t!==u.MicroEdge||"AA"!==i.substring(2,4)||44!==i.length&&36!==i.length?t!==u.Droplet||"B"!==i.substring(2,3)||44!==i.length&&36!==i.length||(this.inputs[0].updated&&this.resetWatchdog(),this.writeOutputs(this.dropletDecode(i))):(this.inputs[0].updated&&this.resetWatchdog(),this.writeOutputs(this.microEdgeDecode(i)))))}onAfterSettingsChange(){let t=this.settings.watchdog.value;t=r.default.timeConvert(t,this.settings.time.value),this.watchdogDelay!=t&&this.resetWatchdog(),this.setOutputs(),this.updateNodeOutput(),this.onInputUpdated()}writeOutputs(t){switch(this.settings.sensorType.value){case u.Droplet:this.setOutputData(0,JSON.stringify(t)),this.setOutputData(1,null==t.id?null:t.id),this.setOutputData(2,null==t.voltage?null:t.voltage),this.setOutputData(3,null==t.rssi?null:t.rssi),this.setOutputData(4,t.voltage<this.settings["battery-warn"].value),this.setOutputData(6,null==t.temp?null:t.temp),this.setOutputData(7,null==t.humidity?null:t.humidity),this.setOutputData(8,null==t.lux?null:t.lux),this.setOutputData(9,null==t.pressure?null:t.pressure),this.setOutputData(10,null==t.movement?null:t.movement);break;case u.MicroEdge:this.setOutputData(0,JSON.stringify(t)),this.setOutputData(1,null==t.id?null:t.id),this.setOutputData(2,null==t.voltage?null:t.voltage),this.setOutputData(3,null==t.rssi?null:t.rssi),this.setOutputData(4,t.voltage<this.settings["battery-warn"].value),this.setOutputData(6,null==t.pulses?null:t.pulses);const e=this.MicroEdgeAnalogs([t.a1,t.a2,t.a3]);this.setOutputData(7,null==e[0]?null:e[0]),this.setOutputData(8,null==e[1]?null:e[1]),this.setOutputData(9,null==e[2]?null:e[2])}}MicroEdgeAnalogs(t){let e=[];for(var i=0;i<3;i++)if("number"==typeof t[i])switch(this.settings[`microEdgeA${i+1}`].value){case"10k":const s=3.34,n=t[i]/1024*s,o=1e4,a=o*n/(s-n),r=1/(1/298+1/3850*Math.log(a/o))-273.15;e.push(Math.round(100*r)/100);break;case"10vdc":e.push(t[i]/1024*10);break;case"digital":void 0===t[i]||t[i]>=1e3?e.push(!1):e.push(!0)}else e.push(null);return e}lastMessageTimeStamp(){return new Date}microEdgeDecode(t){const e=this.getInputData(2),i={id:e+"/id",pulses:e+"/pulses",voltage:e+"/voltage",a1:e+"/a1",a2:e+"/a2",a3:e+"/a3",rssi:e+"/rssi",snr:e+"/snr"};let s=null;return s=this.lastMessageTimeStamp(),{id:t.substring(0,8),pulses:parseInt(t.substring(8,16),16),voltage:parseInt(t.substring(16,18),16)/50,a1:parseInt(t.substring(18,22),16),a2:parseInt(t.substring(22,26),16),a3:parseInt(t.substring(26,30),16),rssi:-1*parseInt(t.substring(t.length-4,t.length-2),16),snr:parseInt(t.substring(t.length-2,t.length),16)/10,nodeName:this.name,topic:i,lastMessage:s}}dropletDecode(t){const e=this.getInputData(2),i={id:e+"/id",temp:e+"/temp",pressure:e+"/pressure",humidity:e+"/humidity",lux:e+"/lux",movement:e+"/movement",voltage:e+"/voltage",rssi:e+"/rssi",snr:e+"/snr"};let s=null;s=this.lastMessageTimeStamp();let n={id:t.substring(0,8),temp:parseInt(t.substring(10,12)+t.substring(8,10),16)/100,pressure:parseInt(t.substring(14,16)+t.substring(12,14),16)/10,humidity:parseInt(t.substring(16,18),16)%128,voltage:parseInt(t.substring(22,24),16)/50,rssi:-1*parseInt(t.substring(t.length-4,t.length-2),16),snr:parseInt(t.substring(t.length-2,t.length),16)/10,nodeName:this.name,topic:i,lastMessage:s};if("B1"===t.substring(2,4)||"B2"===t.substring(2,4)){const e=n;if(e.lux=parseInt(t.substring(20,22)+t.substring(18,20),16),n=e,"B2"==t.substring(2,4)){const i=e;i.movement=parseInt(t.substring(16,18),16)>127,n=i}}return n}resetWatchdog(){this.setOutputData(5,!1,!0),clearInterval(this.timeoutFunc);let t=this.settings.watchdog.value;t=r.default.timeConvert(t,this.settings.time.value),this.watchdogDelay=t,this.timeoutFunc=setTimeout(()=>{this.setOutputData(5,!0,!0)},t)}setOutputs(){const t=this.settings.sensorType.value;if(this.sensorType!=t)switch(t){case u.Droplet:this.removeOutput(6),this.removeOutput(7),this.removeOutput(8),this.removeOutput(9),this.outputs[10]&&this.removeOutput(10),this.addOutput("temperature",a.Type.NUMBER),this.addOutput("humidity",a.Type.NUMBER),this.addOutput("lux",a.Type.NUMBER),this.addOutput("pressure",a.Type.NUMBER),this.addOutput("movement",a.Type.BOOLEAN),this.clearOutputs();break;case u.MicroEdge:this.removeOutput(6),this.removeOutput(7),this.removeOutput(8),this.removeOutput(9),this.removeOutput(10),this.outputs[11]&&this.removeOutput(11),this.addOutput("pulses",a.Type.NUMBER),this.addOutput("a1",a.Type.NUMBER),this.addOutput("a2",a.Type.NUMBER),this.addOutput("a3",a.Type.NUMBER),this.clearOutputs()}t==u.MicroEdge&&(this.outputs[7].name=`a1 (${this.settings.microEdgeA1.value})`,this.outputs[8].name=`a2 (${this.settings.microEdgeA2.value})`,this.outputs[9].name=`a3 (${this.settings.microEdgeA3.value})`),this.sensorType=t,this.updateTitle()}updateTitle(){this.nodeID?this.title=`Lora Sensor Decoder (${this.sensorType} | ${this.nodeID})`:this.title=`Lora Sensor Decoder (${this.sensorType} | ALL)`}clearOutputs(){this.setOutputData(0,null),this.setOutputData(1,null),this.setOutputData(2,null),this.setOutputData(3,null),this.setOutputData(4,null),this.setOutputData(5,null),this.setOutputData(6,null),this.setOutputData(7,null),this.setOutputData(8,null),this.setOutputData(9,null),this.settings.sensorType.value===u.Droplet&&this.setOutputData(10,null)}}e.LoraSensorDecoderNode=d,s.Container.registerNodeType("protocols/lora-raw/lora-sensor-decoder",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoRaRawTwoWayOutput=void 0;const s=i(0),n=i(3),o=i(2),a=i(1),r=i(89);class u extends n.Node{constructor(){super(),this.payloadDefinition=[],this.inputsUpdated=[],this.title=o.NODE_INFO["protocols/lora-raw"]["lora-raw-two-way-out"].title,this.description=o.NODE_INFO["protocols/lora-raw"]["lora-raw-two-way-out"].description,this.settings.enable=a.NodeSetting.create({description:"enable",type:a.SettingType.BOOLEAN,value:!1}),this.settings.senderId=a.NodeSetting.create({description:"sender Id",type:a.SettingType.NUMBER,value:0}),this.settings.port=a.NodeSetting.create({description:"port number",type:a.SettingType.NUMBER,value:0}),this.settings.types=a.NodeSetting.create({description:"Types",type:a.SettingType.READONLY,value:"INT8, INT16, INT32, FLOAT"}),this.settings.definition=a.NodeSetting.create({description:"payload definition (JSON)",type:a.SettingType.STRING,value:""}),this.addInput("trigger",a.Type.BOOLEAN),this.addOutput("error",a.Type.STRING),this.addOutput("output",a.Type.ANY)}init(){this.updateOutputs()}onAdded(){this.payloadDefinition=this.stringToDataTypes(this.settings.definition.value),this.inputsUpdated=new Array(this.payloadDefinition.length),this.inputsUpdated.fill(!1)}onInputUpdated(){for(let t=1;t<this.getInputsCount();t++)this.inputs[t].updated&&(this.inputsUpdated[t-1]=!0);if(!1===this.settings.enable.value)return;if(!this.inputs[0].updated||!1===this.getInputData(0))return;const t=t=>{this.setOutputData(1,"parse error: "+t)},e=(t,e)=>{let i=!0;switch(e){case r.LORA_DATA_TYPE_NAMES.INT8:i=t>=-128&&t<=127;break;case r.LORA_DATA_TYPE_NAMES.UINT8:i=t>=0&&t<=255;break;case r.LORA_DATA_TYPE_NAMES.INT16:i=t>=-32768&&t<=32767;break;case r.LORA_DATA_TYPE_NAMES.UINT16:i=t>=0&&t<=65535;break;case r.LORA_DATA_TYPE_NAMES.INT32:i=t>=-2147483648&&t<=2147483647;break;case r.LORA_DATA_TYPE_NAMES.UINT32:i=t>=0&&t<=4294967295}return i};this.inputsUpdated.fill(!0);let i=0;for(let t=0;t<this.payloadDefinition.length;t++)this.inputsUpdated[t]&&(i+=r.LORA_DATA_TYPE_LENGTHS[this.payloadDefinition[t]]+1);if(0===i)return void t("No input updates");let s=Buffer.alloc(i+2);s.writeUInt8(this.settings.senderId.value,0),s.writeUInt8(this.settings.port.value,1);let n=0;for(let i=2;i<s.length;){if(!this.inputsUpdated[n]){n++;continue}let o=this.payloadDefinition[n],a=this.getInputData(n+1);if(!e(a,o))return void t("invalid value input "+n);switch(s.writeUInt8(n,i++),o){case r.LORA_DATA_TYPE_NAMES.INT8:s.writeInt8(a,i);break;case r.LORA_DATA_TYPE_NAMES.UINT8:s.writeUInt8(a,i);break;case r.LORA_DATA_TYPE_NAMES.INT16:s.writeInt16LE(a,i);break;case r.LORA_DATA_TYPE_NAMES.UINT16:s.writeUInt16LE(a,i);break;case r.LORA_DATA_TYPE_NAMES.INT32:s.writeInt32LE(a,i);break;case r.LORA_DATA_TYPE_NAMES.UINT32:s.writeUInt32LE(a,i);break;case r.LORA_DATA_TYPE_NAMES.FLOAT:s.writeFloatLE(a,i)}i+=r.LORA_DATA_TYPE_LENGTHS[o],n++}this.setOutputData(1,null),this.setOutputData(0,s),this.inputsUpdated.fill(!1)}onAfterSettingsChange(){this.payloadDefinition=this.updateOutputs(),this.setOutputData(1,null),this.onInputUpdated()}updateOutputs(){const t=this.stringToDataTypes(this.settings.definition.value);if(this.payloadDefinition.length!==t.length){const e=this.getInputsCount();for(let t=1;t<e;t++)this.removeInput(t);this.inputsUpdated=new Array(t.length);for(let e=0;e<t.length;e++)this.addInput(e.toString(),a.Type.NUMBER),this.inputsUpdated[e]=!1}return t}stringToDataTypes(t){const e=t.toUpperCase().replace(/ /g,"").split(",").filter(t=>""!==t);if(e&&e.length)for(let t=0;t<e.length;t++){if(void 0===r.LORA_DATA_TYPE_NAMES[e[t]])return void this.setOutputData(1,"settings parse error");e[t]=r.LORA_DATA_TYPE_NAMES[e[t]]}return e}}e.LoRaRawTwoWayOutput=u,s.Container.registerNodeType("protocols/lora-raw/lora-raw-two-way-out",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoRaRawPointsOutput=e.LoRaRawPointsInput=void 0;const s=i(3),n=i(1),o=i(0),a=i(4),r=i(318);var u;!function(t){t[t.INT8=0]="INT8",t[t.UINT8=1]="UINT8",t[t.INT16=2]="INT16",t[t.UINT16=3]="UINT16",t[t.INT32=4]="INT32",t[t.UINT32=5]="UINT32",t[t.FLOAT=6]="FLOAT"}(u||(u={}));const d=[1,1,2,2,4,4,4];class l extends s.Node{constructor(){super(),this.payloadDefinition=[],this.addressPrefix="FFFFFF",this.address="",this.keyBuffer=null,this.nonce=0,this.outputOffset=3,this.title="Nube LoRaRAW Points In",this.description="This node parses Nubes LoRa Points protocol payload",this.settings.enable=n.NodeSetting.create({description:"enable",type:n.SettingType.BOOLEAN,value:!0}),this.settings.senderId=n.NodeSetting.create({description:"sender Id [0-254]",type:n.SettingType.NUMBER,value:0}),this.settings.port=n.NodeSetting.create({description:"port number [0-254]",type:n.SettingType.NUMBER,value:0}),this.settings.types=n.NodeSetting.create({description:"Types # = [8, 16, 23]",type:n.SettingType.READONLY,value:"INT#, UINT#, FLOAT"}),this.settings.definition=n.NodeSetting.create({description:"payload definition (',' separated)",type:n.SettingType.STRING,value:""}),this.settings.key=n.NodeSetting.create({description:"encryption key (hex)",type:n.SettingType.STRING,value:""}),this.settings.other_group=n.NodeSetting.create({description:"Advanced",value:"",type:n.SettingType.GROUP}),this.settings.addrPrefix=n.NodeSetting.create({description:"Address Prefix [6]",type:n.SettingType.STRING,value:"FFFFFF"}),this.settings.nonceLen=n.NodeSetting.create({description:"Nonce Length",type:n.SettingType.NUMBER,value:2}),this.settings.frameCounterEnabled=n.NodeSetting.create({description:"frame counters (**TBA**)",type:n.SettingType.BOOLEAN,value:!1}),this.addInput("rawInput",n.Type.STRING),this.addOutput("error",n.Type.STRING),this.addOutput("rssi",n.Type.NUMBER),this.addOutput("snr",n.Type.NUMBER)}init(){this.updateSettings(),this.updateOutputs(this.payloadDefinition)}onAdded(){this.updateSettings()}onInputUpdated(){if(null===this.keyBuffer)return;let t=this.getInputData(0)||"";if(!1===this.settings.enable.value)return;if(!t||t.length<48||t.substring(0,8).toUpperCase()!==this.address)return;"\r\n"===t.substring(t.length-2,t.length)?t=t.substring(0,t.length-2):t.length%2!=1||"\n"!==t[t.length-1]&&"\r"!==t[t.length-1]||(t=t.substring(0,t.length-1));let e=Buffer.from(t,"hex"),[i,s]=r.loraRawDecryptBuffer(e.slice(0,4),e.slice(4,e.length-2),this.keyBuffer);if(s!==r.LORA_RAW_ERROR.LRERR_NOERR)return void this.setOutputData(0,"LoRaRaw Crypt ERR: "+s);let n=e.readInt8(e.length-2),o=e.readUInt8(e.length-1),a=this.settings.nonceLen.value;if(i[a]!==this.settings.port.value)return;const l=t=>{this.setOutputData(0,"parse error: "+t)};let p=i.slice(a+1),h=new Array(this.payloadDefinition.length),c=new Array(this.payloadDefinition.length);c.fill(!1);let g=0;for(let t=0;t<this.payloadDefinition.length;t++){let t=p.readUInt8(g++),e=0;if(t>=this.payloadDefinition.length)return void l("invalid point "+t);if(c[t])return void l("Bad payload. Point already parsed: "+t);if(e=d[this.payloadDefinition[t]],p.length-g<e)return void l("invalid length");switch(this.payloadDefinition[t]){case u.INT8:h[t]=p.readInt8(g);break;case u.UINT8:h[t]=p.readUInt8(g);break;case u.INT16:h[t]=p.readInt16LE(g);break;case u.UINT16:h[t]=p.readUInt16LE(g);break;case u.INT32:h[t]=p.readInt32LE(g);break;case u.UINT32:h[t]=p.readUInt32LE(g);break;case u.FLOAT:h[t]=p.readFloatLE(g)}c[t]=!0,g+=e}for(let t=0;t<h.length;t++)this.setOutputData(t+this.outputOffset,h[t]);this.setOutputData(1,n),this.setOutputData(2,o),this.setOutputData(0,null)}onAfterSettingsChange(){this.updateSettings()&&(this.updateOutputs(this.payloadDefinition),this.onInputUpdated())}updateSettings(){this.settings.senderId.value=a.default.clamp(this.settings.senderId.value,0,254),this.settings.port.value=a.default.clamp(this.settings.port.value,0,254),this.settings.nonceLen.value=a.default.clamp(this.settings.nonceLen.value,1,4),this.payloadDefinition=this.stringToDataTypes(this.settings.definition.value);let t=this.settings.addrPrefix.value;return this.addressPrefix=t&&6===t.length?t:"FFFFFF",this.address=this.addressPrefix+("0"+this.settings.senderId.value.toString(16)).substr(-2),this.address=this.address.toUpperCase(),32!==this.settings.key.value.length?(this.setOutputData(0,"invalid key"),this.keyBuffer=null,!1):(this.keyBuffer=Buffer.from(this.settings.key.value,"hex"),this.setOutputData(0,null),!0)}updateOutputs(t){if(this.getOutputsCount()-this.outputOffset!==t.length){const e=this.getOutputsCount();for(let t=this.outputOffset;t<e;t++)this.removeOutput(t);for(let e=0;e<t.length;e++)this.addOutput(e.toString(),n.Type.NUMBER);this.updateNodeOutput()}}stringToDataTypes(t){const e=t.toUpperCase().replace(/ /g,"").split(",").filter(t=>""!==t);if(e&&e.length)for(let t=0;t<e.length;t++){if(void 0===u[e[t]])return void this.setOutputData(0,"settings parse error");e[t]=u[e[t]]}return e}}e.LoRaRawPointsInput=l,o.Container.registerNodeType("protocols/lora-raw-v2/lora-raw-points-in",l);class p extends s.Node{constructor(){super(),this.payloadDefinition=[],this.addressPrefix="FFFFFF",this.address=null,this.keyBuffer=null,this.nonce=0,this.errorOutputIndex=1,this.title="Nube LoRaRAW Points Out",this.description="This node compiles points to Nubes LoRa Points protocol",this.settings.enable=n.NodeSetting.create({description:"enable",type:n.SettingType.BOOLEAN,value:!0}),this.settings.enable=n.NodeSetting.create({description:"enable",type:n.SettingType.BOOLEAN,value:!0}),this.settings.senderId=n.NodeSetting.create({description:"sender Id [0-254]",type:n.SettingType.NUMBER,value:0}),this.settings.port=n.NodeSetting.create({description:"port number [0-254]",type:n.SettingType.NUMBER,value:0}),this.settings.types=n.NodeSetting.create({description:"Types ( # = [8, 16, 23] )",type:n.SettingType.READONLY,value:"INT#, UINT#, FLOAT"}),this.settings.definition=n.NodeSetting.create({description:"payload definition (',' separated)",type:n.SettingType.STRING,value:""}),this.settings.key=n.NodeSetting.create({description:"encryption key (hex)",type:n.SettingType.STRING,value:""}),this.settings.other_group=n.NodeSetting.create({description:"Advanced",value:"",type:n.SettingType.GROUP}),this.settings.addrPrefix=n.NodeSetting.create({description:"Address Prefix [6]",type:n.SettingType.STRING,value:"FFFFFF"}),this.settings.nonceLen=n.NodeSetting.create({description:"Nonce Length",type:n.SettingType.NUMBER,value:2}),this.settings.frameCounterEnabled=n.NodeSetting.create({description:"frame counters (**TBA**)",type:n.SettingType.BOOLEAN,value:!1}),this.addInput("trigger",n.Type.BOOLEAN),this.addOutput("output",n.Type.ANY),this.addOutput("error",n.Type.STRING)}init(){this.updateSettings(),this.updateInputs(this.payloadDefinition)}onAdded(){this.updateSettings()}onInputUpdated(){if(!1===this.settings.enable.value)return;if(!this.inputs[0].updated||!0!==this.getInputData(0))return;const t=t=>{this.setOutputData(this.errorOutputIndex,"parse error: "+t)},e=(t,e)=>{let i=!0;switch(e){case u.INT8:i=t>=-128&&t<=127;break;case u.UINT8:i=t>=0&&t<=255;break;case u.INT16:i=t>=-32768&&t<=32767;break;case u.UINT16:i=t>=0&&t<=65535;break;case u.INT32:i=t>=-2147483648&&t<=2147483647;break;case u.UINT32:i=t>=0&&t<=4294967295}return i};let i=0;for(let t=0;t<this.payloadDefinition.length;t++)i+=d[this.payloadDefinition[t]]+1;if(0===i)return void t("No input updates");let s=Buffer.alloc(i+this.settings.nonceLen.value+1);const n=this.settings.nonceLen.value;1===n?(s.writeUInt8(this.nonce,0),this.nonce=this.nonce+1&255):2===n?(s.writeUInt16LE(this.nonce,0),this.nonce=this.nonce+1&65535):4===n&&(s.writeUInt32LE(this.nonce,0),this.nonce=this.nonce+1&4294967295),s.writeUInt8(this.settings.port.value,n);let o=0;for(let i=n+1;i<s.length;){let n=this.payloadDefinition[o],a=this.getInputData(o+1);if(!e(a,n))return void t("invalid value input "+o);switch(s.writeUInt8(o,i++),n){case u.INT8:s.writeInt8(a,i);break;case u.UINT8:s.writeUInt8(a,i);break;case u.INT16:s.writeInt16LE(a,i);break;case u.UINT16:s.writeUInt16LE(a,i);break;case u.INT32:s.writeInt32LE(a,i);break;case u.UINT32:s.writeUInt32LE(a,i);break;case u.FLOAT:s.writeFloatLE(a,i)}i+=d[n],o++}let[a,l]=r.loraRawEncryptBuffer(this.address,s,this.keyBuffer);l===r.LORA_RAW_ERROR.LRERR_NOERR?(s=Buffer.concat([this.address,a]),this.setOutputData(this.errorOutputIndex,null),this.setOutputData(0,s)):this.setOutputData(this.errorOutputIndex,"LoRaRaw Crypt ERR: "+l)}onAfterSettingsChange(){this.updateSettings()&&(this.updateInputs(this.payloadDefinition),this.setOutputData(this.errorOutputIndex,null),this.onInputUpdated())}updateSettings(){if(this.settings.senderId.value=a.default.clamp(this.settings.senderId.value,0,254),this.settings.port.value=a.default.clamp(this.settings.port.value,0,254),this.settings.nonceLen.value=a.default.clamp(this.settings.nonceLen.value,1,4),this.payloadDefinition=this.stringToDataTypes(this.settings.definition.value),32!==this.settings.key.value.length)return this.setOutputData(this.errorOutputIndex,"invalid key"),this.keyBuffer=null,!1;this.keyBuffer=Buffer.from(this.settings.key.value,"hex");let t=this.settings.addrPrefix.value;return this.addressPrefix=t&&6===t.length?t.toUpperCase():"FFFFFF",this.address=Buffer.from(this.addressPrefix+("0"+this.settings.senderId.value.toString(16)).substr(-2),"hex"),this.setOutputData(this.errorOutputIndex,null),!0}updateInputs(t){if(this.getInputsCount()-1!==t.length){const e=this.getInputsCount();for(let t=1;t<e;t++)this.removeInput(t);for(let e=0;e<t.length;e++)this.addInput(e.toString(),n.Type.NUMBER);this.updateNodeOutput()}}stringToDataTypes(t){const e=t.toUpperCase().replace(/ /g,"").split(",").filter(t=>""!==t);if(e&&e.length)for(let t=0;t<e.length;t++){if(void 0===u[e[t]])return void this.setOutputData(this.errorOutputIndex,"settings parse error");e[t]=u[e[t]]}return e}}e.LoRaRawPointsOutput=p,o.Container.registerNodeType("protocols/lora-raw-v2/lora-raw-points-out",p)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.loraRawDecryptBuffer=e.loraRawEncryptBuffer=e.LORA_RAW_ERROR=void 0;var s=i(90);const n=i(319).aesCmac,o=Buffer.alloc(16,0);var a;!function(t){t[t.LRERR_NOERR=0]="LRERR_NOERR",t[t.LRERR_INVALID_KEY=1]="LRERR_INVALID_KEY",t[t.LRERR_INVALID_IV=2]="LRERR_INVALID_IV",t[t.LRERR_INVALID_PAYLOAD=3]="LRERR_INVALID_PAYLOAD",t[t.LRERR_INVALID_CMAC=4]="LRERR_INVALID_CMAC"}(a=e.LORA_RAW_ERROR||(e.LORA_RAW_ERROR={})),e.loraRawEncryptBuffer=function(t,e,i,r=o){if(16!==i.length)return[null,a.LRERR_INVALID_KEY];if(16!==r.length)return[null,a.LRERR_INVALID_IV];var u=s.createCipheriv("aes-128-cbc",i,r).setAutoPadding(!1);e.length%16&&(e=Buffer.concat([e,Buffer.alloc(16-e.length%16,0)])),e=u.update(e),e=Buffer.concat([e,u.final()]);var d=Buffer.concat([t,e.slice(0,12)],16);d=Buffer.concat([d,e],16+e.length);var l=n(i,d,{returnAsBuffer:!0});return[e=Buffer.concat([e,l.slice(0,4)],e.length+4),a.LRERR_NOERR]},e.loraRawDecryptBuffer=function(t,e,i,r=o){if(16!==i.length)return[null,a.LRERR_INVALID_KEY];if(16!==r.length)return[null,a.LRERR_INVALID_IV];if(e.length%16!=4)return[null,a.LRERR_INVALID_PAYLOAD];var u=Buffer.concat([t,e],16);if(u=Buffer.concat([u,e],16+e.length),!n(i,u,{returnAsBuffer:!0}).slice(0,4).compare(e,e.length-4))return[null,a.LRERR_INVALID_CMAC];var d=s.createDecipheriv("aes-128-cbc",i,r).setAutoPadding(!1);return e=d.update(e.slice(0,e.length-4)),[e=Buffer.concat([e,d.final()]),a.LRERR_NOERR]}},function(t,e){t.exports=require("node-aes-cmac")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoraSensorLegacyDecoderNode=void 0;const s=i(0),n=i(3),o=i(1),a=i(7),r=i(90),u=Buffer.alloc(16,0);var d;!function(t){t.Droplet="Droplet",t.MicroEdge="MicroEdge"}(d||(d={}));class l extends n.Node{constructor(){super(),this.watchdogDelay=36e5,this.nodeID="",this.keyBuffer=null,this.title="Lora Sensor Legacy Decoder (Droplet | Micro)",this.description="LEGACY DECODER. PROVIDES DECRYPTION AS NEW FIRMWARE DOESNT\nThis node is used to decode raw serial input messages to LORA sensor values.\nIt should be used in conjunction with the protocols/serial-connector node.\nIf a ‘nodeID’ is set, only messages from matching LORA sensors will be output.\nIf no ‘nodeID’ is set, all valid LORA sensor messages will be output.\nOutputs that are not present in the raw serial input message will be ‘null’.\n‘lowBatteryAlm’ output will be ‘true’ if the LORA sensor has a battery ‘voltage’ value less than the ‘Low battery warning voltage’ setting\notherwise it will be ‘false’.\n‘watchdog’ output will be ‘true’ if there has been no valid message from the ‘nodeID’ LORA sensor for the ‘Watchdog Delay’\notherwise ‘watchdog’ output will be false.  Maximum ‘Watchdog Delay’ setting is 587 hours.\nThis node can be used for decoding Nube Droplet sensors, and Nube MicroEdge sensors.\nThe sensor type can be selected from settings.",this.settings.sensorType=o.NodeSetting.create({description:"LORA Sensor Type",type:o.SettingType.DROPDOWN,config:{items:[{value:d.Droplet,text:d.Droplet},{value:d.MicroEdge,text:d.MicroEdge}]},value:"Droplet"}),this.settings.keyHex=o.NodeSetting.create({description:"Decryption Key (HEX)",value:"",type:o.SettingType.STRING}),this.addInput("rawInput",o.Type.STRING),this.addInputWithSettings("nodeID",o.Type.STRING,"","NodeID"),this.addInputWithSettings("topic",o.Type.STRING,"","Set topic for use elsewhere in wires"),this.addOutput("json",o.Type.STRING),this.addOutput("id",o.Type.STRING),this.addOutput("voltage",o.Type.NUMBER),this.addOutput("rssi",o.Type.NUMBER),this.addOutput("lowBatteryAlm",o.Type.BOOLEAN),this.addOutput("watchdog",o.Type.BOOLEAN),this.addOutput("temperature",o.Type.NUMBER),this.addOutput("humidity",o.Type.NUMBER),this.addOutput("lux",o.Type.NUMBER),this.addOutput("pressure",o.Type.NUMBER),this.addOutput("movement",o.Type.BOOLEAN),this.settings.microEdgeA1=o.NodeSetting.create({description:"MicroEdge a1 Input Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"10k",text:"10k Thermistor"},{value:"10vdc",text:"0-10vdc"},{value:"digital",text:"Digital"}]},value:"10vdc"}),this.settings.microEdgeA2=o.NodeSetting.create({description:"MicroEdge a2 Input Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"10k",text:"10k Thermistor"},{value:"10vdc",text:"0-10vdc"},{value:"digital",text:"Digital"}]},value:"10vdc"}),this.settings.microEdgeA3=o.NodeSetting.create({description:"MicroEdge a3 Input Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"10k",text:"10k Thermistor"},{value:"10vdc",text:"0-10vdc"},{value:"digital",text:"Digital"}]},value:"10vdc"}),this.settings["battery-warn"]=o.NodeSetting.create({description:"Low battery warning voltage",value:3.5,type:o.SettingType.NUMBER}),this.settings.watchdog=o.NodeSetting.create({description:"Watchdog (No message warning) Delay",value:60,type:o.SettingType.NUMBER}),this.settings.time=o.NodeSetting.create({description:"Time",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"minutes"}),this.setSettingsConfig({groups:[{time:{},watchdog:{weight:2}}],conditions:{microEdgeA1:t=>t.sensorType.value===d.MicroEdge,microEdgeA2:t=>t.sensorType.value===d.MicroEdge,microEdgeA3:t=>t.sensorType.value===d.MicroEdge}})}onAdded(){this.sensorType=this.settings.sensorType.value;let t=this.settings.keyHex.value;this.keyBuffer=t&&32===t.length?Buffer.from(t,"hex"):null,this.sensorType===d.MicroEdge&&this.removeOutput(10),this.clearOutputs(),this.updateTitle()}onInputUpdated(){const t=this.settings.sensorType.value;let e=this.getInputData(1).toUpperCase()||"";if(e!=this.nodeID&&(this.nodeID=e,this.updateTitle(),this.broadcastTitleToClients(),this.clearOutputs(),this.resetWatchdog()),null===this.keyBuffer)return;let i=this.getInputData(0)||"";if(!i)return;if(i.length%2!=1||"\r"!==i[i.length-1]&&"\n"!==i[i.length-1]?"\r\n"===i.substring(i.length-2,i.length)&&(i=i.substring(0,i.length-2)):i=i.substring(0,i.length-1),36!==i.length&&44!==i.length)return;let s=Buffer.from(i.substr(0,32),"hex");s=r.createDecipheriv("aes-128-cbc",this.keyBuffer,u).setAutoPadding(!1).update(s),i=s.toString("hex").toUpperCase()+i.substring(32),36!==i.length&&44!==i.length&&"AA"!==i.substring(2,4)&&"B0"!==i.substring(2,4)&&"B1"!==i.substring(2,4)&&"B2"!==i.substring(2,4)||e!=i.substring(0,8)&&""!=e||(t!==d.MicroEdge||"AA"!==i.substring(2,4)||44!==i.length&&36!==i.length?t!==d.Droplet||"B"!==i.substring(2,3)||44!==i.length&&36!==i.length||(this.inputs[0].updated&&this.resetWatchdog(),this.writeOutputs(this.dropletDecode(i))):(this.inputs[0].updated&&this.resetWatchdog(),this.writeOutputs(this.microEdgeDecode(i))))}onAfterSettingsChange(){let t=this.settings.keyHex.value;this.keyBuffer=t&&32===t.length?Buffer.from(t,"hex"):null;let e=this.settings.watchdog.value;e=a.default.timeConvert(e,this.settings.time.value),this.watchdogDelay!=e&&this.resetWatchdog(),this.setOutputs(),this.updateNodeOutput(),this.onInputUpdated()}writeOutputs(t){switch(this.settings.sensorType.value){case d.Droplet:this.setOutputData(0,JSON.stringify(t)),this.setOutputData(1,null==t.id?null:t.id),this.setOutputData(2,null==t.voltage?null:t.voltage),this.setOutputData(3,null==t.rssi?null:t.rssi),this.setOutputData(4,t.voltage<this.settings["battery-warn"].value),this.setOutputData(6,null==t.temp?null:t.temp),this.setOutputData(7,null==t.humidity?null:t.humidity),this.setOutputData(8,null==t.lux?null:t.lux),this.setOutputData(9,null==t.pressure?null:t.pressure),this.setOutputData(10,null==t.movement?null:t.movement);break;case d.MicroEdge:this.setOutputData(0,JSON.stringify(t)),this.setOutputData(1,null==t.id?null:t.id),this.setOutputData(2,null==t.voltage?null:t.voltage),this.setOutputData(3,null==t.rssi?null:t.rssi),this.setOutputData(4,t.voltage<this.settings["battery-warn"].value),this.setOutputData(6,null==t.pulses?null:t.pulses);const e=this.MicroEdgeAnalogs([t.a1,t.a2,t.a3]);this.setOutputData(7,null==e[0]?null:e[0]),this.setOutputData(8,null==e[1]?null:e[1]),this.setOutputData(9,null==e[2]?null:e[2])}}MicroEdgeAnalogs(t){let e=[];for(var i=0;i<3;i++)if("number"==typeof t[i])switch(this.settings[`microEdgeA${i+1}`].value){case"10k":const s=3.34,n=t[i]/1024*s,o=1e4,a=o*n/(s-n),r=1/(1/298+1/3850*Math.log(a/o))-273.15;e.push(Math.round(100*r)/100);break;case"10vdc":e.push(t[i]/1024*10);break;case"digital":void 0===t[i]||t[i]>=1e3?e.push(!1):e.push(!0)}else e.push(null);return e}lastMessageTimeStamp(){return new Date}microEdgeDecode(t){const e=this.getInputData(2),i={id:e+"/id",pulses:e+"/pulses",voltage:e+"/voltage",a1:e+"/a1",a2:e+"/a2",a3:e+"/a3",rssi:e+"/rssi",snr:e+"/snr"};let s=null;return s=this.lastMessageTimeStamp(),{id:t.substring(0,8),pulses:parseInt(t.substring(8,16),16),voltage:parseInt(t.substring(16,18),16)/50,a1:parseInt(t.substring(18,22),16),a2:parseInt(t.substring(22,26),16),a3:parseInt(t.substring(26,30),16),rssi:Buffer.from(t.substring(t.length-4,t.length-2),"hex").readInt8(0),snr:parseInt(t.substring(t.length-2,t.length),16)/10,nodeName:this.name,topic:i,lastMessage:s}}dropletDecode(t){const e=this.getInputData(2),i={id:e+"/id",temp:e+"/temp",pressure:e+"/pressure",humidity:e+"/humidity",lux:e+"/lux",movement:e+"/movement",voltage:e+"/voltage",rssi:e+"/rssi",snr:e+"/snr"};let s=null;s=this.lastMessageTimeStamp();let n={id:t.substring(0,8),temp:parseInt(t.substring(10,12)+t.substring(8,10),16)/100,pressure:parseInt(t.substring(14,16)+t.substring(12,14),16)/10,humidity:parseInt(t.substring(16,18),16)%128,voltage:parseInt(t.substring(22,24),16)/50,rssi:Buffer.from(t.substring(t.length-4,t.length-2),"hex").readInt8(0),snr:parseInt(t.substring(t.length-2,t.length),16)/10,nodeName:this.name,topic:i,lastMessage:s};if("B1"===t.substring(2,4)||"B2"===t.substring(2,4)){const e=n;if(e.lux=parseInt(t.substring(20,22)+t.substring(18,20),16),n=e,"B2"==t.substring(2,4)){const i=e;i.movement=parseInt(t.substring(16,18),16)>127,n=i}}return n}resetWatchdog(){this.setOutputData(5,!1,!0),clearInterval(this.timeoutFunc);let t=this.settings.watchdog.value;t=a.default.timeConvert(t,this.settings.time.value),this.watchdogDelay=t,this.timeoutFunc=setTimeout(()=>{this.setOutputData(5,!0,!0)},t)}setOutputs(){const t=this.settings.sensorType.value;if(this.sensorType!=t)switch(t){case d.Droplet:this.removeOutput(6),this.removeOutput(7),this.removeOutput(8),this.removeOutput(9),this.outputs[10]&&this.removeOutput(10),this.addOutput("temperature",o.Type.NUMBER),this.addOutput("humidity",o.Type.NUMBER),this.addOutput("lux",o.Type.NUMBER),this.addOutput("pressure",o.Type.NUMBER),this.addOutput("movement",o.Type.BOOLEAN),this.clearOutputs();break;case d.MicroEdge:this.removeOutput(6),this.removeOutput(7),this.removeOutput(8),this.removeOutput(9),this.removeOutput(10),this.outputs[11]&&this.removeOutput(11),this.addOutput("pulses",o.Type.NUMBER),this.addOutput("a1",o.Type.NUMBER),this.addOutput("a2",o.Type.NUMBER),this.addOutput("a3",o.Type.NUMBER),this.clearOutputs()}t==d.MicroEdge&&(this.outputs[7].name=`a1 (${this.settings.microEdgeA1.value})`,this.outputs[8].name=`a2 (${this.settings.microEdgeA2.value})`,this.outputs[9].name=`a3 (${this.settings.microEdgeA3.value})`),this.sensorType=t,this.updateTitle()}updateTitle(){this.nodeID?this.title=`Lora Sensor Decoder (${this.sensorType} | ${this.nodeID})`:this.title=`Lora Sensor Decoder (${this.sensorType} | ALL)`}clearOutputs(){this.setOutputData(0,null),this.setOutputData(1,null),this.setOutputData(2,null),this.setOutputData(3,null),this.setOutputData(4,null),this.setOutputData(5,null),this.setOutputData(6,null),this.setOutputData(7,null),this.setOutputData(8,null),this.setOutputData(9,null),this.settings.sensorType.value===d.Droplet&&this.setOutputData(10,null)}}e.LoraSensorLegacyDecoderNode=l,s.Container.registerNodeType("protocols/lora-raw-v2/lora-raw-sensor-decoder-legacy",l)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(5),a=i(1),r=i(2);let u=i(322);class d extends n.Node{constructor(){super(),this.tcpServer=null,this.title=r.NODE_INFO["protocols/modbus"]["modbus-server"].title,this.description="## Description\n "+r.NODE_INFO["protocols/modbus"]["modbus-server"].description+"\n    \n ## Point Address\n    \n ### Coils\n    \n  Valid Coil range is between 0 and 10001. This will allow any modbus client to read and write to those coli ranges\n    \n ### Holding Register\n    \n  Valid Holding Register range is between 10001 and 19999. This will allow any modbus client to read and write to those coli ranges\n    \n ### Enable\n    \n  This will enable/disable the modbus server \n    \n ### Port\n    \n  This is the setting that the modbus server will listen on \n    \n ### Modbus address\n    \n  This will set the modbus server modbus address (valid range between 0 and 255) \n    \n ",this.addInput("connect",a.Type.BOOLEAN),this.addOutput("status",a.Type.BOOLEAN),this.addOutput("error",a.Type.STRING),this.addOutput("message",a.Type.STRING),this.settings.serverEnable=a.NodeSetting.create({description:"Server enable",value:!1,type:a.SettingType.BOOLEAN}),this.settings.port=a.NodeSetting.create({description:"port",value:8502,type:a.SettingType.NUMBER}),this.settings.address=a.NodeSetting.create({description:"Modbus address",value:1,type:a.SettingType.NUMBER})}onAdded(){this.createModbusServer()}onInputUpdated(){this.createModbusServer()}onAfterSettingsChange(){this.createModbusServer()}onRemoved(){this.closeTcpServer()}createModbusServer(){if(this.side===o.Side.server&&(this.closeTcpServer(),this.emitResult(!1,!1,"close connection"),this.settings.serverEnable.value)){const e=Buffer.alloc(160008,0),s=Buffer.alloc(160008,0);let n=this.settings.address.value;n=parseInt(n);const o=0,a=10001,r=20001,d=8,l={getCoil:function(t,i){if(i===n&&t>=o&&t<r)return e.readUInt8(t*d)},getInputRegister:function(t,e){if(e===n&&t>=o&&t<a)return s.readUInt16BE(t*d)},getHoldingRegister:function(t,e){if(e===n&&t>=a&&t<r)return s.readUInt16BE(t*d)},setCoil:function(t,i,s){s===n&&t>=o&&t<r&&e.writeUInt8(i,t*d)},setRegister:function(t,e,i){i===n&&t>=o&&t<r&&s.writeUInt16BE(e,t*d)},readDeviceIdentification:function(t){return new Promise((function(t){setTimeout((function(){t({0:"Nube-IO",1:"wires-server",2:"1",5:"wires-server"})}),10)}))}};var t=i(323).createServer();let p=this.settings.port.value,h=this.settings.address.value;p.toString().length>=3?(t.once("error",e=>{"EADDRINUSE"===e.code&&(this.emitResult(!1,!1,"port in use"),t.close())}),t.once("listening",()=>{this.tcpServer=new u.ServerTCP(l,{host:"0.0.0.0",port:p,debug:!0,unitID:parseInt(h)}),this.tcpServer.on("socketError",t=>{this.emitResult(!1,t,"server error")}),this.tcpServer.on("initialized",()=>{this.emitResult(!0,!1,"initialized")}),t.close()}),t.listen(p)):p.toString().length<3&&this.emitResult(null,!1,"use a port >= 3")}}closeTcpServer(){this.tcpServer&&this.tcpServer.close(()=>{this.emitResult(!1,!1,"closed")})}emitResult(t,e,i){this.setOutputData(0,t),this.setOutputData(1,e),this.setOutputData(2,i)}}s.Container.registerNodeType("protocols/modbus/modbus-server",d)},function(t,e){t.exports=require("modbus-serial")},function(t,e){t.exports=require("net")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(62),n=i(10),o=i(6),a=i(0),r=i(3),u=i(2),d=i(5),l=i(1),p=i(4),h=i(31),c=i(61);class g extends r.Node{constructor(){super(),this.topicsCount=0,this.messageQueue=[],this.title=u.NODE_INFO["protocols/mqtt"].client.title,this.description=u.NODE_INFO["protocols/mqtt"].client.description,this.addInput("[enable]",l.Type.BOOLEAN),this.addOutput("connected",l.Type.BOOLEAN),this.settings.enable=l.NodeSetting.create({description:"Enable",value:!1,type:l.SettingType.BOOLEAN}),this.settings.broker_group=l.NodeSetting.create({description:"Broker settings",value:"",type:l.SettingType.GROUP}),this.settings.broker_group=l.NodeSetting.create({description:"Broker settings",value:"",type:l.SettingType.GROUP}),this.settings.useEnv=l.NodeSetting.create({description:"Dont use env settings",value:!1,type:l.SettingType.BOOLEAN}),this.settings.server=l.NodeSetting.create({description:"Broker URL",value:"0.0.0.0",type:l.SettingType.STRING}),this.settings.port=l.NodeSetting.create({description:"Broker port",value:"1883",type:l.SettingType.STRING}),this.settings.authentication=l.NodeSetting.create({description:"Use Authentication",value:!1,type:l.SettingType.BOOLEAN}),this.settings.username=l.NodeSetting.create({description:"User name",value:"",type:l.SettingType.STRING}),this.settings.password=l.NodeSetting.create({description:"Password",value:"",type:l.SettingType.PASSWORD}),this.settings.topics_group=l.NodeSetting.create({description:"Topic settings",value:"",type:l.SettingType.GROUP}),this.settings.topics_count=l.NodeSetting.create({description:"Number of Topics",value:1,type:l.SettingType.NUMBER}),this.settings.decimals=l.NodeSetting.create({description:"Decimal Places (Numerics)",type:l.SettingType.DROPDOWN,config:{items:[{value:0,text:"0"},{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"},{value:6,text:"6"},{value:7,text:"7"},{value:8,text:"8"},{value:9,text:"9"},{value:10,text:"10"}]},value:3}),this.setSettingsConfig({groups:[{server:{weight:3},port:{weight:1}},{useEnv:{},authentication:{}},{username:{},password:{}},{topics_count:{},decimals:{}}],conditions:{server:t=>!!t.useEnv.value,port:t=>!!t.useEnv.value,authentication:t=>!!t.useEnv.value,username:t=>!!t.authentication.value,password:t=>!!t.authentication.value}})}init(){this.changeTopicsCount(this.settings.topics_count.value)}onCreated(){this.renameInputsOutputs()}onAdded(){this.EXECUTE_INTERVAL=200,this.topicsCount=this.settings.topics_count.value,this.side==d.Side.server&&(this.setOutputData(0,!1),!this.settings.enable.value||null!=this.inputs[0].link&&1!=this.inputs[0].data||this.connectToBroker())}connectToBroker(){let{host:t,port:e,username:i,password:a}=n.default.mqtt,r={};if(this.settings.useEnv.value)null!=this.settings.server.value&&""!=this.settings.server.value&&(r.host=this.settings.server.value),null!=this.settings.port.value&&""!=this.settings.port.value&&(r.port=this.settings.port.value),null!=this.settings.username.value&&""!=this.settings.username.value&&(r.username=this.settings.username.value),null!=this.settings.password.value&&""!=this.settings.password.value&&(r.password=h.default.decrypt(this.settings.password.value));else{if(o.isNull(t))return;if(o.isNull(e))return;r.host=t,r.port=e,!0===this.settings.authentication.value&&(o.isNull(r.username)||(r.username=i),o.isNull(r.password)||(r.password=h.default.decrypt(a)))}this.disconnectFromBroker(),this.client=s.connect(r),this.client.on("connect",()=>{this.setOutputData(0,!0);for(let t=1;t<=this.topicsCount;t++){let e=this.settings["topic"+t].value;e&&""!=e&&this.client.subscribe(e)}}),this.client.on("close",()=>{this.setOutputData(0,!1,!0),this.setOutputData(1,null,!0)}),this.client.on("error",t=>{this.debugWarn(t)}),this.client.on("message",(t,e)=>{let i={topic:t,message:e.toString()};this.messageQueue.push(i)})}disconnectFromBroker(){this.client&&this.client.end()}onInputUpdated(){if(this.inputs[0].updated&&(0==this.inputs[0].data?this.disconnectFromBroker():!this.settings.enable.value||null!=this.inputs[0].link&&1!=this.inputs[0].data||this.connectToBroker()),this.settings.enable.value&&this.client&&this.client.connected)for(let t=1;t<this.getInputsCount();t++){let e=this.inputs[t].data;if(e&&this.inputs[t].updated){let i,s=!0;try{e=JSON.parse(e)}catch(t){console.log("Not a valid JSON"),s=!1}let n="";s&&e.hasOwnProperty("topic")&&typeof e.topic===l.Type.STRING&&e.hasOwnProperty("payload")?(n=JSON.stringify(e.payload),this.client.publish(e.topic,""+n)):(i=this.settings["topic"+t].value,n=s?JSON.stringify(e):String(e),this.client.publish(i,""+n))}}}onAfterSettingsChange(){let t=this.settings.topics_count.value;t=p.default.clamp(t,1,100),this.settings.topics_count.value=t,this.topicsCount!=t&&this.changeTopicsCount(t),this.renameInputsOutputs(),this.container.db&&this.container.db.updateNode(this.id,this.container.id,{$set:{inputs:this.inputs,outputs:this.outputs,settings:this.settings}}),this.side==d.Side.server&&(this.disconnectFromBroker(),this.settings.enable.value&&this.connectToBroker())}onRemoved(){this.disconnectFromBroker()}changeTopicsCount(t){let e=t-this.topicsCount;if(0!=e){if(this.changeInputsCount(t+1,l.Type.STRING),this.changeOutputsCount(t+1,l.Type.STRING),e>0)for(let e=this.topicsCount+1;e<=t;e++){this.settings["outputType"+e]=l.NodeSetting.create({description:"Output Type",type:l.SettingType.DROPDOWN,config:{items:[{value:!1,text:"Payload"},{value:!0,text:"JSON"}]},value:!1}),this.settings["topic"+e]=l.NodeSetting.create({description:"Topic "+e,value:"",type:l.SettingType.STRING});for(let e=this.topicsCount+1;e<=t;e++)this.settingConfigs.groups.push({[`outputType${e}`]:{weight:2},[`topic${e}`]:{weight:5}})}else if(e<0)for(let e=this.topicsCount;e>t;e--)delete this.settings["topic"+e],this.settingConfigs.groups.pop();this.topicsCount=t}}renameInputsOutputs(){for(let t=1;t<=this.topicsCount;t++){let e=this.settings["topic"+t].value;e.length>20&&(e="..."+e.substr(e.length-20,20)),this.inputs[t].name=t+" | "+e,this.outputs[t].name=e+" | "+t}if(this.side==d.Side.editor){for(let t=1;t<=this.topicsCount;t++)this.inputs[t].label=this.inputs[t].name,this.outputs[t].label=this.outputs[t].name;this.setDirtyCanvas(!0,!0)}}onExecute(){this.messageQueue&&this.messageQueue.length>0&&this.processQueue(this.messageQueue.shift())}setMQTTOutput(t,e){if(this.settings["outputType"+e].value)this.setOutputData(e,{topic:t.topic,payload:t.message},!0);else{let i=Number(t.message);if(isNaN(i))return void this.setOutputData(e,t.message);this.setOutputData(e,p.default.toFixedNumber(i,this.settings.decimals.value).toString(),!0)}}processQueue(t){for(let e=1;e<=this.topicsCount;e++)c(this.settings["topic"+e].value,t.topic)&&this.setMQTTOutput(t,e)}}a.Container.registerNodeType("protocols/mqtt/client",g)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(62),n=i(10),o=i(6),a=i(0),r=i(3),u=i(2),d=i(5),l=i(1),p=i(31),h=i(61);class c extends r.Node{constructor(){super(),this.inName=0,this.inEnable=1,this.inData=2,this.inTopic=3,this.title=u.NODE_INFO["protocols/mqtt"]["client-single"].title,this.description="## Description\n "+u.NODE_INFO["protocols/mqtt"]["client-single"].description+'\n   \n ### Enable\n    \n  This will enable/disable the device from broker \n    \n ### Use env settings\n    \n  If set to true this will allow you to use the MQTT broker details set from the .env configuration file in the device\n  If set to false this will allow you to set the MQTT broker details manually\n    \n ### Node input\n    \n  The input named "input" can accept a json input or an mqtt payload to send when the topic is set in the node setting called "[topic]".\n  The input named "input" can accept a json payload input with the name, topic, and mqtt payload. See example below.\n  { "payload": 22, "topic": "my topic", "name": "my node node"}\n    \n ',this.addInput("[name]",l.Type.STRING),this.addInputWithSettings("enable",l.Type.BOOLEAN,!1,"enable broker"),this.addInputWithSettings("input",l.Type.STRING,"","JSON input or input value"),this.addInputWithSettings("topic",l.Type.STRING,"","enter topic if not used from input"),this.addOutput("connected",l.Type.BOOLEAN),this.addOutput("output",l.Type.ANY),this.addOutput("output-json",l.Type.JSON),this.settings.retain=l.NodeSetting.create({description:"Retain message on publish",value:!0,type:l.SettingType.BOOLEAN}),this.settings.payloadJson=l.NodeSetting.create({description:"Send payload ",value:!1,type:l.SettingType.BOOLEAN}),this.settings.enableDebug=l.NodeSetting.create({description:"Log debug messages (view logs in platform)",value:!1,type:l.SettingType.BOOLEAN}),this.settings.qos=l.NodeSetting.create({description:"MQTT Quality Of Service (QoS)",type:l.SettingType.DROPDOWN,config:{items:[{value:-1,text:"na"},{value:0,text:"QoS 0"},{value:1,text:"QoS 1"},{value:2,text:"QoS 2"}]},value:0}),this.settings.broker_group=l.NodeSetting.create({description:"Broker settings",value:"",type:l.SettingType.GROUP}),this.settings.useEnv=l.NodeSetting.create({description:"Dont use env settings",value:!1,type:l.SettingType.BOOLEAN}),this.settings.server=l.NodeSetting.create({description:"Broker URL",value:"0.0.0.0",type:l.SettingType.STRING}),this.settings.port=l.NodeSetting.create({description:"Broker port",value:"1883",type:l.SettingType.STRING}),this.settings.authentication=l.NodeSetting.create({description:"Use Authentication",value:!1,type:l.SettingType.BOOLEAN}),this.settings.username=l.NodeSetting.create({description:"User name",value:"",type:l.SettingType.STRING}),this.settings.password=l.NodeSetting.create({description:"Password",value:"",type:l.SettingType.PASSWORD}),this.setSettingsConfig({groups:[{server:{weight:3},port:{weight:1}},{username:{},password:{}}],conditions:{server:t=>!!t.useEnv.value,port:t=>!!t.useEnv.value,authentication:t=>!!t.useEnv.value,username:t=>!!t.authentication.value,password:t=>!!t.authentication.value}})}onAdded(){this.EXECUTE_INTERVAL=200,this.side==d.Side.server&&(this.setOutputData(0,!1),!0===this.getInputData(this.inEnable)&&(this.connectToBroker(),this.enableDebug=this.settings.enableDebug.value,this.enableDebug&&this.debugInfo("MQTT-CLIENT-SINGLE NODE: connect to Broker")))}connectToBroker(){let{host:t,port:e,username:i,password:a}=n.default.mqtt,r={};const u=this.settings.qos.value;if(-1!==u&&(r.qos=u),this.settings.useEnv.value)null!=this.settings.server.value&&""!=this.settings.server.value&&(r.host=this.settings.server.value),null!=this.settings.port.value&&""!=this.settings.port.value&&(r.port=this.settings.port.value),null!=this.settings.username.value&&""!=this.settings.username.value&&(r.username=this.settings.username.value),null!=this.settings.password.value&&""!=this.settings.password.value&&(r.password=p.default.decrypt(this.settings.password.value));else{if(o.isNull(t))return;if(o.isNull(e))return;r.host=t,r.port=e,!0===this.settings.authentication.value&&(o.isNull(r.username)||(r.username=i),o.isNull(r.password)||(r.password=p.default.decrypt(a)))}this.disconnectFromBroker(),this.client=s.connect(r),this.client.on("connect",()=>{this.enableDebug&&this.debugInfo(`MQTT-CLIENT-SINGLE NODE: this.client = mqtt.connect options: ${JSON.stringify(r)}`),this.setOutputData(0,!0);let t=this.getInputData(this.inData),e=this.getInputData(this.inTopic);if(t||e){let i=!0;try{t=JSON.parse(t)}catch(t){this.enableDebug&&this.debugInfo("MQTT-CLIENT-SINGLE NODE: input isn't JSON"),i=!1}i&&t.hasOwnProperty("topic")&&typeof t.topic===l.Type.STRING?""!=t.topic&&(this.client.subscribe(t.topic),this.enableDebug&&this.debugInfo(`MQTT-CLIENT-SINGLE NODE:  subscribe on json topic ${t.topic}`)):""!=t.topic&&(this.enableDebug&&this.debugInfo(`MQTT-CLIENT-SINGLE NODE:  subscribe on node input topic ${e}`),this.client.subscribe(e))}}),this.client.on("close",()=>{this.setOutputData(0,!1,!0)}),this.client.on("error",t=>{this.debugWarn(t)}),this.client.on("message",(t,e)=>{let i={topic:t,message:e.toString()};this.enableDebug&&this.debugInfo(`MQTT-CLIENT-SINGLE NODE:  this.client.on('message' ${JSON.stringify(i)}`),this.processMessage(i)})}disconnectFromBroker(){this.client&&this.client.end()}onInputUpdated(){if(this.inputs[this.inEnable].updated&&(!0===this.getInputData(this.inEnable)?(this.connectToBroker(),this.enableDebug&&this.debugInfo("MQTT-CLIENT-SINGLE NODE: connect to Broker")):!1===this.getInputData(this.inEnable)?(this.disconnectFromBroker(),this.enableDebug&&this.debugInfo("MQTT-CLIENT-SINGLE NODE: disconnect From Broker")):o.isNull(this.getInputData(this.inEnable))&&(this.onAfterSettingsChange(),this.enableDebug&&this.debugInfo("MQTT-CLIENT-SINGLE NODE: disconnect enable input from node"))),this.inputs[this.inName].updated){let t=this.getInputData(this.inName);o.isNull(t)||(this.name=t,this.broadcastNameToClients())}if(this.getInputData(this.inEnable)&&this.inputs[this.inTopic].updated&&(this.connectToBroker(),this.enableDebug&&this.debugInfo("MQTT-CLIENT-SINGLE NODE: node input topic updated")),this.getInputData(this.inEnable)&&this.client&&this.client.connected){let t=this.getInputData(this.inData);if(t&&this.inputs[this.inData].updated){let e,i=!0;try{t=JSON.parse(t)}catch(t){this.enableDebug&&this.debugInfo("MQTT-CLIENT-SINGLE NODE: input isn't JSON"),i=!1}let s="";if(i&&t.hasOwnProperty("topic")&&typeof t.topic===l.Type.STRING&&t.hasOwnProperty("payload")||t.hasOwnProperty("fields")){if(t.hasOwnProperty("payload")?s=JSON.stringify(t.payload):t.hasOwnProperty("fields")&&(s=JSON.stringify(t.fields.value)),""==t.topic)return;this.publish(t.topic,s)}else{if(e=this.getInputData(this.inTopic),s=i?JSON.stringify(t):String(t),""==e)return;this.publish(e,s)}}}}publish(t,e){const i=this.settings.retain.value;if(this.settings.payloadJson.value){let s=JSON.stringify({value:e});this.client.publish(t,""+s,{retain:i}),this.enableDebug&&this.debugInfo(`MQTT-CLIENT-SINGLE NODE: publish on input topic from json ${t}, '' + ${s}`)}else this.client.publish(t,""+e,{retain:i}),this.enableDebug&&this.debugInfo(`MQTT-CLIENT-SINGLE NODE: publish on input topic from node input ${t}, '' + ${e}`)}onAfterSettingsChange(){this.container.db&&this.container.db.updateNode(this.id,this.container.id,{$set:{inputs:this.inputs,outputs:this.outputs,settings:this.settings}}),this.side==d.Side.server&&(this.disconnectFromBroker(),this.getInputData(this.inEnable)&&(this.connectToBroker(),this.enableDebug&&this.debugInfo("MQTT-CLIENT-SINGLE NODE: connect to Broker from settings")))}onRemoved(){this.disconnectFromBroker()}processMessage(t){let e=this.getInputData(this.inTopic);h(e,t.topic)&&(this.setOutputData(1,t.message),this.setOutputData(2,t))}}a.Container.registerNodeType("protocols/mqtt/client-single",c)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO["protocols/mqtt"]["mqtt-topic-extractor"].title,this.description="## Description\n "+a.NODE_INFO["protocols/mqtt"]["mqtt-topic-extractor"]+"\n ## Settings\n  Index will let you select the part of the topic that you want to extract ***topic/abc/123*** \n  For example if the ***topic*** = ***topic/abc/123***  and ***index*** = 1 the the node ***output*** will = ***abc*** \n ## Inputs\n  The input data must be a sting and in a topic format like ***topic/abc/123*** \n ## Outputs\n  ***output*** will return the ***index*** selection \n  ***output-all*** (Returns an array) will return all the topic parts\n  For example if the ***topic*** = ***topic/abc/123***  the  ***output-all*** will return ***[topic, abc, 123]***\n ",this.addInput("input",o.Type.STRING),this.addInputWithSettings("index",o.Type.NUMBER,0,"Index",!1),this.addOutput("output",o.Type.STRING),this.addOutput("output-all",o.Type.JSON)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1);if(null!=t&&null!=e){const i=t.split("/");this.setOutputData(0,i[e],!0),this.setOutputData(1,i,!0)}else this.setOutputData(0,null,!0),this.setOutputData(1,null,!0)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("protocols/mqtt/mqtt-topic-extractor",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.STRING,super.dynamicInputsStartName="string",this.title=a.NODE_INFO["protocols/mqtt"]["topic-builder"].title,this.description=a.NODE_INFO["protocols/mqtt"]["topic-builder"].description,this.addOutput("output",o.Type.STRING),this.setOutputData(0,null)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputsCount();let e="";for(let i=this.dynamicInputStartPosition;i<t;i++){const t=(this.getInputData(i)||"").toString();""!=t&&(""!=e&&(e=e.concat("/")),e=e.concat(t))}this.setOutputData(0,e,!0)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("protocols/mqtt/topic-builder",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(0),o=i(3),a=i(2),r=i(5),u=i(1),d=i(329),l=i(91);class p extends o.Node{constructor(){super(),this.baudRates=[110,300,600,1200,2400,4800,9600,14400,19200,38400,57600,115200,128e3,256e3],this.isConnected=!1,this.port=null,this.title=a.NODE_INFO["protocols/misc"]["serial-connector"].title,this.description="## Description\n "+a.NODE_INFO["protocols/misc"]["serial-connector"].description+"\n    \n ## Nube LoRa Raw Baud Rate\n  Default Baud Rate For Nube LoRa Raw is ***38400*** \n ",this.addInput("writeValue",u.Type.STRING),this.addInput("enable",u.Type.BOOLEAN),this.addInput("list-ports",u.Type.BOOLEAN),this.addOutput("output",u.Type.STRING),this.addOutput("error",u.Type.STRING),this.addOutput("status",u.Type.BOOLEAN),this.addOutput("last-message",u.Type.STRING),this.addOutput("active-ports",u.Type.BOOLEAN),this.settings.manualPort=u.NodeSetting.create({description:"Enter port manually",value:!1,type:u.SettingType.BOOLEAN}),this.settings.port=u.NodeSetting.create({description:"Serial Port",value:"/dev/ttyUSB2",type:u.SettingType.DROPDOWN,config:{items:[{value:"/dev/ttyUSB2",text:"RS485-1 (/dev/ttyUSB2)"},{value:"/dev/ttyUSB3",text:"RS485-2 (/dev/ttyUSB3)"},{value:"/dev/ttyUSB1",text:"Xbee-1 (/dev/ttyUSB1)"},{value:"/dev/ttyUSB0",text:"Xbee-2 (/dev/ttyUSB0)"},{value:"/dev/ttyAMA0",text:"Xbee-3 (/dev/ttyAMA0)"},{value:"/dev/ttyUSB4",text:"USB Port (/dev/ttyUSB4)"},{value:"/dev/ttyS1",text:"Edge28 Expansion (/dev/ttyS1)"}]}}),this.settings.manualPortNum=u.NodeSetting.create({description:"Enter port number",value:"/dev/ttyACM0",type:u.SettingType.STRING}),this.settings.baudRate=u.NodeSetting.create({description:"Baud rate",value:this.baudRates[6],type:u.SettingType.DROPDOWN,config:{items:this.baudRates.map(t=>({value:t,text:t}))}}),this.setOutputData(0,null),this.setOutputData(1,!1),this.setOutputData(2,null),this.setSettingsConfig({conditions:{manualPortNum:t=>t.manualPort.value,port:t=>!t.manualPort.value}})}onInputUpdated(){if(this.isConnected){if(this.isConnected&&!this.getInputData(1))return this.isConnected=!1,this.clearOutputs(),void this.closePort()}else this.connectToSerialPort();this.writePortData(this.getInputData(0)),!0===this.getInputData(2)&&this.listPorts()}onAfterSettingsChange(){this.connectToSerialPort()}onRemoved(){this.closePort()}connectToSerialPort(){if(this.side!==r.Side.server)return;if(this.clearOutputs(),this.closePort(),!this.getInputData(1))return;let t=this.settings.port.value;const e=this.settings.manualPort.value,i=this.settings.manualPortNum.value;e&&(t=e===s.isNull?t:i);let n=this.settings.baudRate.value;if(!t)return this.debugErr("Port name is not defined!"),void this.setOutputData(1,"Port name is not defined!");this.port=new l(t,{baudRate:n,autoOpen:!1}),this.port.on("open",()=>{this.isConnected=!0,this.setOutputData(2,this.isConnected),this.debugInfo("Port connected")}),this.port.on("error",t=>{this.port=null,this.isConnected=!1,this.setOutputData(1,t.message),this.setOutputData(2,this.isConnected),this.debugErr(t.message)}),this.port.on("close",()=>{this.debugInfo(this.isConnected?"Port closed. Gateway disconnected.":"Port closed"),this.isConnected=!1,this.setOutputData(2,this.isConnected)}),this.port.on("disconnect",()=>{this.isConnected=!1,this.setOutputData(2,this.isConnected),this.debugInfo("Disconnected")});const o=l.parsers.Readline;this.port.pipe(new o({delimiter:"\n"})).on("data",t=>this.readPortData(t)),this.debugInfo("Connecting to "+t+" at "+n+"..."),this.port.open()}clearOutputs(){this.setOutputData(0,null),this.setOutputData(1,null),this.setOutputData(2,!1)}listPorts(){d.default.listPorts().then(t=>{this.setOutputData(4,t)}).catch(t=>{this.setOutputData(4,t)})}closePort(){this.port&&this.port.close(),this.port=null}readPortData(t){this.setOutputData(0,t),this.setOutputData(3,this.formattedExecutionTime())}writePortData(t){if(t){try{t=Buffer.from(JSON.parse(t))}catch(t){}try{this.port.write(t)}catch(t){this.setOutputData(1,t.message)}}}}n.Container.registerNodeType("protocols/misc/serial-connector",p)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(91);e.default=class{static listPorts(){return new Promise((t,e)=>{try{let e=[];s.list().then(i=>{i.forEach(t=>{e.push(t)}),t(e)})}catch(t){e(t)}})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(14),n=i(0),o=i(3),a=i(2),r=i(1),u=i(83);class d extends o.Node{constructor(){super(),this.daysArray=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],this.title=a.NODE_INFO.schedule["weekly-schedule"].title,this.description=a.NODE_INFO.schedule["weekly-schedule"].description,this.addOutput("output",r.Type.BOOLEAN),this.settings.enable=r.NodeSetting.create({description:"Schedule Enable",value:!0,type:r.SettingType.BOOLEAN}),this.settings.stringScheduleName=r.NodeSetting.create({description:"Schedule Name",value:"",type:r.SettingType.STRING}),this.settings.timezone=r.NodeSetting.create({description:"TIMEZONE: Enter the timezone",value:s.tz.guess(),type:r.SettingType.STRING}),this.settings.startHour=r.NodeSetting.create({description:"Start Time",value:7,type:r.SettingType.DROPDOWN,config:{items:this.makeHoursDropdown()}}),this.settings.startMin=r.NodeSetting.create({description:"",value:0,type:r.SettingType.DROPDOWN,config:{items:this.makeMinsDropdown()}}),this.settings.endHour=r.NodeSetting.create({description:"End Time",value:19,type:r.SettingType.DROPDOWN,config:{items:this.makeHoursDropdown()}}),this.settings.endMin=r.NodeSetting.create({description:"",value:0,type:r.SettingType.DROPDOWN,config:{items:this.makeMinsDropdown()}}),this.settings.sunday=r.NodeSetting.create({description:"sunday",value:!1,type:r.SettingType.BOOLEAN}),this.settings.monday=r.NodeSetting.create({description:"monday",value:!1,type:r.SettingType.BOOLEAN}),this.settings.tuesday=r.NodeSetting.create({description:"tuesday",value:!1,type:r.SettingType.BOOLEAN}),this.settings.wednesday=r.NodeSetting.create({description:"wednesday",value:!1,type:r.SettingType.BOOLEAN}),this.settings.thursday=r.NodeSetting.create({description:"thursday",value:!1,type:r.SettingType.BOOLEAN}),this.settings.friday=r.NodeSetting.create({description:"friday",value:!1,type:r.SettingType.BOOLEAN}),this.settings.saturday=r.NodeSetting.create({description:"saturday",value:!1,type:r.SettingType.BOOLEAN}),this.settings.payload=r.NodeSetting.create({description:"Schedule Payload",value:0,type:r.SettingType.NUMBER}),this.setSettingsConfig({groups:[{startHour:{},startMin:{}},{endHour:{},endMin:{}}]})}onAdded(){this.onAfterSettingsChange()}onAfterSettingsChange(){var t={weekly:{},events:{}};if(!this.settings.enable.value)return t;const e=u.default.createUUID(),i=s.tz(this.settings.timezone.value).utcOffset(),n=Math.floor(i/60),o=i%60;var a=0,r=this.settings.startHour.value-n;r<0?(a=-1,r+=24):r>24&&(a=1,r-=24);var d=this.settings.startMin.value-o;d<0?d+=60:d>=60&&(d-=60);var l=this.settings.endHour.value-n;l<0?l+=24:l>24&&(l-=24);var p=this.settings.endMin.value-o;p<0?p+=60:p>=60&&(p-=60);const h=this.settings.sunday.value&&-1==a?7:0,c=this.settings.saturday.value&&1==a?-1:6;var g=[];this.settings.sunday.value&&g.push(this.daysArray[h+a]),this.settings.monday.value&&g.push(this.daysArray[1+a]),this.settings.tuesday.value&&g.push(this.daysArray[2+a]),this.settings.wednesday.value&&g.push(this.daysArray[3+a]),this.settings.thursday.value&&g.push(this.daysArray[4+a]),this.settings.friday.value&&g.push(this.daysArray[5+a]),this.settings.saturday.value&&g.push(this.daysArray[c+a]),t.weekly={[e]:{colour:"#FFFFFF",name:this.settings.stringScheduleName.value||"unknownSchedule",start:`${String(r).padStart(2,"0")}:${String(d).padStart(2,"0")}`,end:`${String(l).padStart(2,"0")}:${String(p).padStart(2,"0")}`,days:g,value:this.settings.payload.value,id:e}},this.setOutputData(0,t)}makeHoursDropdown(){for(var t=[],e=0;e<24;e++)t.push({value:e,text:String(e).padStart(2,"0")});return t}makeMinsDropdown(){for(var t=[],e=0;e<60;e++)t.push({value:e,text:String(e).padStart(2,"0")});return t}}n.Container.registerNodeType("schedule/weekly-schedule",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(2),a=i(1);class r extends n.FlexibleNode{constructor(){super(),this.dynamicSettingsExist=!1,this.dynamicInputsType=a.Type.STRING,this.title=o.NODE_INFO.schedule["schedule-merge"].title,this.description=o.NODE_INFO.schedule["schedule-merge"].description,this.addOutput("output",a.Type.BOOLEAN),this.addOutput("error",a.Type.STRING)}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){for(var t,e,i={},s={},n=0;n<this.getInputsCount();n++)if(t=this.getInputData(n))try{for(var o in(e=JSON.parse(t)).weekly)i[o]=e.weekly[o];for(var a in e.events)i[a]=e.events[a];this.setOutputData(0,{weekly:i,events:s})}catch(t){this.setOutputData(1,t)}}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("schedule/schedule-merge",r)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ScheduleChecker=void 0;const n=i(14),o=i(0),a=i(3),r=i(2),u=i(5),d=i(1),l=i(7),p=i(333);class h extends a.Node{constructor(){super(),this.title=r.NODE_INFO.schedule["schedule-checker"].title,this.description=r.NODE_INFO.schedule["schedule-checker"].description,this.addInputWithSettings("enable",d.Type.BOOLEAN,!0,"Enable",!1),this.addInput("schedules",d.Type.JSON),this.addOutput("output",d.Type.BOOLEAN),this.addOutput("payload",d.Type.BOOLEAN),this.addOutput("nextStart",d.Type.STRING),this.addOutput("nextStop",d.Type.STRING),this.addOutput("lastCheck",d.Type.STRING),this.addOutput("error",d.Type.STRING),this.settings.stringScheduleName=d.NodeSetting.create({description:"Schedule Name",value:"",type:d.SettingType.STRING}),this.settings.timezone=d.NodeSetting.create({description:"TIMEZONE: Enter the timezone",value:n.tz.guess(),type:d.SettingType.STRING}),this.settings.interval=d.NodeSetting.create({description:"Schedule Check Interval (minimum 10 seconds)",value:30,type:d.SettingType.NUMBER}),this.settings.time=d.NodeSetting.create({description:"Units",type:d.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]}),this.settings.numericTimeFormat=d.NodeSetting.create({description:"Timestamp Output Format",type:d.SettingType.DROPDOWN,config:{items:[{value:!1,text:"Timestamps as Strings"},{value:!0,text:"Timestamps as Epoch Numerics"}]},value:!1}),this.nextStart=null,this.nextStop=null,this.schedulePayload=null,this.EXECUTE_INTERVAL=1e4}onAdded(){return s(this,void 0,void 0,(function*(){yield this.updateTitle(),yield this.onInputUpdated()}))}onInputUpdated(){return s(this,void 0,void 0,(function*(){if(this.side!==u.Side.server)return;let t=this.getInputData(1)||{weekly:{},events:{}};yield this.setOutput(t)}))}onExecute(){return s(this,void 0,void 0,(function*(){yield this.setOutput()}))}updateTitle(){return s(this,void 0,void 0,(function*(){null!=this.settings.stringScheduleName.value&&""!=this.settings.stringScheduleName.value?this.title=`Schedule Checker (${this.settings.stringScheduleName.value})`:this.title="Schedule Checker (unconfigured)",this.broadcastTitleToClients()}))}onAfterSettingsChange(){return s(this,void 0,void 0,(function*(){yield this.updateTitle();let t=this.settings.interval.value;t=l.default.timeConvert(t,this.settings.time.value),this.EXECUTE_INTERVAL=Math.max(t,1e4),yield this.onInputUpdated()}))}setOutput(t=null){return s(this,void 0,void 0,(function*(){this.nextStart=null,this.nextStop=null,this.schedulePayload=null,t||(t=this.getInputData(1)||{weekly:{},events:{}});const e=this.settings.stringScheduleName.value;if(null==e||""===e)return this.setOutputData(0,!1,!0),this.setOutputData(1,null,!0),this.setOutputData(2,null,!0),this.setOutputData(3,null,!0),this.setOutputData(4,n(this.executeLastTime).format("YYYY-MM-DDTHH:MM:ss"),!0),void this.setOutputData(5,"Schedule Checker Error: invalid schedule selected",!0);let i=this.settings.timezone.value;n.tz.zone(i)||(i=n.tz.guess());const s=n.tz(i),o=this.getInputData(0);if(t&&e&&o){let n=!1,o=null;for(var a in t.weekly)t.weekly[a].name===e&&(o=p.ScheduleUtils.checkWeeklySchedule(t.weekly[a],s),n=o.scheduleStatus||n,this.schedulePayload=o.value||this.schedulePayload,null!=o.nextStop&&(null==this.nextStop||o.nextStop.isBefore(this.nextStop))&&(this.nextStop=o.nextStop),null!=o.nextStart&&(null==this.nextStart||o.nextStart.isBefore(this.nextStart))&&(this.nextStart=o.nextStart));let r=!1,u=null;for(var a in t.events)t.events[a].name===e&&(u=p.ScheduleUtils.checkEventsSchedule(t.events[a],s),r=u.scheduleStatus||r,this.schedulePayload=u.value||this.schedulePayload,null!=u.nextStop&&(u.nextStop.isBefore(this.nextStop)||null==this.nextStop)&&(this.nextStop=u.nextStop),null!=u.nextStart&&(u.nextStart.isBefore(this.nextStart)||null==this.nextStart)&&(this.nextStart=u.nextStart));const d=n||r;this.setOutputData(0,d,!0),this.setOutputData(1,this.schedulePayload,!0),null!=this.nextStart?this.settings.numericTimeFormat.value?this.setOutputData(2,this.nextStart.valueOf(),!0):this.setOutputData(2,this.nextStart.tz(i).format(),!0):this.setOutputData(2,null,!0),null!=this.nextStop?this.settings.numericTimeFormat.value?this.setOutputData(3,this.nextStop.valueOf(),!0):this.setOutputData(3,this.nextStop.tz(i).format(),!0):this.setOutputData(3,null,!0)}else this.setOutputData(0,!1,!0),this.setOutputData(1,null,!0),this.setOutputData(2,null,!0),this.setOutputData(3,null,!0);this.settings.numericTimeFormat.value?this.setOutputData(4,n(this.executeLastTime).valueOf()):this.setOutputData(4,n(this.executeLastTime).tz(i).format()),this.setOutputData(5,!1)}))}}e.ScheduleChecker=h,o.Container.registerNodeType("schedule/schedule-checker",h)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScheduleUtils=void 0;const s=i(14),n=i(4);e.ScheduleUtils=class{static checkEventsSchedule(t,e){if(t&&Object.prototype.hasOwnProperty.call(t,"dates")){let i=!1,n=null,o=null,a=null;for(let r=0;r<t.dates.length;r++){const u=e.clone().tz("Etc/UTC"),d=s.tz(t.dates[r].start,"Etc/UTC"),l=s.tz(t.dates[r].end,"Etc/UTC");u.isAfter(d)&&u.isBefore(l)?(i=!0,t&&Object.prototype.hasOwnProperty.call(t,"value")&&(a=t.value),(null==o||l.isBefore(o))&&(o=l)):u.isBefore(d)&&u.isBefore(l)&&((null==n||d.isBefore(n))&&(n=d),(null==o||l.isBefore(o))&&(o=l))}return{scheduleStatus:i,nextStart:n,nextStop:o,value:a}}return{scheduleStatus:!1,nextStart:null,nextStop:null,value:null}}static checkWeeklySchedule(t,e){let i=!1,o=null,a=null,r=null;if(t){const u=e.clone().tz("Etc/UTC");let d=t.days.map(t=>n.default.getISOday(t)),l=t.start.split(":").map(t=>Number(t)),p=t.end.split(":").map(t=>Number(t)),h=0;l[0]>p[0]&&(h=1);const c=u.format("YYYY-MM-DD");let g=d.map(e=>s.tz(`${c}T${t.start}:00.000Z`,"Etc/UTC").isoWeekday(e)),m=d.map(e=>s.tz(`${c}T${t.end}:00.000Z`,"Etc/UTC").isoWeekday(e+h));if(h)for(let t=0;t<m.length;t++)if(u.clone().add(1,"weeks").isBefore(m[t])){m[t].subtract(1,"weeks"),g[t].subtract(1,"weeks");break}if(g.every(t=>t.isBefore(u))&&m.every(t=>t.isBefore(u)))g.map(t=>t.add(1,"weeks")),m.map(t=>t.add(1,"weeks"));else if(g.every(t=>t.isBefore(u)))for(let t=0;t<m.length;t++)m[t].isBefore(u)&&(m[t].add(1,"weeks"),g[t].add(1,"weeks"));for(let e=0;e<g.length;e++)g[e].isBefore(u)&&m[e].isAfter(u)?(i=!0,t&&Object.prototype.hasOwnProperty.call(t,"value")&&(r=t.value),a=m[e],o=g[e].add(1,"weeks")):g[e].isAfter(u)&&(null==o||g[e].isBefore(o))&&(o=g[e]),m[e].isAfter(u)&&(null==a||m[e].isBefore(a))&&(a=m[e])}return{scheduleStatus:i,nextStart:o,nextStop:a,value:r}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),o=i(4),a=i(24),r=i(2);class u extends a.default{constructor(){super(),this.title=r.NODE_INFO.statistics["min-max-avg"].title,this.description=r.NODE_INFO.statistics["min-max-avg"].description,this.addOutput("Min",n.Type.NUMBER),this.addOutput("Max",n.Type.NUMBER),this.addOutput("Avg",n.Type.NUMBER)}onInputUpdated(){const t=this.getDefinedInputsOrSettingsValues(),e=Math.min.apply(Math,t),i=Math.max.apply(Math,t),s=t.length,n=o.default.sum(t)/s;this.setOutputData(0,e),this.setOutputData(1,i),this.setOutputData(2,n)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("statistics/min-max-avg",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),o=i(4),a=i(24),r=i(2);class u extends a.default{constructor(){super(),this.title=r.NODE_INFO.statistics.avg.title,this.description=r.NODE_INFO.statistics.avg.description,this.addOutput("Avg",n.Type.NUMBER),this.addOutput("Count",n.Type.STRING),this.addOutput("Sum",n.Type.STRING)}onInputUpdated(){const t=this.getDefinedInputsOrSettingsValues(),e=t.length,i=o.default.sum(t);let s=0;0!==e&&(s=i/e),this.setOutputData(0,s),this.setOutputData(1,e),this.setOutputData(2,i)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("statistics/avg",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),o=i(4),a=i(24),r=i(2);class u extends a.default{constructor(){super(),this.title=r.NODE_INFO.statistics.min.title,this.description=r.NODE_INFO.statistics.min.description,this.addOutput("min",n.Type.NUMBER)}onInputUpdated(){const t=this.getDefinedInputsOrSettingsValues(),e=o.default.stat.min(t);this.setOutputData(0,e)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("statistics/min",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),o=i(4),a=i(24),r=i(2);class u extends a.default{constructor(){super(),this.title=r.NODE_INFO.statistics.max.title,this.description=r.NODE_INFO.statistics.max.description,this.addOutput("max",n.Type.NUMBER)}onInputUpdated(){const t=this.getDefinedInputsOrSettingsValues(),e=o.default.stat.max(t);this.setOutputData(0,e)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("statistics/max",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),o=i(4),a=i(24),r=i(2);class u extends a.default{constructor(){super(),this.title=r.NODE_INFO.statistics.sum.title,this.description=r.NODE_INFO.statistics.sum.description,this.addOutput("sum",n.Type.NUMBER)}onInputUpdated(){const t=this.getDefinedInputsOrSettingsValues(),e=o.default.stat.sum(t);this.setOutputData(0,e)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("statistics/sum",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),o=i(4),a=i(24),r=i(2);class u extends a.default{constructor(){super(),this.title=r.NODE_INFO.statistics.median.title,this.description=r.NODE_INFO.statistics.median.description,this.addOutput("median",n.Type.NUMBER)}onInputUpdated(){const t=this.getDefinedInputsOrSettingsValues(),e=o.default.stat.median(t);this.setOutputData(0,e)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("statistics/median",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),o=i(4),a=i(24),r=i(2);class u extends a.default{constructor(){super(),this.title=r.NODE_INFO.statistics.range.title,this.description=r.NODE_INFO.statistics.range.description,this.addOutput("range",n.Type.NUMBER)}onInputUpdated(){const t=this.getDefinedInputsOrSettingsValues(),e=o.default.stat.range(t);this.setOutputData(0,e)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("statistics/range",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(2),a=i(1);class r extends n.FlexibleNode{constructor(){super(),this.dynamicOutputsExist=!0,this.dynamicSettingsExist=!1,this.dynamicInputsType=a.Type.NUMBER,super.dynamicOutputsType=a.Type.NUMBER,this.dynamicDefaultInputs=5,this.dynamicDefaultOutputs=3,this.title=o.NODE_INFO.statistics.rank.title,this.description=o.NODE_INFO.statistics.rank.description,this.settings.rank=a.NodeSetting.create({description:"Highest or Lowest",type:a.SettingType.DROPDOWN,config:{items:[{value:"top",text:"Rank Highest"},{value:"bottom",text:"Rank Lowest"}]},value:"top"})}onAdded(){this.updateTitle(),this.onInputUpdated()}onInputUpdated(){let t=this.getDefinedInputValues();t=t.sort((t,e)=>t-e);const e=this.getOutputsCount();if("bottom"===this.settings.rank.value)for(let i=0;i<e;i++)this.setOutputData(i,t[i]);else for(let i=0;i<e;i++)this.setOutputData(i,t[t.length-(i+1)])}onAfterSettingsChange(){Number(this.settings.outputs.value)>Number(this.settings.inputs.value)&&(this.settings.outputs.value=Number(this.settings.inputs.value)),super.onAfterSettingsChange(),this.onInputUpdated(),this.updateTitle()}updateTitle(){"top"===this.settings.rank.value?this.title="Rank (Highest)":"bottom"===this.settings.rank.value&&(this.title="Rank (Lowest)")}}s.Container.registerNodeType("statistics/rank",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),o=i(4),a=i(24),r=i(2);class u extends a.default{constructor(){super(),this.title=r.NODE_INFO.statistics["stats-all"].title,this.description=r.NODE_INFO.statistics["stats-all"].description,this.addOutput("max",n.Type.NUMBER),this.addOutput("min",n.Type.NUMBER),this.addOutput("range",n.Type.NUMBER),this.addOutput("sum",n.Type.NUMBER),this.addOutput("mean",n.Type.NUMBER),this.addOutput("median",n.Type.NUMBER),this.addOutput("modes",n.Type.NUMBER),this.addOutput("variance",n.Type.NUMBER),this.addOutput("standardDeviation",n.Type.NUMBER),this.addOutput("meanAbsoluteDeviation",n.Type.NUMBER),this.addOutput("zScores",n.Type.NUMBER)}onInputUpdated(){const t=this.getDefinedInputsOrSettingsValues();this.setOutputData(0,o.default.stat.max(t)),this.setOutputData(1,o.default.stat.min(t)),this.setOutputData(2,o.default.stat.range(t)),this.setOutputData(3,o.default.stat.sum(t)),this.setOutputData(4,o.default.stat.mean(t)),this.setOutputData(5,o.default.stat.median(t)),this.setOutputData(6,o.default.stat.modes(t)),this.setOutputData(7,o.default.stat.variance(t)),this.setOutputData(8,o.default.stat.standardDeviation(t)),this.setOutputData(9,o.default.stat.meanAbsoluteDeviation(t)),this.setOutputData(10,o.default.stat.zScores(t))}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("statistics/stats-all",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.values=[],this.title=o.NODE_INFO.streams["stream-average"].title,this.description="## Description\n "+o.NODE_INFO.streams["stream-average"].description+" \n  ## Reset to null\n ***Reset to null*** if set to option true and a true value on the node ***reset*** this will reset the node ***output*** to a value of null, If set to false it will keep the last node ***output*** value \n ",this.addInput("value",a.Type.NUMBER),this.addInput("reset",a.Type.BOOLEAN),this.addOutput("output",a.Type.NUMBER),this.settings.null=a.NodeSetting.create({description:"Reset to null",value:!1,type:a.SettingType.BOOLEAN}),this.lastReset=!1}onInputUpdated(){const t=this.getInputData(1);let e=this.getInputData(0);const i=this.settings.null.value;if(t&&!this.lastReset)return void(i?(this.setOutputData(0,null),this.values=[],this.lastReset=t):(this.values=[],this.setOutputData(0,this.avg),this.lastReset=t));if(!t&&this.lastReset)return void(this.lastReset=t);if(null==e)return;this.values.push(e);let s=this.values.reduce((function(t,e){return t+e}))/this.values.length;this.avg=s,this.setOutputData(0,this.avg)}}s.Container.registerNodeType("streams/stream-average",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.streams["stream-highest"].title,this.description=o.NODE_INFO.streams["stream-highest"].description,this.description="## Description\n "+o.NODE_INFO.streams["stream-highest"].description+" \n  ## Reset to null\n ***Reset to null*** if set to option true and a true value on the node ***reset*** this will reset the node ***output*** to a value of null, If set to false it will keep the last node ***output*** value \n ",this.addInput("input",a.Type.NUMBER),this.addInput("reset",a.Type.BOOLEAN),this.addOutput("output",a.Type.NUMBER),this.settings.null=a.NodeSetting.create({description:"Reset to null",value:!1,type:a.SettingType.BOOLEAN}),this.lastReset=!1,this.val=null}onInputUpdated(){const t=this.getInputData(1),e=this.settings.null.value;if(t&&!this.lastReset)return void(e?(this.setOutputData(0,null),this.val=null,this.lastReset=t):(this.setOutputData(0,this.val),this.val=null,this.lastReset=t));if(!t&&this.lastReset)return void(this.lastReset=t);let i=this.getInputData(0);null!=i&&(null==this.val||this.val<i)&&(this.val=i,this.setOutputData(0,this.val))}}s.Container.registerNodeType("streams/stream-highest",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.streams.stack.title,this.description="## Description\n "+o.NODE_INFO.streams.stack.description+" \n  ## Reset to null\n ***Reset to null*** if set to option true and a true value on the node ***reset*** this will reset the node ***output*** to a value of null, If set to false it will keep the last node ***output*** value \n ",this.addInput("input",a.Type.NUMBER),this.addInput("reset",a.Type.BOOLEAN),this.addOutput("output",a.Type.NUMBER),this.settings.null=a.NodeSetting.create({description:"Reset to null",value:!1,type:a.SettingType.BOOLEAN}),this.val=null,this.lastReset=!1}onInputUpdated(){const t=this.getInputData(1),e=this.settings.null.value;if(t&&!this.lastReset)return void(e?(this.setOutputData(0,null),this.val=null,this.lastReset=t):(this.setOutputData(0,this.val),this.val=null,this.lastReset=t));if(!t&&this.lastReset)return void(this.lastReset=t);let i=this.getInputData(0);null!=i&&(null==this.val||this.val>i)&&(this.val=i,this.setOutputData(0,this.val))}}s.Container.registerNodeType("streams/stream-lowest",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.val=0,this.title=o.NODE_INFO.streams["stream-sum"].title,this.description="## Description\n "+o.NODE_INFO.streams["stream-sum"].description+" \n  ## Reset to null\n ***Reset to null*** if set to option true and a true value on the node ***reset*** this will reset the node ***output*** to a value of null, If set to false it will keep the last node ***output*** value \n ",this.addInput("input",a.Type.NUMBER),this.addInput("reset",a.Type.BOOLEAN),this.addOutput("output",a.Type.NUMBER),this.settings.null=a.NodeSetting.create({description:"Reset to null",value:!1,type:a.SettingType.BOOLEAN}),this.lastReset=!1}onInputUpdated(){const t=this.getInputData(1),e=this.settings.null.value;!t||this.lastReset?t||!this.lastReset?(this.inputs[0].updated&&null!=this.inputs[0].data&&(this.val+=this.inputs[0].data),this.setOutputData(0,this.val,!0)):this.lastReset=t:e?(this.setOutputData(0,null),this.val=null,this.lastReset=t):(this.setOutputData(0,this.val),this.val=0,this.lastReset=t)}}s.Container.registerNodeType("streams/stream-sum",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(2),a=i(1),r=i(4);class u extends n.FlexibleNode{constructor(){super(),this.dynamicSettingsExist=!1,this.dynamicInputsType=a.Type.ANY,this.title=o.NODE_INFO.streams["stream-merge"].title,this.description=o.NODE_INFO.streams["stream-merge"].description,this.addOutput("output",a.Type.ANY)}onAdded(){this.onInputUpdated(),this.size=this.computeSize()}onInputUpdated(){const t=this.getInputsCount();for(let e=this.dynamicInputStartPosition;e<t;e++){let t=this.getInputData(e);if(r.default.hasInput(t)&&this.inputs[e].updated)return void this.setOutputData(0,this.inputs[e].data)}}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("streams/stream-merge",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.streams.gate.title,this.description=o.NODE_INFO.streams.gate.description,this.addInput("input",a.Type.STRING),this.addInput("open",a.Type.BOOLEAN),this.addOutput("output",a.Type.STRING),this.settings["send-null"]=a.NodeSetting.create({description:"Send null when closed",value:!1,type:a.SettingType.BOOLEAN})}onInputUpdated(){this.getInputData(1)?this.setOutputData(0,this.getInputData(0)):this.settings["send-null"].value&&null!=this.outputs[0].data&&this.setOutputData(0,null)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("streams/gate",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.data=[],this.title=a.NODE_INFO.streams.stack.title,this.description=a.NODE_INFO.streams.stack.description,this.addInput("input"),this.addInput("trigger",o.Type.BOOLEAN),this.addInput("clear",o.Type.BOOLEAN),this.addOutput("output"),this.addOutput("count",o.Type.NUMBER),this.lastReset=!1}onInputUpdated(){const t=this.getInputData(2);if(t&&!this.lastReset)return this.data=[],this.setOutputData(0,null),this.setOutputData(1,0),void(this.lastReset=t);if(t||!this.lastReset){if(this.inputs[0].updated&&null!=this.inputs[0].data&&(this.data.push(this.inputs[0].data),this.setOutputData(1,this.data.length)),this.inputs[1].updated&&1==this.inputs[1].data){let t=this.data.length>0?this.data.pop():null;this.setOutputData(0,t),this.setOutputData(1,this.data.length)}}else this.lastReset=t}}s.Container.registerNodeType("streams/stack",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.data=[],this.title=a.NODE_INFO.streams.queue.title,this.description=a.NODE_INFO.streams.queue.description,this.addInput("input"),this.addInput("trigger",o.Type.BOOLEAN),this.addInput("clear",o.Type.BOOLEAN),this.addOutput("output"),this.addOutput("count",o.Type.NUMBER),this.lastReset=!1}onInputUpdated(){const t=this.getInputData(2);if(t&&!this.lastReset)return this.data=[],this.setOutputData(0,null),this.setOutputData(1,0),void(this.lastReset=t);if(t||!this.lastReset){if(this.inputs[0].updated&&null!=this.inputs[0].data&&(this.data.unshift(this.inputs[0].data),this.setOutputData(1,this.data.length)),this.inputs[1].updated&&1==this.inputs[1].data){let t=this.data.length>0?this.data.pop():null;this.setOutputData(0,t),this.setOutputData(1,this.data.length)}}else this.lastReset=t}}s.Container.registerNodeType("streams/queue",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.delayedValues=[],this.title=r.NODE_INFO.streams["stream-delay"].title,this.description=r.NODE_INFO.streams["stream-delay"].description,this.addInput("input"),this.addInputWithSettings("delay",o.Type.NUMBER,1e3,"Delay (millis)",!1),this.addOutput("output"),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{delay:{weight:2},time:{}}]})}onAdded(){this.inputs[1].name=`[delay] (${this.settings.time.value})`}onAfterSettingsChange(){this.inputs[1].name=`[delay] (${this.settings.time.value})`}onInputUpdated(){this.inputs[0].updated&&this.delayedValues.push({val:this.inputs[0].data,time:Date.now()})}onExecute(){if(0==this.delayedValues.length)return;let t=this.getInputData(1);t=a.default.timeConvert(t,this.settings.time.value);const e=this.delayedValues[0];return Date.now()-e.time>=t?(this.delayedValues.shift(),void this.setOutputData(0,e.val)):void 0}}s.Container.registerNodeType("streams/stream-delay",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.streams["stream-delay-meter"].title,this.description=a.NODE_INFO.streams["stream-delay-meter"].description,this.addInput("input"),this.addInput("reset",o.Type.BOOLEAN),this.addOutput("ms",o.Type.NUMBER),this.lastReset=!1}onInputUpdated(){const t=this.getInputData(1);if(t&&!this.lastReset)return this.lastTime=null,this.setOutputData(0,null),void(this.lastReset=t);if(t||!this.lastReset){if(this.inputs[0].updated&&null!=this.inputs[0].data){if(null!=this.lastTime){let t=Date.now()-this.lastTime;this.setOutputData(0,t)}this.lastTime=Date.now()}}else this.lastReset=t}}s.Container.registerNodeType("streams/stream-delay-meter",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.count=0,this.countWas=0,this.title=a.NODE_INFO.streams["frequency-meter"].title,this.description=a.NODE_INFO.streams["frequency-meter"].description,this.addInput("input"),this.addInput("reset",o.Type.BOOLEAN),this.addOutput("events/sec",o.Type.NUMBER,void 0,{data:0}),this.lastReset=!1,setInterval(()=>{this.count!=this.countWas&&this.setOutputData(0,this.count),this.countWas=this.count,this.count=0},1e3)}onInputUpdated(){const t=this.getInputData(1);if(t&&!this.lastReset)return this.count=0,this.countWas=0,this.setOutputData(0,null),void(this.lastReset=t);t||!this.lastReset?this.count++:this.lastReset=t}}s.Container.registerNodeType("streams/frequency-meter",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.streams.flatline.title,this.description=r.NODE_INFO.streams.flatline.description,this.addInput("input",o.Type.ANY),this.addInputWithSettings("interval",o.Type.NUMBER,30,"Interval"),this.addOutput("output",o.Type.BOOLEAN),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:a.TIME_TYPE.MILLISECONDS,text:"Milliseconds"},{value:a.TIME_TYPE.SECONDS,text:"Seconds"},{value:a.TIME_TYPE.MINUTES,text:"Minutes"},{value:a.TIME_TYPE.HOURS,text:"Hours"}]},value:a.TIME_TYPE.MINUTES}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]})}onAdded(){this.setOutputData(0,!1),this.inputs[1].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(this.inputs[0].updated&&t!==this.lastValue){this.lastValue=t,this.setOutputData(0,!1);const e=a.default.timeConvert(this.getInputData(1),this.settings.time.value);this.timeoutFunc&&clearTimeout(this.timeoutFunc),this.timeoutFunc=setTimeout(()=>{this.setOutputData(0,!0)},e)}}onAfterSettingsChange(){this.inputs[1].name=`[interval] (${this.settings.time.value})`,this.setOutputData(0,!1);const t=a.default.timeConvert(this.getInputData(1),this.settings.time.value);this.timeoutFunc&&clearTimeout(this.timeoutFunc),this.timeoutFunc=setTimeout(()=>{this.setOutputData(0,!0)},t)}}s.NodeTypeRegistry.registerNodeType("streams/flatline",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(84),u=i(2);var d;!function(t){t.Equals="Equals",t.NotEquals="Not Equal",t.GreaterThanEqual="Greater Than Equal",t.GreaterThan="Greater Than",t.LessThanEqual="Less Than Equal",t.LessThan="Less Than",t.Includes="Includes",t.startsWith="Starts With",t.endsWith="Ends With"}(d||(d={}));class l extends n.Node{constructor(){super(),this.title=u.NODE_INFO.string["string-compare"].title,this.description=u.NODE_INFO.string["string-compare"].description,this.addInput("input",o.Type.STRING),this.addInputWithSettings("comparison-to",o.Type.STRING,"","Comparison Value"),this.addOutput("match",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN),this.setOutputData(0,null),this.setOutputData(1,null),this.settings.function=o.NodeSetting.create({description:"Comparison Type",type:o.SettingType.DROPDOWN,config:{items:[{value:d.Equals,text:d.Equals},{value:d.NotEquals,text:d.NotEquals},{value:d.GreaterThanEqual,text:d.GreaterThanEqual},{value:d.GreaterThan,text:d.GreaterThan},{value:d.LessThanEqual,text:d.LessThanEqual},{value:d.LessThan,text:d.LessThan},{value:d.Includes,text:d.Includes},{value:d.startsWith,text:d.startsWith},{value:d.endsWith,text:d.endsWith}]},value:d.Equals}),this.settings.isNumber=o.NodeSetting.create({description:"Comparison value is a number",value:!1,type:o.SettingType.BOOLEAN}),this.settings.passNull=o.NodeSetting.create({description:"Send null if not a match",value:!1,type:o.SettingType.BOOLEAN}),this.settings.null=o.NodeSetting.create({description:"Block null messages on input",value:!1,type:o.SettingType.BOOLEAN})}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1),i=this.settings.null.value;a.default.hasInput(t)?(null!==t||i)&&(r.default.compare(this,t,e)?(this.setOutputData(0,!0),this.setOutputData(1,t)):!0===this.settings.passNull.value?(this.setOutputData(0,null),this.setOutputData(1,null)):(this.setOutputData(0,!1),this.setOutputData(1,t))):this.setOutputData(0,null)}onAfterSettingsChange(){const t=this.settings.function.value;this.title=`String Comparison Compare (${t})`,this.broadcastTitleToClients(),this.onInputUpdated()}}s.Container.registerNodeType("string/string-compare",l)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.string["cut-substring"].title,this.description=a.NODE_INFO.string["cut-substring"].description,this.addInput("input",o.Type.STRING),this.addInputWithSettings("start",o.Type.NUMBER,0,"Start",!1),this.addInputWithSettings("length",o.Type.NUMBER,1,"Length",!1),this.addOutput("output",o.Type.STRING)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1),i=this.getInputData(2);null!=t&&null!=e&&null!=i?this.setOutputData(0,t.substr(e,i)):this.setOutputData(0,null)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("string/cut-substring",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=o.Type.STRING,super.dynamicInputsStartName="string",this.title=a.NODE_INFO.string["string-join"].title,this.description=a.NODE_INFO.string["string-join"].description,this.addOutput("output",o.Type.STRING),this.setOutputData(0,null)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputsCount();let e="";for(let i=this.dynamicInputStartPosition;i<t;i++)e=e.concat(this.getInputData(i));this.setOutputData(0,e,!0)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("string/string-join",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.string["string-length"].title,this.description=a.NODE_INFO.string["string-length"].description,this.addInput("input",o.Type.STRING),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,t.length):this.setOutputData(0,null)}}s.Container.registerNodeType("string/string-length",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(5),r=i(1);class u extends n.Node{constructor(){super(),this.title=o.NODE_INFO.string["string-index-of"].title,this.description=o.NODE_INFO.string["string-index-of"].description,this.addInputWithSettings("input",r.Type.STRING,"","Input Value",!1),this.addInputWithSettings("searchFor",r.Type.STRING,"","Search For Value",!1),this.addOutput("startIndex",r.Type.NUMBER),this.addOutput("endIndex",r.Type.NUMBER),this.setOutputData(0,null),this.setOutputData(1,null),this.settings.input=r.NodeSetting.create({description:"string1 Value",value:"",type:r.SettingType.STRING}),this.settings.searchFor=r.NodeSetting.create({description:"Search For Value",value:"",type:r.SettingType.STRING})}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1),i=t.indexOf(e),s=e.length;i<0?(this.setOutputData(0,null,!0),this.setOutputData(1,null,!0)):(this.setOutputData(0,i,!0),this.setOutputData(1,i+s,!0))}onAfterSettingsChange(){this.side===a.Side.server&&this.onInputUpdated()}}s.Container.registerNodeType("string/string-index-of",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.string["char-at-index"].title,this.description=a.NODE_INFO.string["char-at-index"].description,this.addInput("input",o.Type.STRING),this.addInputWithSettings("index",o.Type.NUMBER,0,"Index",!1),this.addOutput("output",o.Type.STRING)}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1);null!=t&&null!=e?-1===e?this.setOutputData(0,t.slice(-1)):this.setOutputData(0,t.slice(e,e+1)):this.setOutputData(0,null)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("string/char-at-index",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.currentIndex=0,this.title=a.NODE_INFO.string["string-split"].title,this.description=a.NODE_INFO.string["string-split"].description,this.addInput("input",o.Type.STRING),this.addInputWithSettings("separator",o.Type.STRING,"","Separator Value",!1),this.addInput("start",o.Type.BOOLEAN),this.addInput("next",o.Type.BOOLEAN),this.addOutput("output",o.Type.STRING),this.addOutput("left",o.Type.NUMBER),this.setOutputData(0,null),this.setOutputData(1,0)}onCreated(){this.lastStart=!1,this.lastNext=!1}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(2)||!1,e=this.getInputData(3)||!1;this.inputs[2].updated&&t&&!this.lastStart&&(this.currentIndex=0,this.splitNext()),this.lastStart=t,this.inputs[3].updated&&e&&!this.lastNext&&this.splitNext(),this.lastNext=e}onAfterSettingsChange(){this.onInputUpdated()}splitNext(){const t=this.getInputData(0),e=this.getInputData(1);if(null==t||null==e)return;const i=t.split(e);this.currentIndex>=i.length||(this.setOutputData(0,i[this.currentIndex]),this.setOutputData(1,i.length-this.currentIndex-1),this.currentIndex++)}}s.Container.registerNodeType("string/string-split",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(0),o=i(3),a=i(2),r=i(1),u=i(4);class d extends o.Node{constructor(){super(),this.toTitleCase=t=>s.isString(t)&&!s.isNull(t)?t.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):null,this.title=a.NODE_INFO.string["string-case"].title,this.description=a.NODE_INFO.string["string-case"].description,this.addInput("input",r.Type.STRING),this.addOutput("output",r.Type.STRING),this.setOutputData(0,null),this.settings.function=r.NodeSetting.create({description:"Select Case",type:r.SettingType.DROPDOWN,config:{items:[{value:"lower",text:"Lower Case"},{value:"upper",text:"Upper Case"},{value:"first_upper",text:"First Characters to Upper Case"}]},value:"lower"})}onAdded(){this.setTitleAndConversionFunction(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);u.default.hasInput(t)?this.setOutputData(0,this.conversionFunction(t),!0):this.setOutputData(0,null,!0)}onAfterSettingsChange(){this.setTitleAndConversionFunction(),this.onInputUpdated()}setTitleAndConversionFunction(){switch(this.settings.function.value){case"first_upper":this.title="String Case (First Character to Upper)",this.conversionFunction=t=>this.toTitleCase(t);break;case"lower":this.title="String Case (Lower)",this.conversionFunction=t=>t.toLowerCase();break;case"upper":this.title="String Case (Upper)",this.conversionFunction=t=>t.toUpperCase();break;default:this.title="String Case (Lower)",this.conversionFunction=t=>t.toLowerCase()}}}n.Container.registerNodeType("string/string-case",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.string["char-to-ascii"].title,this.description=a.NODE_INFO.string["char-to-ascii"].description,this.addInput("input",o.Type.STRING),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,t.charCodeAt(0)):this.setOutputData(0,null)}}s.Container.registerNodeType("string/char-to-ascii",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.string["ascii-to-char"].title,this.description=a.NODE_INFO.string["ascii-to-char"].description,this.addInput("input",o.Type.NUMBER),this.addOutput("output",o.Type.STRING)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);null!=t?this.setOutputData(0,String.fromCharCode(t)):this.setOutputData(0,null)}}s.Container.registerNodeType("string/ascii-to-char",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.string["string-buffer"].title,this.description=o.NODE_INFO.string["string-buffer"].description,this.addInput("input",a.Type.STRING),this.addInput("sendBuffer",a.Type.BOOLEAN),this.addInput("clearBuffer",a.Type.BOOLEAN),this.addInput("addToBuffer",a.Type.BOOLEAN),this.addOutput("output",a.Type.STRING),this.addOutput("currentBuffer",a.Type.STRING),this.settings.useTrigger=a.NodeSetting.create({description:"Select a Buffer Input Method",type:a.SettingType.DROPDOWN,config:{items:[{value:!0,text:"Add Input to Buffer When Triggered"},{value:!1,text:"Collect all Input Messages (no Trigger)"}]},value:!0}),this.useTrigger=!0,this.bufferData=""}onCreated(){this.lastSend=!1,this.lastClear=!1,this.lastAdd=!1}onAdded(){this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(1)||!1,e=this.getInputData(2)||!1;let i=!1;if(this.useTrigger&&(i=this.getInputData(3)||!1),this.inputs[1].updated&&t&&!this.lastSend&&(this.setOutputData(0,this.bufferData),this.bufferData=""),this.lastSend=t,this.inputs[2].updated&&e&&!this.lastClear&&(this.bufferData=""),this.lastClear=e,!this.useTrigger&&this.inputs[0].updated||this.useTrigger&&this.inputs[3].updated&&i&&!this.lastAdd){const t=this.getInputData(0);if(null==t)return;this.bufferData+=String(t)}this.lastAdd=i,this.setOutputData(1,this.bufferData)}onAfterSettingsChange(){const t=this.settings.useTrigger.value;t!==this.useTrigger&&(t?this.addInput("addToBuffer",a.Type.BOOLEAN):this.removeInput(3)),this.useTrigger=t,this.onInputUpdated()}}s.Container.registerNodeType("string/string-buffer",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.switch["bool-switch"].title,this.description=r.NODE_INFO.switch["bool-switch"].description,this.addInput("switch",o.Type.BOOLEAN),this.addInput("[inTrue]",o.Type.BOOLEAN),this.addInput("[inFalse]",o.Type.BOOLEAN),this.addOutput("output",o.Type.BOOLEAN),this.settings.inTrue=o.NodeSetting.create({description:"True Value",type:o.SettingType.DROPDOWN,config:{items:[{value:!1,text:"false"},{value:!0,text:"true"},{value:null,text:"null"}]},value:null}),this.settings.inFalse=o.NodeSetting.create({description:"False Value",type:o.SettingType.DROPDOWN,config:{items:[{value:!1,text:"false"},{value:!0,text:"true"},{value:null,text:"null"}]},value:null})}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(!a.default.hasInput(t))return void this.setOutputData(0,null);let e=this.getInputData(1);a.default.hasInput(e)||(e=this.settings.inTrue.value);let i=this.getInputData(2);a.default.hasInput(i)||(i=this.settings.inFalse.value),t?this.setOutputData(0,e,!0):this.setOutputData(0,i,!0)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("switch/bool-switch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.switch["num-switch"].title,this.description=r.NODE_INFO.switch["num-switch"].description,this.addInput("switch",o.Type.BOOLEAN),this.addInputWithSettings("inTrue",o.Type.NUMBER,null,"True Value"),this.addInputWithSettings("inFalse",o.Type.NUMBER,null,"False Value"),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(!a.default.hasInput(t))return void this.setOutputData(0,null,!0);const e=this.getInputData(1),i=this.getInputData(2);t?this.setOutputData(0,e,!0):this.setOutputData(0,i,!0)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("switch/num-switch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.switch["string-switch"].title,this.description=r.NODE_INFO.switch["string-switch"].description,this.addInput("switch",o.Type.BOOLEAN),this.addInputWithSettings("inTrue",o.Type.STRING,"","True Value"),this.addInputWithSettings("inFalse",o.Type.STRING,"","False Value"),this.addOutput("output",o.Type.NUMBER)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(!a.default.hasInput(t))return void this.setOutputData(0,null);const e=this.getInputData(1),i=this.getInputData(2);t?this.setOutputData(0,e):this.setOutputData(0,i)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("switch/string-switch",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(2),a=i(1),r=i(4);class u extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=a.Type.BOOLEAN,super.dynamicInputStartPosition=1,this.title=o.NODE_INFO.switch["bool-select"].title,this.description=o.NODE_INFO.switch["bool-select"].description,this.addInput("select",a.Type.NUMBER),this.addOutput("output",a.Type.BOOLEAN)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);!r.default.hasInput(t)||t<this.dynamicInputStartPosition||t>this.getInputsCount()-this.dynamicInputStartPosition?this.setOutputData(0,null,!0):this.setOutputData(0,this.getInputData(t),!0)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("switch/bool-select",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(2),a=i(1),r=i(4);class u extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=a.Type.NUMBER,super.dynamicInputStartPosition=1,this.title=o.NODE_INFO.switch["num-select"].title,this.description=o.NODE_INFO.switch["num-select"].description,this.addInput("select",a.Type.NUMBER),this.addOutput("output",a.Type.NUMBER)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);!r.default.hasInput(t)||t<this.dynamicInputStartPosition||t>this.getInputsCount()-this.dynamicInputStartPosition?this.setOutputData(0,null,!0):this.setOutputData(0,this.getInputData(t),!0)}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("switch/num-select",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),o=i(2),a=i(1),r=i(4);class u extends n.FlexibleNode{constructor(){super(),this.dynamicInputsType=a.Type.STRING,super.dynamicInputStartPosition=1,this.title=o.NODE_INFO.switch["string-select"].title,this.description=o.NODE_INFO.switch["string-select"].description,this.addInput("select",a.Type.NUMBER),this.addOutput("output",a.Type.STRING)}onAdded(){this.size=this.computeSize(),this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);!r.default.hasInput(t)||t<this.dynamicInputStartPosition||t>this.getInputsCount()-this.dynamicInputStartPosition?this.setOutputData(0,null,!0):this.setOutputData(0,this.getInputData(t))}onAfterSettingsChange(){super.onAfterSettingsChange(),this.onInputUpdated()}}s.Container.registerNodeType("switch/string-select",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoolOutputSelectNode=void 0;const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicOutputsExist=!0,this.dynamicInputsExist=!1,this.dynamicSettingsExist=!1,super.dynamicOutputsType=o.Type.BOOLEAN,this.title=a.NODE_INFO.switch["bool-output-select"].title,this.description=a.NODE_INFO.switch["bool-output-select"].description,this.addInput("select",o.Type.NUMBER),this.addInput("input",o.Type.BOOLEAN)}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);t<0||t>=this.getOutputsCount()?this.debugWarn("Defined active output does not exist"):this.setOutputData(t,e)}}e.BoolOutputSelectNode=r,s.Container.registerNodeType("switch/bool-output-select",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NumOutputSelectNode=void 0;const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicOutputsExist=!0,this.dynamicInputsExist=!1,this.dynamicSettingsExist=!1,super.dynamicOutputsType=o.Type.NUMBER,this.title=a.NODE_INFO.switch["num-output-select"].title,this.description=a.NODE_INFO.switch["num-output-select"].description,this.addInput("select",o.Type.NUMBER),this.addInput("input",o.Type.NUMBER)}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);t<0||t>=this.getOutputsCount()?this.debugWarn("Defined active output does not exist"):this.setOutputData(t,e)}}e.NumOutputSelectNode=r,s.Container.registerNodeType("switch/num-output-select",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StringOutputSelectNode=void 0;const s=i(0),n=i(8),o=i(1),a=i(2);class r extends n.FlexibleNode{constructor(){super(),this.dynamicOutputsExist=!0,this.dynamicInputsExist=!1,this.dynamicSettingsExist=!1,super.dynamicOutputsType=o.Type.STRING,this.title=a.NODE_INFO.switch["string-output-select"].title,this.description=a.NODE_INFO.switch["string-output-select"].description,this.addInput("select",o.Type.NUMBER),this.addInput("input",o.Type.STRING)}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);t<0||t>=this.getOutputsCount()?this.debugWarn("Defined active output does not exist"):this.setOutputData(t,e)}}e.StringOutputSelectNode=r,s.Container.registerNodeType("switch/string-output-select",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(5),r=i(1),u=i(32);class d extends n.Node{constructor(){super(),this.title=o.NODE_INFO.system["host-info"].title,this.description="## Description\n "+o.NODE_INFO.system["host-info"].description+"   \n ## On change of settings\n    \n  On change of settings output ***system-info*** will return data in json format\n ## On active Input\n    \n  On an active input ***trigger*** the outputs ***cpu-temp***, ***disc-usage***, ***system-time***, ***system-memory*** will return data in json format\n ## The data returned\n    \n  On change of settings output ***system-info*** will return data in json format\n    \n ",this.addInput("trigger",r.Type.BOOLEAN),this.addOutput("system-info",r.Type.JSON),this.addOutput("cpu-temp",r.Type.JSON),this.addOutput("disc-usage",r.Type.JSON),this.addOutput("system-time",r.Type.JSON),this.addOutput("system-memory",r.Type.JSON),this.addOutput("error",r.Type.STRING)}onCreated(){this.onAfterSettingsChange()}callSystemInfo(){u.default.systemInfo().then(t=>this.setOutputData(0,t)).catch(t=>this.setOutputData(5,t))}callInfo(){u.default.cpuTemperature().then(t=>this.setOutputData(1,t)).catch(t=>this.setOutputData(5,t)),u.default.fsSize().then(t=>this.setOutputData(2,t)).catch(t=>this.setOutputData(5,t)),u.default.systemTime().then(t=>this.setOutputData(3,t)).catch(t=>this.setOutputData(5,t)),u.default.systemMem().then(t=>this.setOutputData(4,t)).catch(t=>this.setOutputData(5,t))}onAfterSettingsChange(){this.side===a.Side.server&&this.callSystemInfo()}onInputUpdated(){this.side===a.Side.server&&this.callInfo()}}s.Container.registerNodeType("system/host-info",d)},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=i(45),o=i(0),a=i(3),r=i(2),u=i(5),d=i(1),l=i(32);class p extends a.Node{constructor(){super(),this.haystackAbout={serverName:l.default.hostName(),productVersion:l.default.getCurrentWiresVersion()},this.title=r.NODE_INFO.system.platform.title,this.description=r.NODE_INFO.system.platform.description,this.addInput("trigger",d.Type.BOOLEAN),this.addOutput("wires-version",d.Type.STRING),this.addOutput("output-json",d.Type.JSON),this.settings.serverName=d.NodeSetting.create({description:"serverName",value:"",type:d.SettingType.READONLY}),this.settings.productVersion=d.NodeSetting.create({description:"productVersion",value:"",type:d.SettingType.READONLY})}onAdded(){return s(this,void 0,void 0,(function*(){yield this.haystackAbout.serverName.then(t=>{this.settings.serverName.value=t,this.broadcastSettingsToClients()}).catch(t=>{this.debugInfo(`PLATFORM NODE: try/catch  serverName info, ${t}`)}),yield this.haystackAbout.productVersion.then(t=>{this.settings.productVersion.value=t,this.broadcastSettingsToClients(),this.setOutputData(0,t)}).catch(t=>{this.debugInfo(`PLATFORM NODE: try/catch  productVersion info, ${t}`)}),this.onAfterSettingsChange()}))}onInputUpdated(){this.onAfterSettingsChange()}onAfterSettingsChange(){this.side===u.Side.server&&n.default.getPlatform().then(t=>{this.setOutputData(1,t)}).catch(t=>{this.debugInfo(`PLATFORM NODE: try/catch  getPlatform info, ${t}`)})}}o.Container.registerNodeType("system/platform",p)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.title=a.NODE_INFO.system.beep.title,this.description=a.NODE_INFO.system.beep.description,this.addInput("trigger",o.Type.BOOLEAN),this.addOutput("error",o.Type.STRING)}onInputUpdated(){try{1==this.getInputData(0)&&process.stderr.write(""),this.setOutputData(0,!1)}catch(t){this.setOutputData(0,!0)}}}s.Container.registerNodeType("system/beep",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(26),n=i(6),o=i(0),a=i(3),r=i(2),u=i(1);class d extends a.Node{constructor(){super(),this.title=r.NODE_INFO.system["execute-cmd"].title,this.description=r.NODE_INFO.system["execute-cmd"].description,this.addInputWithSettings("command",u.Type.STRING,"pwd","Linux Command",!1),this.addInput("trigger",u.Type.BOOLEAN),this.addOutput("out stdout",u.Type.STRING),this.addOutput("out err",u.Type.STRING),this.addOutput("out stderr",u.Type.STRING),this.addOutput("error",u.Type.STRING)}onCreated(){this.lastTrigger=!1}onInputUpdated(){const t=this.getInputData(1)||!1;if(this.inputs[1].updated&&t&&!this.lastTrigger){const t=this.getInputData(0);if(n.isNull(t))return;try{s.exec(t,(t,e,i)=>{e&&(this.setOutputData(0,e),this.setOutputData(3,!1)),t&&(this.setOutputData(1,t),this.setOutputData(3,!0)),i&&(this.setOutputData(2,i),this.setOutputData(3,!0))})}catch(t){this.setOutputData(3,!0)}}this.lastTrigger=t}}o.Container.registerNodeType("system/execute-cmd",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(5),a=i(1),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.system["flow-export"].title,this.description=r.NODE_INFO.system["flow-export"].description,this.addOutput("output",a.Type.STRING),this.addInput("trigger",a.Type.BOOLEAN)}init(){this.properties||(this.properties.lastTrigger=!1)}onInputUpdated(){if(this.side!=o.Side.server)return;const t=this.getInputData(0);if(this.properties.lastTrigger!==t&&t){s.ContainerRegistry.instance().rootContainer().db.getNodes((t,e)=>{t?this.debugErr(` Node id [ ${this.cid}/${this.id} ] has error: ${t.message}.`):this.setOutputData(0,JSON.stringify(e))})}this.properties.lastTrigger=t,this.persistProperties(!1,!0)}}s.Container.registerNodeType("system/flow-export",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(26),n=i(0),o=i(3),a=i(5),r=i(1),u=i(4),d=i(92),l=i(95),p=i(32);class h extends o.Node{constructor(){super(),this.timeStamp=u.default.getTimeStamp(),this.interfaceEth0="eth0",this.eth0Ip=0,this.messageOutput=2,this.errorOutput=3,this.msgOut=(t,e)=>{this.setOutputData(t,e)},this.title="Network Interface EdgeIO-28",this.description="This node is used to configure the network (IP) interface for edge28 controllers.  Changes made to settings will only be saved if ‘Save changes on save’ is toggled ON.  In some cases a reboot will be required to save the changes, if ‘Reboot’ is toggled ON, then clicking ‘save’ will reboot the controller.        NOTE: Making changes on a remote device could cause the device to become inaccessible.",this.addInput("get interface address",r.Type.BOOLEAN),this.addInput("enable eth0 ",r.Type.BOOLEAN),this.addOutput("ip eth0",r.Type.STRING),this.addOutput("message",r.Type.STRING),this.addOutput("error",r.Type.STRING),this.settings.writeChanges=r.NodeSetting.create({description:"Save changes on save",type:r.SettingType.BOOLEAN,value:!1}),this.settings.reboot=r.NodeSetting.create({description:"Optional Reboot. Warning this will reboot the device",type:r.SettingType.BOOLEAN,value:!1}),this.settings.eth0_group=r.NodeSetting.create({description:"Eth Port 0",value:"",type:r.SettingType.GROUP}),this.settings.interfaceTypeEth0=r.NodeSetting.create({description:"Interface Type eth0",type:r.SettingType.DROPDOWN,config:{items:[{value:0,text:"DHCP"},{value:1,text:"Static"}]},value:0}),this.settings.newIpEth0=r.NodeSetting.create({description:"IP",value:"192.168.0.40",type:r.SettingType.STRING}),this.settings.netNetmaskEth0=r.NodeSetting.create({description:"Netmask eth0",value:"255.255.255.0",type:r.SettingType.STRING}),this.settings.newGatewayEth0=r.NodeSetting.create({description:"Gateway",value:"192.168.0.1",type:r.SettingType.STRING}),this.settings.newNameServerEth0=r.NodeSetting.create({description:"Name Servers eth0",value:"8.8.8.8",type:r.SettingType.STRING}),this.setSettingsConfig({groups:[{newIpEth0:{},netNetmaskEth0:{}},{newGatewayEth0:{},newNameServerEth0:{}}],conditions:{newIpEth0:t=>{const e=t.interfaceTypeEth0.value;return![0].includes(e)},netNetmaskEth0:t=>{const e=t.interfaceTypeEth0.value;return![0].includes(e)},newGatewayEth0:t=>{const e=t.interfaceTypeEth0.value;return![0].includes(e)},newNameServerEth0:t=>{const e=t.interfaceTypeEth0.value;return![0].includes(e)}}})}onAdded(){setTimeout(()=>{this.getInterfaces()},2e3)}onInputUpdated(){let t=this.getInputData(1);this.inputs[0].updated&&(this.msgOut(this.messageOutput,"called getInterfaces "+this.timeStamp),setTimeout(()=>{this.getInterfaces()},2e3)),this.inputs[1].updated&&(!0===t?(this.msgOut(this.messageOutput,"called enable Eth0 true "+this.timeStamp),this.enableNetwork(this.interfaceEth0)):!1===t&&(this.msgOut(this.messageOutput,"called disable Eth0 false "+this.timeStamp),this.disableNetwork(this.interfaceEth0)))}onAfterSettingsChange(){if(this.side!==a.Side.server)return;const t=this.settings.newIpEth0.value,e=this.settings.netNetmaskEth0.value,i=this.settings.newGatewayEth0.value,s=this.settings.newNameServerEth0.value,n=this.settings.interfaceTypeEth0.value,r=this.settings.writeChanges.value,u=this.settings.reboot.value,h=d.default.checkIpValid(t,e,i,s);u&&(this.msgOut(this.messageOutput,"called sudo reboot will reboot in 10 sec "+this.timeStamp),this.settings.reboot.value=!1,this.broadcastSettingsToClients(),setTimeout(()=>{this.execCommand("sudo reboot")},1e4)),p.default.systemInfo().then(s=>{"GENERIC AM33XX (FLATTENED DEVICE TREE)"===s.system.model?h&&r?0==n?(this.title="Adapter0(DHCP)",d.default.bbbGetInterfaceDetails().then(t=>{this.msgOut(this.messageOutput,`'MSG: get interface ID' ${t}`),d.default.bbbSetIPDHCP(t).then(t=>{this.msgOut(this.messageOutput,`'MSG: set ip to DHCP' ${t}`)}).catch(t=>{this.msgOut(this.messageOutput,`'ERROR: setting to DHCP' ${t}`)})}).catch(t=>{this.msgOut(this.messageOutput,`'ERROR: setting to DHCP' ${t}`)})):1==n&&(this.title="Adapter (Static)",d.default.bbbGetInterfaceDetails().then(s=>{d.default.bbbSetIPFixed(s,t,e,i).then(t=>{this.msgOut(this.messageOutput,`'MSG: set ip to fixed IP' ${t}`)}).catch(t=>{this.msgOut(this.messageOutput,`'ERROR: setting to fixed IP' ${t}`)})}).catch(t=>{this.msgOut(this.messageOutput,`'ERROR: setting to fixed IP' ${t}`)})):this.msgOut(this.messageOutput,"invalid ip settings"):(l.default.nodeColourChange(this,o.NodeState.ERROR),this.msgOut(this.messageOutput,`'ERROR: incorrect device type ${s.system.model}`))}).catch(t=>this.msgOut(this.messageOutput,`'ERROR: incorrect device type' ${t}`)),r||(this.msgOut(this.messageOutput,"nothing saved "+this.timeStamp),this.msgOut(this.errorOutput,!0))}execCommand(t){if(this.side===a.Side.server)try{s.exec(t,(e,i,s)=>{this.msgOut(this.messageOutput,"called command "+t+" "+this.timeStamp),i&&(this.msgOut(this.messageOutput,i+" "+this.timeStamp),this.msgOut(this.errorOutput,!1)),e&&(this.msgOut(this.messageOutput,e+" "+this.timeStamp),this.msgOut(this.errorOutput,!0)),s&&(this.msgOut(this.messageOutput,s+" "+this.timeStamp),this.msgOut(this.errorOutput,!0))})}catch(t){this.msgOut(this.messageOutput,t+" "+this.timeStamp),this.msgOut(this.errorOutput,!0)}}getInterfaces(){d.default.getActiveNetworks().then(t=>{const e=t.filter(t=>t.name==this.interfaceEth0);this.msgOut(this.eth0Ip,e[0].ip_address),this.msgOut(this.errorOutput,!1)}).catch(t=>{this.msgOut(this.messageOutput,t),this.msgOut(this.errorOutput,!0)})}enableNetwork(t){try{d.default.networkUpDown(t,"up").then(t=>{console.log(t),setTimeout(()=>{this.getInterfaces()},5e3)}).catch(t=>console.log(t))}catch(t){console.log(t)}}disableNetwork(t){try{d.default.networkUpDown(t,"down").then(t=>{console.log(t)}).catch(t=>console.log(t))}catch(t){console.log(t)}}}n.Container.registerNodeType("system/network-interface-edge-28",h)},function(t,e){t.exports=require("network")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(26),n=i(0),o=i(3),a=i(5),r=i(1),u=i(4),d=i(92),l=i(95),p=i(32),h=i(93),c=i(94);class g extends o.Node{constructor(){super(),this.timeStamp=u.default.getTimeStamp(),this.interfaceEth0="eth0",this.interfaceEth1="eth1",this.eth0Ip=0,this.eth1Ip=1,this.messageOutput=2,this.errorOutput=3,this.msgOut=(t,e)=>{this.setOutputData(t,e)},this.title="Network Interfaces",this.description="This node is used to configure the network (IP) interfaces for the device.  Changes made to settings will only be saved if ‘Save changes on save’ is toggled ON.  In some cases a reboot will be required to save the changes, if ‘Reboot’ is toggled ON, then clicking ‘save’ will reboot the controller.      NOTE: Making changes on a remote device could cause the device to become inaccessible.",this.addInput("get interface address",r.Type.BOOLEAN),this.addInput("enable eth0 ",r.Type.BOOLEAN),this.addInput("enable eth1 ",r.Type.BOOLEAN),this.addOutput("ip eth0",r.Type.STRING),this.addOutput("ip eth1",r.Type.STRING),this.addOutput("message",r.Type.STRING),this.addOutput("error",r.Type.STRING),this.settings.writeChanges=r.NodeSetting.create({description:"Save changes on save",type:r.SettingType.BOOLEAN,value:!1}),this.settings.reboot=r.NodeSetting.create({description:"Reboot. Warning this will reboot the device",type:r.SettingType.BOOLEAN,value:!1}),this.settings.eth0_group=r.NodeSetting.create({description:"ETH-1",value:"",type:r.SettingType.GROUP}),this.settings.interfaceTypeEth0=r.NodeSetting.create({description:"Interface Type eth0",type:r.SettingType.DROPDOWN,config:{items:[{value:0,text:"DHCP"},{value:1,text:"Static"}]},value:0}),this.settings.newIpEth0=r.NodeSetting.create({description:"IP",value:"192.168.0.40",type:r.SettingType.STRING}),this.settings.netNetmaskEth0=r.NodeSetting.create({description:"Netmask eth0",value:"255.255.255.0",type:r.SettingType.STRING}),this.settings.newGatewayEth0=r.NodeSetting.create({description:"Gateway",value:"192.168.0.1",type:r.SettingType.STRING}),this.settings.newNameServerEth0=r.NodeSetting.create({description:"Name Servers eth0",value:"8.8.8.8",type:r.SettingType.STRING}),this.settings.eth1_group=r.NodeSetting.create({description:"ETH-2",value:"",type:r.SettingType.GROUP}),this.settings.interfaceTypeEth1=r.NodeSetting.create({description:"Interface Type eth1",type:r.SettingType.DROPDOWN,config:{items:[{value:0,text:"DHCP"},{value:1,text:"Static"}]},value:0}),this.settings.newIpEth1=r.NodeSetting.create({description:"IP",value:"192.168.1.40",type:r.SettingType.STRING}),this.settings.netNetmaskEth1=r.NodeSetting.create({description:"Netmask eth1",value:"255.255.255.0",type:r.SettingType.STRING}),this.settings.newGatewayEth1=r.NodeSetting.create({description:"Gateway",value:"192.168.1.1",type:r.SettingType.STRING}),this.settings.newNameServerEth1=r.NodeSetting.create({description:"Name Servers eth1",value:"8.8.8.8",type:r.SettingType.STRING}),this.setSettingsConfig({groups:[{newIpEth0:{},netNetmaskEth0:{}},{newGatewayEth0:{},newNameServerEth0:{}},{newIpEth1:{},netNetmaskEth1:{}},{newGatewayEth1:{},newNameServerEth1:{}}],conditions:{newIpEth0:t=>{const e=t.interfaceTypeEth0.value;return![0].includes(e)},netNetmaskEth0:t=>{const e=t.interfaceTypeEth0.value;return![0].includes(e)},newGatewayEth0:t=>{const e=t.interfaceTypeEth0.value;return![0].includes(e)},newNameServerEth0:t=>{const e=t.interfaceTypeEth0.value;return![0].includes(e)},newIpEth1:t=>{const e=t.interfaceTypeEth1.value;return![0].includes(e)},netNetmaskEth1:t=>{const e=t.interfaceTypeEth1.value;return![0].includes(e)},newGatewayEth1:t=>{const e=t.interfaceTypeEth1.value;return![0].includes(e)},newNameServerEth1:t=>{const e=t.interfaceTypeEth1.value;return![0].includes(e)}}})}onAdded(){setTimeout(()=>{this.getInterfaces()},2e3)}onInputUpdated(){let t=this.getInputData(1),e=this.getInputData(2);this.inputs[0].updated&&(this.msgOut(this.messageOutput,"called getInterfaces "+this.timeStamp),setTimeout(()=>{this.getInterfaces()},2e3)),this.inputs[1].updated&&(!0===t?(this.msgOut(this.messageOutput,"called enable ETH-1 true "+this.timeStamp),this.enableNetwork(this.interfaceEth0)):!1===t&&(this.msgOut(this.messageOutput,"called disable ETH-1 false "+this.timeStamp),this.disableNetwork(this.interfaceEth0))),this.inputs[2].updated&&(!0===e?(this.msgOut(this.messageOutput,"called enable ETH-2 true "+this.timeStamp),this.enableNetwork(this.interfaceEth1)):!1===e&&(this.msgOut(this.messageOutput,"called disable ETH-2 false "+this.timeStamp),this.disableNetwork(this.interfaceEth1)))}onAfterSettingsChange(){if(this.side!==a.Side.server)return;const t=this.settings.newIpEth0.value,e=this.settings.netNetmaskEth0.value,i=this.settings.newGatewayEth0.value,s=this.settings.newNameServerEth0.value,n=this.settings.interfaceTypeEth0.value,r=this.settings.newIpEth1.value,u=this.settings.netNetmaskEth1.value,g=this.settings.newGatewayEth1.value,m=this.settings.newNameServerEth1.value,f=this.settings.interfaceTypeEth1.value,O=this.settings.writeChanges.value,y=this.settings.reboot.value,v=d.default.checkIpValid(t,e,i,s),N=d.default.checkIpValid(r,u,g,m);y&&(this.msgOut(this.messageOutput,"called sudo reboot will reboot in 10 sec "+this.timeStamp),this.settings.reboot.value=!1,this.broadcastSettingsToClients(),setTimeout(()=>{this.execCommand("sudo reboot")},1e4)),p.default.systemInfo().then(a=>{if("BCM2835"===a.system.model)if(v&&N&&O){let o=[];if(0==n){this.title="Adapter0(DHCP)";let t={interface:this.interfaceEth0,dhcp:!0};o.push(t)}if(1==n){this.title="Adapter (Static)";let n=c.subnet(t,e),a={interface:this.interfaceEth0,ip_address:t,prefix:n.subnetMaskLength,gateway:i,nameservers:[s]};o.push(a)}if(0==f){this.title="Adapter0(DHCP)";let t={interface:this.interfaceEth1,dhcp:!0};o.push(t)}if(1==f){this.title="Adapter (Static)";let t=c.subnet(r,u),e={interface:this.interfaceEth1,ip_address:r,prefix:t.subnetMaskLength,gateway:g,nameservers:[m]};o.push(e)}h.configure(o).then(()=>{this.msgOut(this.messageOutput,"updated "+this.timeStamp),this.msgOut(this.errorOutput,!1)})}else this.msgOut(this.messageOutput,"invalid ip settings");else l.default.nodeColourChange(this,o.NodeState.ERROR),this.msgOut(this.messageOutput,`'ERROR: incorrect device type ${a.system.model}`)}).catch(t=>this.msgOut(this.messageOutput,`'ERROR: incorrect device type' ${t}`)),O||(this.msgOut(this.messageOutput,"nothing saved "+this.timeStamp),this.msgOut(this.errorOutput,!0))}execCommand(t){if(this.side===a.Side.server)try{s.exec(t,(e,i,s)=>{this.msgOut(this.messageOutput,"called command "+t+" "+this.timeStamp),i&&(this.msgOut(this.messageOutput,i+" "+this.timeStamp),this.msgOut(this.errorOutput,!1)),e&&(this.msgOut(this.messageOutput,e+" "+this.timeStamp),this.msgOut(this.errorOutput,!0)),s&&(this.msgOut(this.messageOutput,s+" "+this.timeStamp),this.msgOut(this.errorOutput,!0))})}catch(t){this.msgOut(this.messageOutput,t+" "+this.timeStamp),this.msgOut(this.errorOutput,!0)}}getInterfaces(){d.default.getActiveNetworks().then(t=>{const e=t.filter(t=>t.name==this.interfaceEth0);this.msgOut(this.eth0Ip,e[0].ip_address),this.msgOut(this.errorOutput,!1);const i=t.filter(t=>t.name==this.interfaceEth1);this.msgOut(this.eth1Ip,i[0].ip_address),this.msgOut(this.errorOutput,!1)}).catch(t=>{this.msgOut(this.messageOutput,t),this.msgOut(this.errorOutput,!0)})}enableNetwork(t){try{d.default.networkUpDown(t,"up").then(t=>{console.log(t),setTimeout(()=>{this.getInterfaces()},5e3)}).catch(t=>console.log(t))}catch(t){console.log(t)}}disableNetwork(t){try{d.default.networkUpDown(t,"down").then(t=>{console.log(t)}).catch(t=>console.log(t))}catch(t){console.log(t)}}}n.Container.registerNodeType("system/network-interfaces",g)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(26),n=i(0),o=i(3),a=i(1),r=i(2),u=i(80);class d extends o.Node{constructor(){super(),this.title=r.NODE_INFO.system["system-build-version"].title,this.description=r.NODE_INFO.system["system-build-version"].description,this.addInput("in1",a.Type.STRING),this.addOutput("wires-version",a.Type.STRING),this.addOutput("nodejs-version",a.Type.STRING),this.addOutput("npm-version",a.Type.STRING),this.addOutput("json out",a.Type.STRING),this.addOutput("error",a.Type.STRING)}getCurrentWiresVersion(){return new Promise((function(t){return t({version:u.version})}))}getNodeJsVersion(){return new Promise((t,e)=>{s.exec("node -v",(i,s,n)=>{i?e(i):t({stdout:s})})})}getNPMVersion(){return new Promise((t,e)=>{s.exec("npm -v",(i,s,n)=>{i?e(i):t({stdout:s})})})}onInputUpdated(){let t=[];this.getCurrentWiresVersion().then(e=>{e=JSON.stringify(e).replace(/\\n/g,"").split("version").join("wires version"),t.push(e),this.setOutputData(0,e)}).catch(t=>{this.setOutputData(4,t)}),this.getNodeJsVersion().then(e=>{e=JSON.stringify(e).replace(/\\n/g,"").split("stdout").join("nodejs version"),t.push(e),this.setOutputData(1,e)}).catch(t=>{this.setOutputData(4,t)}),this.getNPMVersion().then(e=>{e=JSON.stringify(e).replace(/\\n/g,"").split("stdout").join("npm version"),t.push(e),this.setOutputData(3,t),this.setOutputData(2,e)}).catch(t=>{this.setOutputData(4,t)})}onAfterSettingsChange(){this.onInputUpdated()}}n.Container.registerNodeType("system/system-build-version",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimeConvertNode=void 0;const s=i(0),n=i(3),o=i(1),a=i(4),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.time.conversion.title,this.description=r.NODE_INFO.time.conversion.description,this.addInput("min",o.Type.NUMBER),this.addOutput("day",o.Type.NUMBER),this.addOutput("hour",o.Type.NUMBER),this.addOutput("sec",o.Type.NUMBER),this.addOutput("milli",o.Type.NUMBER),this.settings.inputType=o.NodeSetting.create({description:"Input Type",type:o.SettingType.DROPDOWN,config:{items:[{value:"day",text:"Days (day)"},{value:"hour",text:"Hours (hour)"},{value:"min",text:"Minutes (min)"},{value:"sec",text:"Seconds (sec)"},{value:"milli",text:"Milliseconds(milli)"}]},value:"min"}),this.settings.precision=o.NodeSetting.create({description:"Precision",type:o.SettingType.NUMBER,value:"2"}),this.conversionFunction=t=>{let e=[null,null,null,null];return e[0]=694444e-9*t,e[1]=.016666667*t,e[2]=60*t,e[3]=6e4*t,e}}onAdded(){this.setConversionFunction(),this.onAfterSettingsChange()}onInputUpdated(){this.onInputOrSettingsChange()}onAfterSettingsChange(){this.setConversionFunction(),this.onInputOrSettingsChange()}onInputOrSettingsChange(){const t=this.getInputData(0);if(!a.default.hasInput(t))return this.setOutputData(0,null),this.setOutputData(1,null),this.setOutputData(2,null),this.setOutputData(3,null),void this.setOutputData(4,null);const e=this.conversionFunction(t),i=Math.abs(this.settings.precision.value);this.setOutputData(0,Number(e[0]).toFixed(i)),this.setOutputData(1,Number(e[1]).toFixed(i)),this.setOutputData(2,Number(e[2]).toFixed(i)),this.setOutputData(3,Number(e[3]).toFixed(i)),this.setOutputData(4,Number(e[4]).toFixed(i))}setConversionFunction(){switch(this.settings.inputType.value){case"min":this.title="Time Conversion (min)",this.inputs[0].name="min",this.outputs[0].name="day",this.outputs[1].name="hour",this.outputs[2].name="sec",this.outputs[3].name="milli",this.conversionFunction=t=>{let e=[null,null,null,null];return e[0]=694444e-9*t,e[1]=.016666667*t,e[2]=60*t,e[3]=6e4*t,e};break;case"sec":this.title="Time Conversion (sec)",this.inputs[0].name="sec",this.outputs[0].name="day",this.outputs[1].name="hour",this.outputs[2].name="min",this.outputs[3].name="milli",this.conversionFunction=t=>{let e=[null,null,null,null];return e[0]=11574e-9*t,e[1]=277778e-9*t,e[2]=.016666667*t,e[3]=1e3*t,e};break;case"milli":this.title="Time Conversion (milli)",this.inputs[0].name="milli",this.outputs[0].name="day",this.outputs[1].name="hour",this.outputs[2].name="min",this.outputs[3].name="sec",this.conversionFunction=t=>{let e=[null,null,null,null];return e[0]=1.1574e-8*t,e[1]=2.7778e-7*t,e[2]=16667e-9*t,e[3]=.00100002*t,e};break;case"day":this.title="Time Conversion (day)",this.inputs[0].name="day",this.outputs[0].name="hour",this.outputs[1].name="min",this.outputs[2].name="sec",this.outputs[3].name="milli",this.conversionFunction=t=>{let e=[null,null,null,null];return e[0]=24*t,e[1]=1440*t,e[2]=86400*t,e[3]=864e5*t,e};break;case"hour":this.title="Time Conversion (hour)",this.inputs[0].name="hour",this.outputs[0].name="day",this.outputs[1].name="min",this.outputs[2].name="sec",this.outputs[3].name="milli",this.conversionFunction=t=>{let e=[null,null,null,null];return e[0]=.0416667*t,e[1]=60*t,e[2]=3600*t,e[3]=36e5*t,e};break;default:this.title="Time Conversion (min)",this.inputs[0].name="min",this.outputs[0].name="day",this.outputs[1].name="hour",this.outputs[2].name="sec",this.outputs[3].name="milli",this.conversionFunction=t=>{let e=[null,null,null,null];return e[0]=694444e-9*t,e[1]=.016666667*t,e[2]=60*t,e[3]=6e4*t,e}}}}e.TimeConvertNode=u,s.Container.registerNodeType("time/conversion",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimeConvertPlusNode=void 0;const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);var u;!function(t){t.TIME="time string as input",t.EPOCH="time epoch as input",t.NEW_TS="time now"}(u||(u={}));class d extends n.Node{constructor(){super(),this.title=r.NODE_INFO.time["conversion-plus"].title,this.description="## Description\n "+r.NODE_INFO.time["conversion-plus"].description+' \n  ## Example output\n  ***{"date":"Mon Aug 17 2020","yearMonthDay":"2020-08-17","year":"2020","month":"Aug","monthAsNumber":"08","dayAsNumber":"17","dayOfYearNumber":"230","day":"Mon","pmOrAm":"PM","hourAsAmPm":"8","hour":"20","timeHourMin":"20:26","time":"20:26:49","minute":"26","minutesSeconds":"26:49","seconds":"49","milliseconds":"000","epoch":"1597660009000","rawDate":"2020-08-17T10:26:49.000Z"}***\n ',this.addInput("input",o.Type.ANY),this.addOutput("out-json",o.Type.JSON),this.settings.time=o.NodeSetting.create({description:"Time",type:o.SettingType.DROPDOWN,config:{items:[{value:u.TIME,text:u.TIME},{value:u.EPOCH,text:u.EPOCH},{value:u.NEW_TS,text:u.NEW_TS}]},value:u.TIME})}onInputUpdated(){const t=this.getInputData(0),e=this.timeSelection(t),i=a.default.timeConvertPlus(e);this.setOutputData(0,i)}onAfterSettingsChange(){this.onInputUpdated()}timeSelection(t){const e=this.settings.time.value;let i=null;return e===u.TIME?i=new Date(t):e===u.EPOCH?i=new Date(parseInt(t)):e===u.NEW_TS&&(i=new Date),i}}e.TimeConvertPlusNode=d,s.Container.registerNodeType("time/conversion-plus",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimezoneConvertNode=void 0;const s=i(14),n=i(0),o=i(3),a=i(2),r=i(1),u=i(387);class d extends o.Node{constructor(){super(),this.title=a.NODE_INFO.time["timezone-conversion"].title,this.description=a.NODE_INFO.time["timezone-conversion"].description,this.addInput("input",r.Type.ANY),this.addOutput("out-time-converted",r.Type.ANY),this.addOutput("out-local-converted",r.Type.ANY),this.settings.region=r.NodeSetting.create({description:"Select Region",type:r.SettingType.AUTOCOMPLETE,config:{items:u.default.tsCategory}}),this.settings.timezone=r.NodeSetting.create({description:"Select TimeZone (Hit save to refresh)",value:"Sydney/Australia",type:r.SettingType.DROPDOWN})}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){const t=this.getInputData(0);try{const e=s.tz(t,this.settings.timezone.value),i=s(t);this.setOutputData(0,e.format()),this.setOutputData(1,i.format())}catch(t){this.debugWarn(`ERROR: trying to convert a timezone${t}`)}}onAfterSettingsChange(){const t=this.settings.region.value;this.settings.timezone.config={items:u.default.tsType(t)},this.broadcastSettingsToClients(),this.onInputUpdated()}}e.TimezoneConvertNode=d,n.Container.registerNodeType("time/timezone-conversion",d)},function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.africaZones="Africa",t.americaZones="America",t.antarcticaZones="Antarctica",t.asiaZones="Asia",t.atlanticZones="Atlantic",t.australiaZones="Australia",t.europeZones="Europe",t.indianZones="Indian",t.pacificZones="Pacific"}(s||(s={}));class n{static tsType(t){switch(t){case s.africaZones:return Object.values(this.africaZones);case s.americaZones:return Object.values(this.americaZones);case s.antarcticaZones:return Object.values(this.antarcticaZones);case s.asiaZones:return Object.values(this.asiaZones);case s.atlanticZones:return Object.values(this.atlanticZones);case s.australiaZones:return Object.values(this.australiaZones);case s.europeZones:return Object.values(this.europeZones);case s.indianZones:return Object.values(this.indianZones);case s.pacificZones:return Object.values(this.pacificZones)}}}e.default=n,n.tsCategory=[s.africaZones,s.americaZones,s.antarcticaZones,s.asiaZones,s.atlanticZones,s.australiaZones,s.europeZones,s.indianZones,s.pacificZones].map(t=>({value:t,text:t})),n.europeZones=["Europe/Amsterdam","Europe/Andorra","Europe/Astrakhan","Europe/Athens","Europe/Belgrade","Europe/Berlin","Europe/Brussels","Europe/Bucharest","Europe/Budapest","Europe/Chisinau","Europe/Copenhagen","Europe/Dublin","Europe/Gibraltar","Europe/Helsinki","Europe/Istanbul","Europe/Kaliningrad","Europe/Kiev","Europe/Kirov","Europe/Lisbon","Europe/London","Europe/Luxembourg","Europe/Madrid","Europe/Malta","Europe/Minsk","Europe/Monaco","Europe/Moscow","Europe/Oslo","Europe/Paris","Europe/Prague","Europe/Riga","Europe/Rome","Europe/Samara","Europe/Saratov","Europe/Simferopol","Europe/Sofia","Europe/Stockholm","Europe/Tallinn","Europe/Tirane","Europe/Ulyanovsk","Europe/Uzhgorod","Europe/Vienna","Europe/Vilnius","Europe/Volgograd","Europe/Warsaw","Europe/Zaporozhye","Europe/Zurich"],n.africaZones=["Africa/Abidjan","Africa/Accra","Africa/Algiers","Africa/Bissau","Africa/Cairo","Africa/Casablanca","Africa/Ceuta","Africa/El_Aaiun","Africa/Johannesburg","Africa/Juba","Africa/Khartoum","Africa/Lagos","Africa/Maputo","Africa/Monrovia","Africa/Nairobi","Africa/Ndjamena","Africa/Sao_Tome","Africa/Tripoli","Africa/Tunis","Africa/Windhoek"],n.asiaZones=["Asia/Almaty","Asia/Amman","Asia/Anadyr","Asia/Aqtau","Asia/Aqtobe","Asia/Ashgabat","Asia/Atyrau","Asia/Baghdad","Asia/Baku","Asia/Bangkok","Asia/Barnaul","Asia/Beirut","Asia/Bishkek","Asia/Brunei","Asia/Chita","Asia/Choibalsan","Asia/Colombo","Asia/Damascus","Asia/Dhaka","Asia/Dili","Asia/Dubai","Asia/Dushanbe","Asia/Famagusta","Asia/Gaza","Asia/Hebron","Asia/Ho_Chi_Minh","Asia/Hong_Kong","Asia/Hovd","Asia/Irkutsk","Asia/Jakarta","Asia/Jayapura","Asia/Jerusalem","Asia/Kabul","Asia/Kamchatka","Asia/Karachi","Asia/Kathmandu","Asia/Khandyga","Asia/Kolkata","Asia/Krasnoyarsk","Asia/Kuala_Lumpur","Asia/Kuching","Asia/Macau","Asia/Magadan","Asia/Makassar","Asia/Manila","Asia/Nicosia","Asia/Novokuznetsk","Asia/Novosibirsk","Asia/Omsk","Asia/Oral","Asia/Pontianak","Asia/Pyongyang","Asia/Qatar","Asia/Qostanay","Asia/Qyzylorda","Asia/Riyadh","Asia/Sakhalin","Asia/Samarkand","Asia/Seoul","Asia/Shanghai","Asia/Singapore","Asia/Srednekolymsk","Asia/Taipei","Asia/Tashkent","Asia/Tbilisi","Asia/Tehran","Asia/Thimphu","Asia/Tokyo","Asia/Tomsk","Asia/Ulaanbaatar","Asia/Urumqi","Asia/Ust-Nera","Asia/Vladivostok","Asia/Yakutsk","Asia/Yangon","Asia/Yekaterinburg","Asia/Yerevan"],n.antarcticaZones=["Antarctica/Casey","Antarctica/Davis","Antarctica/DumontDUrville","Antarctica/Macquarie","Antarctica/Mawson","Antarctica/Palmer","Antarctica/Rothera","Antarctica/Syowa","Antarctica/Troll","Antarctica/Vostok"],n.americaZones=["America/Adak","America/Anchorage","America/Araguaina","America/Argentina/Buenos_Aires","America/Argentina/Catamarca","America/Argentina/Cordoba","America/Argentina/Jujuy","America/Argentina/La_Rioja","America/Argentina/Mendoza","America/Argentina/Rio_Gallegos","America/Argentina/Salta","America/Argentina/San_Juan","America/Argentina/San_Luis","America/Argentina/Tucuman","America/Argentina/Ushuaia","America/Asuncion","America/Atikokan","America/Bahia","America/Bahia_Banderas","America/Barbados","America/Belem","America/Belize","America/Blanc-Sablon","America/Boa_Vista","America/Bogota","America/Boise","America/Cambridge_Bay","America/Campo_Grande","America/Cancun","America/Caracas","America/Cayenne","America/Chicago","America/Chihuahua","America/Costa_Rica","America/Creston","America/Cuiaba","America/Curacao","America/Danmarkshavn","America/Dawson","America/Dawson_Creek","America/Denver","America/Detroit","America/Edmonton","America/Eirunepe","America/El_Salvador","America/Fort_Nelson","America/Fortaleza","America/Glace_Bay","America/Godthab","America/Goose_Bay","America/Grand_Turk","America/Guatemala","America/Guayaquil","America/Guyana","America/Halifax","America/Havana","America/Hermosillo","America/Indiana/Indianapolis","America/Indiana/Knox","America/Indiana/Marengo","America/Indiana/Petersburg","America/Indiana/Tell_City","America/Indiana/Vevay","America/Indiana/Vincennes","America/Indiana/Winamac","America/Inuvik","America/Iqaluit","America/Jamaica","America/Juneau","America/Kentucky/Louisville","America/Kentucky/Monticello","America/La_Paz","America/Lima","America/Los_Angeles","America/Maceio","America/Managua","America/Manaus","America/Martinique","America/Matamoros","America/Mazatlan","America/Menominee","America/Merida","America/Metlakatla","America/Mexico_City","America/Miquelon","America/Moncton","America/Monterrey","America/Montevideo","America/Nassau","America/New_York","America/Nipigon","America/Nome","America/Noronha","America/North_Dakota/Beulah","America/North_Dakota/Center","America/North_Dakota/New_Salem","America/Ojinaga","America/Panama","America/Pangnirtung","America/Paramaribo","America/Phoenix","America/Port-au-Prince","America/Port_of_Spain","America/Porto_Velho","America/Puerto_Rico","America/Punta_Arenas","America/Rainy_River","America/Rankin_Inlet","America/Recife","America/Regina","America/Resolute","America/Rio_Branco","America/Santarem","America/Santiago","America/Santo_Domingo","America/Sao_Paulo","America/Scoresbysund","America/Sitka","America/St_Johns","America/Swift_Current","America/Tegucigalpa","America/Thule","America/Thunder_Bay","America/Tijuana","America/Toronto","America/Vancouver","America/Whitehorse","America/Winnipeg","America/Yakutat","America/Yellowknife"],n.pacificZones=["Pacific/Apia","Pacific/Auckland","Pacific/Bougainville","Pacific/Chatham","Pacific/Chuuk","Pacific/Easter","Pacific/Efate","Pacific/Enderbury","Pacific/Fakaofo","Pacific/Fiji","Pacific/Funafuti","Pacific/Galapagos","Pacific/Gambier","Pacific/Guadalcanal","Pacific/Guam","Pacific/Honolulu","Pacific/Kiritimati","Pacific/Kosrae","Pacific/Kwajalein","Pacific/Majuro","Pacific/Marquesas","Pacific/Nauru","Pacific/Niue","Pacific/Norfolk","Pacific/Noumea","Pacific/Pago_Pago","Pacific/Palau","Pacific/Pitcairn","Pacific/Pohnpei","Pacific/Port_Moresby","Pacific/Rarotonga","Pacific/Tahiti","Pacific/Tarawa","Pacific/Tongatapu","Pacific/Wake","Pacific/Wallis"],n.australiaZones=["Australia/Adelaide","Australia/Brisbane","Australia/Broken_Hill","Australia/Currie","Australia/Darwin","Australia/Eucla","Australia/Hobart","Australia/Lindeman","Australia/Lord_Howe","Australia/Melbourne","Australia/Perth","Australia/Sydney"],n.atlanticZones=["Atlantic/Azores","Atlantic/Bermuda","Atlantic/Canary","Atlantic/Cape_Verde","Atlantic/Faroe","Atlantic/Madeira","Atlantic/Reykjavik","Atlantic/South_Georgia","Atlantic/Stanley"],n.indianZones=["Indian/Chagos","Indian/Christmas","Indian/Cocos","Indian/Kerguelen","Indian/Mahe","Indian/Maldives","Indian/Mauritius","Indian/Reunion"]},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ClockNode=void 0;const s=i(0),n=i(3),o=i(5),a=i(1),r=i(7),u=i(2),d=i(34);class l extends n.Node{constructor(){super(),this.lastInterval=1e3,this.title=u.NODE_INFO.time.clock.title,this.description=u.NODE_INFO.time.clock.description,this.addOutput("timeString",a.Type.STRING),this.addOutput("hour",a.Type.NUMBER),this.addOutput("min",a.Type.NUMBER),this.addOutput("sec",a.Type.NUMBER),this.addInputWithSettings("interval",a.Type.NUMBER,1,"Interval"),this.settings.time=a.NodeSetting.create({description:"Time",type:a.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{time:{},interval:{weight:2}}]}),this.settings.advanced=a.NodeSetting.create({description:"Show Advanced Options",value:!1,type:a.SettingType.BOOLEAN}),this.properties.advancedOutputs=!1}init(){this.settings.advanced.value&&this.addOutputs()}onAdded(){this.inputs[0].name=`[interval] (${this.settings.time.value})`,clearInterval(this.timeoutFunc);let t=this.getInputData(0);t=r.default.timeConvert(t,this.settings.time.value),this.timeoutFunc=setInterval(()=>{this.recalculate()},t),this.lastInterval=t,this.recalculate()}onInputUpdated(){let t=this.getInputData(0);t=r.default.timeConvert(t,this.settings.time.value),t!=this.lastInterval&&(this.lastInterval=t,clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>{this.recalculate()},t))}recalculate(){if(this.side!==o.Side.server)return;const t=this.settings.advanced.value,e=d();this.setOutputData(0,e.format("HH:mm:ss"),!0),this.setOutputData(1,e.hours(),!0),this.setOutputData(2,e.minutes(),!0),this.setOutputData(3,e.seconds(),!0),t&&(this.setOutputData(4,e.milliseconds(),!0),this.setOutputData(5,e.toString(),!0),this.setOutputData(6,e.utcOffset()/60,!0),this.setOutputData(7,e.valueOf(),!0))}onAfterSettingsChange(){const t=this.settings.advanced.value;this.inputs[0].name=`[interval] (${this.settings.time.value})`,t&&!this.properties.advancedOutputs?(this.addOutputs(),this.properties.advancedOutputs=!0,this.persistProperties(!1,!0)):!t&&this.properties.advancedOutputs&&(this.removeOutput(4),this.removeOutput(5),this.removeOutput(6),this.removeOutput(7),this.properties.advancedOutputs=!1,this.persistProperties(!1,!0)),this.updateNodeOutput(),this.onInputUpdated()}addOutputs(){this.addOutput("millis",a.Type.NUMBER),this.addOutput("longString",a.Type.STRING),this.addOutput("TZOffset",a.Type.NUMBER),this.addOutput("epoch",a.Type.NUMBER)}}e.ClockNode=l,s.Container.registerNodeType("time/clock",l)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DateNode=void 0;const s=i(0),n=i(3),o=i(1),a=i(2);class r extends n.Node{constructor(){super(),this.interval=5e3,this.title=a.NODE_INFO.time.date.title,this.description=a.NODE_INFO.time.date.description,this.addOutput("dateString",o.Type.STRING),this.addOutput("dayString",o.Type.STRING),this.addOutput("dayOfWeek",o.Type.NUMBER),this.addOutput("date",o.Type.NUMBER),this.addOutput("month",o.Type.NUMBER),this.addOutput("year",o.Type.NUMBER)}onAdded(){clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>{this.recalculate()},this.interval),this.recalculate()}recalculate(){let t=new Date;const e=t.getDay();let i=null;switch(e){case 0:i="Sunday";break;case 1:i="Monday";break;case 2:i="Tuesday";break;case 3:i="Wednesday";break;case 4:i="Thursday";break;case 5:i="Friday";break;case 6:i="Saturday"}this.setOutputData(0,t.toLocaleDateString(),!0),this.setOutputData(1,i,!0),this.setOutputData(2,e,!0),this.setOutputData(3,t.getDate(),!0),this.setOutputData(4,t.getMonth()+1,!0),this.setOutputData(5,t.getFullYear(),!0)}}e.DateNode=r,s.Container.registerNodeType("time/date",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimeDiffNode=void 0;const s=i(34),n=i(0),o=i(3),a=i(2),r=i(1);var u;!function(t){t.TIME="time string as input (YY:MM:DD)",t.EPOCH="time epoch as input (1597662977823)"}(u||(u={}));class d extends o.Node{constructor(){super(),this.title=a.NODE_INFO.time["date-difference"].title,this.description="## Description\n "+a.NODE_INFO.time["date-difference"].description+" \n ## Inputs\n  The inputs can be sent as a unix timestamp ***epoch***. Change the settings ***Time input type*** for different input type \n ## Outputs (return data type is ***JSON***)\n  ***out-difference-time*** will return the time difference in for example: ***hours: 1, minutes: 30 ***\n  ***out-difference-totals*** will return the time difference in for example: ***hours: 1, minutes: 90 ***\n ",this.addInput("time-compare-1",r.Type.ANY),this.addInput("time-compare-2",r.Type.ANY),this.addOutput("out-difference-time",r.Type.ANY),this.addOutput("out-difference-totals",r.Type.ANY),this.settings.time=r.NodeSetting.create({description:"Time input type",type:r.SettingType.DROPDOWN,config:{items:[{value:u.EPOCH,text:u.EPOCH}]},value:u.TIME})}onAdded(){this.onAfterSettingsChange()}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1),i=this.settings.time.value;try{i===u.TIME?(this.setOutputData(0,this.diffTime(s(t),e)),this.setOutputData(1,this.diffTotals(s(t),e))):i===u.EPOCH&&(this.setOutputData(0,this.diffTime(s(parseInt(t)),s(parseInt(e)))),this.setOutputData(1,this.diffTotals(s(parseInt(t)),s(parseInt(e)))))}catch(t){this.debugWarn(`ERROR: trying to convert a timezone ${t}`)}}onAfterSettingsChange(){this.onInputUpdated()}diffTime(t,e){let i=t.diff(e,"year");e.add(i,"years");let s=t.diff(e,"months");e.add(s,"months");let n=t.diff(e,"days");e.add(n,"days");let o=t.diff(e,"hours");e.add(o,"hours");let a=t.diff(e,"minutes");return e.add(a,"minutes"),{years:i,months:s,days:n,hours:o,minutes:a,seconds:t.diff(e,"seconds"),ms:t.diff(e)}}diffTotals(t,e){return{years:t.diff(e,"year"),months:t.diff(e,"months"),days:t.diff(e,"days"),hours:t.diff(e,"hours"),minutes:t.diff(e,"minutes"),seconds:t.diff(e,"seconds"),ms:t.diff(e)}}}e.TimeDiffNode=d,n.Container.registerNodeType("time/date-difference",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(4),r=i(7),u=i(2);class d extends n.Node{constructor(){super(),this.lastRunVal=!1,this.lastResetVal=!1,this.lastInterval=100,this.runState=!1,this.startTime=null,this.elapsed=0,this.units=1,this.digits=3,this.title=u.NODE_INFO.time.stopwatch.title,this.description=u.NODE_INFO.time.stopwatch.description,this.addInputWithSettings("enable",o.Type.BOOLEAN,0,"Enable",!1),this.addInput("reset",o.Type.BOOLEAN),this.settings.units=o.NodeSetting.create({description:"Output Units",type:o.SettingType.DROPDOWN,config:{items:[{value:1,text:"Milliseconds"},{value:1e3,text:"Seconds"},{value:6e4,text:"Minutes"},{value:36e5,text:"Hours"},{value:864e5,text:"Days"}]},value:1}),this.addInputWithSettings("interval",o.Type.NUMBER,200,"Count Interval",!1),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"milliseconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]}),this.addOutput("elapsed",o.Type.NUMBER),this.setOutputData(0,null),this.elapsed=0}onAdded(){this.runState=!1,this.setOutputData(0,this.elapsed),this.inputs[2].name=`[interval] (${this.settings.time.value})`,this.outputs[0].name="[elapsed] (milliseconds)",this.onAfterSettingsChange()}onInputUpdated(){let t=this.getInputData(0),e=this.getInputData(1);e&&!this.lastResetVal&&(this.elapsed=0,this.startTime=Date.now(),this.setOutputData(0,0,!0)),this.lastResetVal=e;let i=this.getInputData(2);i=r.default.timeConvert(i,this.settings.time.value),i!=this.lastInterval&&this.runState&&(clearInterval(this.timeoutFunc),this.setOutputData(0,Date.now()-this.startTime+this.elapsed,!0),this.timeoutFunc=setInterval(()=>{const t=(Date.now()-this.startTime+this.elapsed)/this.units;this.setOutputData(0,a.default.toFixedNumber(t,this.digits),!0)},i),this.lastInterval=i),t&&!this.lastRunVal?(this.setOutputData(0,this.elapsed,!0),this.runState=!0,this.startTime=Date.now(),this.timeoutFunc=setInterval(()=>{const t=(Date.now()-this.startTime+this.elapsed)/this.units;this.setOutputData(0,a.default.toFixedNumber(t,this.digits),!0)},i),this.lastRunVal=t):!t&&this.lastRunVal&&(clearInterval(this.timeoutFunc),this.elapsed=Date.now()-this.startTime+this.elapsed,this.runState=!1,this.setOutputData(0,this.elapsed,!0),this.lastRunVal=t)}onAfterSettingsChange(){switch(this.inputs[2].name=`[interval] (${this.settings.time.value})`,this.units=Number(this.settings.units.value),this.units){case 1:this.outputs[0].name="[elapsed] (milliseconds)";break;case 1e3:this.outputs[0].name="[elapsed] (seconds)";break;case 6e4:this.outputs[0].name="[elapsed] (minutes)";break;case 36e5:this.outputs[0].name="[elapsed] (hours)";break;case 864e5:this.outputs[0].name="[elapsed] (days)";break;default:this.outputs[0].name="[elapsed] (milliseconds)"}const t=Number(this.outputs[0].data)/this.units;this.setOutputData(0,a.default.toFixedNumber(t,this.digits),!0),this.onInputUpdated()}}s.Container.registerNodeType("time/stopwatch",d)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CronIntervalNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(1),r=i(63).CronJob,u=i(48),d=i(64);class l extends n.Node{constructor(){super(),this.job=null,this.jobCronExp="",this.title=o.NODE_INFO.time["cron-interval"].title,this.description=o.NODE_INFO.time["cron-interval"].description,this.addInputWithSettings("enable",a.Type.BOOLEAN,!1,"Enable",!1),this.addOutput("output",a.Type.BOOLEAN),this.addOutput("info",a.Type.STRING),this.addOutput("cronExpression",a.Type.STRING),this.addOutput("cronDescription",a.Type.STRING),this.addOutput("nextExecution",a.Type.STRING),this.settings.timezone=a.NodeSetting.create({description:"Enter the cron time zone",value:"Australia/Sydney",type:a.SettingType.STRING}),this.settings["cron-type"]=a.NodeSetting.create({description:"Cron Type",type:a.SettingType.DROPDOWN,config:{items:[{value:0,text:"Every Minutes (At every xth minute)"},{value:1,text:"Every Hours (At minute x past every xth hour.)"},{value:2,text:"Every Days (At x:xx every x days)"},{value:8,text:"Every Day At Time (x:xx)"},{value:3,text:"Every Month (Start of every month)"},{value:4,text:"Every Month On (On x Day at x:xx)"},{value:5,text:"Every Year (Start of every year)"},{value:6,text:"Every Year On (On x month x day at x:xx)"},{value:7,text:"Between Days (At x:xx between x and x day of the month)"}]},value:0}),this.settings.min=a.NodeSetting.create({description:"Set minute",value:1,type:a.SettingType.NUMBER}),this.settings.hour=a.NodeSetting.create({description:"Set hour",value:13,type:a.SettingType.NUMBER}),this.settings.day=a.NodeSetting.create({description:"Set day",value:1,type:a.SettingType.NUMBER}),this.settings.dayBetweenStart=a.NodeSetting.create({description:"Day Range Start",value:1,type:a.SettingType.NUMBER}),this.settings.dayBetweenEnd=a.NodeSetting.create({description:"Day Range End",value:15,type:a.SettingType.NUMBER}),this.settings.month=a.NodeSetting.create({description:"Set month",value:1,type:a.SettingType.NUMBER}),this.setSettingsConfig({groups:[{dayBetweenStart:{},dayBetweenEnd:{}}],conditions:{min:t=>{const e=t["cron-type"].value;return 0==e||1==e||2==e||4==e||6==e||7==e||8==e},hour:t=>{const e=t["cron-type"].value;return 1==e||2==e||4==e||6==e||7==e||8==e},day:t=>{const e=t["cron-type"].value;return 2==e||4==e||6==e||7==e},dayBetweenStart:t=>7==t["cron-type"].value,dayBetweenEnd:t=>7==t["cron-type"].value,month:t=>6==t["cron-type"].value}})}onAdded(){clearInterval(this.timeoutFunc),this.setOutputData(0,!1),this.onAfterSettingsChange()}onAfterSettingsChange(){this.onInputUpdated()}onRemoved(){this.job&&this.job.stop()}jsonataQuery(t){return u("_d").evaluate(t)}onInputUpdated(){const t=this.getInputData(0),e=parseInt(this.settings.min.value),i=parseInt(this.settings.hour.value),s=parseInt(this.settings.day.value),n=parseInt(this.settings.dayBetweenStart.value),o=parseInt(this.settings.dayBetweenEnd.value),a=parseInt(this.settings.month.value),u=this.settings.timezone.value,l=this.settings["cron-type"].value;let p=null;if(t&&(p="invalid",0==l&&e>=0&&e<60?p="*/"+e+" * * * *":1==l&&e>=0&&e<60&&i>=0&&i<24?p=e+" */"+i+" * * *":2==l&&e>=0&&e<60&&i>=0&&i<24&&s>0&&s<=31?p=e+" "+i+" */"+s+" * *":3==l?p="0 0 1 * *":4==l&&e>=0&&e<60&&i>=0&&i<24&&s>0&&s<=31?p=e+" "+i+" "+s+" * *":5==l?p="0 0 1 1 *":6==l&&e>=0&&e<60&&i>=0&&i<24&&s>0&&s<=31&&a>=0&&a<=12?p=e+" "+i+" "+s+" "+a+" *":7==l&&e>=0&&e<60&&i>=0&&i<24&&n<o&&n>=1&&n<=30&&o>=2&&o<=31?p=e+" "+i+" "+n+"-"+o+" * *":8==l&&e>=0&&e<60&&i>=0&&i<24&&(p=e+" "+i+" * * *")),!t||null==p||"invalid"===p){"invalid"===p?this.setOutputData(1,"invalid configuration"):this.setOutputData(1,"CRON job stopped");try{this.job&&this.job.stop()}catch(t){this.setOutputData(1,t)}return this.job=null,this.jobCronExp="",this.setOutputData(0,!1,!0),this.setOutputData(2,null,!0),this.setOutputData(3,null,!0),void this.setOutputData(4,null,!0)}this.job&&p!==this.jobCronExp&&(this.setOutputData(1,"CRON job stopped"),this.job.stop(),this.job=null,this.jobCronExp="");try{this.jobCronExp=p,this.setOutputData(2,p),this.setOutputData(3,d.toString(p)),this.job=new r(p,()=>{this.setOutputData(0,!0),this.timeoutFunc=setTimeout(()=>{this.setOutputData(0,!1)},500);let t=this.job.nextDates(1);this.setOutputData(4,this.jsonataQuery(t))},null,null,u),setTimeout((function(){}),500),this.setOutputData(1,"CRON job started"),this.job.start();let t=this.job.nextDates(1);this.setOutputData(4,this.jsonataQuery(t))}catch(t){this.setOutputData(1,t)}}}e.CronIntervalNode=l,s.Container.registerNodeType("time/cron-interval",l)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CronWeeklyNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(1),r=i(63).CronJob,u=i(48),d=i(64);class l extends n.Node{constructor(){super(),this.job=null,this.jobCronExp="",this.title=o.NODE_INFO.time["cron-weekly"].title,this.description=o.NODE_INFO.time["cron-weekly"].description,this.addInputWithSettings("enable",a.Type.BOOLEAN,!1,"Enable",!1),this.addOutput("output",a.Type.BOOLEAN),this.addOutput("info",a.Type.STRING),this.addOutput("cronExpression",a.Type.STRING),this.addOutput("cronDescription",a.Type.STRING),this.addOutput("nextExecution",a.Type.STRING),this.settings.timezone=a.NodeSetting.create({description:"Enter the cron time zone",value:"Australia/Sydney",type:a.SettingType.STRING}),this.settings.min=a.NodeSetting.create({description:"Set minute",value:0,type:a.SettingType.NUMBER}),this.settings.hour=a.NodeSetting.create({description:"Set hour",value:6,type:a.SettingType.NUMBER}),this.settings.sunday=a.NodeSetting.create({description:"sunday",value:!1,type:a.SettingType.BOOLEAN}),this.settings.monday=a.NodeSetting.create({description:"monday",value:!1,type:a.SettingType.BOOLEAN}),this.settings.tuesday=a.NodeSetting.create({description:"tuesday",value:!1,type:a.SettingType.BOOLEAN}),this.settings.wednesday=a.NodeSetting.create({description:"wednesday",value:!1,type:a.SettingType.BOOLEAN}),this.settings.thursday=a.NodeSetting.create({description:"thursday",value:!1,type:a.SettingType.BOOLEAN}),this.settings.friday=a.NodeSetting.create({description:"friday",value:!1,type:a.SettingType.BOOLEAN}),this.settings.saturday=a.NodeSetting.create({description:"saturday",value:!1,type:a.SettingType.BOOLEAN})}onAdded(){clearInterval(this.timeoutFunc),this.setOutputData(0,!1),this.onAfterSettingsChange()}onAfterSettingsChange(){this.onInputUpdated()}onRemoved(){this.job&&this.job.stop()}jsonataQuery(t){return u("_d").evaluate(t)}onInputUpdated(){const t=this.getInputData(0);let e=null;if(t){e="invalid";const t=this.settings.min.value,i=this.settings.hour.value;if(t>=0&&t<=59&&i>=0&&i<24){e=t+" "+i+" * * ";let s=[];this.settings.sunday.value&&s.push("0"),this.settings.monday.value&&s.push("1"),this.settings.tuesday.value&&s.push("2"),this.settings.wednesday.value&&s.push("3"),this.settings.thursday.value&&s.push("4"),this.settings.friday.value&&s.push("5"),this.settings.saturday.value&&s.push("6"),e+=s.join(",")}}if(!t||null==e||"invalid"===e){"invalid"===e?this.setOutputData(1,"invalid configuration"):this.setOutputData(1,"CRON job stopped");try{this.job&&this.job.stop()}catch(t){this.setOutputData(1,t)}return this.job=null,this.jobCronExp="",this.setOutputData(0,!1,!0),this.setOutputData(2,null,!0),this.setOutputData(3,null,!0),void this.setOutputData(4,null,!0)}const i=this.settings.timezone.value;this.job&&e!==this.jobCronExp&&(this.setOutputData(1,"CRON job stopped"),this.job.stop(),this.job=null,this.jobCronExp="");try{this.jobCronExp=e,this.setOutputData(2,e),this.setOutputData(3,d.toString(e)),this.job=new r(e,()=>{this.setOutputData(0,!0),this.timeoutFunc=setTimeout(()=>{this.setOutputData(0,!1)},500);let t=this.job.nextDates(1);this.setOutputData(4,this.jsonataQuery(t))},null,null,i),setTimeout((function(){}),500),this.setOutputData(1,"CRON job started"),this.job.start();let t=this.job.nextDates(1);this.setOutputData(4,this.jsonataQuery(t))}catch(t){this.setOutputData(1,t)}}}e.CronWeeklyNode=l,s.Container.registerNodeType("time/cron-weekly",l)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CronExpressionNode=void 0;const s=i(6),n=i(0),o=i(3),a=i(1),r=i(63).CronJob,u=i(48),d=i(64),l=i(395),p=i(2);class h extends o.Node{constructor(){super(),this.job=null,this.jobCronExp="",this.title=p.NODE_INFO.time["cron-expression"].title,this.description=p.NODE_INFO.time["cron-expression"].description,this.addInputWithSettings("enable",a.Type.BOOLEAN,!0,"Enable",!1),this.addInputWithSettings("cronExpression",a.Type.STRING,"","Cron Expression"),this.addOutput("output",a.Type.BOOLEAN),this.addOutput("info",a.Type.STRING),this.addOutput("cronDescription",a.Type.STRING),this.addOutput("nextExecution",a.Type.STRING),this.settings.timezone=a.NodeSetting.create({description:"Enter the cron time zone",value:"Australia/Sydney",type:a.SettingType.STRING})}onAdded(){clearInterval(this.timeoutFunc),this.setOutputData(0,!1),this.onAfterSettingsChange()}onAfterSettingsChange(){this.onInputUpdated()}onRemoved(){this.job&&this.job.stop()}jsonataQuery(t){return u("_d").evaluate(t)}onInputUpdated(){const t=this.getInputData(0),e=this.getInputData(1),i=l.isValidCron(e);if(!t||!i){i?this.setOutputData(1,"CRON job stopped"):this.setOutputData(1,"invalid CRON Expression");try{this.job&&this.job.stop()}catch(t){this.setOutputData(1,t)}return this.job=null,this.jobCronExp="",this.setOutputData(0,!1,!0),this.setOutputData(2,null,!0),void this.setOutputData(3,null,!0)}const n=this.settings.timezone.value;this.job&&e!==this.jobCronExp&&(this.setOutputData(1,"CRON job stopped"),this.job.stop(),this.job=null,this.jobCronExp="");try{this.jobCronExp=e,this.setOutputData(2,d.toString(e)),this.job=new r(e,()=>{if(this.setOutputData(0,!0),this.timeoutFunc=setTimeout(()=>{this.setOutputData(0,!1)},500),s.isNull(this.job))return;let t=this.job.nextDates(1);this.setOutputData(3,this.jsonataQuery(t))},null,null,n),setTimeout((function(){}),500),this.setOutputData(1,"CRON job started"),this.job.start();let t=this.job.nextDates(1);this.setOutputData(3,this.jsonataQuery(t))}catch(t){this.setOutputData(1,t)}}}e.CronExpressionNode=h,n.Container.registerNodeType("time/cron-expression",h)},function(t,e){t.exports=require("cron-validator")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimestampGeneratorNode=void 0;const s=i(34),n=i(0),o=i(3),a=i(2),r=i(1);class u extends o.Node{constructor(){super(),this.title=a.NODE_INFO.time["timestamp-generator"].title,this.description="## Description\n "+a.NODE_INFO.time["timestamp-generator"].description+' \n ## Inputs\n  The an active input a timestamp will be generated based of the device time \n ## Outputs (return data type is ***JSON***)\n  ***date-string*** will return the timestamp: **"2019-08-31T11:54:27+10:00" ***\n  ***date-unix*** will return the timestamp: **1598838867***\n  ***date-format*** will return the time that is formatted as per moment js format options https://momentjs.com/docs/#/displaying/format/*\n ### Formatting options examples\n -ENTER in settings\t***LT*** with return 8:30 PM\n -ENTER in settings\t***LTS*** with return 8:30:25 PM\n -ENTER in settings\t***LLLL*** with return \tThursday, September 4, 1986 8:30 PM\n ',this.addInput("input",r.Type.ANY),this.addOutput("date-string",r.Type.STRING),this.addOutput("date-unix",r.Type.STRING),this.addOutput("date-format",r.Type.STRING),this.settings.format=r.NodeSetting.create({description:"Formatting options",value:"x",type:r.SettingType.STRING})}onAfterSettingsChange(){}onInputUpdated(){const t=this.settings.format.value;let e=s();this.setOutputData(0,e.format()),this.setOutputData(1,e.unix()),this.setOutputData(2,e.format(t))}}e.TimestampGeneratorNode=u,n.Container.registerNodeType("time/timestamp-generator",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.trigger["change-of-value"].title,this.description=r.NODE_INFO.trigger["change-of-value"].description,this.addInput("input",o.Type.ANY),this.addInputWithSettings("interval",o.Type.NUMBER,1,"Interval"),this.addInputWithSettings("threshold",o.Type.NUMBER,0,"COV Threshold"),this.addOutput("output",o.Type.BOOLEAN),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]})}onAdded(){this.setOutputData(0,!1),this.inputs[1].name=`[interval] (${this.settings.time.value})`}onInputUpdated(){const t=this.getInputData(0),e="number"==typeof t;if(this.inputs[0].updated&&t!==this.lastValue&&("number"!=typeof this.lastValue||!e||e&&Math.abs(t-this.lastValue)>=this.getInputData(2))){this.lastValue=t,this.setOutputData(0,!0);const e=a.default.timeConvert(this.getInputData(1),this.settings.time.value);this.timeoutFunc&&clearTimeout(this.timeoutFunc),this.timeoutFunc=setTimeout(()=>{this.setOutputData(0,!1)},e)}}onAfterSettingsChange(){this.inputs[1].name=`[interval] (${this.settings.time.value})`}}s.Container.registerNodeType("trigger/change-of-value",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(2),a=i(1),r=i(4);class u extends n.Node{constructor(){super(),this.state=!1,this.title=o.NODE_INFO.trigger.random.title,this.description=o.NODE_INFO.trigger.random.description,this.settings.digits=a.NodeSetting.create({description:"Number of decimal places",value:3,type:a.SettingType.NUMBER}),this.addInput("trigger",a.Type.BOOLEAN),this.addInputWithSettings("max",a.Type.NUMBER,1,"Maximum Value"),this.addInputWithSettings("min",a.Type.NUMBER,0,"Minimum Value"),this.addOutput("output",a.Type.NUMBER),this.setOutputData(0,null)}onAdded(){this.onInputUpdated()}onInputUpdated(){let t=this.getInputData(0);if(null==t)this.lastVal=!1,this.setOutputData(0,null),this.state=!1;else if(t==this.lastVal)return;if(1==t){const t=this.getInputData(1),e=this.getInputData(2);this.settings.digits.value;let i=this.settings.digits.value,s=Math.random()*(t-e)+e;s=r.default.toFixedNumber(s,i),this.setOutputData(0,s)}this.lastVal=t}}s.Container.registerNodeType("trigger/random",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TriggeredInjectNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(1);class r extends n.Node{constructor(){super(),this.title=o.NODE_INFO.trigger.inject.title,this.description=o.NODE_INFO.trigger.inject.description,this.addInputWithSettings("enable",a.Type.BOOLEAN,!0,"Enable"),this.addInputWithSettings("message",a.Type.STRING,"true","Message"),this.addInput("trigger",a.Type.BOOLEAN),this.addOutput("output",a.Type.BOOLEAN)}onCreated(){this.lastTrigger=!1}onAdded(){this.getInputData(0)||this.setOutputData(0,null)}onInputUpdated(){if(!this.getInputData(0))return void this.setOutputData(0,null,!0);let t=this.getInputData(2);if(t&&!this.lastTrigger){const t=this.getInputData(1);this.setOutputData(0,t,!1)}this.lastTrigger=t}onAfterSettingsChange(){}}e.TriggeredInjectNode=r,s.Container.registerNodeType("trigger/inject",r)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InjectNode=void 0;const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.lastInterval=1e3,this.runState=!0,this.title=r.NODE_INFO.trigger["interval-inject"].title,this.description=r.NODE_INFO.trigger["interval-inject"].description,this.addInputWithSettings("enable",o.Type.BOOLEAN,!0,"Enable"),this.addInputWithSettings("message",o.Type.ANY,"true","Message"),this.addInputWithSettings("interval",o.Type.NUMBER,1,"Interval"),this.addOutput("output",o.Type.BOOLEAN),this.settings.time=o.NodeSetting.create({description:"Units",type:o.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]})}onAdded(){if(clearInterval(this.timeoutFunc),this.inputs[2].name=`[interval] (${this.settings.time.value})`,!this.getInputData(0))return this.setOutputData(0,null),void(this.runState=!1);let t=this.getInputData(2);t=a.default.timeConvert(t,this.settings.time.value),this.timeoutFunc=setInterval(()=>{const t=this.getInputData(1);this.setOutputData(0,t)},t),this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(!t&&this.runState)return clearInterval(this.timeoutFunc),this.setOutputData(0,null,!0),void(this.runState=!1);if(!t&&!this.runState)return this.setOutputData(0,null,!0),void(this.runState=!1);if(t){let t=this.getInputData(2);if(t=a.default.timeConvert(t,this.settings.time.value),this.runState)return void(t!=this.lastInterval&&(this.lastInterval=t,clearInterval(this.timeoutFunc),this.timeoutFunc=setInterval(()=>{const t=this.getInputData(1);this.setOutputData(0,t)},t)));this.runState||(this.runState=!0,this.timeoutFunc=setInterval(()=>{const t=this.getInputData(1);this.setOutputData(0,t)},t))}}onAfterSettingsChange(){this.inputs[2].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}}e.InjectNode=u,s.Container.registerNodeType("trigger/interval-inject",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimeIteratorNode=void 0;const s=i(0),n=i(3),o=i(2),a=i(1),r=i(7);class u extends n.Node{constructor(){super(),this.state=!1,this.runState=!0,this.complete=!1,this.lastStart=!1,this.lastStop=!1,this.count=0,this.reqInterval=null,this.reqIterations=null,this.title=o.NODE_INFO.trigger.iterator.title,this.description=o.NODE_INFO.trigger.iterator.description,this.addInputWithSettings("interval",a.Type.NUMBER,10,"Interval",!1),this.addInputWithSettings("iterations",a.Type.NUMBER,5,"Iterations",!1),this.addInput("start",a.Type.BOOLEAN),this.addInput("stop",a.Type.BOOLEAN),this.addOutput("output",a.Type.BOOLEAN),this.addOutput("complete",a.Type.BOOLEAN),this.addOutput("count",a.Type.NUMBER),this.settings.time=a.NodeSetting.create({description:"Units",type:a.SettingType.DROPDOWN,config:{items:[{value:"milliseconds",text:"Milliseconds"},{value:"seconds",text:"Seconds"},{value:"minutes",text:"Minutes"},{value:"hours",text:"Hours"}]},value:"seconds"}),this.setSettingsConfig({groups:[{interval:{weight:2},time:{}}]}),this.settings.false=a.NodeSetting.create({description:"Generate False",value:!0,type:a.SettingType.BOOLEAN})}onAdded(){clearInterval(this.timeoutFunc),this.setOutputData(0,!1),this.setOutputData(1,!1),this.inputs[0].name=`[interval] (${this.settings.time.value})`,this.lastStart=!1,this.lastStop=!1,this.complete=!0,this.count=0,this.onInputUpdated()}start(){this.runState=!0,this.settings.false.value?this.timeoutFunc=setInterval(()=>{1==this.state?(this.state=!1,this.setOutputData(0,!1),this.count>=this.reqIterations&&(clearInterval(this.timeoutFunc),this.setOutputData(1,!1),this.complete=!0,this.runState=!1)):(this.state=!0,this.setOutputData(0,!0),this.count++,this.setOutputData(2,this.count))},this.reqInterval/(2*this.reqIterations-1)):this.timeoutFunc=setInterval(()=>{this.state=!0,this.setOutputData(0,!0),this.count++,this.setOutputData(2,this.count),this.count>=this.reqIterations&&(clearInterval(this.timeoutFunc),this.complete=!0,this.runState=!1)},this.reqInterval/(this.reqIterations-1))}onInputUpdated(){let t=this.getInputData(3);if(t&&!this.lastStop&&!this.complete)return this.lastStop=t,this.settings.false.value&&(this.state=!1,this.setOutputData(0,!1)),clearInterval(this.timeoutFunc),void(this.runState=!1);if(!t&&this.lastStop&&!this.complete)return this.lastStop=t,void this.start();this.lastStop=t;let e=this.getInputData(2);if(e&&!this.lastStart){this.lastStart=e,clearInterval(this.timeoutFunc),this.count=0,this.settings.false.value&&(this.state=!1,this.setOutputData(0,!1));let i=this.getInputData(0);i=r.default.timeConvert(i,this.settings.time.value);const s=this.getInputData(1);if(s<=0||i<=0)return void(this.runState=!1);if(this.reqInterval=i,this.reqIterations=s,this.setOutputData(0,!0),this.state=!0,this.complete=!1,this.count++,this.setOutputData(2,this.count),t)return this.settings.false.value?void setTimeout(()=>{this.runState=!1,this.state=!1,this.setOutputData(0,!1)},i/(2*s-1)):void(this.runState=!1);this.start()}this.lastStart=e}onAfterSettingsChange(){this.inputs[0].name=`[interval] (${this.settings.time.value})`,this.onInputUpdated()}}e.TimeIteratorNode=u,s.Container.registerNodeType("trigger/iterator",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.currentMode="SCHEDULE",this.remainingRuntime=0,this.updateInterval=5e3,this.title=r.NODE_INFO.widget["schedule-afterhours-off"].title,this.description=r.NODE_INFO.widget["schedule-afterhours-off"].description,this.addInput("modeInput",o.Type.STRING),this.addInput("scheduleInput",o.Type.BOOLEAN),this.addInput("scheduleNextStop",o.Type.NUMBER),this.addInputWithSettings("AH duration (mins)",o.Type.NUMBER,120,"Afterhours Duration (minutes)"),this.addOutput("modeOutput",o.Type.STRING),this.addOutput("enableOutput",o.Type.BOOLEAN),this.addOutput("remainingRuntime (ms)",o.Type.NUMBER),this.AHRuntime=a.default.timeConvert(120,"minutes")}onCreated(){this.currentMode="OFF",this.onInputUpdated()}onAdded(){this.currentMode="OFF",this.onInputUpdated()}onInputUpdated(){const t=this.getInputData(0);if(null==t)return this.currentMode=null,this.setOutputData(0,""),this.setOutputData(1,null),this.timeoutFunc&&clearInterval(this.timeoutFunc),this.remainingRuntime=0,void this.setOutputData(2,null);if("OFF"==t)return this.currentMode="OFF",this.setOutputData(0,"OFF"),this.setOutputData(1,!1),this.timeoutFunc&&clearInterval(this.timeoutFunc),this.remainingRuntime=0,void this.setOutputData(2,0);if("SCHEDULE"==t&&this.currentMode!==t?(this.currentMode="SCHEDULE",this.setOutputData(0,"SCHEDULE"),this.getInputData(1)?this.startSchedule():(this.timeoutFunc&&clearInterval(this.timeoutFunc),this.setOutputData(1,!1),this.setOutputData(2,0))):"AFTERHOURS"==t&&this.currentMode!==t&&this.startAfterhours(),"SCHEDULE"===this.currentMode){const t=this.getInputData(1);if(t||this.setOutputData(2,0),this.inputs[1].updated&&(t?(this.setOutputData(1,!0),this.startSchedule()):(this.setOutputData(1,!1),this.timeoutFunc&&clearInterval(this.timeoutFunc),this.setOutputData(2,0))),null==this.getInputData(2))this.setOutputData(2,null);else if(this.inputs[2].updated){const t=this.getInputData(2);t&&this.setOutputData(2,t-Date.now())}}else a.default.timeConvert(this.getInputData(3),"minutes")!==this.AHRuntime&&"AFTERHOURS"===this.currentMode&&this.startAfterhours()}startSchedule(){this.timeoutFunc&&clearInterval(this.timeoutFunc);const t=this.getInputData(2);t?(this.remainingRuntime=t-Date.now(),this.setOutputData(2,this.remainingRuntime),this.timeoutFunc=setInterval(()=>{this.remainingRuntime-=this.updateInterval,this.setOutputData(2,this.remainingRuntime)},this.updateInterval)):this.setOutputData(2,null),this.setOutputData(1,!0)}startAfterhours(){this.currentMode="AFTERHOURS",this.setOutputData(0,"AFTERHOURS"),this.setOutputData(1,!0),clearInterval(this.timeoutFunc);const t=a.default.timeConvert(this.getInputData(3)||120,"minutes");this.AHRuntime=t,this.remainingRuntime=t,this.setOutputData(2,t),this.timeoutFunc=setInterval(()=>{if(this.remainingRuntime-=this.updateInterval,this.remainingRuntime<=0)return this.setOutputData(1,!1),this.setOutputData(2,0),this.currentMode="SCHEDULE",this.setOutputData(0,"SCHEDULE"),clearInterval(this.timeoutFunc),void(this.getInputData(1)&&this.startSchedule());this.setOutputData(2,this.remainingRuntime)},this.updateInterval)}onAfterSettingsChange(){this.onInputUpdated()}}s.Container.registerNodeType("widget/schedule-afterhours-off",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(3),o=i(1),a=i(7),r=i(2);class u extends n.Node{constructor(){super(),this.title=r.NODE_INFO.widget["schedule-prestart-fixed"].title,this.description=r.NODE_INFO.widget["schedule-prestart-fixed"].description,this.addInputWithSettings("enable",o.Type.BOOLEAN,!0,"Enable"),this.addInput("temp",o.Type.NUMBER),this.addInput("SP",o.Type.NUMBER),this.addInput("scheduleNextStart",o.Type.NUMBER),this.addInput("reset",o.Type.NUMBER),this.addOutput("output",o.Type.STRING),this.settings.condition1_range1=o.NodeSetting.create({description:"temp > (SP + ?):",value:1,type:o.SettingType.NUMBER}),this.settings.condition1_range2=o.NodeSetting.create({description:"temp <= (SP + ?)",value:2.5,type:o.SettingType.NUMBER}),this.settings.condition1_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:20,type:o.SettingType.NUMBER}),this.settings.condition2_range1=o.NodeSetting.create({description:"temp > (SP + ?):",value:2.5,type:o.SettingType.NUMBER}),this.settings.condition2_range2=o.NodeSetting.create({description:"temp <= (SP + ?)",value:5,type:o.SettingType.NUMBER}),this.settings.condition2_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:40,type:o.SettingType.NUMBER}),this.settings.condition3_range1=o.NodeSetting.create({description:"temp > (SP + ?):",value:5,type:o.SettingType.NUMBER}),this.settings.condition3_range2=o.NodeSetting.create({description:"temp <= (SP + ?)",value:100,type:o.SettingType.NUMBER}),this.settings.condition3_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:60,type:o.SettingType.NUMBER}),this.settings.condition4_range1=o.NodeSetting.create({description:"temp > (SP + ?):",value:null,type:o.SettingType.NUMBER}),this.settings.condition4_range2=o.NodeSetting.create({description:"temp <= (SP + ?)",value:null,type:o.SettingType.NUMBER}),this.settings.condition4_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:null,type:o.SettingType.NUMBER}),this.settings.condition5_range1=o.NodeSetting.create({description:"temp > (SP + ?):",value:null,type:o.SettingType.NUMBER}),this.settings.condition5_range2=o.NodeSetting.create({description:"temp <= (SP + ?)",value:null,type:o.SettingType.NUMBER}),this.settings.condition5_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:null,type:o.SettingType.NUMBER}),this.settings.condition6_range1=o.NodeSetting.create({description:"temp < (SP + ?):",value:-1,type:o.SettingType.NUMBER}),this.settings.condition6_range2=o.NodeSetting.create({description:"temp >= (SP + ?)",value:-2.5,type:o.SettingType.NUMBER}),this.settings.condition6_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:30,type:o.SettingType.NUMBER}),this.settings.condition7_range1=o.NodeSetting.create({description:"temp < (SP + ?):",value:-2.5,type:o.SettingType.NUMBER}),this.settings.condition7_range2=o.NodeSetting.create({description:"temp >= (SP + ?)",value:-5,type:o.SettingType.NUMBER}),this.settings.condition7_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:40,type:o.SettingType.NUMBER}),this.settings.condition8_range1=o.NodeSetting.create({description:"temp < (SP + ?):",value:-5,type:o.SettingType.NUMBER}),this.settings.condition8_range2=o.NodeSetting.create({description:"temp >= (SP + ?)",value:-100,type:o.SettingType.NUMBER}),this.settings.condition8_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:60,type:o.SettingType.NUMBER}),this.settings.condition9_range1=o.NodeSetting.create({description:"temp < (SP + ?):",value:null,type:o.SettingType.NUMBER}),this.settings.condition9_range2=o.NodeSetting.create({description:"temp >= (SP + ?)",value:null,type:o.SettingType.NUMBER}),this.settings.condition9_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:null,type:o.SettingType.NUMBER}),this.settings.condition10_range1=o.NodeSetting.create({description:"temp < (SP + ?):",value:null,type:o.SettingType.NUMBER}),this.settings.condition10_range2=o.NodeSetting.create({description:"temp >= (SP + ?)",value:null,type:o.SettingType.NUMBER}),this.settings.condition10_time=o.NodeSetting.create({description:"Prestart Time (Mins)",value:null,type:o.SettingType.NUMBER}),this.setSettingsConfig({groups:[{condition1_range1:{},condition1_range2:{},condition1_time:{}},{condition2_range1:{},condition2_range2:{},condition2_time:{}},{condition3_range1:{},condition3_range2:{},condition3_time:{}},{condition4_range1:{},condition4_range2:{},condition4_time:{}},{condition5_range1:{},condition5_range2:{},condition5_time:{}},{condition6_range1:{},condition6_range2:{},condition6_time:{}},{condition7_range1:{},condition7_range2:{},condition7_time:{}},{condition8_range1:{},condition8_range2:{},condition8_time:{}},{condition9_range1:{},condition9_range2:{},condition9_time:{}},{condition10_range1:{},condition10_range2:{},condition10_time:{}}]})}onCreated(){this.enabled=!1,this.EXECUTE_INTERVAL=3e4}onAdded(){this.EXECUTE_INTERVAL=3e4,this.onInputUpdated()}onAfterSettingsChange(){this.onInputUpdated(),this.onExecute()}onExecute(){const t=(new Date).valueOf();if(!this.getInputData(0)||null==this.nextStart||this.nextStart-t<0)return this.setOutputData(0,!1),void(this.enabled=!1);if(this.enabled)return;const e=this.getInputData(1),i=this.getInputData(2);if(null!=e&&null!=i)for(var s=1;s<=10;s++){var n=this.settings[`condition${s}_range1`].value,o=this.settings[`condition${s}_range2`].value,r=this.settings[`condition${s}_time`].value;if(null!=n&&null!=o&&null!=r&&(r=a.default.timeConvert(r,"minutes"),this.nextStart-t<=r)){if(s<=5&&e>i+n&&e<=i+o)return this.enabled=!0,void this.setOutputData(0,!0);if(s>5&&e<i+n&&e>=i+o)return this.enabled=!0,void this.setOutputData(0,!0)}}}onInputUpdated(){if(!this.getInputData(0))return this.setOutputData(0,!1),void(this.enabled=!1);this.getInputData(4)&&this.inputs[4].updated&&(this.enabled=!1,this.setOutputData(0,!1));const t=this.getInputData(3);null!=t&&t===this.nextStart||(this.nextStart=t,this.setOutputData(0,!1),this.enabled=!1)}}s.Container.registerNodeType("widget/schedule-prestart-fixed",u)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(12),n=i(0),o=i(405);n.Container.registerNodeType(s.UNKNOWN_NODE,o.UnknownNode,null,!1)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UnknownNode=void 0;const s=i(3),n=i(2);class o extends s.Node{constructor(){super(),this.title=n.NODE_INFO.unknown.unknown.title,this.description=n.NODE_INFO.unknown.unknown.description}}e.UnknownNode=o},function(t,e,i){"use strict";var s=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function a(t){try{u(s.next(t))}catch(t){o(t)}}function r(t){try{u(s.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}u((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.db=void 0;const n=i(9),o=i(407),a=i(410),r=i(411),u=i(412),d=i(413),l=i(414);class p{constructor(){this.authUserDatabase=new o.default,this.userDatabase=new l.default,this.nodeDatabase=new u.default,this.dashboardDatabase=new a.default,this.scheduleDatabase=new d.default,this.historianDatabase=new r.default}asyncLoadDatabase(t,e=p.CLEANUP_INTERVAL){return s(this,void 0,void 0,(function*(){return Promise.all([this.authUserDatabase.asyncLoadDatabase(t,e),this.userDatabase.asyncLoadDatabase(t,e),this.nodeDatabase.asyncLoadDatabase(t,e),this.dashboardDatabase.asyncLoadDatabase(t,e),this.scheduleDatabase.asyncLoadDatabase(t,e),this.historianDatabase.asyncLoadDatabase(t,e)]).then(t=>(n.db_logger.info(`Finish loading ${t.length} datasource`),t))}))}addUser(t,e){this.userDatabase.addUser(t,e)}addOrUpdateUser(t,e){return this.userDatabase.addOrUpdateUser(t,e)}getUsers(t){this.userDatabase.getUsers(t)}getUser(t,e){this.userDatabase.getUser(t,e)}getAsyncUsers(){return this.userDatabase.getAsyncUsers()}updateUser(t,e,i){this.userDatabase.updateUser(t,e)}getUsersCount(t){this.userDatabase.getUsersCount(t)}removeUser(t,e){this.userDatabase.removeUser(t,e)}dropUsers(t){this.userDatabase.dropUsers()}addNode(t,e){this.nodeDatabase.addNode(t,e)}batchInsertNodes(t,e){this.nodeDatabase.batchInsertNodes(t,e)}batchDeleteNodes(t,e){this.nodeDatabase.batchDeleteNodes(t,e)}getNodes(t){this.nodeDatabase.getNodes(t)}getNodeType(t,e){this.nodeDatabase.getNodeType(t,e)}listNodes(t,e){this.nodeDatabase.listNodes(t,e)}getNode(t,e,i){this.nodeDatabase.getNode(t,e,i)}updateNode(t,e,i,s){this.nodeDatabase.updateNode(t,e,i,s)}removeNode(t,e,i){this.nodeDatabase.removeNode(t,e,i)}dropNodes(t){this.nodeDatabase.dropNodes(t)}addUiPanel(t,e){this.dashboardDatabase.addUiPanel(t,e)}getUiPanels(t){this.dashboardDatabase.getUiPanels(t)}getUiPanel(t,e){this.dashboardDatabase.getUiPanel(t,e)}updateUiPanel(t,e,i){this.dashboardDatabase.updateUiPanel(t,e,i)}dropUiPanels(t){this.dashboardDatabase.dropUiPanels(t)}removeUiPanel(t,e){this.dashboardDatabase.removeUiPanel(t,e)}addSchedule(t,e){this.scheduleDatabase.addSchedule(t,e)}updateSchedule(t,e,i){this.scheduleDatabase.updateSchedule(t,e,i)}removeSchedule(t,e){this.scheduleDatabase.removeSchedule(t,e)}addHistory(t,e){this.historianDatabase.addHistory(t,e)}updateHistory(t,e,i){this.historianDatabase.updateHistory(t,e,i)}removeHistory(t,e){this.historianDatabase.removeHistory(t,e)}addAuthUser(t){return this.authUserDatabase.addAuthUser(t)}getAuthUser(){return this.authUserDatabase.getAuthUser()}deleteAuthUsers(){return this.authUserDatabase.deleteAuthUsers()}getAuthToken(t){return this.authUserDatabase.getAuthToken(t)}isAuthenticated(t){return this.authUserDatabase.isAuthenticated(t)}}p.CLEANUP_INTERVAL=3e5;const h=new p;e.db=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(10),n=i(31),o=i(9),a=i(33),r=i(409);class u extends a.AbstractDatabase{addAuthUser(t){return new Promise((e,i)=>{this.db.find({},(a,r)=>{if(r.length)return o.db_logger.warn("User is already inserted"),void i("User is already inserted");if(!s.default.secretKey){const t="Please provide secret key on environment";return o.db_logger.error(t),void i(t)}t.password=n.default.encrypt(t.password),this.db.insert(t,(t,s)=>{t?(o.db_logger.error(t.message),i(t)):e(s)})})})}getAuthUser(){return new Promise((t,e)=>{this.db.findOne({},(i,s)=>{i?(o.db_logger.error(i.message),e(i)):t(s)})})}deleteAuthUsers(){return new Promise((t,e)=>{this.db.remove({},{multi:!0},i=>{i?(o.db_logger.error(i.message),e(i)):t("Successfully removed")})})}getAuthToken(t){return new Promise((e,i)=>{this.db.findOne({username:t.username},(a,u)=>{if(a)o.db_logger.error(a.message),i(a);else if(u&&n.default.decrypt(u.password)===t.password)try{const t=r.sign({username:u.username},s.default.secretKey,{expiresIn:18e3});e(`${t}`)}catch(t){o.db_logger.error(`Error: ${t.message}`),i(t.message)}else o.db_logger.warn("Invalid Credentials"),i("Invalid Credentials")})})}isAuthenticated(t){return new Promise((e,i)=>{r.verify(t,s.default.secretKey,(t,s)=>{t?(o.db_logger.error(t),i(t)):e(s)})})}dbName(){return"auth"}}e.default=u},function(t,e){t.exports=require("nedb")},function(t,e){t.exports=require("jsonwebtoken")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(9),n=i(33);class o extends n.AbstractDatabase{addUiPanel(t,e){this.db.insert(t,(function(t,i){t&&s.db_logger.error(t.message),e&&e(t,i)}))}getUiPanels(t){this.db.find({},(function(e,i){e&&s.db_logger.error(e),t&&t(e,i)}))}getUiPanel(t,e){this.db.findOne({name:t},(function(t,i){t&&s.db_logger.warn(t.message),e&&e(t,i)}))}updateUiPanel(t,e,i){this.db.update({name:t},e,{},(function(e,n){e&&s.db_logger.error(e.message),0==n&&s.db_logger.error(`Cat't update dashboard panel [${t}]. Document not found.`),i&&i(e)}))}removeUiPanel(t,e){this.db.remove({name:t},{},(function(t,i){t&&s.db_logger.error(t.message),0==i&&s.db_logger.error("Cat't remove. Document not found."),e&&e(t)}))}dropUiPanels(t){this.db.remove({},{multi:!0},(function(e){e&&s.db_logger.error(e.message),t&&t(e)}))}dbName(){return"dashboard"}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(9),n=i(33);class o extends n.AbstractDatabase{addHistory(t,e){this.db.insert(t,(function(t,i){t&&s.db_logger.error(t.message),e&&e(t,i)}))}updateHistory(t,e,i,n){this.db.update(t,e,{},(function(t,e){t?s.db_logger.error(t.message):n(e),0==e&&s.db_logger.error(`Can't update history [${name}]. Document not found.`),i&&i(t)}))}removeHistory(t,e,i){this.db.remove(t,{},(function(t,n){t?s.db_logger.error(t.message):i(n),0==n&&s.db_logger.debug("Cat't remove. History Document not found."),e&&e(t)}))}dbName(){return"history"}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(22),n=i(16),o=i(9),a=i(33);class r extends a.AbstractDatabase{addNode(t,e){let i=s.SerializableHelper.serialize(t);i._id=n.IdGenerator.createNodeId(i.cid,i.id),this.db.insert(i,(function(t,i){t&&o.db_logger.error(t.message),e&&e(t,i)}))}batchInsertNodes(t,e){this.db.insert(t.map(t=>(t._id=n.IdGenerator.createNodeId(t.cid,t.id),s.SerializableHelper.serialize(t))),(function(t,i){t&&o.db_logger.error(t.message),e&&e(t,i)}))}batchDeleteNodes(t,e){this.db.remove(t,{multi:!0},(function(t,i){t&&o.db_logger.warn(t.message),e&&e(t,i)}))}getNodes(t){this.db.find({},(function(e,i){e&&o.db_logger.warn(e),t&&t(e,i)}))}getNode(t,e,i){let s=n.IdGenerator.createNodeId(e,t);this.db.findOne({_id:s},(function(t,e){t&&o.db_logger.warn(t.message),i&&i(t,e)}))}getNodeType(t,e){this.db.find({type:t},(function(t,i){t&&o.db_logger.warn(t.message),e&&e(t,i)}))}listNodes(t,e){this.db.find(t,(function(t,i){t&&o.db_logger.warn(t.message),e&&e(t,i)}))}updateNode(t,e,i,s){let a=n.IdGenerator.createNodeId(e,t);this.db.update({_id:a},i,{},(function(i,n){i&&o.db_logger.error(i.message),0==n&&o.db_logger.warn(`Can't update node [${e}/${t}]. Document not found.`),s&&s(i)}))}removeNode(t,e,i){let s=n.IdGenerator.createNodeId(e,t);this.db.remove({_id:s},{},(function(t,e){t&&o.db_logger.error(t.message),0==e&&o.db_logger.warn("Can't remove. Document not found."),i&&i(t)}))}dropNodes(t){this.db.remove({},{multi:!0},(function(e){e&&o.db_logger.error(e.message),t&&t(e)}))}dbName(){return"nodes"}}e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(9),n=i(33);class o extends n.AbstractDatabase{addSchedule(t,e){this.db.insert(t,(function(t,i){t&&s.db_logger.error(t.message),e&&e(t,i)}))}updateSchedule(t,e,i,n){this.db.update(t,e,{},(function(t,e){t?s.db_logger.error(t.message):n(e),0==e&&s.db_logger.error(`Can't update schedule [${name}]. Document not found.`),i&&i(t)}))}removeSchedule(t,e,i){this.db.remove(t,{},(function(t,n){t?s.db_logger.error(t.message):i(n),0==n&&s.db_logger.debug("Cat't remove. Schedule Document not found."),e&&e(t)}))}dbName(){return"schedule"}}e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(9),n=i(33);class o extends n.AbstractDatabase{addUser(t,e){this.db.insert(t,(function(t,i){t&&s.db_logger.error(t.message),e&&e(t,i)}))}getUser(t,e){this.db.findOne(t,(function(t,i){t&&s.db_logger.warn(t.message),e&&e(t,i)}))}getUsers(t){this.db.find({},(function(e,i){e&&s.db_logger.error(e),t&&t(e,i)}))}getAsyncUsers(){return new Promise((t,e)=>{this.db.find({},(function(i,n){i?(s.db_logger.warn(i.message),e(i)):t(n)}))})}updateUser(t,e,i){this.db.update(t,e,{},(function(t,e){t&&s.db_logger.error(t.message),0==e&&s.db_logger.error(`Cat't update user [${name}]. Document not found.`),i&&i(t)}))}getUsersCount(t){this.db.count({},(function(e,i){e&&s.db_logger.warn(e.message),t&&t(e,i)}))}addOrUpdateUser(t,e){return new Promise((i,s)=>{this.getUser(t,(n,o)=>{o?this.updateUser(t,e,t=>{t?s(t):i()}):this.addUser(e,t=>{t?s(t):i()})})})}removeUser(t,e){this.db.remove(t,{},(function(t,i){t&&s.db_logger.error(t.message),e&&e(t)}))}dropUsers(t){this.db.remove({},{multi:!0},(function(e){e&&s.db_logger.error(e.message),t&&t(e)}))}dbName(){return"users"}}e.default=o}]);
//# sourceMappingURL=app.js.map